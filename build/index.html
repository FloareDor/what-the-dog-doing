<!doctype html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover"><title>Scotty Survival</title><style>:root{--bg:#0a0d12;--sky:#1a2940;--ink:#ecf3ff;--red:#ef4f6c;--mint:#69f0c9;--gold:#ffd56d;--line:#2f4868}*{box-sizing:border-box}html,body{margin:0;width:100%;height:100%;overflow:hidden;background:var(--bg);color:var(--ink);font-family:Trebuchet MS,Avenir Next,Segoe UI,sans-serif}body{touch-action:none}canvas{display:block;width:100%;height:100%}</style></head><body><canvas id="c"></canvas><script src="leaderboard-config.js"></script><script>(()=>{const t=document.getElementById("c"),e=t.getContext("2d");let a=360,l=740,s=1,n=0;const r=[{id:"home",n:"Cohon Centre",x:260,y:900,r:170,c:"#8ec0ff"},{id:"nsh",n:"NSH",x:980,y:460,r:170,c:"#79d7ff"},{id:"mel",n:"Mellon Inst",x:1880,y:1260,r:185,c:"#ffd58f"}],o=["i need to go out","these things are scary","may lord help us","can we ever go out?"],i=["a dog?","scotty??","what the dog doing?"],h=180,f=.42,c=1.08,d=9999,m=9e3,b={};function x(t){const e=new Image;return e.src="black_scottish_terrier_dog_with_red_scarf/rotations/"+t+".png",e}b.e=x("east"),b.w=x("west"),b.ne=x("north-east"),b.nw=x("north-west"),b.se=x("south-east"),b.sw=x("south-west");let y=0;function p(t,e,a,l){if(!y)return;const s=y.createOscillator(),n=y.createGain();s.type=a||"triangle",s.frequency.value=t,n.gain.value=l||.02,n.gain.exponentialRampToValueAtTime(1e-4,y.currentTime+e),s.connect(n).connect(y.destination),s.start(),s.stop(y.currentTime+e)}let g=0;function M(){if(!u.start)return;const t=performance.now();t-g<1200||(g=t,p(392,.07,"square",.02),p(523,.08,"triangle",.014))}const u={start:0,dead:0,lvup:0,t:0,time:0,kills:0,spawnT:0,nextSpawn:.8,msg:"",msgT:0,level:1,xp:0,nextXp:24,stop:0,shake:0,xpPulse:0,cardT:0,best:+localStorage.ss_best||0,choices:[],homeNeed:3,homeGot:0,sch:{nsh:0,mel:0},pz:0,uq:[],inB:"",mb:0,mbd:0,bs:0,bd:0,bs2:0,bd2:0,b2At:0,pred:0,predDead:0,moth:0,mothDead:0,bossDownT:0,won:0,endWave:0,endT:0,endSpawnT:0,apWarn1:0,apWarn2:0,apStormHitCd:0,botMask:0,chemMask:0,labStep:0,labBank:0,labFlip:0,labNsh:0,labMel:0,labNshRuns:0,labMelRuns:0,stormCd:0,labCd:0,safeCampT:0,safeBreachCd:0,safeThreat:0,lvPend:0,lvGrace:0,lbSent:0,lbTop:[],lbTopErr:"",lbFetchT:0,lbRankText:"",lbRankErr:"",lbRankFetchT:0,lbBtnX:0,lbBtnY:0,lbBtnW:0,lbBtnH:0},k=window.LEADERBOARD_CONFIG||{},T=((k.supabaseUrl||"")+"").replace(/\/+$/,""),S=(k.supabaseAnonKey||"")+"",C=(k.table||"leaderboard_entries")+"",P="zoomies_last_entry",v="zoomies_lb_name",R="zoomies_lb_optin";function A(t){try{return localStorage.getItem(t)||""}catch{return""}}function z(t,e){try{localStorage.setItem(t,e)}catch{}}function w(t){return"string"==typeof t&&t.length>0&&t.length<=24&&/^[A-Za-z0-9 _.-]+$/.test(t)}function D(){location.href="leaderboard.html"}async function I(t){if(!T||!S||!C)return;const e=Date.now();if(t||!(e-u.lbFetchT<8e3)){u.lbFetchT=e,u.lbTopErr="";try{const t="?select=name,kills,time_seconds&order=kills.desc,time_seconds.asc,id.asc&limit=3",e=await fetch(T+"/rest/v1/"+encodeURIComponent(C)+t,{headers:{apikey:S,Authorization:"Bearer "+S}});if(!e.ok)return void(u.lbTopErr="leaderboard unavailable");const a=await e.json();u.lbTop=Array.isArray(a)?a:[]}catch{u.lbTopErr="leaderboard unavailable"}}}async function B(t){if(!T||!S||!C)return;const e=Date.now();if(!t&&e-u.lbRankFetchT<8e3)return;u.lbRankFetchT=e,u.lbRankErr="";const a=function(t){try{const e=localStorage.getItem(t);return e?JSON.parse(e):0}catch{return 0}}(P);if(a&&a.id)try{const s=await fetch(T+"/rest/v1/"+encodeURIComponent(C)+"?select=id,name,kills,time_seconds&id=eq."+a.id+"&limit=1",{headers:{apikey:S,Authorization:"Bearer "+S}});if(!s.ok)return void(u.lbRankErr="rank unavailable");const n=await s.json();if(!Array.isArray(n)||!n.length)return void(u.lbRankText="score syncing...");const r=n[0];async function l(t){const e=await fetch(T+"/rest/v1/"+encodeURIComponent(C)+"?select=id&"+t,{method:"HEAD",headers:{apikey:S,Authorization:"Bearer "+S,Prefer:"count=exact"}});if(!e.ok)throw Error("count failed");return function(t){const e=((t||"")+"").match(/\/(\d+)$/);return e?+e[1]:0}(e.headers.get("content-range"))}const o=await l("kills=gt."+r.kills)+await l("kills=eq."+r.kills+"&time_seconds=lt."+r.time_seconds)+await l("kills=eq."+r.kills+"&time_seconds=eq."+r.time_seconds+"&id=lt."+r.id)+1;u.lbRankText="your rank #"+o+" ("+r.kills+" / "+Number(r.time_seconds).toFixed(1)+"s)"}catch{u.lbRankErr="rank unavailable"}else u.lbRankText="submit once to track your rank"}const W={x:260,y:900,vx:0,vy:0,r:15,hp:100,maxHp:100,speed:185,fireCd:0,fireRate:.46,dmg:12,range:400,shots:1,magnet:88,face:1,rx:0,ry:0,flash:0,gx:1,gy:0,zc:0,zr:0,zt:0,zx:1,zy:0,zcd:0,zDur:1,zSpd:2.1,zLoad:1.5,zCool:5.5,zDmg:24,zDr:.55,zb:0,zp:0,mkOn:0,mkT:0,mkI:8.8,mkS:0,mkD:14,mkR:54,mkSl:.54,chDo:14,chBurst:10,chHeal:8,chHealCd:0,chHealI:.85,cat:0,catM:0,catType:0,bot:0,botCount:0,botSlots:0,bType:0,bAtk:1,bAuraR:0,bAuraSl:0,bHealCd:0,bHealI:10,bHealAmt:10,bHealFx:0,triA:0,triFx:0,slCharge:0,slFocus:0,slT:0,slRecallT:0,slLinkT:0,slRecallPulse:0,slCarryVx:0,slCarryVy:0,slPow:0,slWave:0,slComboFx:0,slHitMask:0,slPerfect:0,slDx:1,slDy:0,bx:0,by:0,ba:0,bcd:0,bRate:1.9,bDmg:1.15,bRange:480,bFetch:95,bPull:195,bCarry:0,bCarryMax:2,bGrabCd:0,bGrabI:.38,bPier:4,bSize:6},E={l:0,r:0,u:0,d:0,gr:0};let H=-1,L=0;const F={x:78,y:0,r:42,kr:16,tx:0,ty:0,ax:0,ay:0,ttx:0,tty:0,tax:0,tay:0,show:0,act:0},q=[],O=[],N=[],G=[],X=[],V=[],_=[];function Y(t,e){return t+Math.random()*(e-t)}function K(t,e,a){return t<e?e:t>a?a:t}function U(t,e,a,l,s,n){const r=s-a,o=n-l;let i=((t-a)*r+(e-l)*o)/(r*r+o*o||1);i=K(i,0,1);const h=t-(a+r*i),f=e-(l+o*i);return h*h+f*f}function Z(t){const e=t-1;return 1+2.70158*e*e*e+1.70158*e*e}function Q(t,a,l,s,n){const r=Math.max(0,Math.min(n,.5*Math.min(l,s)));e.beginPath(),e.moveTo(t+r,a),e.lineTo(t+l-r,a),e.quadraticCurveTo(t+l,a,t+l,a+r),e.lineTo(t+l,a+s-r),e.quadraticCurveTo(t+l,a+s,t+l-r,a+s),e.lineTo(t+r,a+s),e.quadraticCurveTo(t,a+s,t,a+s-r),e.lineTo(t,a+r),e.quadraticCurveTo(t,a,t+r,a),e.closePath()}function j(){const t=a<560,e=t?a-14:Math.min(a-20,620),s=t?K(.48*l,296,390):K(.4*l,268,340),n=.5*(a-e),r=l-s-12,o=[];if(t){const t=8,a=e-22,l=Math.max(74,Math.min(100,(s-84-2*t)/3)),i=r+50;for(let e=0;e<3;e++)o.push({x:n+14,y:i+e*(l+t),w:a,h:l})}else{const t=10,a=(e-32-2*t)/3,l=Math.max(102,Math.min(130,s-82)),i=r+52;for(let e=0;e<3;e++)o.push({x:n+16+e*(a+t),y:i,w:a,h:l})}return{mobile:t,bx:n,by:r,bw:e,bh:s,rects:o}}function J(t,a,l,s,n,r){const o=t.split(" ");let i="",h=0;for(let t=0;t<o.length;t++){const f=i?i+" "+o[t]:o[t];if(e.measureText(f).width<=s)i=f;else{if(e.fillText(i,a,l+h*n),h++,h>=r)return;i=o[t]}}h<r&&i&&e.fillText(i,a,l+h*n)}function $(t,a){let l=(t??"")+"";if(a<=0)return"";if(e.measureText(l).width<=a)return l;for(;l.length>1&&e.measureText(l+"...").width>a;)l=l.slice(0,-1);return l+"..."}function tt(t){return t.includes("Buddy")||t.includes("Bot")?"ü§ñ":t.includes("Catalyst")||t.includes("Chemical")||t.includes("Acidic")?"üß™":t.includes("Heal")||t.includes("Tough")?"‚ù§Ô∏è":t.includes("Shock")||t.includes("Zoomies")||t.includes("Rapid")||t.includes("Speed")?"‚ö°":t.includes("Magnet")?"üß≤":t.includes("Shot")?"üéØ":t.includes("Territory")||t.includes("Puddle")||t.includes("Gravity")?"üíß":t.includes("Bite")?"ü¶¥":"üõ†Ô∏è"}function et(t){for(let e=0;e<r.length;e++)if(r[e].id===t)return r[e];return 0}function at(t,e,a){const l=a||0;for(let a=0;a<r.length;a++){const s=r[a],n=t-s.x,o=e-s.y;if(n*n+o*o<(s.r+l)*(s.r+l))return s}return 0}function lt(t,e){const a=e||0;let l=0;for(let e=0;e<r.length;e++){const s=r[e];let n=t.x-s.x,o=t.y-s.y,i=Math.hypot(n,o)||1;const h=s.r+a;if(i<h){if(i<.001){const t=Math.random()*Math.PI*2;n=Math.cos(t),o=Math.sin(t),i=1}t.x=s.x+n/i*h,t.y=s.y+o/i*h,l=1}}return l}function st(){const t=Math.min(a-24,420),e=Math.min(l-130,260),s=.5*(a-t),n=.5*(l-e)+24,r=(t-36-20)/3,o=n+e-72;return{bx:s,by:n,bw:t,bh:e,btn:[{x:s+18,y:o,w:r,h:46},{x:s+18+r+10,y:o,w:r,h:46},{x:s+18+2*(r+10),y:o,w:r,h:46}]}}function nt(t){const e=[];let a=-1;for(let l=0;l<t;l++){let t=3*Math.random()|0;t===a&&(t=(t+1+(2*Math.random()|0))%3),e.push(t),a=t}return e}function rt(t,e){if(!u.pz)if("lab"===e&&"nsh"===t){const t=1+(u.labNshRuns/2|0),e=4+Math.min(2,t-1);u.pz={id:"nsh",seq:nt(e),step:0,lab:1,trial:u.labNshRuns+1,tier:t},u.msg="research",u.msgT=1.2}else if("lab"===e&&"mel"===t){const t=1+(u.labMelRuns/2|0),e=5+Math.min(2,t-1);u.pz={id:"mel",seq:nt(e),step:0,lab:1,trial:u.labMelRuns+1,tier:t},u.msg="research",u.msgT=1.2}else"nsh"===t?(u.pz={id:"nsh",seq:nt(3),step:0},u.msg="research",u.msgT=1.2):"mel"===t&&(u.pz={id:"mel",seq:nt(4),step:0},u.msg="research",u.msgT=1.2)}function ot(t){if(!u.pz)return;const e=u.pz;if(t===e.seq[e.step]){if(e.step++,p(620+70*e.step,.04,"triangle",.018),e.step>=e.seq.length){const t=e.id;u.pz=0,function(t){"nsh"===t&&2!==u.sch.nsh?(u.sch.nsh=2,mt("nsh"),u.msg="nsh",u.msgT=2.1,At(.12),Ht(W.x,W.y,"#79d7ff",16,95),p(760,.07,"square",.024)):"nsh"===t&&u.labNsh>0?(u.labNsh--,mt("nsh"),u.msg="nsh prototype ready",u.msgT=1.8,At(.12),Ht(W.x,W.y,"#9de6ff",12,72),p(740,.06,"triangle",.022)):"mel"===t&&2!==u.sch.mel?(u.sch.mel=2,mt("mel"),u.msg="mel",u.msgT=2.1,At(.12),Ht(W.x,W.y,"#ffd58f",16,95),p(720,.07,"square",.024)):"mel"===t&&u.labMel>0&&(u.labMel--,mt("mel"),u.msg="mellon prototype ready",u.msgT=1.8,At(.12),Ht(W.x,W.y,"#b6ef9d",12,72),p(720,.06,"triangle",.022)),Tt(),u.labCd=3}(t),e.lab&&("nsh"===t?u.labNshRuns++:"mel"===t&&u.labMelRuns++)}}else e.step=0,At(.03),p(180,.06,"square",.02),u.msg="retry",u.msgT=.55}function it(t){"nsh"===t&&0===u.sch.nsh?(u.sch.nsh=1,M(),rt("nsh"),u.msg="help",u.msgT=1.4,p(640,.05,"triangle",.02)):"mel"===t&&0===u.sch.mel&&(u.sch.mel=1,M(),rt("mel"),u.msg="help",u.msgT=1.4,p(680,.05,"triangle",.02))}function ht(){const t=bt(u.chemMask);return t>=3?"triple burst":2===t?"dual burst":1&u.chemMask?"acid":2&u.chemMask?"heal":4&u.chemMask?"grav":"chem"}function ft(){W.cat&&(u.msg="brew: "+ht(),u.msgT=1.1,p(520,.04,"triangle",.016))}function ct(){if(2!==u.sch.nsh)return 0;let t=1;return(u.mbd||u.bs||u.bd||u.bs2||u.bd2)&&(t=2),(u.bs2||u.bd2)&&(t=3),t}function dt(){if(2!==u.sch.mel)return 0;let t=1;return(u.bd||u.bs2||u.bd2)&&(t=2),(u.bs2||u.bd2)&&(t=3),t}function mt(t){u.uq.indexOf(t)<0&&u.uq.push(t)}function bt(t){return(1&t?1:0)+(2&t?1:0)+(4&t?1:0)}function xt(){return W.zt>0||W.slT>0||W.slRecallT>0||W.slLinkT>0}function yt(){return xt()||u.lvGrace>0}const pt={1:{rate:1.15,dmg:1.6,range:620,fetch:72,pull:150,carry:1,grab:.42,pier:5,size:7.2,auraR:0,auraSl:0,healI:0,healAmt:0,pulse:1,col:"#9de6ff",body:"#93d8ff",ring:"#d0efff"},2:{rate:1.72,dmg:.95,range:520,fetch:118,pull:198,carry:2,grab:.34,pier:0,size:3.8,auraR:0,auraSl:0,healI:18,healAmt:10,pulse:0,col:"#7ae8a3",body:"#74de95",ring:"#d9ffe5"},3:{rate:2.45,dmg:.95,range:390,fetch:110,pull:205,carry:2,grab:.34,pier:2,size:8.5,auraR:124,auraSl:.46,healI:0,healAmt:0,pulse:1,col:"#ffd48c",body:"#ffd48c",ring:"#fff0c7"}};function gt(t){const e=pt[t]||pt[1],a=Math.max(0,W.bCarryMax-2);return{rate:Math.max(.5,e.rate*(W.bRate/1.9)),dmg:e.dmg*(W.bDmg/1.15),range:e.range*(W.bRange/480),fetch:e.fetch*(W.bFetch/95),pull:e.pull*(W.bPull/195),carry:Math.max(1,e.carry+a),grab:Math.max(.14,e.grab*(W.bGrabI/.38)),pier:Math.max(0,Math.round(e.pier+(W.bPier-4))),size:Math.max(2.8,e.size*(W.bSize/6)),auraR:e.auraR,auraSl:e.auraSl,healI:e.healI,healAmt:e.healAmt,pulse:e.pulse,col:e.col,body:e.body,ring:e.ring}}function Mt(t){const e=[];for(let a=1;a<=3;a++)t&1<<a-1||e.push(a);return e}function ut(t){return 1===t?{n:"Volt Buddy",d:"striker bot: rapid shock pulses, low cargo",f:()=>Pt(1),bg:"rgba(29,53,79,.96)",st:"rgba(147,216,255,.88)",tx:"#f1f9ff",sub:"#b3d4ee"}:2===t?{n:"Medic Buddy",d:"green rounds + heals Scotty every 18s",f:()=>Pt(2),bg:"rgba(24,72,44,.96)",st:"rgba(148,232,171,.9)",tx:"#e9ffef",sub:"#b9e5c6"}:{n:"Guard Buddy",d:"warden bot: slowing aura + sturdy pulse",f:()=>Pt(3),bg:"rgba(73,50,27,.96)",st:"rgba(255,205,138,.9)",tx:"#fff4df",sub:"#e6cda5"}}function kt(t){return 1===t?{n:"Acidic Puddle",d:"corrosive zone: burst + damage over time",f:()=>vt(1),bg:"rgba(33,75,34,.96)",st:"rgba(160,236,146,.88)",tx:"#edffe9",sub:"#bce2b3"}:2===t?{n:"Heal Puddle",d:"restorative zone: heals Scotty while inside",f:()=>vt(2),bg:"rgba(22,79,72,.96)",st:"rgba(151,242,228,.9)",tx:"#e8fffb",sub:"#b6e7df"}:{n:"Gravity Puddle",d:"black hole zone: drags enemies from far outside",f:()=>vt(3),bg:"rgba(30,45,86,.96)",st:"rgba(156,190,255,.9)",tx:"#edf3ff",sub:"#bfd1f0"}}function Tt(){for(;u.kills>=110*(u.labStep+1);)u.labStep++,u.labBank=Math.min(6,u.labBank+1),u.msg="new prototype intel",u.msgT=1.25,p(620,.04,"triangle",.018);for(;u.labBank>0;){const t=u.uq.indexOf("nsh")>=0?1:0,e=u.uq.indexOf("mel")>=0?1:0,a=bt(u.botMask),l=bt(u.chemMask),s=ct(),n=dt(),r=a+u.labNsh+t,o=l+u.labMel+e,i=2===r+1?2:4,h=2===o+1?2:3,f=2===u.sch.nsh&&a>=1&&r<s&&u.labBank>=i,c=2===u.sch.mel&&l>=1&&o<n&&u.labBank>=h;if(!f&&!c)break;let d="";f&&c?(u.labFlip^=1,d=u.labFlip?"nsh":"mel"):d=f?"nsh":"mel","nsh"===d?(u.labNsh++,u.msg="nsh: prototype bench ready",u.msgT=1.6,p(700,.05,"triangle",.02),u.labBank-=i):(u.labMel++,u.msg="mellon: catalyst bench ready",u.msgT=1.6,p(680,.05,"triangle",.02),u.labBank-=h)}}function St(t){u.lvup||u.pz||u.uq.length||u.labCd>0||("nsh"===t&&u.labNsh>0?(rt("nsh","lab"),u.msg="nsh: run prototype trial",u.msgT=1.35,p(700,.05,"triangle",.02)):"mel"===t&&u.labMel>0&&(rt("mel","lab"),u.msg="mellon: run prototype trial",u.msgT=1.35,p(680,.05,"triangle",.02)))}function Ct(){const t=function(){const t=[];for(let e=1;e<=3;e++)u.botMask&1<<e-1&&t.push(e);return t}(),e=W.bot?Math.max(1,Math.min(0|W.botCount,t.length||1)):0;for(;V.length<e;){const e=t[Math.min(t.length-1,V.length)]||1;V.push({x:W.x,y:W.y,t:e,cd:Y(.05,.3),grabCd:Y(.03,.22),slx:0,sly:0,vx:0,vy:0})}for(;V.length>e;)V.pop();for(let e=0;e<V.length;e++)V[e].t=t[Math.min(t.length-1,e)]||V[e].t||1;if(W.botSlots!==e){const t=40;for(let e=0;e<V.length;e++){const a=W.ba+e*(2*Math.PI/Math.max(1,V.length));V[e].x=W.x+Math.cos(a)*t,V[e].y=W.y+Math.sin(a)*t,V[e].cd=Y(.05,.3),V[e].grabCd=Y(.03,.22),V[e].slx=0,V[e].sly=0,V[e].vx=0,V[e].vy=0}W.botSlots=e}V.length||(W.bx=W.x+20,W.by=W.y+4,W.botSlots=0)}function Pt(t){const e=!W.bot;W.bot=1,W.bType=t,W.bx=W.x+20,W.by=W.y+4,W.ba=0,e&&(W.bcd=.45,W.bRate=1.9,W.bDmg=1.15,W.bRange=480,W.bFetch=95,W.bPull=195,W.bCarry=0,W.bCarryMax=2,W.bGrabCd=0,W.bGrabI=.38,W.bPier=4,W.bSize=6,W.bAtk=1,W.bAuraR=0,W.bAuraSl=0,W.bHealCd=0,W.bHealI=10,W.bHealAmt=10,W.bHealFx=0),u.botMask|=1<<t-1,W.botCount=Math.max(1,bt(u.botMask)),Ct(),Tt()}function vt(t){W.cat=1,W.catType=t,W.catM=0,W.chDo=14,W.chBurst=10,W.chHeal=8,W.chHealCd=0,W.chHealI=.85,1===t?(W.chDo=20,W.chBurst=13):2===t?(W.chHeal=10,W.chHealI=.85):W.mkSl=Math.max(W.mkSl,.6),u.chemMask|=1<<t-1,Tt()}function Rt(){if(u.lvup||u.dead||u.pz||!u.uq.length||yt())return;const t=u.uq.shift();if(u.choices=[],"nsh"===t){const t=Mt(u.botMask);if(1===t.length){const e=t[0];return Pt(e),u.msg="nsh: "+function(t){return 1===t?"Volt Buddy":2===t?"Medic Buddy":"Guard Buddy"}(e)+" calibrated",u.msgT=1.6,Ht(W.x,W.y,"#9de6ff",14,84),void p(760,.06,"triangle",.025)}2===t.length?u.choices=[ut(t[0]),ut(t[1]),{n:"Wildcard Buddy",d:"installs one of the remaining buddy prototypes",f:()=>Pt(t[Math.random()*t.length|0]),bg:"rgba(42,63,95,.96)",st:"rgba(167,207,255,.86)",tx:"#eef7ff",sub:"#c3d8ef"}]:3===t.length&&(u.choices=[ut(1),ut(2),ut(3)])}else if("mel"===t){const t=Mt(u.chemMask);if(1===t.length){const e=t[0];return vt(e),u.msg="mellon: "+function(t){return 1===t?"Acidic Puddle":2===t?"Heal Puddle":"Gravity Puddle"}(e)+" calibrated",u.msgT=1.6,Ht(W.x,W.y,"#b6ef9d",14,84),void p(740,.06,"triangle",.025)}2===t.length?u.choices=[kt(t[0]),kt(t[1]),{n:"Wildcard Catalyst",d:"mixes one of the remaining catalyst variants",f:()=>vt(t[Math.random()*t.length|0]),bg:"rgba(38,76,56,.96)",st:"rgba(159,236,184,.88)",tx:"#eaffef",sub:"#c2ebd0"}]:3===t.length&&(u.choices=[kt(1),kt(2),kt(3)])}u.choices.length&&(u.lvup=1,u.cardT=0,u.msg="up",u.msgT=1.4,p(760,.07,"triangle",.028))}function At(t){u.shake=K(u.shake+t,0,1.3)}function zt(t){u.stop=Math.max(u.stop,t)}function wt(){s=Math.max(1,Math.min(2,devicePixelRatio||1)),a=Math.max(320,0|innerWidth),l=Math.max(560,0|innerHeight),t.width=a*s|0,t.height=l*s|0,e.setTransform(s,0,0,s,0,0),e.imageSmoothingEnabled=!1;const n=F.r+16;F.act?(F.x=K(F.x,n,a-n),F.y=K(F.y,n,l-n)):(F.x=78,F.y=l-88)}function Dt(t,e){let a=t-F.x,l=e-F.y;const s=Math.hypot(a,l)||1,n=F.r;s<10?(a=0,l=0):s>n&&(a=a/s*n,l=l/s*n),F.ttx=a,F.tty=l,F.tax=a/n,F.tay=l/n}function It(t){F.act=0,F.ttx=0,F.tty=0,F.tax=0,F.tay=0,t&&(F.tx=0,F.ty=0,F.ax=0,F.ay=0,F.show=0)}function Bt(t){X.length>=420||X.push(t)}function Wt(t){N.length>=260||N.push(t)}function Et(t){O.length>=260||O.push(t)}function Ht(t,e,a,l,s){const n=q.length>130?.5:q.length>90?.7:1,r=Math.max(1,l*n|0);for(let l=0;l<r;l++){const l=Math.random()*Math.PI*2,n=(s||70)*(.4+Math.random());Bt({x:t,y:e,vx:Math.cos(l)*n,vy:Math.sin(l)*n,t:Y(.2,.6),c:a})}}function Lt(t,e,a,l,s){const n=q[t],r=!!s;if(6===n.k){const t=80+2*n.r,e=12+.3*u.time,a=W.x-n.x,l=W.y-n.y,s=Math.hypot(a,l);s<t&&!at(W.x,W.y,-8)&&($t(e*(1-s/t)),W.vx+=a/(s||1)*180,W.vy+=l/(s||1)*180),Ht(n.x,n.y,"#ff6644",20,t),Ht(n.x,n.y,"#ffaa44",12,.65*t),At(.1),p(180,.06,"sawtooth",.02)}if(9===n.k){u.pred=0,u.predDead=1,u.msg="predator down!",u.msgT=2.2,u.bossDownT=2,zt(.1),At(.45),Ht(n.x,n.y,"#ff2222",30,200),Ht(n.x,n.y,"#ffa64d",18,140),p(240,.1,"sawtooth",.03),p(380,.1,"triangle",.022);for(let t=q.length-1;t>=0;t--)10===q[t].k&&(Ht(q[t].x,q[t].y,"#882222",8,40),q.splice(t,1))}if(11===n.k){u.moth=0,u.mothDead=1,u.won=1,u.msg="CAMPUS SECURED",u.msgT=999,u.bossDownT=5,zt(.15),At(.7),Ht(n.x,n.y,"#ff44ff",60,360),Ht(n.x,n.y,"#ffd56d",50,300),Ht(n.x,n.y,"#69f0c9",40,250),Ht(n.x,n.y,"#8ec0ff",30,200),p(440,.22,"triangle",.035),p(554,.2,"triangle",.03),p(659,.24,"triangle",.035),p(880,.3,"triangle",.03);for(let t=q.length-1;t>=0;t--)12===q[t].k&&(Ht(q[t].x,q[t].y,"#662266",6,34),q.splice(t,1))}if(5===n.k&&(u.mb=0,u.mbd=1,u.msg="the provost is down!",u.msgT=2,u.bossDownT=1.6,zt(.08),At(.4),Ht(n.x,n.y,"#ffa64d",36,190),Ht(n.x,n.y,"#ffe0a0",20,130),p(240,.1,"sawtooth",.03),p(380,.1,"triangle",.02)),3===n.k){u.bd=1,u.bs=0,u.b2At=u.t+12,u.apWarn1=0,u.apWarn2=0,u.apStormHitCd=0;const t=n.b1Eat||0;u.msg=t>8?"the dean falls... stuffed with "+t+" mints":"the dean is defeated!",u.msgT=2.4,u.bossDownT=2.4,zt(.12),At(.6),Ht(n.x,n.y,"#ffe38f",48,240),Ht(n.x,n.y,"#a789ff",30,180),t>4&&Ht(n.x,n.y,"#69f0c9",20,160),p(200,.12,"sawtooth",.038),p(320,.12,"triangle",.024),p(500,.14,"square",.02)}else 4===n.k&&(u.bd2=1,u.bs2=0,u.msg="APEX DOWN ‚Äî ENDLESS MODE BEGINS",u.msgT=2.8,u.endWave=0,u.endT=0,u.endSpawnT=6,At(.42),zt(.08),Ht(n.x,n.y,"#c8b6ff",40,260),Ht(n.x,n.y,"#ffd56d",24,180),p(210,.16,"sawtooth",.04),p(330,.12,"triangle",.025));u.kills++,Tt(),r?Ht(n.x,n.y,e||"#ff9675",Math.max(2,.35*(a||9)|0),Math.max(20,.6*(l||70))):(zt(.03),At(.08),Ht(n.x,n.y,e||"#ff9675",a||9,l||70),p(280,.03,"square",.012));const o=260-N.length;if(o>0){const t=r?Math.random()<.25?1:0:1+(Math.random()<.4?1:0);for(let e=0;e<Math.min(t,o);e++)Wt({x:n.x+Y(-7,7),y:n.y+Y(-7,7),v:0|Y(5,8),m:1,t:0})}q.splice(t,1)}function Ft(t){G.length>=18&&G.shift(),G.push({x:W.x+4*W.gx,y:W.y+8,r:W.mkR,t:W.mkD,d:W.mkD,m:t});const e=1===t?"acid":2===t?"heal":3===t?"grav":"territory",a=1===t?"#8fdd73":2===t?"#7ad8cd":3===t?"#8fb6ff":"#ffd56d";u.msg=e,u.msgT=.5,Ht(W.x,W.y+8,a,8,38),p(1===t?540:2===t?600:3===t?480:560,.03,"triangle",.018),zt(.015),At(.035)}function qt(){const t=[];if(W.cat)for(let e=1;e<=3;e++)u.chemMask&1<<e-1&&t.push(e);t.length||t.push(0),Ft(t[0]),W.mkS=.32,W.mkBurstQ=t.slice(1),W.mkBurst=W.mkBurstQ.length,W.mkBurstT=W.mkBurst>0?.5:0,W.mkBurst<=0&&(W.mkT=W.mkI)}function Ot(t,e,a,l,s){(function(t,e,a,l){for(let s=0;s<_.length;s++){const n=_[s],r=e-n.x,o=a-n.y;if(n.k===t&&r*r+o*o<(l+n.r)*(l+n.r)*.22)return 1}return 0})(t,e,a,l)||(_.length>=14&&_.shift(),_.push({k:t,x:e,y:a,r:l,t:s,d:s,pcd:0}),u.msg=function(t){return 1===t?"vortex: pull + melt":2===t?"sanctuary: heal + slow":3===t?"toxic bloom: chip + regen":"campus storm!"}(t),u.msgT=4===t?1.55:1.2,Ht(e,a,function(t){return 1===t?"#95f0b8":2===t?"#89ffe8":3===t?"#ccff9b":"#c8f3ff"}(t),4===t?24:14,4===t?126:84),p(4===t?820:1===t?700:2===t?640:680,.06,"triangle",.022))}function Nt(t,e,a){G[t]&&(G[t].t=Math.min(G[t].t,.05)),G[e]&&(G[e].t=Math.min(G[e].t,.05)),void 0!==a&&G[a]&&(G[a].t=Math.min(G[a].t,.05))}function Gt(t){if(u.dead=0,u.lvup=0,u.t=0,u.time=0,u.spawnT=0,u.nextSpawn=.8,u.kills=0,u.msg="",u.msgT=0,u.level=1,u.xp=0,u.nextXp=24,u.stop=0,u.shake=0,u.xpPulse=0,u.cardT=0,u.choices=[],u.homeGot=0,u.sch.nsh=0,u.sch.mel=0,u.pz=0,u.uq.length=0,u.inB="",u.mb=0,u.mbd=0,u.bs=0,u.bd=0,u.bs2=0,u.bd2=0,u.b2At=0,u.pred=0,u.predDead=0,u.moth=0,u.mothDead=0,u.bossDownT=0,u.won=0,u.endWave=0,u.endT=0,u.endSpawnT=0,u.apWarn1=0,u.apWarn2=0,u.apStormHitCd=0,u.botMask=0,u.chemMask=0,u.labStep=0,u.labBank=0,u.labFlip=0,u.labNsh=0,u.labMel=0,u.labNshRuns=0,u.labMelRuns=0,u.stormCd=0,u.labCd=0,u.safeCampT=0,u.safeBreachCd=0,u.safeThreat=0,u.lvPend=0,u.lvGrace=0,u.lbSent=0,u.lbTopErr="",u.lbRankErr="",u.lbRankText="",u.lbFetchT=0,u.lbRankFetchT=0,u.lbBtnX=0,u.lbBtnY=0,u.lbBtnW=0,u.lbBtnH=0,W.x=260,W.y=900,W.vx=0,W.vy=0,W.hp=100,W.maxHp=100,W.speed=185,W.fireCd=0,W.fireRate=.46,W.dmg=12,W.range=400,W.shots=1,W.magnet=88,W.face=1,W.rx=0,W.ry=0,W.flash=0,W.gx=1,W.gy=0,W.zc=0,W.zr=0,W.zt=0,W.zx=1,W.zy=0,W.zcd=0,W.zDur=1,W.zSpd=2.1,W.zLoad=1.5,W.zCool=5.5,W.zDmg=24,W.zDr=.55,W.zb=0,W.zp=0,W.mkOn=0,W.mkT=0,W.mkI=8.8,W.mkS=0,W.mkD=14,W.mkR=54,W.mkSl=.54,W.mkBurst=0,W.mkBurstT=0,W.mkBurstQ=[],W.chDo=14,W.chBurst=10,W.chHeal=8,W.chHealCd=0,W.chHealI=.85,W.cat=0,W.catM=0,W.catType=0,W.bot=0,W.botCount=0,W.botSlots=0,W.bType=0,W.bAtk=1,W.bAuraR=0,W.bAuraSl=0,W.bHealCd=0,W.bHealI=10,W.bHealAmt=10,W.bHealFx=0,W.triA=0,W.triFx=0,W.slCharge=0,W.slFocus=0,W.slT=0,W.slRecallT=0,W.slLinkT=0,W.slRecallPulse=0,W.slCarryVx=0,W.slCarryVy=0,W.slPow=0,W.slWave=0,W.slComboFx=0,W.slHitMask=0,W.slPerfect=0,W.slDx=1,W.slDy=0,W.bx=W.x+20,W.by=W.y+4,W.ba=0,W.bcd=.45,W.bRate=1.9,W.bDmg=1.15,W.bRange=480,W.bFetch=95,W.bPull=195,W.bCarry=0,W.bCarryMax=2,W.bGrabCd=0,W.bGrabI=.38,W.bPier=4,W.bSize=6,W.slRopeRest=0,q.length=0,O.length=0,N.length=0,G.length=0,X.length=0,V.length=0,_.length=0,E.l=E.r=E.u=E.d=E.gr=0,L=0,It(1),function(){const t=et("nsh"),e=et("mel");for(let e=0;e<80;e++){const e=Y(720,2380),a=Y(220,1580);if(!(Math.hypot(e-260,a-900)<560)){t.x=e,t.y=a;break}}for(let a=0;a<80;a++){const a=Y(620,2380),l=Y(220,1580),s=Math.hypot(a-260,l-900),n=Math.hypot(a-t.x,l-t.y);if(!(s<560||n<520)){e.x=a,e.y=l;break}}}(),u.msg="home: unlock",u.msgT=1.6,t){for(let t=0;t<24;t++)Wt({x:1300+Y(-120,120),y:900+Y(-120,120),v:7,m:1,t:0});for(let t=0;t<10;t++)Wt({x:330+58*t,y:900+Y(-60,60),v:5,m:1,t:0})}}function Xt(){if(q.length>=h)return;const t=Math.random()*Math.PI*2,e=Y(360,560),a=1+.045*u.time;let l=22+8*a+Y(-4,8),s=56+6*a+Y(-6,10),n=Y(12,18),r=8+.9*a,o=0;u.time>8&&Math.random()<.24&&(o=1,s*=1.65,l*=.66,n*=.82,r*=.82),u.time>18&&Math.random()<.18&&(o=2,s*=.74,l*=2.15,n*=1.35,r*=1.28);const i=u.bd?u.kills-800:0;if(i>0){const t=Math.random();i>800&&t<.1?(o=8,l*=1.1,s*=.62,n=Y(13,17),r*=.6):i>400&&t<.2?(o=7,l*=1.6,s*=.82,n=Y(14,19),r*=1.1):i>100&&t<.28&&(o=6,l*=.72,s*=1.35,n=Y(10,15),r*=.7)}if(u.endT>0){const t=1+.02*u.endT+.08*u.endWave;l*=t,s=Math.min(s*(1+.006*u.endT),1.6*s),r*=Math.min(t,3.5)}let f=K(W.x+Math.cos(t)*e,20,2580),c=K(W.y+Math.sin(t)*e,20,1780);const d=at(f,c,10);if(d){const t=f-d.x,e=c-d.y,a=Math.hypot(t,e)||1;f=d.x+t/a*(d.r+18),c=d.y+e/a*(d.r+18)}const m={x:f,y:c,r:n,hp:l,s,dmg:r,vx:0,vy:0,ht:0,sl:0,ce:0,bm:0,bt:0,bi:"",k:o};8===o&&(m.healCd=Y(1.8,2.8)),q.push(m)}function Vt(t){if(q.length>=179)return;const e=Math.random()*Math.PI*2,a=Y(60,120),l=80+1.5*u.time,s={x:K(t.x+Math.cos(e)*a,20,2580),y:K(t.y+Math.sin(e)*a,20,1780),r:.8*t.r,hp:l,s:.95*t.s,dmg:.3*t.dmg,vx:0,vy:0,ht:0,sl:0,ce:0,bm:0,bt:0,bi:"",k:10,cloneLife:Y(4,6)};lt(s,8),q.push(s),Ht(s.x,s.y,"rgba(180,20,40,.6)",6,40),p(140,.04,"sawtooth",.012)}function _t(t){if(q.length>=179)return;const e=Math.random()*Math.PI*2,a=Y(40,100),l=60+1.2*u.time,s={x:K(t.x+Math.cos(e)*a,20,2580),y:K(t.y+Math.sin(e)*a,20,1780),r:Y(9,13),hp:l,s:Y(90,120),dmg:8+.2*u.time,vx:0,vy:0,ht:0,sl:0,ce:0,bm:0,bt:0,bi:"",k:12};lt(s,6),q.push(s)}function Yt(t,e,a){if(q.length>=179)return;const l=Math.max(1,0|a);for(let a=0;a<e&&q.length<h;a++){const e=Math.random()*Math.PI*2,a=Y(30,90),s=K(t.x+Math.cos(e)*a,20,2580),n=K(t.y+Math.sin(e)*a,20,1780),r=l>=2&&Math.random()<.38?2:1,o=2===r?110+5.6*u.time+Y(-8,12):68+4*u.time+Y(-6,10),i=2===r?78+Y(-8,12):108+Y(-10,20),h=2===r?22+.34*u.time:16+.28*u.time,f={x:s,y:n,r:2===r?Y(15,20):Y(12,17),hp:o,s:i,dmg:h,vx:0,vy:0,ht:0,sl:0,ce:0,bm:0,bt:0,bi:"",k:r};lt(f,10),q.push(f)}}function Kt(t,e,a,l){const s=K(.78*a,44,86),n=Math.max(1.15,.72*l);for(let a=0;a<_.length;a++){const l=_[a];if(5!==l.k)continue;const r=l.x-t,o=l.y-e,i=.4*(l.r+s);if(r*r+o*o<i*i)return l.x=.5*(l.x+t),l.y=.5*(l.y+e),l.r=Math.max(l.r,s),l.t=Math.max(l.t,n),l.d=Math.max(l.d,n),void(l.pcd=0)}_.length>=14&&_.shift(),_.push({k:5,x:t,y:e,r:s,t:n,d:n,pcd:0,ap:1}),Ht(t,e,"#d4b8ff",8,52),p(250,.035,"sawtooth",.011)}function Ut(){return function(){const t=jt.filter(t=>!t.req||t.req());u.choices=[];for(let e=0;e<3&&t.length;e++){const e=Math.random()*t.length|0;u.choices.push(t[e]),t.splice(e,1)}}(),u.choices.length?(u.lvup=1,u.cardT=0,u.xpPulse=.65,u.msg="upgrade",u.msgT=2.1,zt(.06),At(.2),p(860,.08,"triangle",.03),1):0}function Zt(t,e){const a=N[t];if(!a)return;a.bc&&W.bCarry>0&&W.bCarry--,function(t){for(u.xp+=t;u.xp>=u.nextXp;){u.xp-=u.nextXp,u.level++,u.nextXp=1.36*u.nextXp+9|0,yt()?(u.lvPend++,u.xpPulse=.65,u.msg="upgrade queued",u.msgT=1,p(760,.05,"triangle",.018)):Ut();break}}(a.v),N.splice(t,1),u.xpPulse=Math.min(.5,u.xpPulse+.11);let l=W.x,s=W.y;if("bot"===e){const t=(0|a.bc)-1,e=t>=0&&t<V.length?V[t]:0;l=e?e.x:W.bx,s=e?e.y:W.by}Ht(l,s,"#69f0c9",4,40),W.mkOn||(u.homeGot++,u.homeGot>=u.homeNeed&&(W.mkOn=1,W.mkT=0,qt(),u.msg="territory online",u.msgT=2.2,p(820,.07,"triangle",.028),Ht(W.x,W.y,"#ffd56d",16,95)))}function Qt(){return 1+u.kills/1200}const jt=[{n:"Rapid Fire",d:"shoot faster",f:()=>W.fireRate=Math.max(.06,W.fireRate*(1-.22*Math.min(Qt(),4))),req:()=>1},{n:"Big Bites",d:"more damage",f:()=>W.dmg+=10*Qt(),req:()=>1},{n:"Speed Paws",d:"move faster",f:()=>W.speed+=35*Qt(),req:()=>1},{n:"Extra Shot",d:"+projectiles",f:()=>{const t=1+Math.floor(Qt()/2);W.shots=Math.min(14,W.shots+t)},req:()=>1},{n:"Snack Magnet",d:"pickup range up",f:()=>W.magnet+=45*Qt(),req:()=>1},{n:"Tough Fur",d:"+max hp +heal",f:()=>{const t=40*Qt();W.maxHp+=t,W.hp=Math.min(W.maxHp,W.hp+t)},req:()=>1},{n:"Quick Heal",d:"heal now",f:()=>W.hp=Math.min(W.maxHp,W.hp+55*Qt()),req:()=>1},{n:"Range Up",d:"bullets fly farther",f:()=>W.range=Math.min(1200,W.range+60*Qt()),req:()=>1},{n:"Zoomies Time",d:"zoomies lasts longer",f:()=>W.zDur=Math.min(6,W.zDur+.38*Qt()),req:()=>1},{n:"Zoomies CD",d:"zoomies cooldown down",f:()=>W.zCool=Math.max(.4,W.zCool-.9*Qt()),req:()=>1},{n:"Zoomies Speed",d:"zoomies speed up",f:()=>W.zSpd=Math.min(8,W.zSpd+.5*Qt()),req:()=>1},{n:"Zoomies Charge",d:"zoomies charge faster",f:()=>W.zLoad=Math.max(.2,W.zLoad-.26*Qt()),req:()=>1},{n:"Zoomies Damage",d:"zoomies hit harder",f:()=>W.zDmg+=6*Qt(),req:()=>1},{n:"Territory CD",d:"territory cooldown down",f:()=>W.mkI=Math.max(1.2,W.mkI-.75*Qt()),req:()=>W.mkOn},{n:"Territory Radius",d:"territory area bigger",f:()=>W.mkR=Math.min(260,W.mkR+18*Qt()),req:()=>W.mkOn},{n:"Territory Duration",d:"territory lasts longer",f:()=>W.mkD=Math.min(90,W.mkD+6*Qt()),req:()=>W.mkOn},{n:"Territory Slow",d:"territory slows more",f:()=>W.mkSl=Math.min(.96,W.mkSl+.14*Math.min(Qt(),3)),req:()=>W.mkOn},{n:"Territory Burst",d:"mark drops extra puddle",f:()=>{W.mkBurst=1,W.mkR=Math.min(260,W.mkR+8)},req:()=>W.mkOn&&!W.mkBurst},{n:"Chemical Puddle",d:"chem damage up",f:()=>{const t=Qt();W.chDo=Math.min(200,W.chDo+12*t),W.chBurst=Math.min(120,W.chBurst+10*t)},req:()=>W.cat},{n:"Chemical Radius",d:"chem area bigger",f:()=>W.mkR=Math.min(280,W.mkR+15*Qt()),req:()=>W.cat},{n:"Chemical Tempo",d:"chem cooldown down",f:()=>W.mkI=Math.max(.8,W.mkI-.65*Qt()),req:()=>W.cat},{n:"Chemical Heal",d:"puddles heal scotty",f:()=>{W.chHeal=Math.min(30,W.chHeal+4*Qt()),W.chHealI=Math.max(.3,W.chHealI-.08*Qt())},req:()=>W.cat},{n:"Bot Fetch",d:"bot grabs mints farther",f:()=>W.bFetch=Math.min(500,W.bFetch+40*Qt()),req:()=>W.bot},{n:"Bot Cargo",d:"bot carries more mints",f:()=>W.bCarryMax=Math.min(12,W.bCarryMax+1+Math.floor(Qt()/3)),req:()=>W.bot},{n:"Bot Speed",d:"bots move faster",f:()=>W.bPull=Math.min(600,W.bPull+35*Qt()),req:()=>W.bot},{n:"Bot Heal",d:"bots heal scotty",f:()=>{W.bHealAmt=Math.min(60,W.bHealAmt+5*Qt()),W.bHealI=Math.max(3,W.bHealI-1)},req:()=>W.bot},{n:"Shock Tempo",d:"shock pulse cooldown down",f:()=>W.bRate=Math.max(.2,W.bRate*(1-.2*Math.min(Qt(),4))),req:()=>W.bot&&W.bAtk},{n:"Shock Pierce",d:"pulse pierces more + wider",f:()=>{W.bPier=Math.min(20,W.bPier+Math.ceil(1.2*Qt())),W.bSize=Math.min(36,W.bSize+1.6*Qt())},req:()=>W.bot&&W.bAtk},{n:"Shock Power",d:"shock pulse damage up",f:()=>W.bDmg=Math.min(8,W.bDmg+.4*Qt()),req:()=>W.bot&&W.bAtk},{n:"Shock Range",d:"shock pulse range up",f:()=>W.bRange=Math.min(900,W.bRange+55*Qt()),req:()=>W.bot&&W.bAtk}];function Jt(t){u.lvup&&u.choices[t]&&(u.choices[t].f(),u.lvup=0,u.msg=u.choices[t].n+" applied",u.msgT=1.4,u.xpPulse=.25,u.labCd=Math.max(u.labCd,3),At(.08),Ht(W.x,W.y,"#69f0c9",12,90),Rt())}function $t(t){W.zt>0?W.flash=Math.max(W.flash,.03):(W.hp-=t,At(.03),W.hp<=0&&(W.hp=0,u.dead=1,u.start=1,u.kills>u.best&&(u.best=0|u.kills,localStorage.ss_best=u.best),u.msg="swarmed",u.msgT=999,zt(.09),At(.42),p(120,.22,"sawtooth",.05),Ht(W.x,W.y,"#ff6f89",26,130),I(1),B(1),async function(){if(u.lbSent)return;if(u.lbSent=1,!function(){if(!T||!S||!C)return 0;const t=A(R);if("yes"===t)return 1;if("no"===t)return 0;const e=confirm("Join the global leaderboard? Your name, kills, and time will be submitted when a run ends.");return z(R,e?"yes":"no"),e?1:0}())return;const t=function(){let t=A(v).trim();if(w(t))return t;const e=prompt("Enter a name for global leaderboard (1-24 chars).");return null==e?"":(t=e.trim(),w(t)?(z(v,t),t):(alert("Name must be 1-24 chars and only letters, numbers, spaces, _, ., or -."),""))}();if(!t)return;const e=0|u.kills,a=+u.time.toFixed(1);if(!(e<0||!Number.isFinite(a)||a<0))try{const l=await fetch(T+"/rest/v1/"+encodeURIComponent(C),{method:"POST",headers:{"Content-Type":"application/json",apikey:S,Authorization:"Bearer "+S,Prefer:"return=representation"},body:JSON.stringify([{name:t,kills:e,time_seconds:a}])});if(!l.ok)return;const s=await l.json(),n=Array.isArray(s)?s[0]:0;n&&n.id&&z(P,JSON.stringify({id:n.id,name:n.name,kills:n.kills,time_seconds:n.time_seconds})),I(1),B(1)}catch{}}()))}function te(){y||(y=new(window.AudioContext||window.webkitAudioContext)),u.start||(u.start=1,Gt(1),p(430,.05,"triangle",.02))}function ee(e){H===e.pointerId&&(L=0,It(),t.hasPointerCapture(H)&&t.releasePointerCapture(H),H=-1)}addEventListener("resize",wt),addEventListener("keydown",function(t){const e=t.code;if("Space"!==e&&"ArrowUp"!==e&&"ArrowDown"!==e&&"ArrowLeft"!==e&&"ArrowRight"!==e||t.preventDefault(),"Space"!==e&&"Enter"!==e||te(),!u.dead||"KeyL"!==e)return!u.dead||"Space"!==e&&"Enter"!==e&&"KeyR"!==e?void(u.lvup?"Digit1"===e?Jt(0):"Digit2"===e?Jt(1):"Digit3"===e&&Jt(2):u.pz?"Digit1"===e?ot(0):"Digit2"===e?ot(1):"Digit3"===e&&ot(2):u.start&&!u.dead&&("KeyQ"!==e?"KeyA"===e||"ArrowLeft"===e?E.l=1:"KeyD"===e||"ArrowRight"===e?E.r=1:"KeyW"===e||"ArrowUp"===e?E.u=1:"KeyS"===e||"ArrowDown"===e?E.d=1:"KeyE"!==e&&"ShiftLeft"!==e&&"ShiftRight"!==e||(E.gr=1):ft())):(Gt(1),void p(360,.05,"triangle",.02));D()}),addEventListener("keyup",function(t){const e=t.code;"KeyA"===e||"ArrowLeft"===e?E.l=0:"KeyD"===e||"ArrowRight"===e?E.r=0:"KeyW"===e||"ArrowUp"===e?E.u=0:"KeyS"===e||"ArrowDown"===e?E.d=0:"KeyE"!==e&&"ShiftLeft"!==e&&"ShiftRight"!==e||(E.gr=0)}),t.addEventListener("pointerdown",function(e){if(!(H>=0&&H!==e.pointerId)){if(H=e.pointerId,t.setPointerCapture(H),te(),u.dead)return e.clientX>=u.lbBtnX&&e.clientX<=u.lbBtnX+u.lbBtnW&&e.clientY>=u.lbBtnY&&e.clientY<=u.lbBtnY+u.lbBtnH?void D():(Gt(1),void p(360,.05,"triangle",.02));if(u.lvup)!function(t,e){if(!u.lvup)return;const a=j().rects;for(let l=0;l<a.length;l++){const s=a[l];if(t>=s.x&&t<=s.x+s.w&&e>=s.y&&e<=s.y+s.h){Jt(l);break}}}(e.clientX,e.clientY);else{if(u.pz){const t=st();for(let a=0;a<3;a++){const l=t.btn[a];if(e.clientX>=l.x&&e.clientX<=l.x+l.w&&e.clientY>=l.y&&e.clientY<=l.y+l.h)return void ot(a)}return}u.start&&!u.dead&&W.cat&&function(t,e){const l=a-18-44;return t>=l&&t<=l+44&&e>=66&&e<=110}(e.clientX,e.clientY)?ft():"mouse"!==e.pointerType&&(L=1,function(t,e){const s=F.r+16;F.x=K(t,s,a-s),F.y=K(e,s,l-s),F.tx=0,F.ty=0,F.ax=0,F.ay=0,F.ttx=0,F.tty=0,F.tax=0,F.tay=0,F.act=1}(e.clientX,e.clientY),Dt(e.clientX,e.clientY))}}},{passive:1}),t.addEventListener("pointermove",function(t){H!==t.pointerId||!u.start||u.dead||u.lvup||L&&Dt(t.clientX,t.clientY)},{passive:1}),t.addEventListener("pointerup",ee,{passive:1}),t.addEventListener("pointercancel",ee,{passive:1}),wt(),Gt(1),requestAnimationFrame(function t(x){n||(n=x);let y=.001*(x-n);n=x,y=Math.max(0,Math.min(.034,y)),function(t){const e=t;!function(t){const e=1-Math.exp(22*-t),a=1-Math.exp(16*-t);F.tx+=(F.ttx-F.tx)*e,F.ty+=(F.tty-F.ty)*e,F.ax+=(F.tax-F.ax)*e,F.ay+=(F.tay-F.ay)*e,F.show+=((F.act?1:0)-F.show)*a,!F.act&&F.show<.003&&(F.show=0)}(e),u.msgT>0&&(u.msgT-=e),u.bossDownT>0&&(u.bossDownT=Math.max(0,u.bossDownT-e)),u.apStormHitCd>0&&(u.apStormHitCd=Math.max(0,u.apStormHitCd-e)),u.stormCd>0&&(u.stormCd=Math.max(0,u.stormCd-e)),u.labCd>0&&(u.labCd=Math.max(0,u.labCd-e)),u.stop>0&&(u.stop=Math.max(0,u.stop-e),t*=.06),u.shake>0&&(u.shake=Math.max(0,u.shake-2.2*e)),u.xpPulse>0&&(u.xpPulse=Math.max(0,u.xpPulse-1.7*e)),W.flash>0&&(W.flash=Math.max(0,W.flash-7*e)),W.zb>0&&(W.zb=Math.max(0,W.zb-e)),W.zp>0&&(W.zp=Math.max(0,W.zp-e)),W.rx*=Math.max(0,1-18*e),W.ry*=Math.max(0,1-18*e),W.zcd>0&&(W.zcd=Math.max(0,W.zcd-e)),W.mkS>0&&(W.mkS=Math.max(0,W.mkS-e)),W.mkT>0&&W.zt<=0&&(W.mkT=Math.max(0,W.mkT-e)),W.bHealFx>0&&(W.bHealFx=Math.max(0,W.bHealFx-e)),W.triFx>0&&(W.triFx=Math.max(0,W.triFx-e*(W.slT>0||W.slRecallT>0||W.slLinkT>0?1:1.7))),W.slWave>0&&(W.slWave=Math.max(0,W.slWave-2.6*e)),W.slComboFx>0&&(W.slComboFx=Math.max(0,W.slComboFx-2.1*e)),W.slLinkT>0&&(W.slLinkT=Math.max(0,W.slLinkT-e));for(let e=G.length-1;e>=0;e--){const a=G[e];a.t-=t,a.t<=0&&G.splice(e,1)}for(let e=_.length-1;e>=0;e--){const a=_[e];a.t-=t,a.pcd>0&&(a.pcd=Math.max(0,a.pcd-t)),a.t<=0&&_.splice(e,1)}for(let e=X.length-1;e>=0;e--){const a=X[e];a.t-=t,a.x+=a.vx*t,a.y+=a.vy*t,a.vy+=480*t,a.t<=0&&X.splice(e,1)}if(!u.start)return;if(u.dead)return I(0),void B(0);if(u.won)return void(u.bossDownT=Math.max(u.bossDownT,3));if(xt()?u.lvGrace=1:u.lvGrace>0&&(u.lvGrace=Math.max(0,u.lvGrace-e)),!u.lvup&&!u.pz&&u.lvPend>0&&!yt()&&(u.lvPend--,Ut()),u.lvup)return void(u.cardT=Math.min(.9,u.cardT+e));if(u.pz)return void(u.t+=t);if(u.t+=t,u.bd&&!u.bs2&&!u.bd2){const t=u.b2At-u.t;t<=8.5&&!u.apWarn1&&(u.apWarn1=1,u.msg="something big is approaching...",u.msgT=1.5,p(190,.055,"triangle",.016)),t<=3.6&&!u.apWarn2&&(u.apWarn2=1,u.msg="someone...",u.msgT=1.2,p(170,.06,"sawtooth",.02))}const a=et("nsh"),l=et("mel");W.mkOn&&0===u.sch.nsh&&Math.hypot(W.x-a.x,W.y-a.y)<a.r&&it("nsh"),2===u.sch.nsh&&0===u.sch.mel&&Math.hypot(W.x-l.x,W.y-l.y)<l.r&&it("mel"),2===u.sch.nsh&&u.labNsh>0&&Math.hypot(W.x-a.x,W.y-a.y)<a.r&&St("nsh"),2===u.sch.mel&&u.labMel>0&&Math.hypot(W.x-l.x,W.y-l.y)<l.r&&St("mel"),Rt();const s=(E.r?1:0)-(E.l?1:0),n=(E.d?1:0)-(E.u?1:0),r=Math.hypot(F.ax,F.ay);let o=s,i=n;L&&r>.12&&(o+=F.ax,i+=F.ay);let b=Math.hypot(o,i);b>1&&(o/=b,i/=b);const x=(Math.hypot(s,n)>.05||L&&r>.12)&&W.mkS<=0,y=at(W.x,W.y,-6);if(W.mkOn&&W.mkT<=0&&W.mkS<=0&&W.zt<=0&&W.zr<=0&&W.zc<=0&&W.mkBurst<=0&&qt(),W.mkBurst>0&&(W.mkBurstT=Math.max(0,W.mkBurstT-t),W.mkBurstT<=0&&W.mkBurstQ.length>0&&(Ft(W.mkBurstQ.shift()),W.mkBurst--,W.mkBurst>0?W.mkBurstT=.5:W.mkT=W.mkI)),function(){const t=[];for(let e=0;e<G.length;e++){const a=G[e];a.t>.08&&a.m>=1&&a.m<=3&&t.push(e)}if(t.length<2)return;if(u.stormCd<=0&&t.length>=3)for(let e=0;e<t.length-2;e++){const a=G[t[e]];for(let l=e+1;l<t.length-1;l++){const s=G[t[l]];for(let n=l+1;n<t.length;n++){const r=G[t[n]];if(14!=(1<<a.m|1<<s.m|1<<r.m))continue;const o=Math.hypot(a.x-s.x,a.y-s.y),i=Math.hypot(s.x-r.x,s.y-r.y),h=Math.hypot(r.x-a.x,r.y-a.y);if(o>.8*(a.r+s.r)||i>.8*(s.r+r.r)||h>.8*(r.r+a.r))continue;const f=(a.x+s.x+r.x)/3,c=(a.y+s.y+r.y)/3,d=Math.min(152,(a.r+s.r+r.r)/3+36);Ot(4,f,c,d,6),u.stormCd=8,Nt(t[e],t[l],t[n]);for(let t=_.length-1;t>=0;t--){const e=_[t];5===e.k&&Math.hypot(e.x-f,e.y-c)<d+e.r+80&&(Ht(e.x,e.y,"#8effdc",12,72),_.splice(t,1))}for(let t=q.length-1;t>=0;t--){const e=q[t],a=e.x-f,l=e.y-c,s=a*a+l*l;if(4===e.k&&s<1.8*d*(1.8*d)){e.hp-=4.5*W.chBurst+3.5*W.chDo,e.ht=.3,e.s*=.45,e.apStormCd=Math.max(e.apStormCd||0,4);const s=Math.hypot(a,l)||1;if(e.vx+=a/s*520,e.vy+=l/s*520,Ht(e.x,e.y,"#8effdc",26,160),u.msg="campus storm: apex vulnerable!",u.msgT=1.8,p(860,.08,"triangle",.03),e.hp<=0){Lt(t,"#8effdc",18,130,1);continue}}if(s<d*d*1.2){const s=Math.hypot(a,l)||1;e.hp-=2.8*W.chBurst+1.5*W.chDo,e.ht=.2,e.vx+=a/s*360,e.vy+=l/s*360,e.hp<=0&&Lt(t,"#c8f3ff",12,96,1)}}return}}}const e={};for(let a=0;a<t.length-1;a++){const l=t[a];if(e[l])continue;const s=G[l];for(let n=a+1;n<t.length;n++){const a=t[n];if(e[a])continue;const r=G[a];if(s.m===r.m)continue;if(Math.hypot(s.x-r.x,s.y-r.y)>.7*(s.r+r.r))continue;const o=Math.min(s.m,r.m),i=Math.max(s.m,r.m),h=1===o&&3===i?1:2===o&&3===i?2:3;Ot(h,.5*(s.x+r.x),.5*(s.y+r.y),Math.min(122,.44*(s.r+r.r)+18),1===h?5.4:2===h?6.1:5.8),Nt(l,a),e[l]=1,e[a]=1;break}}}(),W.zt<=0)if(!y&&!x&&W.zcd<=0&&W.mkS<=0){if(W.zc=Math.min(W.zLoad,W.zc+t),W.zc>.25){const e=W.zc/W.zLoad;W.rx+=.9*(2*Math.random()-1)*e*60*t,W.ry+=.9*(2*Math.random()-1)*e*60*t,At(7e-4*e*60*t)}W.zc>=W.zLoad&&!W.zr&&(W.zr=1,u.msg="zoomies ready",u.msgT=1.1,At(.08),p(760,.05,"triangle",.024))}else if(W.zr){W.zt=W.zDur,W.zr=0,W.zc=0;const t=b||1;W.zx=o/t,W.zy=i/t,W.slCharge=0,W.slFocus=0,W.slPow=0,W.slLinkT=0,W.slHitMask=0,W.slPerfect=0,W.slRopeRest=0,zt(.04),At(.28),W.flash=.09,W.gx=W.zx,W.gy=W.zy,Ht(W.x,W.y,"#9dffea",18,120),p(980,.06,"square",.028)}else W.zc=0;if(W.zt>0){if(W.zt=Math.max(0,W.zt-t),x){W.zx=.85*W.zx+.15*o,W.zy=.85*W.zy+.15*i;const t=Math.hypot(W.zx,W.zy)||1;W.zx/=t,W.zy/=t}const e=W.zb>0?1.35:1;if(W.vx=W.zx*W.speed*W.zSpd*e+W.slCarryVx,W.vy=W.zy*W.speed*W.zSpd*e+W.slCarryVy,W.face=W.vx>=0?1:-1,W.rx-=8*W.zx*t*60,W.ry-=6*W.zy*t*60,Math.random()<.65&&Bt({x:W.x-Y(-6,6),y:W.y-Y(-6,6),vx:.12*-W.vx+Y(-35,35),vy:.12*-W.vy+Y(-35,35),t:Y(.1,.25),c:"#8fffe5"}),W.zt<=0){if(W.bot&&V.length>=3&&W.slCharge>=.25){const t=W.slPerfect&&W.slFocus>=.98?1:0,e=Math.min(1,W.slCharge*(t?1.15:1));W.slT=.34+(.72-.34)*e,W.slRecallT=0,W.slRecallPulse=0,W.slCarryVx=0,W.slCarryVy=0,W.slPow=.68+.48*e+.34*t,W.slLinkT=c*(.82+.34*e+.2*t),W.slDx=W.zx,W.slDy=W.zy,W.slWave=1,W.triFx=1,W.slHitMask=0,W.slRopeRest=176+72*e+36*t,W.slComboFx=Math.max(W.slComboFx,t?.95:0);const a=620*(1.02+.82*e+.46*t)+.6*Math.max(0,W.vx*W.zx+W.vy*W.zy);for(let t=0;t<3&&t<V.length;t++){const l=V[t],s=.26*(t-1),n=Math.cos(s),r=Math.sin(s),o=W.zx*n-W.zy*r,i=W.zx*r+W.zy*n,h=a*(1-.06*Math.abs(t-1));l.slx=o*h+.28*W.vx,l.sly=i*h+.28*W.vy,l.vx=l.slx,l.vy=l.sly,Ht(l.x,l.y,"#b6f6ff",6,50+44*e)}zt(.05+.025*e),At(.2+.14*e),Ht(W.x,W.y,"#8eefff",14,92+58*e),u.msg=t?"perfect slingshot":"slingshot pack",u.msgT=.82,p(t?1020:940,.05,"square",.026),p(t?1350:1220,.04,"triangle",.018),W.slPerfect=0,W.slFocus=0}else W.slCharge=0,W.slFocus=0,W.slPerfect=0,W.slRecallT=0,W.slLinkT=0,W.slRecallPulse=0,W.slCarryVx=0,W.slCarryVy=0,W.slHitMask=0,W.slRopeRest=0,u.msg="zoomies cd",u.msgT=.65,p(420,.04,"triangle",.016);W.zcd=W.zCool}}else W.vx=o*W.speed+W.slCarryVx,W.vy=i*W.speed+W.slCarryVy,Math.abs(W.vx)>.5&&(W.face=W.vx>0?1:-1),W.mkS>0&&(W.rx+=.5*Math.sin(45*u.t),Math.random()<.7&&Bt({x:W.x+Y(-5,5),y:W.y+10+Y(-3,3),vx:Y(-14,14),vy:Y(6,30),t:Y(.12,.26),c:"#ffd56d"}));if(W.x=K(W.x+W.vx*t,12,2588),W.y=K(W.y+W.vy*t,12,1788),W.zt>0&&W.zp<=0)for(let t=0;t<G.length;t++){const e=G[t],a=W.x-e.x,l=W.y-e.y;if(a*a+l*l<e.r*e.r){W.zp=.22,W.zb=.48,Ht(W.x,W.y,"#8fffe5",8,95),p(740,.03,"triangle",.02);for(let t=q.length-1;t>=0;t--){const a=q[t],l=a.x-e.x,s=a.y-e.y;l*l+s*s<e.r*e.r&&(a.hp-=2.2*W.zDmg,a.ht=.13,a.vx+=260*W.zx,a.vy+=260*W.zy,a.hp<=0&&Lt(t,"#8fffe5",10,80,1))}break}}const g=at(W.x,W.y,-6);u.time+=t;const M=g?g.id:"";if(u.inB=M,function(t,e){if(!t)return u.safeCampT=0,u.safeBreachCd=0,void(u.safeThreat=0);if(u.safeCampT+=e,u.safeThreat=function(t){if(!t)return 0;const e=t.r+230,a=e*e;let l=0;for(let e=0;e<q.length;e++){const s=q[e],n=s.x-t.x,r=s.y-t.y;n*n+r*r<a&&l++}return l}(t),u.safeCampT<9||u.safeThreat<6)return;if(u.safeBreachCd-=e,u.safeBreachCd>0)return;const a=u.safeCampT-9,l=Math.max(0,u.safeThreat-6);$t(2.6+Math.min(7.5,.35*a)+Math.min(5.5,.45*l)),u.safeBreachCd=.9,u.msg="shelter breached - move!",u.msgT=.65,Ht(W.x,W.y,"#ef4f6c",8,55),p(150,.04,"sawtooth",.018)}(g,t),W.cat){W.chHealCd>0&&(W.chHealCd=Math.max(0,W.chHealCd-t));let e=0;for(let t=0;t<G.length;t++){const a=G[t],l=W.x-a.x,s=W.y-a.y;if(2===a.m&&l*l+s*s<a.r*a.r){e=1;break}}if(e&&W.chHealCd<=0&&W.hp<W.maxHp){const t=Math.min(W.chHeal,W.maxHp-W.hp);W.hp+=t,W.chHealCd=W.chHealI,Ht(W.x,W.y,"#7fe8dd",8,52),u.msg="heal +"+(0|t),u.msgT=.65}}let k=0,T=0,S=0,C=0;for(let t=0;t<_.length;t++){const e=_[t],a=W.x-e.x,l=W.y-e.y;a*a+l*l<e.r*e.r&&(2===e.k?(!S||e.t>S.t)&&(S=e):3===e.k?k=1:4===e.k?T=1:5===e.k&&(C=e))}if(S&&S.pcd<=0&&W.hp<W.maxHp){const t=Math.min(10,W.maxHp-W.hp);W.hp+=t,S.pcd=1.6,Ht(W.x,W.y,"#95ffe8",10,70),u.msg="well +"+(0|t),u.msgT=.6}if(k&&W.hp<W.maxHp){const e=Math.min(W.maxHp-W.hp,1.6*t);e>0&&(W.hp+=e)}if(T&&W.hp<W.maxHp){const e=Math.min(W.maxHp-W.hp,8*t);e>0&&(W.hp+=e)}if(C&&!g){const e=C.x-W.x,a=C.y-W.y,l=Math.hypot(e,a)||1;let s=(32+(C.d-C.t)/Math.max(.001,C.d)*20)*(.35+.65*K(l/Math.max(1,C.r),0,1));W.zt>0&&(s*=.28),W.x=K(W.x+e/l*s*t,12,2588),W.y=K(W.y+a/l*s*t,12,1788),u.apStormHitCd<=0&&l<.82*C.r&&($t(W.zt>0?1.62:3.6),u.apStormHitCd=.34),Math.random()<.28&&Bt({x:W.x+Y(-8,8),y:W.y+Y(-8,8),vx:Y(-18,18),vy:Y(-30,10),t:Y(.08,.18),c:"#d4b8ff"})}let P=0;if(W.bot&&W.botCount>0){if(Ct(),P=W.zt>0&&V.length>=3,P){const e=x?Math.max(0,o*W.zx+i*W.zy):0,a=.6+.95*e;W.slCharge=Math.min(1,W.slCharge+t*a),W.zt<=.24?x&&e>.82?(W.slFocus=Math.min(1,W.slFocus+4.5*t),W.slFocus>=1&&!W.slPerfect&&(W.slPerfect=1,W.slComboFx=Math.max(W.slComboFx,.55),u.msg="perfect line",u.msgT=.45,p(1180,.03,"triangle",.014))):W.slPerfect||(W.slFocus=Math.max(0,W.slFocus-3.8*t)):W.slPerfect||(W.slFocus=Math.max(0,W.slFocus-1.6*t)),W.triFx=Math.min(1,W.triFx+t*(W.slPerfect?4.1:3.2))}else W.slT<=0&&W.slRecallT<=0&&W.slLinkT<=0&&(W.slCharge>0||W.slFocus>0||W.slPerfect)&&(W.slCharge=Math.max(0,W.slCharge-2.6*t),W.slFocus=Math.max(0,W.slFocus-2.8*t),W.slFocus<=.02&&(W.slPerfect=0));W.slT>0?(W.slT=Math.max(0,W.slT-t),W.slT<=0&&(V.length>=3&&W.slPow>.08?(W.slRecallT=f*(.86+.28*Math.min(1,W.slPow)),W.slRecallPulse=0,u.msg="recall strike",u.msgT=.52,p(860,.03,"triangle",.014)):W.slHitMask=0)):W.slRecallT>0&&(W.slRecallT=Math.max(0,W.slRecallT-t),W.slRecallT<=0&&(W.slRecallPulse=1,W.slLinkT=Math.max(W.slLinkT,.652),W.slHitMask=0)),W.ba+=t*(P||W.slT>0||W.slRecallT>0||W.slLinkT>0?4.9:2.3),W.triA+=t*(P||W.slLinkT>0?9.2:4.2);const e=V.length>=3&&W.slLinkT>0;if((W.slT>0||W.slRecallT>0||e)&&x){const e=Math.hypot(o,i)||1,a=o/e,l=i/e,s=W.slT>0?9.2:W.slRecallT>0?7.4:6.1,n=Math.min(1,t*s);W.slDx+=(a-W.slDx)*n,W.slDy+=(l-W.slDy)*n;const r=Math.hypot(W.slDx,W.slDy)||1;W.slDx/=r,W.slDy/=r}if(V.length>=3&&(W.slT>0||W.slRecallT>0||e)){(W.slRopeRest||0)<=0&&(W.slRopeRest=176);const e=142*(.7+.45*Math.min(1,W.slPow)+(W.slT>0?.24:0));W.slRopeRest=Math.max(44,W.slRopeRest-t*e)}else(W.slRopeRest||0)>0&&(W.slRopeRest=Math.max(0,W.slRopeRest-220*t));let a=0,l=0,s=0,n=0,r=.18,h=0,d=0,m=0;V.length>=3&&(W.slT>0?(a=2,r=.46):W.slRecallT>0?(a=3,r=.33):e?(a=4,r=.29):P&&(a=1,r=.18));for(let r=0;r<V.length;r++){const o=V[r],i=o.x,b=o.y,x=Math.max(.001,t);if(W.slT>0&&r<3){const e=860*(.62+.48*Math.min(1,W.slPow));o.slx+=W.slDx*e*t,o.sly+=W.slDy*e*t,o.x=K(o.x+o.slx*t,16,2584),o.y=K(o.y+o.sly*t,16,1784);const a=Math.max(0,1-t*(2.35+1.2*Math.max(0,.9-W.slPow)));o.slx*=a,o.sly*=a}else{let e=0,a=0;if(W.slRecallT>0&&r<3){const l=K(W.slRecallT/f,0,1),s=24+22*l,n=(r-1)*(24+12*l);e=W.x+W.slDx*s-W.slDy*n,a=W.y+W.slDy*s+W.slDx*n;const i=22+20*(1-l);o.vx+=(e-o.x)*i*t,o.vy+=(a-o.y)*i*t;const h=Math.max(0,1-t*(7.2+1.8*(1-l)));o.vx*=h,o.vy*=h,o.x=K(o.x+o.vx*t,16,2584),o.y=K(o.y+o.vy*t,16,1784)}else if(P&&r<3){const l=94+34*W.slCharge,s=(r-1)*(34+12*W.slCharge),n=Math.sin(18*u.t+1.6*r)*(4+8*W.slCharge);e=W.x-W.zx*l-W.zy*s,a=W.y-W.zy*l+W.zx*s+n;const i=18+20*W.slCharge;o.vx+=(e-o.x)*i*t,o.vy+=(a-o.y)*i*t;const h=Math.max(0,1-t*(7.4+1.8*W.slCharge));o.vx*=h,o.vy*=h,o.x=K(o.x+o.vx*t,16,2584),o.y=K(o.y+o.vy*t,16,1784)}else{const l=W.ba+r*(2*Math.PI/V.length),s=38+2*Math.sin(2*u.t+.7*r);e=W.x+Math.cos(l)*s,a=W.y+Math.sin(l)*s,o.x+=(e-o.x)*Math.min(1,8*t),o.y+=(a-o.y)*Math.min(1,8*t)}o.slx*=Math.max(0,1-7.8*t),o.sly*=Math.max(0,1-7.8*t)}if(o.vx=(o.x-i)/x,o.vy=(o.y-b)/x,W.slT>0&&r<3||(o.slx=.74*o.slx+.26*o.vx,o.sly=.74*o.sly+.26*o.vy),e&&r<3){const e=o.x-W.x,a=o.y-W.y,l=Math.hypot(e,a)||1,s=e/l,n=a/l,r=K(W.slLinkT/c,0,1);let i=Math.max(44,W.slRopeRest||92)+11.56*r+20*Math.min(1,W.slPow);W.slT>0?i+=28:W.slRecallT>0&&(i=Math.max(44,.74*i));const f=o.vx-W.vx,b=o.vy-W.vy,x=K((13.2*(l-i)+13.2*.58*(f*s+b*n))*t,-125,125),y=-n,p=s,g=K(.32*-(f*y+b*p)*(.65+.55*Math.min(1,W.slPow))*t,-84,84),M=-s*x+y*g,u=-n*x+p*g;o.slx+=M,o.sly+=u,o.vx+=M,o.vy+=u,o.x=K(o.x+M*t,16,2584),o.y=K(o.y+u*t,16,1784);const k=.62*(.76+.34*Math.min(1,W.slPow));h-=M*k,d-=u*k,m++,Math.random()<.18&&Math.abs(l-i)>10&&Bt({x:.5*(W.x+o.x)+Y(-4,4),y:.5*(W.y+o.y)+Y(-4,4),vx:Y(-16,16),vy:Y(-16,16),t:Y(.06,.14),c:"#d6f7ff"})}if(a&&r<3){let t=0,e=0;if(2===a)t=.6*o.vx+.4*o.slx,e=.6*o.vy+.4*o.sly;else if(3===a){const a=W.x-o.x,l=W.y-o.y,s=Math.hypot(a,l)||1,n=190+110*W.slPow;t=a/s*n+.45*o.vx+.2*o.slx,e=l/s*n+.45*o.vy+.2*o.sly}else 4===a?(t=.78*o.vx+.38*o.slx,e=.78*o.vy+.38*o.sly):(t=.72*o.vx+.25*o.slx,e=.72*o.vy+.25*o.sly);l+=t,s+=e,n++}o.grabCd>0&&(o.grabCd=Math.max(0,o.grabCd-t))}if(m>0&&(l+=h,s+=d,n+=m),n>0){const e=l/n*r,o=s/n*r,i=Math.min(1,t*(2===a?9.2:3===a?8.4:4===a?7.8:6.8));W.slCarryVx+=(e-W.slCarryVx)*i,W.slCarryVy+=(o-W.slCarryVy)*i}else{const e=Math.max(0,1-8.5*t);W.slCarryVx*=e,W.slCarryVy*=e,Math.abs(W.slCarryVx)+Math.abs(W.slCarryVy)<.5&&(W.slCarryVx=0,W.slCarryVy=0)}W.slT>0||W.slRecallT>0||W.slLinkT>0?W.triFx=Math.min(1,W.triFx+4.1*t):!P&&W.slLinkT<=0&&W.slPow>0&&(W.slPow=Math.max(0,W.slPow-2.2*t)),W.slT<=0&&W.slRecallT<=0&&W.slLinkT<=0&&W.slWave<=0&&W.slPow<.01&&(W.slPow=0,W.slRopeRest=0,W.triFx=Math.max(0,W.triFx-2.2*t)),W.bx=V[0].x,W.by=V[0].y;let b=0,y=18,M=10;for(let t=0;t<V.length;t++)if(2==(0|V[t].t)){const t=gt(2);b=1,y=Math.min(y,t.healI||18),M=Math.max(M,t.healAmt||10)}if(b&&(W.bHealCd>0&&(W.bHealCd=Math.max(0,W.bHealCd-t)),W.bHealCd<=0&&W.hp<W.maxHp)){const t=Math.min(M,W.maxHp-W.hp);W.hp+=t,W.bHealCd=y,W.bHealFx=.7,u.msg="medic +"+(0|t),u.msgT=.9,Ht(W.x,W.y,"#84f0a6",10,62),p(760,.05,"triangle",.018)}if(!g&&W.bAtk)for(let e=0;e<V.length;e++){const a=V[e],l=gt(0|a.t||1);if(a.cd-=t,a.cd>0)continue;let s=0,n=l.range*l.range;for(let t=0;t<q.length;t++){const e=q[t],l=e.x-a.x,r=e.y-a.y,o=l*l+r*r;o<n&&(n=o,s=e)}if(s){const t=Math.hypot(s.x-a.x,s.y-a.y)||1,e=!!l.pulse,n=l.col,r=l.pier;Et({x:a.x,y:a.y,vx:(s.x-a.x)/t*420,vy:(s.y-a.y)/t*420,d:W.dmg*l.dmg,life:1.35,pier:r,c:n,r:l.size,pulse:e}),a.cd=l.rate,Ht(a.x,a.y,n,4,36)}else a.cd=.35}}else V.length=0,W.bCarry=0,W.botSlots=0,P=0,W.slCharge=0,W.slFocus=0,W.slT=0,W.slRecallT=0,W.slLinkT=0,W.slRecallPulse=0,W.slCarryVx=0,W.slCarryVy=0,W.slPow=0,W.slHitMask=0,W.slPerfect=0,W.slComboFx=0,W.slRopeRest=0;W.fireCd-=t,!g&&W.fireCd<=0&&(W.fireCd=W.fireRate,function(){const t=function(){let t=0,e=1e9;for(let a=0;a<q.length;a++){const l=q[a],s=l.x-W.x,n=l.y-W.y,r=s*s+n*n;r<e&&(e=r,t=l)}return t}();if(!t)return;let e=t.x-W.x,a=t.y-W.y,l=Math.hypot(e,a)||1;if(l>W.range)return;e/=l,a/=l;const s=W.shots;for(let t=0;t<s;t++){const l=1===s?0:.18*(t-(s-1)/2),n=Math.cos(l),r=Math.sin(l),o=e*n-a*r,i=e*r+a*n;Et({x:W.x,y:W.y,vx:520*o,vy:520*i,d:W.dmg,life:1.05,pier:1})}W.gx=e,W.gy=a,W.rx-=6*e,W.ry-=4*a,W.flash=.07,W.face=e>=0?1:-1,Ht(W.x+16*e,W.y+10*a,"#ffd56d",3,35),At(.025),p(640,.04,"square",.018)}()),u.bd2&&(u.endT+=t),!u.won&&u.kills>=d&&!u.mothDead&&0===q.length&&(u.won=1,u.msg="CAMPUS SECURED",u.msgT=999,u.bossDownT=4,At(.5),zt(.12),Ht(W.x,W.y,"#ffd56d",50,300),Ht(W.x,W.y,"#69f0c9",40,250),Ht(W.x,W.y,"#8ec0ff",30,200),p(523,.2,"triangle",.03),p(659,.18,"triangle",.025),p(784,.25,"triangle",.03));const v=u.kills<d&&!u.won&&!u.mothDead;u.spawnT-=t,v&&u.bd&&!u.pred&&!u.predDead&&!u.bs2&&!u.bd2&&u.kills>=1500&&function(){if(u.pred||u.predDead||q.length>=h)return;const t=Math.random()*Math.PI*2,e=1600+8*u.time,a={x:K(W.x+500*Math.cos(t),50,2550),y:K(W.y+500*Math.sin(t),50,1750),r:32,hp:e,s:76,dmg:24,vx:0,vy:0,ht:0,sl:0,ce:0,bm:0,bt:0,bi:"",k:9,prMax:e,prCloak:0,prCloakCd:Y(5,7),prLunge:0,prLungeDx:0,prLungeDy:0,prCloneCd:Y(10,15),prPhase:1,prTrailT:0};lt(a,26),q.push(a),u.pred=1,u.msg="the predator stalks...",u.msgT=2,p(80,.2,"sawtooth",.03),p(55,.25,"sawtooth",.018),At(.22)}(),v&&u.bd2&&!u.moth&&!u.mothDead&&u.kills>=m&&function(){if(u.moth||u.mothDead||q.length>=h)return;const t=Math.random()*Math.PI*2,e=8400+22*u.time,a={x:K(W.x+600*Math.cos(t),60,2540),y:K(W.y+600*Math.sin(t),60,1740),r:52,hp:e,s:54,dmg:48,vx:0,vy:0,ht:0,sl:0,ce:0,bm:0,bt:0,bi:"",k:11,moMax:e,moPhase:1,moScreamCd:Y(6,9),moScreamT:0,moBroodCd:Y(5,8),moWaveCd:Y(4,6),moWaveT:0,moRage:0};lt(a,40),q.push(a),u.moth=1,u.msg="THE MOTHER AWAKENS",u.msgT=3,p(60,.4,"sawtooth",.05),p(40,.5,"sawtooth",.035),p(90,.3,"triangle",.025),At(.42)}(),v&&2===u.sch.nsh&&!u.mb&&!u.mbd&&!u.bs&&!u.bd&&u.kills>=200&&function(){if(u.mb||u.mbd||u.bs||u.bd||u.bs2||u.bd2||q.length>=h)return;const t=Math.random()*Math.PI*2,e=320+8*u.time,a={x:K(W.x+440*Math.cos(t),40,2560),y:K(W.y+440*Math.sin(t),40,1760),r:28,hp:e,s:78,dmg:18,vx:0,vy:0,ht:0,sl:0,ce:0,bm:0,bt:0,bi:"",k:5,mbMax:e,mbChargeCd:Y(2.2,3.4),mbChargeT:0,mbDx:0,mbDy:0};lt(a,22),q.push(a),u.mb=1,u.msg="the provost charges in!",u.msgT=1.6,p(200,.12,"sawtooth",.028),At(.18)}();const R=u.kills>800||u.time>999;if(v&&2===u.sch.mel&&!u.bs&&!u.bd&&!u.bs2&&!u.bd2&&u.kills>=600&&R&&function(){if(u.bs||u.bd||u.bs2||u.bd2||q.length>=h)return;const t=Math.random()*Math.PI*2,e=880+14*u.time,a={x:K(W.x+520*Math.cos(t),40,2560),y:K(W.y+520*Math.sin(t),40,1760),r:38,hp:e,s:52,dmg:28,vx:0,vy:0,ht:0,sl:0,ce:0,bm:0,bt:0,bi:"",k:3,b1Max:e,b1Eat:0,b1Cd:0,b1BaseR:38,b1BaseS:52,b1BaseDmg:28,b1Pulse:0,b1Roar:0};lt(a,28),q.push(a),u.bs=1,u.msg="the dean hungers...",u.msgT=1.8,p(170,.15,"sawtooth",.03),p(85,.25,"sawtooth",.02),At(.24)}(),v&&u.bd&&!u.pred&&!u.bs2&&!u.bd2&&(u.t>=u.b2At||u.kills>=2500)&&function(){if(u.bs2||u.bd2||q.length>=h)return;const t=Math.random()*Math.PI*2,e=3200+42*u.time,a={x:K(W.x+560*Math.cos(t),44,2556),y:K(W.y+560*Math.sin(t),44,1756),r:46,hp:e,s:68,dmg:52,vx:0,vy:0,ht:0,sl:0,ce:0,bm:0,bt:0,bi:"",k:4,apMax:e,apBaseS:68,apCd:Y(1.1,1.8),apTele:0,apTeleD:0,apAimX:0,apAimY:0,apBurstLeft:0,apBurstSpd:920,apPhase:1,apStormCd:Y(2.8,4.2),apSummonCd:Y(2.6,3.8),apEvadeCd:0,apImpactCd:0,apSlamCd:0,apRegenCd:0,apShieldT:0};lt(a,36),q.push(a),u.bs2=1,u.msg="APEX DEAN APPROACHES",u.msgT=2,p(120,.2,"sawtooth",.04),p(60,.3,"sawtooth",.03),At(.38)}(),v&&u.spawnT<=0){u.spawnT=u.nextSpawn;const t=.78-.018*u.time,e=u.endT>0?.014*u.endT:0;u.nextSpawn=Math.max(.12,t-e),Xt(),!u.bs&&!u.bs2&&u.time>26&&Math.random()<.28&&Xt(),u.endT>0&&(Math.random()<.35+.04*u.endWave&&Xt(),u.endWave>=2&&Math.random()<.2&&Xt())}if(v&&u.endT>0&&(u.endSpawnT-=t,u.endSpawnT<=0)){u.endWave++,u.endSpawnT=Math.max(18,35-2.5*u.endWave),u.msg="ENDLESS WAVE "+u.endWave,u.msgT=2,At(.12),p(320,.08,"square",.02),p(440,.06,"triangle",.015);const t=4+2*u.endWave;for(let e=0;e<Math.min(t,12);e++)Xt()}for(let e=O.length-1;e>=0;e--){const a=O[e];if(a.life-=t,a.x+=a.vx*t,a.y+=a.vy*t,a.life<=0||a.x<-20||a.y<-20||a.x>2620||a.y>1820)O.splice(e,1);else for(let t=q.length-1;t>=0;t--){const l=q[t],s=l.x-a.x,n=l.y-a.y,r=a.r||3;if(s*s+n*n<(l.r+r)*(l.r+r)){let s=1;if(4===l.k&&l.apShieldT>0&&(s=.45),7===l.k){const t=Math.atan2(W.y-l.y,W.x-l.x),e=Math.atan2(l.vy||.001,l.vx||.001),a=Math.abs(t-e);(a<1.2||a>2*Math.PI-1.2)&&(s*=.35)}if(l.hp-=a.d*s,l.ht=a.pulse?.12:.09,l.vx+=a.vx*(a.pulse?.11:.07),l.vy+=a.vy*(a.pulse?.11:.07),a.pulse&&Ht(l.x,l.y,"#9de6ff",3,28),a.pier--,l.hp<=0&&Lt(t,a.pulse?"#9de6ff":"#ff9675",a.pulse?7:9,a.pulse?58:70,a.pulse?1:0),a.pier<0){O.splice(e,1);break}}}}let A=0,z=0,w=0,D=0,H=0;const Z=g;for(let e=q.length-1;e>=0;e--){const a=q[e];let l=W.x,s=W.y;if(Z)if(a.bi!==Z.id&&(a.bi=Z.id,a.bm=0,a.bt=Y(.9,1.7)),a.bt-=t,a.bt<=0&&(0===a.bm?(a.bm=1,a.bt=Y(1.1,2.1)):(a.bm=0,a.bt=Y(.9,1.7))),0===a.bm){const t=W.x-Z.x,e=W.y-Z.y,a=Math.hypot(t,e)||1;l=Z.x+t/a*(Z.r+8),s=Z.y+e/a*(Z.r+8)}else{const t=a.x-Z.x,n=a.y-Z.y,r=Math.hypot(t,n)||1;l=a.x+t/r*220+-n/r*Math.sin(2*u.t+e)*30,s=a.y+n/r*220+t/r*Math.sin(2*u.t+e)*30}else a.bi="",a.bt=0,a.bm=0;if(11===a.k){a.moMax||(a.moMax=a.hp);const e=K(a.hp/(a.moMax||1),0,1);if(a.moPhase=e>.6?1:e>.25?2:3,a.moRage=a.moPhase-1,a.moScreamCd-=t,a.moScreamT>0){if(a.moScreamT=Math.max(0,a.moScreamT-t),!g){const e=W.x-a.x,l=W.y-a.y,s=Math.hypot(e,l)||1;s<320+60*a.moRage&&(W.vx*=Math.max(.3,1-3.5*t),W.vy*=Math.max(.3,1-3.5*t),W.vx-=e/s*80*t,W.vy-=l/s*80*t)}Math.random()<.4&&Bt({x:a.x+Y(2*-a.r,2*a.r),y:a.y+Y(2*-a.r,2*a.r),vx:Y(-30,30),vy:Y(-30,30),t:Y(.1,.22),c:"#cc44cc"})}else a.moScreamCd<=0&&(a.moScreamT=1.2+.4*a.moRage,a.moScreamCd=Y(Math.max(3,6-1.5*a.moRage),Math.max(5,9-2*a.moRage)),Ht(a.x,a.y,"#dd66dd",16+4*a.moRage,200+40*a.moRage),p(70,.12,"sawtooth",.03),u.msg=3===a.moPhase?"MOTHER SCREAMS!":"mother scream!",u.msgT=.8);if(a.moBroodCd-=t,a.moBroodCd<=0){const t=2+a.moPhase;for(let e=0;e<t;e++)_t(a);a.moBroodCd=Y(Math.max(3,6-a.moRage),Math.max(4,8-a.moRage)),Ht(a.x,a.y,"#993399",8,80),p(100,.05,"sawtooth",.015)}if(a.moWaveCd-=t,a.moWaveT>0)a.moWaveT=Math.max(0,a.moWaveT-t);else if(a.moWaveCd<=0){a.moWaveT=.6,a.moWaveCd=Y(Math.max(2.5,4.5-.8*a.moRage),Math.max(3.5,6-a.moRage));const t=180+50*a.moRage,e=10+5*a.moRage,l=Math.hypot(W.x-a.x,W.y-a.y);l<t&&!g&&$t(e*(1-l/t)),Ht(a.x,a.y,"#ee55ee",14+4*a.moRage,.6*t),p(90,.08,"sawtooth",.022)}a.s=54+12*a.moRage}if(9===a.k){a.prMax||(a.prMax=a.hp),a.prCloakCd||(a.prCloakCd=Y(4,6)),a.prCloneCd||(a.prCloneCd=Y(8,12));const e=K(a.hp/(a.prMax||1),0,1);a.prPhase=e>.5?1:2;const n=2===a.prPhase?1:0;if(a.prCloakCd-=t,a.prCloak>0){a.prCloak=Math.max(0,a.prCloak-t);const e=Math.atan2(W.y-a.y,W.x-a.x)+(.7+.3*n),r=180+40*n;if(l=W.x+Math.cos(e)*r,s=W.y+Math.sin(e)*r,a.s=1.5*(88+30*n),Math.random()<.3&&Bt({x:a.x+Y(-a.r,a.r),y:a.y+Y(-a.r,a.r),vx:Y(-10,10),vy:Y(-10,10),t:Y(.06,.14),c:"rgba(180,20,20,.5)"}),a.prCloak<=0){const t=W.x-a.x,e=W.y-a.y,l=Math.hypot(t,e)||1;a.prLunge=.35,a.prLungeDx=t/l,a.prLungeDy=e/l,a.prCloakCd=Y(Math.max(2.5,4.5-1.5*n),Math.max(3.5,6-1.5*n)),Ht(a.x,a.y,"#ff3333",14,100),p(160,.06,"sawtooth",.025),u.msg=2===a.prPhase?"PREDATOR STRIKES!":"predator lunges!",u.msgT=.7}}else a.prCloakCd<=0&&(a.prCloak=Y(2.2+.8*n,3.5+1*n),a.prCloakCd=99,Ht(a.x,a.y,"rgba(120,10,10,.6)",10,70),p(100,.08,"sawtooth",.018),u.msg="predator cloaks...",u.msgT=1);if(a.prLunge>0&&(a.prLunge=Math.max(0,a.prLunge-t),a.vx+=1100*(a.prLungeDx||0)*t,a.vy+=1100*(a.prLungeDy||0)*t,Math.random()<.5&&Bt({x:a.x+Y(-8,8),y:a.y+Y(-8,8),vx:-(a.prLungeDx||0)*Y(40,100),vy:-(a.prLungeDy||0)*Y(40,100),t:Y(.08,.2),c:"#ff3333"})),a.s=a.prCloak>0?1.5*(88+30*n):88+30*n,a.prCloneCd-=t,a.prCloneCd<=0){const t=2===a.prPhase?3:2;for(let e=0;e<t;e++)Vt(a);a.prCloneCd=Y(Math.max(5,9-3*n),Math.max(7,12-3*n)),Ht(a.x,a.y,"#881111",10,80),p(110,.06,"sawtooth",.016),u.msg="predator summons shadows",u.msgT=.9}a.prTrailT-=t,a.prTrailT<=0&&a.prCloak<=0&&(a.prTrailT=.08,Bt({x:a.x+Y(-4,4),y:a.y+Y(-4,4),vx:Y(-12,12),vy:Y(5,20),t:Y(.12,.24),c:"#aa2222"}))}if(10===a.k&&void 0!==a.cloneLife&&(a.cloneLife-=t,a.cloneLife<=0)){Ht(a.x,a.y,"#661111",6,30),q.splice(e,1);continue}if(5===a.k)if(a.mbMax||(a.mbMax=a.hp),a.mbChargeCd||(a.mbChargeCd=Y(2.2,3.4)),a.mbChargeT||(a.mbChargeT=0),a.mbChargeCd-=t,a.mbChargeT>0)a.mbChargeT=Math.max(0,a.mbChargeT-t),a.vx+=680*(a.mbDx||0)*t,a.vy+=680*(a.mbDy||0)*t,Math.random()<.4&&Bt({x:a.x+Y(-6,6),y:a.y+Y(-6,6),vx:-(a.mbDx||0)*Y(30,80),vy:-(a.mbDy||0)*Y(30,80),t:Y(.08,.18),c:"#ffa64d"});else if(a.mbChargeCd<=0&&!g){const t=W.x-a.x,e=W.y-a.y,l=Math.hypot(t,e)||1;a.mbDx=t/l,a.mbDy=e/l,a.mbChargeT=.42,a.mbChargeCd=Y(2,3.2),Ht(a.x,a.y,"#ffa64d",8,60),p(220,.05,"sawtooth",.02),u.msg="provost charges!",u.msgT=.7}if(8===a.k&&(a.healCd||(a.healCd=Y(1.8,2.8)),a.healCd-=t,a.healCd<=0)){a.healCd=Y(1.6,2.6);const t=120,l=15+.4*u.time;let s=0;for(let n=0;n<q.length;n++){if(n===e||q[n].k>=3)continue;const r=q[n].x-a.x,o=q[n].y-a.y;r*r+o*o<t*t&&(q[n].hp+=l,q[n].ht=Math.max(q[n].ht,.06),s++)}s>0&&(Ht(a.x,a.y,"#7fff7f",6+2*s,.6*t),Math.random()<.5&&Bt({x:a.x,y:a.y-10,vx:0,vy:-30,t:.3,c:"#7fff7f"}))}if(3===a.k&&(a.b1Max||(a.b1Max=a.hp),a.b1BaseR||(a.b1BaseR=a.r),a.b1BaseS||(a.b1BaseS=a.s),a.b1BaseDmg||(a.b1BaseDmg=a.dmg),a.b1Cd>0&&(a.b1Cd=Math.max(0,a.b1Cd-t)),a.b1Pulse>0&&(a.b1Pulse=Math.max(0,a.b1Pulse-t)),a.b1Roar>0&&(a.b1Roar=Math.max(0,a.b1Roar-t))),4===a.k){a.apMax||(a.apMax=a.hp),a.apBaseS||(a.apBaseS=a.s),a.apCd||(a.apCd=Y(1.1,1.8)),a.apStormCd||(a.apStormCd=Y(2.8,4.2)),a.apSummonCd||(a.apSummonCd=Y(2.6,3.8)),a.apBurstSpd||(a.apBurstSpd=920),a.apTele||(a.apTele=0),a.apBurstLeft||(a.apBurstLeft=0),a.apEvadeCd||(a.apEvadeCd=0),a.apImpactCd||(a.apImpactCd=0),a.apSlamCd||(a.apSlamCd=0),a.apRegenCd||(a.apRegenCd=0),a.apShieldT||(a.apShieldT=0);const e=K(a.hp/(a.apMax||1),0,1),l=e>.66?1:e>.33?2:3,s=l-1;a.apPhase=l,a.s=(a.apBaseS||68)*(1+.18*s+(W.zt>0?.22:0)),a.apCd-=t,a.apStormCd-=t,a.apSummonCd-=t,a.apEvadeCd>0&&(a.apEvadeCd=Math.max(0,a.apEvadeCd-t)),a.apImpactCd>0&&(a.apImpactCd=Math.max(0,a.apImpactCd-t)),a.apSlamCd>0&&(a.apSlamCd=Math.max(0,a.apSlamCd-t)),a.apRegenCd>0&&(a.apRegenCd=Math.max(0,a.apRegenCd-t)),a.apShieldT>0&&(a.apShieldT=Math.max(0,a.apShieldT-t));const n=W.x-a.x,r=W.y-a.y,o=Math.hypot(n,r)||1,i=1===l?.38:2===l?.58:.78,h=K(W.x+W.vx*i+34*(W.zx||0),20,2580),f=K(W.y+W.vy*i+34*(W.zy||0),20,1780);if(!g&&o<140+20*l&&a.apSlamCd<=0&&a.apTele<=0){a.apSlamCd=Math.max(2.2,4.2-1.1*s),o<120+28*l&&$t(14+6*l+4*s);const t=320+80*l;W.vx+=(W.x-a.x)/o*t,W.vy+=(W.y-a.y)/o*t,At(.22+.08*s),zt(.04),Ht(a.x,a.y,"#e0c8ff",22+6*l,160+30*l),Ht(a.x,a.y,"#ff8bd9",10+3*l,100+20*l),Kt(K(a.x+Y(-18,18),24,2576),K(a.y+Y(-18,18),24,1776),52+14*l,1.6+.4*l),p(90,.1,"sawtooth",.035),p(55,.14,"sawtooth",.025),u.msg=3===l?"APEX SLAM! OMEGA FURY!":"apex ground slam!",u.msgT=.9,a.vx*=.1,a.vy*=.1}if(l>=3&&a.apRegenCd<=0){const t=Math.min(.008*a.apMax,a.apMax-a.hp);t>0&&(a.hp+=t,Math.random()<.35&&Bt({x:a.x+Y(-14,14),y:a.y+Y(-14,14),vx:Y(-10,10),vy:Y(-30,-10),t:Y(.15,.3),c:"#d8b4ff"})),a.apRegenCd=.35}if(a.apShieldT>0&&Math.random()<.5&&Bt({x:a.x+Y(-a.r,a.r),y:a.y+Y(-a.r,a.r),vx:Y(-16,16),vy:Y(-16,16),t:Y(.08,.16),c:"#c8b6ff"}),l>1&&!a.apLastPhase&&(a.apLastPhase=1),a.apLastPhase&&l!==a.apLastPhase&&(a.apShieldT=1.8,a.apLastPhase=l,Ht(a.x,a.y,"#c8b6ff",18,140),p(180,.08,"triangle",.022),u.msg=2===l?"APEX RAGE MODE":"APEX OMEGA FRENZY",u.msgT=1.2,Yt(a,l+1,l)),!g&&W.zt>0&&a.apEvadeCd<=0){const t=Math.random()<.5?-1:1,e=300+90*s;a.vx+=-W.zy*t*e,a.vy+=W.zx*t*e,l>=2&&Math.random()<.35&&(a.vx+=n/o*180,a.vy+=r/o*180),a.apEvadeCd=Math.max(.35,.55-.1*s),l>=2&&Math.random()<.55+.15*s&&Kt(K(a.x+-W.zy*t*60,24,2576),K(a.y+W.zx*t*60,24,1776),62+14*s,2+.45*s),Ht(a.x,a.y,"#d7c1ff",12+2*l,80+10*l),p(176-.05*s,.05,"sawtooth",.02)}if(a.apTele>0){if(a.apTele=Math.max(0,a.apTele-t),a.vx*=Math.max(0,1-13*t),a.vy*=Math.max(0,1-13*t),Math.random()<.65&&Bt({x:a.x+Y(-8,8),y:a.y+Y(-8,8),vx:Y(-26,26),vy:Y(-26,26),t:Y(.1,.2),c:"#dab9ff"}),Math.random()<.6&&Bt({x:a.apAimX+Y(-10,10),y:a.apAimY+Y(-10,10),vx:Y(-20,20),vy:Y(-20,20),t:Y(.08,.18),c:"#f4dcff"}),a.apTele<=0){const t=a.apAimX-a.x,e=a.apAimY-a.y,n=Math.hypot(t,e)||1,r=(a.apBurstSpd||920)+180*s+Y(-45,70);a.vx+=t/n*r,a.vy+=e/n*r,a.ht=Math.max(a.ht,.18),At(.22+.06*s),zt(.035),Ht(a.x,a.y,"#c7a9ff",24,160),Kt(K(a.apAimX+Y(-22,22),24,2576),K(a.apAimY+Y(-22,22),24,1776),72+16*s,2.4+.6*s),l>=2?Yt(a,3===l?4:2,l):Math.random()<.3&&Yt(a,1,l),a.apBurstLeft=(0|a.apBurstLeft)-1,a.apBurstLeft>0?(a.apTeleD=Math.max(.16,.3-.04*s),a.apTele=a.apTeleD,a.apAimX=K(W.x+W.vx*(.7*i)+Y(-36,36),20,2580),a.apAimY=K(W.y+W.vy*(.7*i)+Y(-36,36),20,1780)):a.apCd=Y(Math.max(.36,1-.28*s),Math.max(.65,1.6-.34*s)),p(140-10*s,.07,"sawtooth",.035)}}else if(a.apCd<=0){const t=o<180,e=o>360;let i=1===l?2:2===l?3:4;if(t&&l>=2&&i++,e&&(i=Math.max(i,3)),a.apBurstLeft=i,a.apTeleD=Math.max(.2,.46-.09*s-(t?.08:0)),a.apTele=a.apTeleD,a.apAimX=h,a.apAimY=f,a.apBurstSpd=880+190*s+(e?110:0),Math.random()<.45+.25*s){const t=Math.random()<.5?-1:1;a.apAimX=K(a.apAimX+-r/o*t*(80+50*s),20,2580),a.apAimY=K(a.apAimY+n/o*t*(80+50*s),20,1780)}u.msg=3===l?"APEX FRENZY!":"apex charging",u.msgT=.6,Ht(a.x,a.y,"#b59bff",14+5*l,100+22*l),p(185-12*s,.06,"square",.022),a.apSummonCd<=0&&(Yt(a,l+1,l),a.apSummonCd=Y(Math.max(.9,2.4-.7*s),Math.max(1.4,3.4-.8*s)))}if(a.apStormCd<=0&&!g){if(Kt(K(W.x+.36*W.vx+Y(-40,40),24,2576),K(W.y+.36*W.vy+Y(-40,40),24,1776),68+14*l,2.2+.55*l),l>=2&&Math.random()<.35+.15*s&&Kt(K(a.x+Y(-140,140),24,2576),K(a.y+Y(-140,140),24,1776),60+12*l,2+.45*l),l>=3&&Math.random()<.28){const t=Math.random()*Math.PI*2;Kt(K(W.x+130*Math.cos(t)+Y(-30,30),24,2576),K(W.y+130*Math.sin(t)+Y(-30,30),24,1776),56+10*s,1.8+.4*s)}a.apStormCd=Y(Math.max(2,3.8-.55*s),Math.max(2.8,5-.55*s))}if(!g){const e=a.x-W.x,s=a.y-W.y,n=Math.hypot(e,s)||1,r=340+50*l;if(n<r){const a=(1-n/r)*(130+48*l);W.x=K(W.x+e/n*a*t,12,2588),W.y=K(W.y+s/n*a*t,12,1788),W.rx-=e/n*(1.8+.42*l),W.ry-=s/n*(1.5+.36*l)}}}const n=l-a.x,r=s-a.y,o=Math.hypot(n,r)||1;let i=1,h=0,f=0,c=0,d=0;for(let e=0;e<_.length;e++){const l=_[e],s=a.x-l.x,n=a.y-l.y,r=s*s+n*n;if(5!==l.k){if(1===l.k){const e=1.9*l.r;if(r<e*e){const o=Math.sqrt(r)||1,h=1-o/e,f=120+h*h*390;a.vx+=-s/o*f*t,a.vy+=-n/o*f*t,i=Math.min(i,.8),r<l.r*l.r&&(i=Math.min(i,.48),c+=.95*W.chDo+7)}continue}if(!(r>=l.r*l.r))if(2===l.k)i=Math.min(i,.5);else if(3===l.k)i=Math.min(i,.72),c+=.75*W.chDo+4;else if(4===l.k){const e=Math.sqrt(r)||1,o=1-e/l.r,h=170+o*o*420;a.vx+=-s/e*h*t,a.vy+=-n/e*h*t,i=Math.min(i,.28),c+=2.1*W.chDo+22,d=1,(a.sc||0)<=0&&(a.sc=.24,Ht(a.x,a.y,"#c8f3ff",4,34))}}else r<l.r*l.r&&4!==a.k&&(i=Math.min(i,1.15))}a.sc>0&&(a.sc=Math.max(0,a.sc-t));for(let e=0;e<G.length;e++){const l=G[e],s=a.x-l.x,n=a.y-l.y,r=s*s+n*n,o=0|l.m;if(3===o){const e=2.35*l.r;if(r<e*e){const o=Math.sqrt(r)||1,c=1-o/e,d=90+c*c*350;a.vx+=-s/o*d*t,a.vy+=-n/o*d*t,i=Math.min(i,.88),r<l.r*l.r&&(f=3,i=Math.min(i,.42),h=1)}continue}if(r<l.r*l.r){f=o;const t=1===o?.3:2===o?.18:W.mkSl;i=Math.min(i,1-t),h=1,1===o&&W.cat&&a.ce<=0&&(a.ce=.55,a.hp-=W.chBurst,Ht(a.x,a.y,"#ffd58f",5,44));break}}if(W.bot&&V.length)for(let t=0;t<V.length;t++){const e=V[t],l=a.x-e.x,s=a.y-e.y,n=l*l+s*s,r=gt(0|e.t||1);n<400&&(i=Math.min(i,.65)),r.auraR>0&&n<r.auraR*r.auraR&&(i=Math.min(i,1-r.auraSl))}if((P||W.slRecallT>0||W.slLinkT>0)&&V.length>=3){i=Math.min(i,P?.58:.66);let t=0;for(let e=0;e<3;e++){const l=V[e],s=a.r+14;if(U(a.x,a.y,W.x,W.y,l.x,l.y)<s*s){t=1;break}}if(t&&(a.tc||0)<=0){const t=P?Math.max(.1,W.slCharge):Math.max(.32,W.slPow),l=P?.24+.38*t:.34+.92*t,s=W.zDmg*l*(a.k>=3?.82:1);a.hp-=s,a.ht=Math.max(a.ht,P?.12:.16);const n=(P?170:230)+(P?120:250)*t,r=P?W.zx:W.slDx,o=P?W.zy:W.slDy;if(a.vx+=r*n,a.vy+=o*n,a.tc=P?.08:.06,z++,Ht(a.x,a.y,P?"#95edff":"#bff8ff",P?3:5,P?34:48),a.hp<=0){Lt(e,P?"#95edff":"#bff8ff",P?9:11,P?70:84,1),w++;continue}}}if((W.slT>0||W.slRecallT>0)&&V.length>=3){const t=W.slT<=0&&W.slRecallT>0;let l=0;for(let s=0;s<3;s++){const n=V[s],r=a.x-n.x,o=a.y-n.y,i=a.r+(t?20:22);if(r*r+o*o<i*i&&(a.tc||0)<=0){const i=(t?1.05:1.45)+(t?1.05:1.75)*W.slPow,h=W.zDmg*i*(a.k>=3?.82:t?1:1.05);a.hp-=h,a.ht=.18;const f=Math.hypot(r,o)||1,c=Math.hypot(W.x-n.x,W.y-n.y)||1,d=t?(W.x-n.x)/c:W.slDx,m=t?(W.y-n.y)/c:W.slDy,b=(t?240:340)+(t?190:320)*W.slPow;if(a.vx+=d*b+r/f*(130+100*W.slPow),a.vy+=m*b+o/f*(130+100*W.slPow),a.tc=t?.08:.095,z++,Ht(a.x,a.y,t?"#bdf7ff":"#8eefff",t?5:7,t?52:64),l=1,!t){const t=1<<s;W.slHitMask&t||(W.slHitMask|=t),D||7!==W.slHitMask||(D=1,H=Math.max(H,W.slPow),W.slLinkT=Math.max(W.slLinkT,.8140000000000001),W.slWave=Math.max(W.slWave,.95),W.slComboFx=Math.max(W.slComboFx,1.2),u.msg="triple crack",u.msgT=.7,p(1240,.04,"square",.024),p(820,.05,"triangle",.017))}if(a.hp<=0){Lt(e,t?"#bdf7ff":"#8eefff",t?9:12,t?76:92,1),w++;break}}}if(l&&a.hp<=0)continue}if(a.tc>0&&(a.tc=Math.max(0,a.tc-t)),4===a.k){const t=a.apPhase||1;d?(i=Math.min(i,.22),c+=3.5*W.chDo+38,(a.sc||0)<=0&&(a.sc=.18,Ht(a.x,a.y,"#8effdc",8,58))):i=Math.max(i,t>=3?.72:2===t?.62:.54)}if(a.sl=h,h){const l=W.cat&&1===f?W.chDo:0;if(l>0&&(a.hp-=l*t),a.ht=Math.max(a.ht,.08),a.hp<=0){Lt(e,"#f7d96b",8,60);continue}}if(c>0&&(a.hp-=c*t,a.ht=Math.max(a.ht,.11),a.hp<=0)){Lt(e,"#c8f3ff",10,76,1);continue}a.ce>0&&(a.ce=Math.max(0,a.ce-t)),a.vx*=Math.max(0,1-8*t),a.vy*=Math.max(0,1-8*t),a.ht=Math.max(0,a.ht-t),a.x+=(n/o*a.s*i+a.vx)*t,a.y+=(r/o*a.s*i+a.vy)*t,lt(a,6)&&(a.vx*=.4,a.vy*=.4);const m=W.x-a.x,b=W.y-a.y;if((Math.hypot(m,b)||1)<a.r+W.r-1){if(W.zt>0){if(a.hp-=W.zDmg,a.ht=.12,a.vx+=280*W.zx,a.vy+=280*W.zy,z++,a.hp<=0){Lt(e,"#8fffe5",12,90,1),w++;continue}A+=.35*a.dmg;continue}4===a.k&&a.apImpactCd<=0&&!g&&(a.apImpactCd=.9,Kt(K(W.x+Y(-16,16),24,2576),K(W.y+Y(-16,16),24,1776),68+10*(a.apPhase||1),2.2+.35*(a.apPhase||1)),Ht(W.x,W.y,"#e1c6ff",10,84),At(.15)),A+=4===a.k?1.2*a.dmg:a.dmg}}if(W.slRecallPulse){W.slRecallPulse=0;const t=132*(.88+.24*Math.min(1,W.slPow)),e=t*t,a=W.zDmg*(.48+.62*Math.min(1,W.slPow));let l=0;for(let s=q.length-1;s>=0;s--){const n=q[s],r=n.x-W.x,o=n.y-W.y,i=r*r+o*o;if(i>e)continue;const h=Math.sqrt(i)||1,f=1-h/t;n.hp-=a*(.58+.42*f),n.ht=Math.max(n.ht,.13);const c=170+220*f*(.7+.3*Math.min(1,W.slPow));n.vx+=r/h*c,n.vy+=o/h*c,l++,z++,Math.random()<.26&&Ht(n.x,n.y,"#cdf9ff",3,34),n.hp<=0&&(Lt(s,"#cdf9ff",10,78,1),w++)}W.slWave=Math.max(W.slWave,.78),W.slComboFx=Math.max(W.slComboFx,.48),Ht(W.x,W.y,"#cdf9ff",16,104+66*Math.min(1,W.slPow)),l>0&&(u.msg="recall burst",u.msgT=.55,zt(.035+.015*Math.min(1,W.slPow)),At(.08+.07*Math.min(1,W.slPow)),p(900,.03,"square",.018))}if(D){const t=165*(.9+.35*H),e=t*t,a=W.zDmg*(.7+1.1*H);for(let l=q.length-1;l>=0;l--){const s=q[l],n=s.x-W.x,r=s.y-W.y,o=n*n+r*r;if(o>e)continue;const i=Math.sqrt(o)||1,h=1-i/t;s.hp-=a*(.55+.45*h),s.ht=Math.max(s.ht,.14);const f=220+280*H*h;s.vx+=n/i*f,s.vy+=r/i*f,z++,Math.random()<.32&&Ht(s.x,s.y,"#b8f6ff",3,40),s.hp<=0&&(Lt(l,"#b8f6ff",11,86,1),w++)}zt(.06+.03*Math.min(1,H)),At(.2+.14*Math.min(1,H)),Ht(W.x,W.y,"#b8f6ff",20,130+90*H)}z>0&&(zt(Math.min(.04,.012*z)),At(Math.min(.24,.04*z)),u.xpPulse=Math.min(.6,u.xpPulse+.06*z),p(260,.02,"square",.016),w>1&&p(310,.02,"square",.013)),A>0&&$t(A*t);for(let e=N.length-1;e>=0;e--){const a=N[e],l=W.x-a.x,s=W.y-a.y,n=Math.hypot(l,s)||1;if(W.bot&&V.length)if(a.bc){const e=(0|a.bc)-1,l=e>=0&&e<V.length?V[e]:V[0],s=gt(0|l.t||1),n=l.x-a.x,r=l.y-a.y,o=Math.hypot(n,r)||1,i=Math.min(1.3*s.pull,13*o);a.x+=n/o*i*t,a.y+=r/o*i*t}else{let e=0;for(let t=0;t<V.length;t++)e+=gt(0|V[t].t||1).carry;if(W.bCarry<e&&n>1.45*W.magnet)for(let e=0;e<V.length;e++){const l=V[e];if(l.grabCd>0)continue;const s=gt(0|l.t||1),n=l.x-a.x,r=l.y-a.y,o=Math.hypot(n,r)||1;if(o<s.fetch){a.x+=n/o*s.pull*t,a.y+=r/o*s.pull*t,o<10&&(a.bc=e+1,W.bCarry++,l.grabCd=s.grab,Ht(a.x,a.y,"#9de6ff",3,24));break}}}n<W.magnet&&(a.x+=l/n*240*t,a.y+=s/n*240*t),n<W.r+8&&Zt(e,a.bc?"bot":"player")}if((E.gr||L)&&Math.random()<.04&&u.time>2&&Wt({x:K(W.x+Y(-20,20),12,2588),y:K(W.y+Y(-20,20),12,1788),v:4,m:1,t:0}),u.bs)for(let t=0;t<q.length;t++){const e=q[t];if(!(3!==e.k||e.b1Cd>0))for(let t=N.length-1;t>=0;t--){const a=N[t],l=a.x-e.x,s=a.y-e.y;if(Math.hypot(l,s)<e.r){if(Math.hypot(a.x-W.x,a.y-W.y)<W.magnet)continue;N.splice(t,1),e.b1Eat=(e.b1Eat||0)+1,e.b1Cd=.14,e.b1Pulse=.35;const l=e.b1Eat,s=1/(1+.035*l);e.r=e.b1BaseR+1.6*l*s,e.hp=Math.min(e.hp+35*s,e.b1Max+35*s),e.b1Max+=35*s,e.dmg=e.b1BaseDmg+2*l*s,e.s=e.b1BaseS+2.4*l*s,Ht(e.x,e.y,"#69f0c9",6,e.r+18),p(120+6*l,.06,"sawtooth",.018),l%5==0&&(e.b1Roar=.6,At(.14),Ht(e.x,e.y,"#a789ff",14,e.r+50),p(80,.12,"sawtooth",.028),u.msg="the dean grows stronger!",u.msgT=1.4)}}}}(y),function(){const t=u.shake*u.shake,n=10*(2*Math.random()-1)*t,h=10*(2*Math.random()-1)*t;e.setTransform(s,0,0,s,n,h);const x=K(W.x-.5*a,0,2600-a),y=K(W.y-.5*l,0,1800-l),p=e.createLinearGradient(0,0,0,l);p.addColorStop(0,"#263f60"),p.addColorStop(.55,"#16273f"),p.addColorStop(1,"#0b111a"),e.fillStyle=p,e.fillRect(0,0,a,l),e.strokeStyle="rgba(63,96,132,.35)",e.lineWidth=1;const g=-x%56;for(let t=-y%56;t<l;t+=56)e.beginPath(),e.moveTo(0,0|t),e.lineTo(a,0|t),e.stroke();for(let t=g;t<a;t+=56)e.beginPath(),e.moveTo(0|t,0),e.lineTo(0|t,l),e.stroke();const M=1300-x,k=900-y;e.fillStyle="rgba(105,240,201,.07)",e.beginPath(),e.arc(M,k,210,0,2*Math.PI),e.fill();const T=at(W.x,W.y,-8);for(let t=0;t<r.length;t++){const s=r[t],n=s.x-x,h=s.y-y;if(n<-s.r-30||h<-s.r-30||n>a+s.r+30||h>l+s.r+30)continue;const f="home"===s.id?0:2===u.sch[s.id],c="home"===s.id?!W.mkOn:1===u.sch[s.id]||"nsh"===s.id&&(0===u.sch.nsh||2===u.sch.nsh&&u.labNsh>0)||"mel"===s.id&&(2===u.sch.nsh&&0===u.sch.mel||2===u.sch.mel&&u.labMel>0);e.globalAlpha=f?.18:c?.14:.08,e.fillStyle=s.c,e.beginPath(),e.arc(n,h,s.r,0,2*Math.PI),e.fill(),e.globalAlpha=.65,e.strokeStyle=f?"#9effc8":s.c,e.lineWidth=2,e.beginPath(),e.arc(n,h,s.r,0,2*Math.PI),e.stroke(),e.globalAlpha=1,e.fillStyle="#dce8ff",e.font="600 12px Trebuchet MS,sans-serif",e.fillText(s.n,n-s.r+10,h-s.r-8);const d="home"===s.id?48:44,m=30,b=n-.5*d,p=h-.5*m;if(e.fillStyle="rgba(18,25,37,.9)",e.fillRect(b,p,d,m),e.strokeStyle="rgba(165,190,220,.55)",e.lineWidth=1,e.strokeRect(b+.5|0,p+.5|0,d-1,m-1),e.fillStyle="rgba(248,234,164,.86)",e.fillRect(b+6|0,p+6|0,11,8),e.fillRect(b+d-17|0,p+6|0,11,8),e.fillStyle="rgba(44,56,72,.95)",e.beginPath(),e.arc(b+11+Math.sin(2*u.t+t),p+11,1.7,0,2*Math.PI),e.fill(),e.beginPath(),e.arc(b+d-11+Math.sin(2*u.t+t+1),p+11,1.7,0,2*Math.PI),e.fill(),u.start&&!u.dead){const a=T?i:o,l=a[(.45*u.t+2*t|0)%a.length],r=h-.44*s.r,f=4.6*l.length+12;e.fillStyle="rgba(8,12,20,.82)",Q(n-.5*f,r-9,f,16,7),e.fill(),e.fillStyle="rgba(220,240,255,.9)",e.font="600 9px Trebuchet MS,sans-serif",e.fillText(l,n-.5*f+6,r+3)}}for(let t=0;t<N.length;t++){const s=N[t],n=s.x-x,r=s.y-y;n<-10||r<-10||n>a+10||r>l+10||(e.fillStyle="#69f0c9",e.beginPath(),e.arc(n,r,5,0,2*Math.PI),e.fill(),e.fillStyle="#ceffef",e.fillRect(n-1|0,r-1|0,2,2))}for(let t=0;t<G.length;t++){const s=G[t],n=s.x-x,r=s.y-y;if(n<-s.r-20||r<-s.r-20||n>a+s.r+20||r>l+s.r+20)continue;const o=s.t/s.d;e.globalAlpha=.24+.22*o;let i="#f4d96e",h="#fff0a9";W.cat&&(1===s.m?(i="#53d93d",h="#baff87"):2===s.m?(i="#42cdb9",h="#a8f6ea"):3===s.m&&(i="#597fd6",h="#bdd4ff")),e.fillStyle=i,e.beginPath(),e.arc(n,r,s.r,0,2*Math.PI),e.fill(),e.globalAlpha=.34+.28*Math.sin(5*(u.t+t))*o,e.strokeStyle=h,e.lineWidth=1.9,e.beginPath(),e.arc(n,r,.68*s.r+2*Math.sin(4*(u.t+t)),0,2*Math.PI),e.stroke(),W.cat&&(3===s.m&&(e.globalAlpha=.1+.08*o,e.strokeStyle="rgba(175,205,255,.72)",e.lineWidth=1.25,e.beginPath(),e.arc(n,r,2.35*s.r*(.97+.03*Math.sin(2*u.t+t)),0,2*Math.PI),e.stroke(),e.globalAlpha=.08+.07*o,e.strokeStyle="rgba(140,174,255,.58)",e.lineWidth=1,e.beginPath(),e.arc(n,r,1.6*s.r*(.96+.04*Math.sin(2.7*u.t+.8*t)),0,2*Math.PI),e.stroke()),e.globalAlpha=.18+.24*o,1===s.m?e.fillStyle="#dbff8f":2===s.m?e.fillStyle="#d8fff7":3===s.m?e.fillStyle="#e1ebff":e.fillStyle="#f1ffb3",e.beginPath(),e.arc(n+Math.sin(4*u.t+t)*s.r*.22,r-.16*s.r,2.4+.7*Math.sin(7*u.t+t),0,2*Math.PI),e.fill(),e.beginPath(),e.arc(n-.18*s.r,r+Math.sin(3*u.t+.7*t)*s.r*.14,1.9+.5*Math.sin(8*u.t+.4*t),0,2*Math.PI),e.fill(),e.beginPath(),e.arc(n+.12*s.r,r+.2*s.r,1.6+.4*Math.sin(6*u.t+.5*t),0,2*Math.PI),e.fill()),e.globalAlpha=1}for(let t=0;t<_.length;t++){const s=_[t],n=s.x-x,r=s.y-y;if(n<-s.r-40||r<-s.r-40||n>a+s.r+40||r>l+s.r+40)continue;const o=s.t/s.d,i=.86+.12*Math.sin(5*u.t+t),h=s.r*i;let f="#95f0b8",c="#d6ffea",d="#6ae9b4";if(2===s.k?(f="#7cf6e7",c="#d8fff7",d="#a0fff0"):3===s.k?(f="#c5f690",c="#efffd0",d="#d9ffab"):4===s.k?(f="#bde9ff",c="#f0fbff",d="#d4f2ff"):5===s.k&&(f="#b89edf",c="#d8c4f0",d="#c4a8e8"),e.globalAlpha=.14+.16*o,e.fillStyle=f,e.beginPath(),e.arc(n,r,h,0,2*Math.PI),e.fill(),e.globalAlpha=.28+.24*o,e.strokeStyle=c,e.lineWidth=2,e.beginPath(),e.arc(n,r,.78*h,0,2*Math.PI),e.stroke(),e.globalAlpha=.2+.2*o,e.strokeStyle=d,e.lineWidth=1.4,e.beginPath(),e.arc(n,r,h*(1.08+.05*Math.sin(7*u.t+t)),0,2*Math.PI),e.stroke(),4===s.k)for(let t=0;t<3;t++){const a=5.6*u.t+2.1*t,l=n+Math.cos(a)*h*.62,s=r+Math.sin(a)*h*.62;e.globalAlpha=.5+.3*o,e.fillStyle="#f2fcff",e.beginPath(),e.arc(l,s,2.3,0,2*Math.PI),e.fill()}if(5===s.k){for(let t=0;t<4;t++){const a=-4.2*u.t+1.57*t,l=n+Math.cos(a)*h*.55,s=r+Math.sin(a)*h*.55;e.globalAlpha=.35+.25*o,e.fillStyle="#e0c8ff",e.beginPath(),e.arc(l,s,2,0,2*Math.PI),e.fill()}e.globalAlpha=.08+.1*o,e.strokeStyle="#9b7ccc",e.lineWidth=1.8,e.beginPath(),e.arc(n,r,h*(.5+.08*Math.sin(9*u.t+t)),0,2*Math.PI),e.stroke()}e.globalAlpha=1}for(let t=0;t<q.length;t++){const s=q[t],n=s.x-x,r=s.y-y;if(n<-40||r<-40||n>a+40||r>l+40)continue;const o=12===s.k?"#884488":11===s.k?"#aa22aa":10===s.k?"#661122":9===s.k?"#bb1122":8===s.k?"#3dba5a":7===s.k?"#8899aa":6===s.k?"#d95530":5===s.k?"#cc7a2e":4===s.k?"#713ce8":3===s.k?"#a789ff":2===s.k?"#665a78":1===s.k?"#5687a1":s.sl?"#70805a":"#4b667f";if(9===s.k&&(s.prCloak||0)>0)K((s.prCloak||0)/1.5,0,1),e.globalAlpha=.06+.08*Math.sin(12*u.t+t),e.fillStyle="#bb1122",e.beginPath(),e.arc(n,r,s.r,0,2*Math.PI),e.fill(),e.globalAlpha=.04+.03*Math.sin(20*u.t+3*t),e.strokeStyle="#ff4444",e.lineWidth=1,e.beginPath(),e.arc(n+4*Math.sin(8*u.t),r+4*Math.cos(7*u.t),s.r+6,0,2*Math.PI),e.stroke(),e.globalAlpha=1;else if(10===s.k){const a=K((s.cloneLife||0)/2,0,1);e.globalAlpha=.3+.2*a+.1*Math.sin(14*u.t+t),e.fillStyle=o,e.beginPath(),e.arc(n,r,s.r,0,2*Math.PI),e.fill(),e.fillStyle="#ff3344",e.fillRect(n-3|0,r-2|0,2,2),e.fillRect(n+1|0,r-2|0,2,2),e.globalAlpha=1}else e.fillStyle=s.ht>0?"#9db4d1":o,e.beginPath(),e.arc(n,r,s.r,0,2*Math.PI),e.fill();if((9!==s.k||(s.prCloak||0)<=0)&&10!==s.k&&(e.fillStyle="#f0627c",e.fillRect(n-4|0,r-2|0,3,3),e.fillRect(n+1|0,r-2|0,3,3)),5===s.k){const a=K(s.hp/(s.mbMax||s.hp||1),0,1);e.globalAlpha=.3+.15*Math.sin(6*u.t+t),e.strokeStyle="#ffa64d",e.lineWidth=2.2,e.beginPath(),e.arc(n,r,s.r+7+2*Math.sin(5*u.t),0,2*Math.PI),e.stroke(),(s.mbChargeT||0)>0&&(e.globalAlpha=.25,e.fillStyle="#ffa64d",e.beginPath(),e.arc(n-22*(s.mbDx||0),r-22*(s.mbDy||0),.7*s.r,0,2*Math.PI),e.fill());const l=2.2*s.r,o=n-.5*l,i=r-s.r-12;e.globalAlpha=.85,e.fillStyle="rgba(10,14,22,.9)",e.fillRect(o-1,i-1,l+2,5),e.fillStyle="#664420",e.fillRect(o,i,l,3),e.fillStyle=a>.5?"#ffa64d":"#ff6633",e.fillRect(o,i,l*a,3),e.globalAlpha=1}if(6===s.k){const a=.5+.5*Math.sin(8*u.t+t);e.globalAlpha=.12+.1*a,e.fillStyle="#ff4422",e.beginPath(),e.arc(n,r,s.r+6+4*a,0,2*Math.PI),e.fill(),e.globalAlpha=.4,e.fillStyle="#ffaa44",e.beginPath(),e.arc(n,r,2.5,0,2*Math.PI),e.fill(),e.globalAlpha=1}if(7===s.k){const a=Math.atan2(W.y-s.y,W.x-s.x);e.globalAlpha=.22+.08*Math.sin(4*u.t+t),e.strokeStyle="#aabbcc",e.lineWidth=3,e.beginPath(),e.arc(n,r,s.r+5,a-.8,a+.8),e.stroke(),e.globalAlpha=1}if(8===s.k&&(e.globalAlpha=.6,e.fillStyle="#7fff7f",e.fillRect(n-1.5|0,r-5|0,3,10),e.fillRect(n-5|0,r-1.5|0,10,3),(s.healCd||0)<.4&&(e.globalAlpha=.1+.08*(1-(s.healCd||0)/.4),e.strokeStyle="#7fff7f",e.lineWidth=1.2,e.beginPath(),e.arc(n,r,120*(1-(s.healCd||0)/.4),0,2*Math.PI),e.stroke()),e.globalAlpha=1),9===s.k&&(s.prCloak||0)<=0){const a=K(s.hp/(s.prMax||s.hp||1),0,1),l=a<=.5?1:0,o=.5+.5*Math.sin(4*u.t+t);e.globalAlpha=.12+.08*o+.06*l,e.fillStyle=l?"#ff1111":"#bb2233",e.beginPath(),e.arc(n,r,s.r+16+5*o,0,2*Math.PI),e.fill(),e.globalAlpha=.35+.15*Math.sin(6*u.t),e.strokeStyle=l?"#ff3333":"#cc2244",e.lineWidth=2.5,e.beginPath(),e.arc(n,r,s.r+10+3*Math.sin(5*u.t),0,2*Math.PI),e.stroke(),e.globalAlpha=.9,e.fillStyle="#ff2222",e.beginPath(),e.arc(n-5,r-3,2.5+.5*l,0,2*Math.PI),e.fill(),e.beginPath(),e.arc(n+5,r-3,2.5+.5*l,0,2*Math.PI),e.fill(),(s.prLunge||0)>0&&(e.globalAlpha=.2,e.fillStyle="#ff2222",e.beginPath(),e.arc(n-30*(s.prLungeDx||0),r-30*(s.prLungeDy||0),.8*s.r,0,2*Math.PI),e.fill(),e.beginPath(),e.arc(n-55*(s.prLungeDx||0),r-55*(s.prLungeDy||0),.5*s.r,0,2*Math.PI),e.fill());const i=Math.max(50,2.6*s.r),h=6,f=n-.5*i,c=r-s.r-18;e.globalAlpha=.88,e.fillStyle="rgba(10,6,6,.92)",e.fillRect(f-2,c-2,i+4,h+4),e.fillStyle="#3a1015",e.fillRect(f,c,i,h);const d=e.createLinearGradient(f,0,f+i,0);d.addColorStop(0,l?"#ff2222":"#cc2244"),d.addColorStop(1,l?"#ff6644":"#ee4466"),e.fillStyle=d,e.fillRect(f,c,i*a,h),e.globalAlpha=1}if(11===s.k){const a=K(s.hp/(s.moMax||s.hp||1),0,1),l=s.moRage||0,o=.5+.5*Math.sin(3.5*u.t+t);if(e.globalAlpha=.1+.06*o+.05*l,e.fillStyle=l>1?"#dd22dd":"#aa33aa",e.beginPath(),e.arc(n,r,s.r+22+6*o+8*l,0,2*Math.PI),e.fill(),e.globalAlpha=.3+.15*Math.sin(5*u.t),e.strokeStyle=l>1?"#ff44ff":"#cc44cc",e.lineWidth=3+l,e.beginPath(),e.arc(n,r,s.r+12+3*Math.sin(4.5*u.t),0,2*Math.PI),e.stroke(),(s.moScreamT||0)>0){const t=K((s.moScreamT||0)/1.6,0,1);e.globalAlpha=.15*t,e.strokeStyle="#ff66ff",e.lineWidth=4,e.beginPath(),e.arc(n,r,(320+60*l)*(1-.3*t),0,2*Math.PI),e.stroke()}if((s.moWaveT||0)>0){const t=(s.moWaveT||0)/.6;e.globalAlpha=.2*t,e.fillStyle="#ee55ee",e.beginPath(),e.arc(n,r,(180+50*l)*(1-.4*t),0,2*Math.PI),e.fill()}e.globalAlpha=.9,e.fillStyle="#ff44ff",e.beginPath(),e.arc(n-8,r-4,3+.5*l,0,2*Math.PI),e.fill(),e.beginPath(),e.arc(n+8,r-4,3+.5*l,0,2*Math.PI),e.fill(),e.fillStyle="#ffaaff",e.beginPath(),e.arc(n,r+6,2,0,2*Math.PI),e.fill();const i=Math.max(60,2.8*s.r),h=7,f=n-.5*i,c=r-s.r-20;e.globalAlpha=.9,e.fillStyle="rgba(12,4,12,.92)",e.fillRect(f-2,c-2,i+4,h+4),e.fillStyle="#2a0e2a",e.fillRect(f,c,i,h);const d=e.createLinearGradient(f,0,f+i,0);l>1?(d.addColorStop(0,"#ff22ff"),d.addColorStop(1,"#ff77ff")):l>0?(d.addColorStop(0,"#cc33cc"),d.addColorStop(1,"#ee55ee")):(d.addColorStop(0,"#993399"),d.addColorStop(1,"#cc55cc")),e.fillStyle=d,e.fillRect(f,c,i*a,h),e.globalAlpha=1}if(3===s.k){const a=s.b1Eat||0,l=K(s.hp/(s.b1Max||s.hp||1),0,1),o=(s.b1Pulse||0)>.01?s.b1Pulse/.35:0,i=(s.b1Roar||0)>.01?s.b1Roar/.6:0,h=Math.min(1,a/20),f=s.r+10+2.2*a+3*Math.sin(4*u.t);e.globalAlpha=.08+.08*h+.14*o,e.fillStyle=a>15?"#ff8f8f":a>8?"#ffd58f":"#a789ff",e.beginPath(),e.arc(n,r,f,0,2*Math.PI),e.fill();const c=a>15?"#ff6b6b":a>8?"#ffaa44":"#c8a0ff";if(e.globalAlpha=.28+.12*Math.sin(5*u.t+t)+.08*i,e.strokeStyle=c,e.lineWidth=2.2+.08*a,e.beginPath(),e.arc(n,r,s.r+8+2.5*Math.sin(5.5*u.t+t),0,2*Math.PI),e.stroke(),i>.01&&(e.globalAlpha=.22*i,e.strokeStyle="#c8a0ff",e.lineWidth=3,e.beginPath(),e.arc(n,r,s.r+20+50*(1-i),0,2*Math.PI),e.stroke()),a>0)for(let t=0;t<Math.min(a,8);t++){const l=u.t*(3.2+.4*t)+t*(.78+.04*a),o=s.r+8+2.5*t+3*Math.sin(6*u.t+t),i=n+Math.cos(l)*o,h=r+Math.sin(l)*o;e.globalAlpha=.35+.2*Math.sin(8*u.t+t),e.fillStyle="#69f0c9",e.beginPath(),e.arc(i,h,2.2+.06*a,0,2*Math.PI),e.fill()}o>.01&&(e.globalAlpha=.3*o,e.fillStyle="#69f0c9",e.beginPath(),e.arc(n,r,s.r+8+24*(1-o),0,2*Math.PI),e.fill());const d=Math.max(44,2.2*s.r),m=5,b=n-.5*d,x=r-s.r-16;e.globalAlpha=.85,e.fillStyle="rgba(10,14,22,.9)",e.fillRect(b-2,x-2,d+4,m+4),e.fillStyle="#3a2255",e.fillRect(b,x,d,m),e.fillStyle=l>.5?"#a789ff":l>.25?"#d88fff":"#ff6b9a",e.fillRect(b,x,d*l,m),a>0&&(e.fillStyle="#69f0c9",e.font="700 9px Trebuchet MS,sans-serif",e.fillText("√ó"+a,b+d+5,x+5)),e.globalAlpha=1}if(4===s.k){const a=K(s.hp/(s.apMax||s.hp||1),0,1),l=a>.66?"#bfa1ff":a>.33?"#d8b4ff":"#ffb6f2",o=Math.hypot(s.vx||0,s.vy||0);if(o>220){const a=(s.vx||0)/(o||1),l=(s.vy||0)/(o||1);e.globalAlpha=.14+.06*Math.sin(20*u.t+t),e.fillStyle="rgba(165,126,242,.7)",e.beginPath(),e.ellipse(n-a*(18+.02*o),r-l*(18+.02*o),.7*s.r,.44*s.r,Math.atan2(l,a),0,2*Math.PI),e.fill()}if(e.globalAlpha=.25+.12*Math.sin(8*u.t+t),e.strokeStyle=l,e.lineWidth=2,e.beginPath(),e.arc(n,r,s.r+10+2*Math.sin(6*u.t+t),0,2*Math.PI),e.stroke(),s.apTele>0&&void 0!==s.apAimX){const t=1-K(s.apTele/(s.apTeleD||.001),0,1),a=s.apAimX-x,l=s.apAimY-y;e.globalAlpha=.22+.5*t,e.strokeStyle="#f2d6ff",e.lineWidth=2.2+1.8*t,e.setLineDash([7,6]),e.lineDashOffset=90*-u.t,e.beginPath(),e.moveTo(n,r),e.lineTo(a,l),e.stroke(),e.setLineDash([]),e.beginPath(),e.arc(a,l,26+26*t,0,2*Math.PI),e.stroke(),e.globalAlpha=.12+.3*t,e.fillStyle="rgba(234,203,255,.85)",e.beginPath(),e.arc(a,l,18+22*t,0,2*Math.PI),e.fill(),e.fillStyle="rgba(248,232,255,.75)",e.beginPath(),e.arc(a,l,3.2,0,2*Math.PI),e.fill()}if(s.apShieldT>0){const t=K(s.apShieldT/1.8,0,1);e.globalAlpha=.12+.22*t,e.fillStyle="rgba(200,182,255,.8)",e.beginPath(),e.arc(n,r,s.r+16+3*Math.sin(14*u.t),0,2*Math.PI),e.fill(),e.globalAlpha=.35+.4*t,e.strokeStyle="rgba(220,200,255,.9)",e.lineWidth=2.5+2*t,e.beginPath(),e.arc(n,r,s.r+14+2*Math.sin(10*u.t),0,2*Math.PI),e.stroke()}if((s.apSlamCd||0)<.8&&(s.apSlamCd||0)>0){const t=1-K((s.apSlamCd||0)/.8,0,1);e.globalAlpha=.08+.18*t,e.strokeStyle="#ff8bd9",e.lineWidth=1.5+2*t,e.setLineDash([6,4]),e.lineDashOffset=60*-u.t;const a=120+28*(s.apPhase||1);e.beginPath(),e.arc(n,r,a,0,2*Math.PI),e.stroke(),e.setLineDash([])}if((s.apPhase||1)>=3&&Math.random()<.12){const a=Math.random()*Math.PI*2,l=.6*s.r;e.globalAlpha=.25+.15*Math.sin(12*u.t+t),e.fillStyle="#d8b4ff",e.beginPath(),e.arc(n+Math.cos(a)*l,r+Math.sin(a)*l,1.8,0,2*Math.PI),e.fill()}e.globalAlpha=1}}for(let t=0;t<O.length;t++){const a=O[t],l=a.x-x,s=a.y-y;if(a.pulse){const t=a.r||8;e.fillStyle="rgba(157,230,255,.2)",e.beginPath(),e.arc(l,s,1.4*t,0,2*Math.PI),e.fill(),e.strokeStyle=a.c||"#9de6ff",e.lineWidth=2,e.beginPath(),e.arc(l,s,t,0,2*Math.PI),e.stroke(),e.fillStyle="rgba(224,250,255,.88)",e.beginPath(),e.arc(l,s,.34*t,0,2*Math.PI),e.fill()}else e.fillStyle=a.c||"#ffd56d",e.fillRect(l-2|0,s-2|0,4,4)}const S=W.x-x+W.rx,C=W.y-y+W.ry,P=Math.abs(W.vx)>=Math.abs(W.vy)?W.face>0?b.e:b.w:W.vy<0?W.face>0?b.ne:b.nw:W.face>0?b.se:b.sw;if(e.fillStyle="rgba(0,0,0,.35)",e.beginPath(),e.ellipse(S,C+14,17,6,0,0,2*Math.PI),e.fill(),P&&P.complete?e.drawImage(P,S-22,C-18,44,30):(e.fillStyle="#0b0f14",e.beginPath(),e.arc(S,C,12,0,2*Math.PI),e.fill(),e.fillStyle="#ef4f6c",e.fillRect(S+3|0,C-6|0,7,3)),W.bHealFx>0){const t=Math.min(1,W.bHealFx/.7),a=24+2*Math.sin(18*u.t);e.globalAlpha=.18+.26*t,e.fillStyle="#79f2ad",e.beginPath(),e.arc(S,C,a+9*t,0,2*Math.PI),e.fill(),e.globalAlpha=.55+.35*t,e.strokeStyle="#bfffd6",e.lineWidth=2.2,e.beginPath(),e.arc(S,C,a,0,2*Math.PI),e.stroke(),e.globalAlpha=1}if(W.bot&&V.length){for(let t=0;t<V.length;t++){const a=gt(0|V[t].t||1),l=a.body,s=a.ring,n=V[t],r=n.x-x,o=n.y-y;e.fillStyle="rgba(0,0,0,.25)",e.beginPath(),e.ellipse(r,o+8,11,4,0,0,2*Math.PI),e.fill(),e.fillStyle=l,e.beginPath(),e.arc(r,o,9,0,2*Math.PI),e.fill(),e.fillStyle="#16314a",e.fillRect(r-3|0,o-2|0,2,2),e.fillRect(r+1|0,o-2|0,2,2),e.strokeStyle=s,e.lineWidth=1.2,e.beginPath(),e.arc(r,o,12+1.5*Math.sin(9*u.t+t),0,2*Math.PI),e.stroke(),a.auraR>0&&(e.strokeStyle="rgba(255,231,176,.42)",e.lineWidth=1.5,e.beginPath(),e.arc(r,o,a.auraR*(.84+.08*Math.sin(4*u.t+.7*t)),0,2*Math.PI),e.stroke())}if((W.zt>0||W.slT>0||W.slRecallT>0||W.slLinkT>0)&&V.length>=3){const t=K(W.slLinkT/c,0,1),a=Math.max(W.triFx,W.slCharge,W.slFocus,W.slPow*(W.slT>0||W.slRecallT>0||W.slLinkT>0?1:.35),.85*t,.55*W.slComboFx),l=1-K((Math.max(44,W.slRopeRest||92)-44)/132,0,1),s=W.zt>0?W.zx:W.slT>0||W.slRecallT>0?W.slDx:W.gx,n=W.zt>0?W.zy:W.slT>0||W.slRecallT>0?W.slDy:W.gy,r=4.6*u.t;for(let t=0;t<3;t++){const o=V[t],i=o.x-x,h=o.y-y,f=(t-1)*(12+(9+6*(1-l))*a),c=.5*(S+i)+-n*f,d=.5*(C+h)+s*f;e.strokeStyle="rgba(150,238,255,"+(.28+.42*a+.08*l)+")",e.lineWidth=1.8+1.6*a,e.beginPath(),e.moveTo(S,C),e.quadraticCurveTo(c,d,i,h),e.stroke(),e.strokeStyle="rgba(223,252,255,"+(.2+.48*a+.06*l)+")",e.lineWidth=.9+.9*a,e.beginPath(),e.moveTo(S,C),e.quadraticCurveTo(c,d,i,h),e.stroke();const m=(r+.27*t)%1,b=1-m,p=b*b*S+2*b*m*c+m*m*i,g=b*b*C+2*b*m*d+m*m*h;if(e.fillStyle="rgba(219,250,255,"+(.5+.45*a+.04*l)+")",e.beginPath(),e.arc(p,g,1.9+1.1*a,0,2*Math.PI),e.fill(),W.slT>0||W.slRecallT>0||W.slLinkT>0){const t=(o.slx||0)+W.slDx*(28+44*l),s=(o.sly||0)+W.slDy*(28+44*l),n=Math.hypot(t,s)||1,r=i-t/n*(18+10*a),f=h-s/n*(18+10*a);e.strokeStyle="rgba(167,244,255,"+(.22+.44*a+.14*l)+")",e.lineWidth=2.2+.9*a,e.beginPath(),e.moveTo(r,f),e.lineTo(i,h),e.stroke()}}if(W.zt>0&&W.slFocus>0){const t=Math.min(1,W.slFocus),a=30+9*t+1.1*Math.sin(20*u.t);e.strokeStyle=W.slPerfect?"rgba(255,233,160,.95)":"rgba(196,239,255,"+(.35+.45*t)+")",e.lineWidth=1.4+1.6*t,e.beginPath(),e.arc(S,C,a,.5*-Math.PI,.5*-Math.PI+2*Math.PI*t),e.stroke(),W.slPerfect&&(e.fillStyle="rgba(255,240,190,.96)",e.font="700 10px Trebuchet MS,sans-serif",e.fillText("PERFECT",S-22,C-28))}}if(W.bCarry>0){const t=V[0].x-x,a=V[0].y-y;e.fillStyle="rgba(6,10,16,.84)",e.beginPath(),e.arc(t+10,a-10,8,0,2*Math.PI),e.fill(),e.fillStyle="#dfffff",e.font="700 10px Trebuchet MS,sans-serif",e.fillText(""+W.bCarry,t+7,a-7)}}if(W.mkS>0&&W.zt<=0){const t=W.face>0?-1:1,a=K(W.mkS/.32,0,1),l=S+13*t,s=C+8,n=l+t*(11+2.2*Math.sin(36*u.t)),r=s+7+1.1*Math.sin(22*u.t);e.strokeStyle="rgba(248,220,112,"+(.38+.45*a)+")",e.lineWidth=2,e.beginPath(),e.moveTo(l,s),e.quadraticCurveTo(.5*(l+n),s+2,n,r),e.stroke(),e.fillStyle="rgba(250,214,103,.72)",e.beginPath(),e.arc(n+2*t,r+2,2.1,0,2*Math.PI),e.fill(),e.fillStyle="rgba(244,205,93,.38)",e.beginPath(),e.ellipse(n+5*t,r+7,5.2,2.7,0,0,2*Math.PI),e.fill()}if((W.zc>0||W.zcd>0)&&W.zt<=0){const t=W.zcd>0?0:Math.min(1,W.zc/W.zLoad),a=t<=0?Math.max(0,1-W.zcd/W.zCool):0,l=18+8*t+1.2*Math.sin(22*u.t);e.strokeStyle=W.zr?"#8fffe5":"#ffd56d",e.lineWidth=2+1.8*t,e.beginPath(),e.arc(S,C,l,.5*-Math.PI,.5*-Math.PI+2*Math.PI*t),e.stroke(),W.zcd>0&&(e.strokeStyle="rgba(158,200,255,.7)",e.lineWidth=2,e.beginPath(),e.arc(S,C,16,.5*-Math.PI,.5*-Math.PI+2*Math.PI*a),e.stroke())}if(W.zt>0||W.slT>0||W.slRecallT>0||W.slLinkT>0){const t=W.zt>0?W.zt/2:Math.max(.55*W.slPow,.46*K(W.slLinkT/c,0,1)),a=W.zt>0?W.zx:W.slT>0||W.slRecallT>0?W.slDx:W.gx,l=W.zt>0?W.zy:W.slT>0||W.slRecallT>0?W.slDy:W.gy;e.strokeStyle="rgba(143,255,229,.7)",e.lineWidth=2.5,e.beginPath(),e.arc(S,C,20+2*Math.sin(30*u.t)+4*t,0,2*Math.PI),e.stroke(),e.fillStyle="rgba(143,255,229,.16)",e.beginPath(),e.ellipse(S-10*a,C-7*l,20,10,Math.atan2(l,a),0,2*Math.PI),e.fill()}if(W.slWave>0){const t=W.slWave,a=30+88*(1-t);e.globalAlpha=.06+.16*t,e.fillStyle="rgba(142,238,255,.95)",e.beginPath(),e.arc(S,C,1.08*a,0,2*Math.PI),e.fill(),e.globalAlpha=.74*t,e.strokeStyle="rgba(214,250,255,.96)",e.lineWidth=2+2.4*t,e.beginPath(),e.arc(S,C,a,0,2*Math.PI),e.stroke(),e.globalAlpha=1}if(W.slComboFx>0){const t=Math.min(1,W.slComboFx),a=42+58*(1-t);e.globalAlpha=.07+.2*t,e.fillStyle="rgba(185,244,255,.95)",e.beginPath(),e.arc(S,C,1.1*a,0,2*Math.PI),e.fill(),e.globalAlpha=.2+.45*t,e.strokeStyle="rgba(229,251,255,.96)",e.lineWidth=1.8+1.5*t,e.beginPath(),e.arc(S,C,a,0,2*Math.PI),e.stroke(),e.globalAlpha=1}W.flash>0&&(e.globalAlpha=W.flash/.07,e.fillStyle="#ffe598",e.beginPath(),e.moveTo(S+16*W.gx,C+8*W.gy),e.lineTo(S+24*W.gx-5*W.gy,C+24*W.gy+4*W.gx),e.lineTo(S+24*W.gx+5*W.gy,C+24*W.gy-4*W.gx),e.closePath(),e.fill(),e.globalAlpha=1);for(let t=0;t<X.length;t++){const s=X[t],n=s.x-x,r=s.y-y;n<-8||r<-8||n>a+8||r>l+8||(e.globalAlpha=Math.max(0,Math.min(1,2.4*s.t)),e.fillStyle=s.c,e.fillRect(0|n,0|r,3,3))}e.globalAlpha=1;const v=44,R=a-18-v,A=a<420;let z=62,w=74;const D=Math.max(96,a-190);if(e.fillStyle="rgba(7,10,16,.76)",e.fillRect(10,10,a-20,104),e.fillStyle="#eef4ff",e.font="700 17px Trebuchet MS,sans-serif",e.fillText("SCOTTY",20,32),A){const t=52,a=R-8;e.font="600 12px Trebuchet MS,sans-serif",e.fillStyle="#9ec8ff",e.fillText("Time "+u.time.toFixed(1)+"s",20,t),e.fillStyle="#ffd56d",e.fillText(u.bd2?u.kills+"/"+m:"Kills "+u.kills,118,t),u.endWave>0&&(e.fillStyle="#ff9a7a",e.fillText("W"+u.endWave,210,t)),e.textAlign="right",e.fillStyle="#dce8ff",e.fillText("Best "+u.best,a,t),e.textAlign="left",z=62,w=74}else e.font="600 14px Trebuchet MS,sans-serif",e.fillStyle="#9ec8ff",e.fillText("Time "+u.time.toFixed(1)+"s",20,54),e.fillStyle="#ffd56d",e.fillText(u.bd2?u.kills+"/"+m:"Kills "+u.kills,150,54),u.endWave>0&&(e.fillStyle="#ff9a7a",e.fillText("Wave "+u.endWave,280,54)),e.textAlign="right",e.fillStyle="#dce8ff",e.fillText("Best "+u.best,a-24,54),e.textAlign="left";e.fillStyle="#2a3346",e.fillRect(20,z,D,10),e.fillStyle="#ef4f6c",e.fillRect(20,z,D*(W.hp/W.maxHp),10),e.fillStyle="#24374d",e.fillRect(20,w,D,8),e.fillStyle="#69f0c9",e.fillRect(20,w,D*(u.xp/u.nextXp),8);let I=0;for(let t=0;t<q.length;t++)if(11===q[t].k){I=q[t];break}let B=0;for(let t=0;t<q.length;t++)if(9===q[t].k){B=q[t];break}let E=0;for(let t=0;t<q.length;t++)if(5===q[t].k){E=q[t];break}let H=0;for(let t=0;t<q.length;t++)if(3===q[t].k){H=q[t];break}let Y=0;for(let t=0;t<q.length;t++)if(4===q[t].k){Y=q[t];break}let U=118;if(I&&u.moth){const t=K(I.hp/(I.moMax||I.hp||1),0,1),l=t>.6?"AWAKENED":t>.25?"FURIOUS":"BERSERK",s=K(.62*a,260,660),n=14,r=.5*(a-s),o=U+2;e.fillStyle="rgba(14,4,14,.92)",Q(r-10,o-20,s+20,42,11),e.fill(),e.fillStyle="rgba(50,10,50,.95)",e.fillRect(r,o,s,n);const i=e.createLinearGradient(r,0,r+s,0);t>.6?(i.addColorStop(0,"#993399"),i.addColorStop(1,"#cc55cc")):t>.25?(i.addColorStop(0,"#cc33cc"),i.addColorStop(1,"#ee55ee")):(i.addColorStop(0,"#ff22ff"),i.addColorStop(1,"#ff77ff")),e.fillStyle=i,e.fillRect(r,o,s*t,n),e.strokeStyle="rgba(255,100,255,.5)",e.lineWidth=1.2,e.strokeRect(r+.5,o+.5,s-1,n-1),e.fillStyle=t>.25?"#ffaaff":"#ff66ff",e.font="700 12px Trebuchet MS,sans-serif",e.textAlign="center",e.fillText("THE MOTHER // "+l,r+.5*s,o-7),e.textAlign="left",U+=38}if(B&&u.pred){const t=K(B.hp/(B.prMax||B.hp||1),0,1),l=t>.5?"STALKING":"ENRAGED",s=(B.prCloak||0)>0,n=K(.6*a,240,640),r=13,o=.5*(a-n),i=U+2;e.fillStyle="rgba(14,4,4,.92)",Q(o-10,i-20,n+20,40,11),e.fill(),e.fillStyle="rgba(60,10,15,.95)",e.fillRect(o,i,n,r);const h=e.createLinearGradient(o,0,o+n,0);t>.5?(h.addColorStop(0,"#bb1122"),h.addColorStop(1,"#ee3344")):(h.addColorStop(0,"#ff2222"),h.addColorStop(1,"#ff6644")),e.fillStyle=h,e.fillRect(o,i,n*t,r),e.strokeStyle="rgba(255,80,80,.5)",e.lineWidth=1.2,e.strokeRect(o+.5,i+.5,n-1,r-1),e.fillStyle=t>.5?"#ffaaaa":"#ff6666",e.font="700 12px Trebuchet MS,sans-serif",e.textAlign="center",e.fillText("THE PREDATOR // "+l+(s?" [CLOAKED]":""),o+.5*n,i-7),e.textAlign="left",U+=36}if(E&&u.mb){const t=K(E.hp/(E.mbMax||E.hp||1),0,1),l=K(.48*a,180,500),s=9,n=.5*(a-l),r=U+2;e.fillStyle="rgba(10,14,22,.88)",Q(n-10,r-16,l+20,32,11),e.fill(),e.fillStyle="rgba(50,36,18,.95)",e.fillRect(n,r,l,s);const o=e.createLinearGradient(n,0,n+l,0);o.addColorStop(0,"#cc7a2e"),o.addColorStop(1,"#ffa64d"),e.fillStyle=o,e.fillRect(n,r,l*t,s),e.strokeStyle="rgba(200,180,140,.55)",e.lineWidth=1.2,e.strokeRect(n+.5,r+.5,l-1,s-1),e.fillStyle="#ffe0a0",e.font="700 10px Trebuchet MS,sans-serif",e.textAlign="center",e.fillText("THE PROVOST",n+.5*l,r-5),e.textAlign="left",U+=28}if(H&&u.bs){const t=K(H.hp/(H.b1Max||H.hp||1),0,1),l=H.b1Eat||0,s=l>20?"THE DEAN // BLOATED":l>12?"THE DEAN // GORGED":l>5?"THE DEAN // HUNGRY":"THE DEAN",n=K(.54*a,200,560),r=11,o=.5*(a-n),i=U+2;e.fillStyle="rgba(10,14,22,.88)",Q(o-10,i-18,n+20,36,11),e.fill(),e.fillStyle="rgba(40,28,62,.95)",e.fillRect(o,i,n,r);const h=e.createLinearGradient(o,0,o+n,0);l>20?(h.addColorStop(0,"#ff3333"),h.addColorStop(1,"#ff7755")):l>12?(h.addColorStop(0,"#ff5656"),h.addColorStop(1,"#ff9a7a")):l>5?(h.addColorStop(0,"#ffaa44"),h.addColorStop(1,"#ffd58f")):(h.addColorStop(0,"#9a7dff"),h.addColorStop(1,"#c8a0ff")),e.fillStyle=h,e.fillRect(o,i,n*t,r),e.strokeStyle="rgba(200,190,240,.55)",e.lineWidth=1.2,e.strokeRect(o+.5,i+.5,n-1,r-1),e.fillStyle=l>20?"#ffaaaa":l>12?"#ffc4c4":l>5?"#ffe0b3":"#e4d8ff",e.font="700 11px Trebuchet MS,sans-serif",e.textAlign="center",e.fillText(s+(l>0?" ["+l+" mints]":""),o+.5*n,i-7),e.textAlign="left",U+=32}if(Y){const t=K(Y.hp/(Y.apMax||Y.hp||1),0,1),l=Y.apPhase||1,s=1===l?"ALPHA":2===l?"RAGE":"OMEGA",n=K(.58*a,220,620),r=12,o=.5*(a-n),i=U+2;e.fillStyle="rgba(10,14,22,.88)",Q(o-10,i-18,n+20,38,11),e.fill();const h=e.createLinearGradient(0,i,0,i+r);h.addColorStop(0,"rgba(54,71,103,.95)"),h.addColorStop(1,"rgba(30,40,63,.95)"),e.fillStyle=h,e.fillRect(o,i,n,r);const f=e.createLinearGradient(o,0,o+n,0);1===l?(f.addColorStop(0,"#9a7dff"),f.addColorStop(1,"#c8b6ff")):2===l?(f.addColorStop(0,"#d28cff"),f.addColorStop(1,"#ffbfd8")):(f.addColorStop(0,"#ff8bd9"),f.addColorStop(1,"#ffc3f1")),e.fillStyle=f,e.fillRect(o,i,n*t,r),e.strokeStyle="rgba(220,234,255,.65)",e.lineWidth=1.2,e.strokeRect(o+.5,i+.5,n-1,r-1),e.fillStyle="#f4ecff",e.font="700 11px Trebuchet MS,sans-serif",e.textAlign="center",e.fillText("APEX DEAN // "+s,o+.5*n,i-7),e.textAlign="left",U+=34}const lt=function(){if(!W.mkOn)return"collect mints "+u.homeGot+"/"+u.homeNeed+" to unlock territory puddles";if(u.inB&&u.safeCampT>=6&&u.safeThreat>=6)return"shelter breached - move out and clear pressure";if(u.won)return"CAMPUS SECURED - you did it!";if(u.moth)return"defeat the mother to secure campus!";if(u.pred)return"defeat the predator!";if(u.kills>=d)return"clear remaining enemies! "+q.length+" left";if(u.pz&&"nsh"===u.pz.id)return"solve nsh lab sequence";if(u.pz&&"mel"===u.pz.id)return"solve mellon lab sequence";if(0===u.sch.nsh)return"reach nsh and request robotics support";if(1===u.sch.nsh)return"complete nsh puzzle to unlock first buddy";if(0===u.sch.mel)return"reach mellon institute and request catalyst support";if(1===u.sch.mel)return"complete mellon puzzle to unlock first catalyst";if(u.bd2)return u.kills>=8800?"WAVE "+u.endWave+" - "+u.kills+"/"+m+" - something stirs...":u.endWave>0?"WAVE "+u.endWave+" - "+u.kills+"/"+m+" kills":"endless cleanup - "+u.kills+"/"+m+" kills to final boss";if(u.bs2&&bt(u.chemMask)>=3)return"triple burst! overlap all 3 puddles to storm apex!";if(u.bs2)return"defeat apex dean";if(u.bs)return"defeat dean and keep evac mints out of his reach";if(u.mb)return"defeat the provost!";const t=bt(u.botMask),e=bt(u.chemMask);return 2===u.sch.nsh&&t<ct()?2!==ct()||u.mbd?3!==ct()||u.bs2||u.bd2?"visit nsh for buddy prototype trial":"reach apex phase to unlock final buddy prototype":"push midgame pressure to unlock buddy prototype tier 2":2===u.sch.mel&&e<dt()?2!==dt()||u.bd?3!==dt()||u.bs2||u.bd2?"visit mellon institute for catalyst prototype trial":"reach apex phase to unlock final catalyst":"take down dean to unlock catalyst tier 2":u.labNsh>0&&u.labMel>0?"visit nsh / mellon for prototype upgrades":u.labNsh>0?"visit nsh for buddy prototype":u.labMel>0?"visit mellon institute for catalyst prototype":2===u.sch.mel&&u.kills<600?"stabilize evacuation lanes - "+u.kills+"/600 threat cleared":!u.bd||u.bs2||u.bd2?"clear routes and protect evac paths - "+u.kills+" threats down":"hold campus perimeter - apex eta "+Math.max(0,u.b2At-u.t).toFixed(1)+"s"}();if(e.fillStyle="rgba(8,12,19,.62)",e.fillRect(14,U,a-28,26),e.fillStyle="#d7ffe8",e.font="600 12px Trebuchet MS,sans-serif",e.fillText(lt,22,U+17),u.start&&!u.dead){let t=0;if(W.mkOn?0===u.sch.nsh||1===u.sch.nsh?t=et("nsh"):0===u.sch.mel||1===u.sch.mel?t=et("mel"):u.labNsh>0?t=et("nsh"):u.labMel>0&&(t=et("mel")):t=et("home"),t){const s=t.x-x,n=t.y-y;if(!(s>-t.r&&s<a+t.r&&n>-t.r&&n<l+t.r)){const s=t.x-W.x,n=t.y-W.y,r=Math.atan2(n,s),o=28,i=.5*a,h=.5*l;let f=i+400*Math.cos(r),c=h+400*Math.sin(r);f<o?(c=h+(o-i)/(f-i)*(c-h),f=o):f>a-o&&(c=h+(a-o-i)/(f-i)*(c-h),f=a-o),c<o?(f=i+(o-h)/(c-h)*(f-i),c=o):c>l-o&&(f=i+(l-o-h)/(c-h)*(f-i),c=l-o);const d=Math.hypot(s,n),m=.6+.4*Math.sin(3.6*u.t),b=9+2*m,x=t.c;e.globalAlpha=.18*m,e.fillStyle=x,e.beginPath(),e.arc(f,c,b+6,0,2*Math.PI),e.fill(),e.globalAlpha=.65+.25*m,e.fillStyle=x,e.beginPath(),e.moveTo(f+Math.cos(r)*b,c+Math.sin(r)*b),e.lineTo(f+Math.cos(r+2.5)*b*.7,c+Math.sin(r+2.5)*b*.7),e.lineTo(f+Math.cos(r-2.5)*b*.7,c+Math.sin(r-2.5)*b*.7),e.closePath(),e.fill(),e.globalAlpha=.7,e.fillStyle="#dce8ff",e.font="600 9px Trebuchet MS,sans-serif",e.textAlign="center",e.fillText(t.n,f,c-b-4);const y=d<1e3?(0|d)+"":(d/1e3).toFixed(1)+"k";e.fillText(y,f,c+b+11),e.textAlign="left",e.globalAlpha=1}}}if(W.bot&&V.length>=3){const t=U+30,l=a-44,s=W.zt>0&&W.slT<=0&&W.slRecallT<=0,n=s?K(W.slCharge,0,1):W.slT>0?K(W.slT/.72,0,1):W.slRecallT>0?K(W.slRecallT/f,0,1):W.slLinkT>0?K(W.slLinkT/c,0,1):0,r=s?"triple buddy: rope windup":W.slT>0?"triple buddy: blade throw":W.slRecallT>0?"triple buddy: blade recall":W.slLinkT>0?"triple buddy: ropes tightening":"triple buddy: zoomies to arm";e.fillStyle="rgba(8,12,19,.64)",e.fillRect(14,t,a-28,22),e.fillStyle="rgba(48,72,98,.9)",e.fillRect(22,t+8,l,8),e.fillStyle=W.slRecallT>0?"#c9f7ff":W.slT>0?"#8eefff":W.slLinkT>0?"#a8f4ff":"#9fdfff",e.fillRect(22,t+8,l*n,8),e.fillStyle="#d5f2ff",e.font="600 11px Trebuchet MS,sans-serif",e.fillText(r,22,t+16),U+=26}if(u.start&&!u.dead){const t=(t,a,l,s,n,r)=>{e.fillStyle="rgba(8,12,19,.92)",e.fillRect(R,t,v,v),e.strokeStyle=s?a:"rgba(129,157,187,.7)",e.lineWidth=2,e.strokeRect(R+.5,t+.5,43,43),e.strokeStyle="rgba(72,88,109,.85)",e.lineWidth=3,e.beginPath(),e.arc(R+22,t+22,14.96,0,2*Math.PI),e.stroke(),e.strokeStyle=a,e.beginPath(),e.arc(R+22,t+22,14.96,.5*-Math.PI,.5*-Math.PI+2*Math.PI*K(l,0,1)),e.stroke(),e.fillStyle=a,r<1?(e.beginPath(),e.moveTo(R+21.56,t+8.36),e.lineTo(R+.35*v,t+23.32),e.lineTo(R+21.56,t+23.32),e.lineTo(R+17.16,t+36.08),e.lineTo(R+29.48,t+18.04),e.lineTo(R+22.44,t+18.04),e.closePath(),e.fill()):r<2?(e.beginPath(),e.arc(R+22,t+19.36,4.4,0,2*Math.PI),e.fill(),e.beginPath(),e.moveTo(R+22,t+8.8),e.bezierCurveTo(R+30.36,t+19.8,R+28.16,t+29.48,R+22,t+34.32),e.bezierCurveTo(R+15.84,t+29.48,R+13.64,t+19.8,R+22,t+8.8),e.fill()):(e.lineWidth=2,e.beginPath(),e.arc(R+22,t+22,.12*v,0,2*Math.PI),e.stroke(),e.beginPath(),e.arc(R+22,t+22,9.68,0,2*Math.PI),e.stroke()),n>0?(e.fillStyle="#dce8ff",e.font="700 10px Trebuchet MS,sans-serif",e.fillText(n.toFixed(1)+"s",R+8,t+v-6)):s&&(e.fillStyle="rgba(255,255,255,.8)",e.beginPath(),e.arc(R+v-8,t+8,3,0,2*Math.PI),e.fill())};t(14,"#8fffe5",W.zcd>0?1-W.zcd/W.zCool:W.zr?1:W.zc/W.zLoad,W.zt>0,W.zcd>0?W.zcd:0,0);const a=W.mkOn?W.mkT>0?1-W.mkT/W.mkI:1:0;t(66,W.cat?function(){const t=bt(u.chemMask);return t>=3?"#5ccba0":2===t?"#7ae88a":1&u.chemMask?"#8fdd73":2&u.chemMask?"#7ad8cd":4&u.chemMask?"#8fb6ff":"#f4d96e"}():"#f4d96e",a,W.mkS>0,W.mkOn&&W.mkT>0?W.mkT:0,1);const l=W.rf?W.rfT>0?1-W.rfT/W.rfI:1:0;W.rf&&t(118,"#a8b8ff",l,1,W.rfT>0?W.rfT:0,2),W.cat&&(e.fillStyle="rgba(7,10,16,.75)",e.fillRect(R-56,78,50,20),e.fillStyle="#dce8ff",e.font="600 10px Trebuchet MS,sans-serif",e.fillText(ht(),R-50,91))}if(u.msgT>0&&(e.fillStyle="rgba(8,12,19,.74)",e.fillRect(14,U+30,a-28,28),e.fillStyle="#d7ffe8",e.font="600 13px Trebuchet MS,sans-serif",e.fillText(u.msg,22,U+49)),u.bossDownT>0){const t=K(u.bossDownT/2.4,0,1),s=.96+.08*Math.sin(18*u.t)*t,n=.5*a,r=.52*l;e.fillStyle="rgba(7,10,16,"+(.2+.26*t)+")",e.fillRect(0,0,a,l),e.save(),e.translate(n,r),e.scale(s,s),e.translate(-n,-r),e.textAlign="center",e.fillStyle="rgba(255,227,143,"+(.44+.4*t)+")",e.font=(a<520?"700 30px":"700 40px")+" Trebuchet MS,sans-serif";const o=u.won?"CAMPUS SECURED":u.moth?"THE MOTHER HAS AWAKENED":!u.predDead||u.bs2||u.bd2?u.bd&&!u.bd2?"THE DEAN IS DOWN":u.mbd&&!u.bd?"THE PROVOST IS DOWN":u.bd2?"APEX DOWN ‚Äî ENDLESS MODE":"BOSS DOWN":"PREDATOR DOWN";e.fillText(o,n,r-8),e.fillStyle="rgba(209,231,255,"+(.58+.32*t)+")",e.font=(a<520?"600 13px":"600 15px")+" Trebuchet MS,sans-serif";const i=u.won?u.kills+" kills - "+u.time.toFixed(1)+"s - scotty saved campus!":u.bd2&&!u.moth?"restore campus flow: "+u.kills+"/"+m+" threats":u.bd?"something big is approaching...":"keep going...";e.fillText(i,n,r+20),e.restore(),e.textAlign="left"}if(u.start&&!u.dead&&!u.lvup&&!u.pz&&F.show>.01){const t=F.x+F.tx,a=F.y+F.ty;e.fillStyle="rgba(7,11,17,"+.42*F.show+")",e.beginPath(),e.arc(F.x,F.y,F.r+8,0,2*Math.PI),e.fill(),e.strokeStyle="rgba(158,200,255,"+.45*F.show+")",e.lineWidth=2,e.beginPath(),e.arc(F.x,F.y,F.r,0,2*Math.PI),e.stroke(),e.fillStyle="rgba(105,240,201,"+(L?.65:.42)*F.show+")",e.beginPath(),e.arc(t,a,F.kr,0,2*Math.PI),e.fill(),e.strokeStyle="rgba(220,248,255,"+.65*F.show+")",e.lineWidth=1.5,e.beginPath(),e.arc(t,a,F.kr,0,2*Math.PI),e.stroke()}if(!u.start){const t=20,s=.16*l,n=a-40,r=.68*l,o=t+16;e.fillStyle="rgba(6,9,14,.86)",e.fillRect(t,s,n,r),e.fillStyle="#fff",e.font="700 30px Trebuchet MS,sans-serif",e.fillText("Project: Zoomies",o,s+42),e.fillStyle="#9ec8ff",e.font="600 15px Trebuchet MS,sans-serif",e.fillText("what the dog doing?",o,s+64),e.fillStyle="#d8e6ff",e.font="600 14px Trebuchet MS,sans-serif",J("Goop swallowed CMU paths. People are trapped inside buildings. Scotty is the only one fast enough to move across campus.",o,s+98,n-32,18,5),e.fillStyle="#9ec8ff",e.font="600 13px Trebuchet MS,sans-serif",J("Collaborate with each school lab to keep evacuation routes open and push back the goop across campus in escalating phases.",o,s+200,n-32,17,3),e.fillStyle="#dce8ff",e.font="600 12px Trebuchet MS,sans-serif",J("Controls: drag to move. Remove finger to charge Zoomies, then move to dash. Buildings are temporary shelters, not permanent safety. Keep moving and clearing routes.",o,s+250,n-32,16,4),e.fillStyle="#69f0c9",e.font="700 23px Trebuchet MS,sans-serif",e.fillText("tap start",o,s+r-22)}if(u.lvup&&!u.dead){e.fillStyle="rgba(6,10,15,.16)",e.fillRect(0,0,a,l);const t=j(),s=t.bx,n=t.by,r=t.bw,o=t.bh,i=t.rects,h=t.mobile;e.fillStyle="rgba(17,29,45,.95)",Q(s,n,r,o,16),e.fill(),e.strokeStyle="rgba(90,125,163,.8)",e.lineWidth=1.2,Q(s+.5,n+.5,r-1,o-1,16),e.stroke(),e.fillStyle="#ecf3ff",e.font=(h?"700 18px":"700 20px")+" Trebuchet MS,sans-serif",e.fillText("SKILL BOOK",s+14,n+24),e.fillStyle="#9ec8ff",e.font="600 12px Trebuchet MS,sans-serif",e.fillText("choose",s+14,n+39);for(let t=0;t<3;t++){const a=u.choices[t],l=i[t],s=.9+.1*Z(K((u.cardT-.07*t)/.28,0,1)),n=l.x+.5*l.w,r=l.y+.5*l.h;e.save(),e.translate(n,r),e.scale(s,s),e.translate(-n,-r);const o=a&&a.bg?a.bg:"rgba(27,44,66,.96)",f=a&&a.st?a.st:"rgba(116,150,186,.85)",c=a&&a.tx?a.tx:"#eef5ff",d=a&&a.sub?a.sub:"#a9c3e2";if(e.fillStyle=o,Q(l.x,l.y,l.w,l.h,10),e.fill(),e.strokeStyle=f,e.lineWidth=1.2,Q(l.x+.5,l.y+.5,l.w-1,l.h-1,10),e.stroke(),a){const t=tt(a.n)+" "+a.n;let s=h?16:17;for(;s>12&&(e.font="700 "+s+"px Trebuchet MS,sans-serif",!(e.measureText(t).width<=l.w-22));s--);e.fillStyle=c,e.fillText(t,l.x+12,l.y+30),e.fillStyle=d,e.font="600 12px Trebuchet MS,sans-serif",J(a.d,l.x+12,l.y+48,l.w-24,14,2)}e.restore()}e.fillStyle="#95bce8",e.font="600 12px Trebuchet MS,sans-serif",e.fillText("tap 1/2/3",s+14,n+o-12)}if(u.pz&&!u.dead&&!u.lvup&&u.start){const t=st(),s=u.pz;if(e.fillStyle="rgba(5,9,14,.5)",e.fillRect(0,0,a,l),e.fillStyle="rgba(16,24,37,.96)",Q(t.bx,t.by,t.bw,t.bh,14),e.fill(),e.strokeStyle="rgba(106,145,185,.85)",e.lineWidth=1.2,Q(t.bx+.5,t.by+.5,t.bw-1,t.bh-1,14),e.stroke(),e.fillStyle="#ecf3ff",e.font="700 19px Trebuchet MS,sans-serif",e.fillText("nsh"===s.id?"NSH lab":"Mellon lab",t.bx+14,t.by+27),"nsh"===s.id){e.fillStyle="#dce8ff",e.font="600 12px Trebuchet MS,sans-serif",e.fillText("order",t.bx+14,t.by+66);for(let a=0;a<s.seq.length;a++){const l=t.bx+24+34*a,n=t.by+86,r=a<s.step;e.fillStyle=r?"#8cffc2":"#79d7ff",e.beginPath(),e.arc(l,n,12,0,2*Math.PI),e.fill(),e.fillStyle="#12243a",e.font="700 11px Trebuchet MS,sans-serif",e.fillText(s.seq[a]+1+"",l-3,n+4)}}else{const a=["#8fd3ff","#ffd58f","#ff9fb7"];e.fillStyle="#dce8ff",e.font="600 12px Trebuchet MS,sans-serif",e.fillText("mix",t.bx+14,t.by+66);for(let l=0;l<s.seq.length;l++){const n=t.bx+24+30*l,r=t.by+86,o=l<s.step;e.fillStyle=a[s.seq[l]],e.beginPath(),e.arc(n,r,10,0,2*Math.PI),e.fill(),o&&(e.strokeStyle="#8cffc2",e.lineWidth=2,e.beginPath(),e.arc(n,r,12,0,2*Math.PI),e.stroke())}}for(let a=0;a<3;a++){const l=t.btn[a];e.fillStyle="nsh"===s.id?"rgba(37,87,129,.96)":["#3c6588","#9a6f3f","#8e4f64"][a],Q(l.x,l.y,l.w,l.h,10),e.fill(),e.strokeStyle="rgba(196,223,255,.72)",e.lineWidth=1.1,Q(l.x+.5,l.y+.5,l.w-1,l.h-1,10),e.stroke(),e.fillStyle="#eef5ff",e.font="700 13px Trebuchet MS,sans-serif",e.fillText("nsh"===s.id?"terminal "+(a+1):["blue","amber","rose"][a],l.x+9,l.y+28)}e.fillStyle="#9ec8ff",e.font="600 11px Trebuchet MS,sans-serif",e.fillText("tap 1/2/3",t.bx+14,t.by+t.bh-10)}if(u.dead){let t=24,s=.2*l,n=a-48,r=Math.min(.62*l,430);s+r>l-14&&(s=14,r=l-28),e.fillStyle="rgba(5,8,13,.88)",e.fillRect(t,s,n,r);const o=a<420||l<760,i=o?14:16,h=Math.min(210,a-90),f=34,c=.5*(a-h),d=s+r-f-12;u.lbBtnX=c,u.lbBtnY=d,u.lbBtnW=h,u.lbBtnH=f;let m=s+44;if(e.fillStyle="#ff8298",e.font=(o?"700 29px":"700 33px")+" Trebuchet MS,sans-serif",e.fillText("GAME OVER",t+Math.max(10,.5*(n-196)),m),m+=30,e.fillStyle="#dce8ff",e.font="600 20px Trebuchet MS,sans-serif",e.fillText("Kills "+u.kills,t+Math.max(12,.5*(n-86)),m),m+=26,e.fillText("Best "+u.best,t+Math.max(12,.5*(n-74)),m),u.endWave>0&&(m+=26,e.fillStyle="#ff9a7a",e.fillText("Wave "+u.endWave,t+Math.max(12,.5*(n-74)),m)),m+=26,e.fillStyle="#9ec8ff",e.font="600 13px Trebuchet MS,sans-serif",e.fillText("Top 3 global",t+16,m),m+=18,e.font="600 12px Trebuchet MS,sans-serif",u.lbTop.length){for(let a=0;a<u.lbTop.length&&a<3;a++){const l=u.lbTop[a],s=m+a*i,r=a+1+". "+$(l.name,Math.max(40,n-170));e.fillStyle="#dce8ff",e.textAlign="left",e.fillText(r,t+16,s),e.fillStyle="#bdd8ff",e.textAlign="right",e.fillText(l.kills+" / "+Number(l.time_seconds).toFixed(1)+"s",t+n-16,s)}e.textAlign="left"}else e.fillStyle="#dce8ff",e.fillText(u.lbTopErr||"loading leaderboard...",t+16,m);const b=m+3*i+6;e.fillStyle="#9de6ff",e.font="600 12px Trebuchet MS,sans-serif",e.fillText($(u.lbRankText||u.lbRankErr||"checking your rank...",n-32),t+16,b);const x=Math.min(d-8,b+24);e.fillStyle="#69f0c9",e.font=(o?"700 18px":"700 20px")+" Trebuchet MS,sans-serif",e.fillText("tap retry (anywhere)",t+16,x),e.fillStyle="rgba(19,38,58,.95)",Q(c,d,h,f,10),e.fill(),e.strokeStyle="rgba(130,190,255,.9)",e.lineWidth=1.4,Q(c+.5,d+.5,h-1,f-1,10),e.stroke(),e.fillStyle="#9de6ff",e.font="700 15px Trebuchet MS,sans-serif",e.textAlign="center",e.fillText("open leaderboard",c+.5*h,d+22),e.textAlign="left"}}(),requestAnimationFrame(t)})})();</script></body></html>