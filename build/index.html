<!doctype html><html lang="en"><head><meta charset="utf-8"><meta name="viewport"
    content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover"><title>Project: Zoomies</title><style>:root{--bg:#0a0d12;--sky:#1a2940;--ink:#ecf3ff;--red:#ef4f6c;--mint:#69f0c9;--gold:#ffd56d;--line:#2f4868}*{box-sizing:border-box}html,body{margin:0;width:100%;height:100%;overflow:hidden;background:var(--bg);color:var(--ink);font-family:Trebuchet MS,Avenir Next,Segoe UI,sans-serif}body{touch-action:none}canvas{display:block;width:100%;height:100%}</style></head><body><canvas id="c"></canvas><script src="leaderboard-config.js"></script><script>(()=>{const t=document.getElementById("c"),e=t.getContext("2d");let a=360,l=740,s=1,n=0;const o=260,r=900,i=[{id:"home",n:"Cohon Centre",x:o,y:r,r:170,c:"#8ec0ff"},{id:"nsh",n:"NSH",x:980,y:460,r:170,c:"#79d7ff"},{id:"mel",n:"Mellon Inst",x:1880,y:1260,r:185,c:"#ffd58f"},{id:"bak",n:"Baker Hall",x:2280,y:640,r:170,c:"#9ec8ff"}],f=["i need to go out","these things are scary","may lord help us","can we ever go out?"],h=["a dog?","scotty??","what the dog doing?"],c=160,b=.42,d=1.08,m=9999,y=3e3,x={};function p(t){const e=new Image;return e.src="black_scottish_terrier_dog_with_red_scarf/rotations/"+t+".png",e}x.e=p("east"),x.w=p("west"),x.ne=p("north-east"),x.nw=p("north-west"),x.se=p("south-east"),x.sw=p("south-west");let g=0;function M(t,e,a,l){if(!g)return;const s=g.createOscillator(),n=g.createGain();s.type=a||"triangle",s.frequency.value=t,n.gain.value=l||.02,n.gain.exponentialRampToValueAtTime(1e-4,g.currentTime+e),s.connect(n).connect(g.destination),s.start(),s.stop(g.currentTime+e)}let u=0;function k(){if(!S.start)return;const t=performance.now();t-u<1200||(u=t,M(392,.07,"square",.02),M(523,.08,"triangle",.014))}let T=new Audio("sound/music.mp3");T.loop=!0,T.volume=.33;const S={start:0,dead:0,lvup:0,t:0,time:0,kills:0,spawnT:0,nextSpawn:.8,msg:"",msgT:0,level:1,xp:0,nextXp:24,stop:0,shake:0,xpPulse:0,cardT:0,best:+localStorage.ss_best||0,choices:[],homeNeed:3,homeGot:0,musicStarted:0,sch:{nsh:0,mel:0,bak:0},pz:0,uq:[],inB:"",mb:0,mbd:0,bs:0,bd:0,bs2:0,bd2:0,b2At:0,pred:0,predDead:0,moth:0,mothDead:0,bossDownT:0,won:0,endWave:0,endT:0,endSpawnT:0,apWarn1:0,apWarn2:0,apStormHitCd:0,botMask:0,chemMask:0,psyMask:0,labStep:0,labBank:0,labFlip:0,labNsh:0,labMel:0,labBak:0,labNshRuns:0,labMelRuns:0,stormCd:0,labCd:0,safeCampT:0,safeBreachCd:0,safeThreat:0,lvPend:0,lvGrace:0,lbSent:0,lbTop:[],lbTopErr:"",lbFetchT:0,lbRankText:"",lbRankErr:"",lbRankFetchT:0,lbRetryAt:0,lbBtnX:0,lbBtnY:0,lbBtnW:0,lbBtnH:0,paused:0,pauseBtnX:0,pauseBtnY:0,pauseBtnW:0,pauseBtnH:0},v=window.LEADERBOARD_CONFIG||{},P=((v.supabaseUrl||"")+"").replace(/\/+$/,""),C=(v.supabaseAnonKey||"")+"",R=(v.table||"leaderboard_entries")+"",z="zoomies_last_entry",A="zoomies_lb_name",w="zoomies_lb_optin",D="zoomies_lb_guest_id",I="zoomies_lb_best_score",B="zoomies_lb_pending_entry",W="zoomies_lb_last_synced_score";function F(t){try{return localStorage.getItem(t)||""}catch{return""}}function E(t,e){try{localStorage.setItem(t,e)}catch{}}function H(t){try{const e=localStorage.getItem(t);return e?JSON.parse(e):0}catch{return 0}}function L(t){return"string"==typeof t&&t.length>0&&t.length<=24&&/^[A-Za-z0-9 _.-]+$/.test(t)}function q(){location.href="leaderboard.html"}function N(t,e){const a=Number(t.kills)||0,l=Number(e.kills)||0;if(l!==a)return l-a;const s=Number(t.time_seconds),n=Number(e.time_seconds);if(s!==n)return s-n;const o=Date.parse(t.created_at||"")||0,r=Date.parse(e.created_at||"")||0;return r!==o?r-o:(Number(e.id)||0)-(Number(t.id)||0)}function O(t){if(!t||"object"!=typeof t)return 0;const e=0|Number(t.kills),a=+Number(t.time_seconds).toFixed(1);return e<0||!Number.isFinite(a)||a<0?0:{kills:e,time_seconds:a}}function _(t,e){return t?e?t.kills!==e.kills?t.kills>e.kills:t.time_seconds<e.time_seconds:1:0}function V(t){return O(H(t))}function G(t,e){e&&E(t,JSON.stringify(e))}function X(t){try{localStorage.removeItem(t)}catch{}}async function K(t){if(!P||!C||!R)return;const e=Date.now();if(t||!(e-S.lbFetchT<8e3)){S.lbFetchT=e,S.lbTopErr="";try{const t="?select=id,name,kills,time_seconds,created_at&order=kills.desc,time_seconds.asc,created_at.desc,id.desc&limit=100",e=await fetch(P+"/rest/v1/"+encodeURIComponent(R)+t,{headers:{apikey:C,Authorization:"Bearer "+C}});if(!e.ok)return void(S.lbTopErr="leaderboard unavailable");const a=await e.json(),l=Array.isArray(a)?a.slice().sort(N):[];S.lbTop=l.slice(0,5)}catch{S.lbTopErr="leaderboard unavailable"}}}async function U(t){if(!P||!C||!R)return;const e=Date.now();if(!t&&e-S.lbRankFetchT<8e3)return;S.lbRankFetchT=e,S.lbRankErr="";const a=H(z);if(a&&a.id)try{const s=await fetch(P+"/rest/v1/"+encodeURIComponent(R)+"?select=id,name,kills,time_seconds&id=eq."+a.id+"&limit=1",{headers:{apikey:C,Authorization:"Bearer "+C}});if(!s.ok)return void(S.lbRankErr="rank unavailable");const n=await s.json();if(!Array.isArray(n)||!n.length)return void(S.lbRankText="score syncing...");const o=n[0];async function l(t){const e=await fetch(P+"/rest/v1/"+encodeURIComponent(R)+"?select=id&"+t,{method:"HEAD",headers:{apikey:C,Authorization:"Bearer "+C,Prefer:"count=exact"}});if(!e.ok)throw Error("count failed");return function(t){const e=((t||"")+"").match(/\/(\d+)$/);return e?+e[1]:0}(e.headers.get("content-range"))}const r=await l("kills=gt."+o.kills)+await l("kills=eq."+o.kills+"&time_seconds=lt."+o.time_seconds)+await l("kills=eq."+o.kills+"&time_seconds=eq."+o.time_seconds+"&id=lt."+o.id)+1;S.lbRankText="your rank #"+r+" ("+o.kills+" / "+Number(o.time_seconds).toFixed(1)+"s)"}catch{S.lbRankErr="rank unavailable"}else S.lbRankText="submit once to track your rank"}async function Y(){if(S.lbSent)return;if(Date.now()<S.lbRetryAt)return;if(!(P&&C&&R&&("yes"!==F(w)&&E(w,"yes"),1)))return;const t=function(){let t=F(A).trim();if(L(t))return t;const e=prompt("Enter a name for global leaderboard (1-24 chars).");if(null!=e){if(t=e.trim(),L(t))return E(A,t),t;alert("Name must be 1-24 chars and only letters, numbers, spaces, _, ., or -. Using a guest name for now.")}return t=function(){let t=F(D).trim().toLowerCase();return/^[a-z0-9]{4,12}$/.test(t)||(t=Math.random().toString(36).slice(2,8),E(D,t)),"player-"+t}(),E(A,t),t}();if(!t)return;const e=function(){const t=O({kills:0|S.kills,time_seconds:+S.time.toFixed(1)});if(!t)return 0;const e=V(I);return e&&!_(t,e)||G(I,t),t}()||O({kills:0|S.kills,time_seconds:+S.time.toFixed(1)});if(!e)return;const a=V(I),l=V(B);let s=a&&_(a,e)?a:e;l&&_(l,s)&&(s=l);const n=V(W);if(!l&&function(t,e){return!(!t||!e||t.kills!==e.kills||t.time_seconds!==e.time_seconds)}(n,s))return;G(B,s);const o={name:t,kills:s.kills,time_seconds:s.time_seconds};S.lbSent=1;try{let e=await fetch(P+"/rest/v1/"+encodeURIComponent(R),{method:"POST",headers:{"Content-Type":"application/json",apikey:C,Authorization:"Bearer "+C,Prefer:"return=representation"},body:JSON.stringify([o])});if(e.ok){const t=await e.json(),a=Array.isArray(t)?t[0]:0;return a&&a.id&&E(z,JSON.stringify({id:a.id,name:a.name,kills:a.kills,time_seconds:a.time_seconds})),G(W,s),X(B),S.lbRetryAt=0,K(1),void U(1)}if(e=await fetch(P+"/rest/v1/"+encodeURIComponent(R),{method:"POST",headers:{"Content-Type":"application/json",apikey:C,Authorization:"Bearer "+C,Prefer:"return=minimal"},body:JSON.stringify([o])}),!e.ok)return S.lbSent=0,void(S.lbRetryAt=Date.now()+5e3);try{const e="?select=id,name,kills,time_seconds&name=eq."+encodeURIComponent(t)+"&kills=eq."+s.kills+"&time_seconds=eq."+s.time_seconds+"&order=id.desc&limit=1",a=await fetch(P+"/rest/v1/"+encodeURIComponent(R)+e,{headers:{apikey:C,Authorization:"Bearer "+C}});if(a.ok){const t=await a.json(),e=Array.isArray(t)?t[0]:0;e&&e.id&&E(z,JSON.stringify({id:e.id,name:e.name,kills:e.kills,time_seconds:e.time_seconds}))}}catch{}G(W,s),X(B),S.lbRetryAt=0,S.lbRankText="score submitted; rank syncing...",K(1),U(1)}catch{S.lbSent=0,S.lbRetryAt=Date.now()+5e3}}const J={x:260,y:900,vx:0,vy:0,r:15,hp:100,maxHp:100,speed:192,fireCd:0,fireRate:.46,dmg:12,range:400,shots:1,magnet:88,face:1,rx:0,ry:0,flash:0,gx:1,gy:0,zc:0,zr:0,zt:0,zx:1,zy:0,zcd:0,zDur:1,zSpd:2.1,zLoad:1.5,zCool:5.5,zDmg:24,zDr:.55,zb:0,zp:0,mkOn:0,mkT:0,mkI:8.8,mkS:0,mkD:14,mkR:54,mkSl:.54,chDo:14,chBurst:10,chHeal:8,chHealCd:0,chHealI:.85,cat:0,catM:0,catType:0,fb:0,fbT:0,fbI:8.6,fbR:210,fbFear:2.3,fbKn:320,fbFx:0,fbTier:0,fbMode:1,fbAiT:0,bot:0,botCount:0,botSlots:0,bType:0,bAtk:1,bAuraR:0,bAuraSl:0,bHealCd:0,bHealI:10,bHealAmt:10,bHealFx:0,triA:0,triFx:0,slCharge:0,slFocus:0,slT:0,slRecallT:0,slLinkT:0,slRecallPulse:0,slCarryVx:0,slCarryVy:0,slPow:0,slWave:0,slComboFx:0,slHitMask:0,slPerfect:0,slScale:1,slDx:1,slDy:0,zoomShield:0,bx:0,by:0,ba:0,bcd:0,bRate:1.9,bDmg:1.15,bRange:480,bFetch:95,bPull:195,bCarry:0,bCarryMax:2,bGrabCd:0,bGrabI:.38,bPier:4,bSize:6},Z={l:0,r:0,u:0,d:0,gr:0};let j=-1,Q=0;const $={x:78,y:0,r:42,kr:16,tx:0,ty:0,ax:0,ay:0,ttx:0,tty:0,tax:0,tay:0,show:0,act:0},tt=[],et=[],at=[],lt=[],st=[],nt=[],ot=[],rt=[],it={on:0,x:0,y:0,t:0,d:0,pop:0};function ft(t,e){return t+Math.random()*(e-t)}function ht(t,e,a){return t<e?e:t>a?a:t}function ct(t,e,a,l,s,n){const o=s-a,r=n-l;let i=((t-a)*o+(e-l)*r)/(o*o+r*r||1);i=ht(i,0,1);const f=t-(a+o*i),h=e-(l+r*i);return f*f+h*h}function bt(t){const e=t-1;return 1+2.70158*e*e*e+1.70158*e*e}function dt(t,a,l,s,n){const o=Math.max(0,Math.min(n,.5*Math.min(l,s)));e.beginPath(),e.moveTo(t+o,a),e.lineTo(t+l-o,a),e.quadraticCurveTo(t+l,a,t+l,a+o),e.lineTo(t+l,a+s-o),e.quadraticCurveTo(t+l,a+s,t+l-o,a+s),e.lineTo(t+o,a+s),e.quadraticCurveTo(t,a+s,t,a+s-o),e.lineTo(t,a+o),e.quadraticCurveTo(t,a,t+o,a),e.closePath()}function mt(){const t=a<560,e=t?a-14:Math.min(a-20,620),s=t?ht(.48*l,296,390):ht(.4*l,268,340),n=.5*(a-e),o=l-s-12,r=[];if(t){const t=8,a=e-22,l=Math.max(74,Math.min(100,(s-84-2*t)/3)),i=o+50;for(let e=0;e<3;e++)r.push({x:n+14,y:i+e*(l+t),w:a,h:l})}else{const t=10,a=(e-32-2*t)/3,l=Math.max(102,Math.min(130,s-82)),i=o+52;for(let e=0;e<3;e++)r.push({x:n+16+e*(a+t),y:i,w:a,h:l})}return{mobile:t,bx:n,by:o,bw:e,bh:s,rects:r}}function yt(t,a,l,s,n,o){const r=t.split(" ");let i="",f=0;for(let t=0;t<r.length;t++){const h=i?i+" "+r[t]:r[t];if(e.measureText(h).width<=s)i=h;else{if(e.fillText(i,a,l+f*n),f++,f>=o)return;i=r[t]}}f<o&&i&&e.fillText(i,a,l+f*n)}function xt(t,a){let l=(t??"")+"";if(a<=0)return"";if(e.measureText(l).width<=a)return l;for(;l.length>1&&e.measureText(l+"...").width>a;)l=l.slice(0,-1);return l+"..."}function pt(t){return t.includes("Buddy")||t.includes("Bot")?"ü§ñ":t.includes("Catalyst")||t.includes("Chemical")||t.includes("Acidic")?"üß™":t.includes("Heal")||t.includes("Tough")?"‚ù§Ô∏è":t.includes("Shock")||t.includes("Zoomies")||t.includes("Rapid")||t.includes("Speed")?"‚ö°":t.includes("Magnet")?"üß≤":t.includes("Shot")?"üéØ":t.includes("Territory")||t.includes("Puddle")||t.includes("Gravity")?"üíß":t.includes("Bite")?"ü¶¥":"üõ†Ô∏è"}function gt(t){for(let e=0;e<i.length;e++)if(i[e].id===t)return i[e];return 0}function Mt(t,e,a){const l=a||0;for(let a=0;a<i.length;a++){const s=i[a],n=t-s.x,o=e-s.y;if(n*n+o*o<(s.r+l)*(s.r+l))return s}return 0}function ut(t,e){const a=e||0;let l=0;for(let e=0;e<i.length;e++){const s=i[e];let n=t.x-s.x,o=t.y-s.y,r=Math.hypot(n,o)||1;const f=s.r+a;if(r<f){if(r<.001){const t=Math.random()*Math.PI*2;n=Math.cos(t),o=Math.sin(t),r=1}t.x=s.x+n/r*f,t.y=s.y+o/r*f,l=1}}return l}function kt(){const t=Math.min(a-24,420),e=Math.min(l-130,260),s=.5*(a-t),n=.5*(l-e)+24,o=(t-36-20)/3,r=n+e-72;return{bx:s,by:n,bw:t,bh:e,btn:[{x:s+18,y:r,w:o,h:46},{x:s+18+o+10,y:r,w:o,h:46},{x:s+18+2*(o+10),y:r,w:o,h:46}]}}function Tt(t){const e=[];let a=-1;for(let l=0;l<t;l++){let t=3*Math.random()|0;t===a&&(t=(t+1+(2*Math.random()|0))%3),e.push(t),a=t}return e}function St(t,e){if(!S.pz)if("lab"===e&&"nsh"===t){const t=1+(S.labNshRuns/2|0),e=4+Math.min(2,t-1);S.pz={id:"nsh",seq:Tt(e),step:0,lab:1,trial:S.labNshRuns+1,tier:t},S.msg="research",S.msgT=1.2}else if("lab"===e&&"mel"===t){const t=1+(S.labMelRuns/2|0),e=5+Math.min(2,t-1);S.pz={id:"mel",seq:Tt(e),step:0,lab:1,trial:S.labMelRuns+1,tier:t},S.msg="research",S.msgT=1.2}else"nsh"===t?(S.pz={id:"nsh",seq:Tt(3),step:0},S.msg="research",S.msgT=1.2):"mel"===t?(S.pz={id:"mel",seq:Tt(4),step:0},S.msg="research",S.msgT=1.2):"bak"===t&&(S.pz={id:"bak",lane:-1,wT:1,wMax:1,hit:0,need:7,miss:0,maxMiss:3},Pt(S.pz),S.msg="calm panic waves",S.msgT=1.25)}function vt(t){const e=0|t.lane;let a=3*Math.random()|0;e>=0&&a===e&&(a=(a+1+(2*Math.random()|0))%3),t.lane=a;const l=1.16-Math.min(.42,.043*(t.hit||0));t.wMax=Math.max(.55,l),t.wT=t.wMax}function Pt(t){t.hit=0,t.miss=0,vt(t)}function Ct(t){if(!S.pz)return;const e=S.pz;if("bak"!==e.id)if(t===e.seq[e.step]){if(e.step++,M(620+70*e.step,.04,"triangle",.018),e.step>=e.seq.length){const t=e.id;S.pz=0,At(t),e.lab&&("nsh"===t?S.labNshRuns++:"mel"===t&&S.labMelRuns++)}}else e.step=0,le(.03),M(180,.06,"square",.02),S.msg="retry",S.msgT=.55;else if(t===e.lane){const t=1-e.wT/Math.max(.001,e.wMax);if(e.hit++,t>.42&&t<.72?(ce(J.x,J.y,"#9ed9ff",7,56),M(920,.04,"triangle",.02)):M(640,.04,"triangle",.016),e.hit>=e.need)return S.pz=0,void At("bak");vt(e)}else e.miss++,le(.03),M(180,.05,"square",.019),e.miss>=e.maxMiss?(S.msg="panic spike: reset",S.msgT=.9,Pt(e)):(S.msg="wrong door",S.msgT=.5,vt(e))}let Rt=new Audio("sound/whatthedogdoing.mp3");function zt(t){Math.random()<.55&&(Rt.volume=.33,Rt.play().catch(()=>{})),"nsh"===t&&0===S.sch.nsh?(S.sch.nsh=1,k(),St("nsh"),S.msg="help",S.msgT=1.4,M(640,.05,"triangle",.02)):"mel"===t&&0===S.sch.mel?(S.sch.mel=1,k(),St("mel"),S.msg="help",S.msgT=1.4,M(680,.05,"triangle",.02)):"bak"===t&&0===S.sch.bak&&(S.sch.bak=1,k(),St("bak"),S.msg="baker needs calming support",S.msgT=1.5,M(700,.05,"triangle",.02))}function At(t){"nsh"===t&&2!==S.sch.nsh?(S.sch.nsh=2,Nt("nsh"),S.msg="nsh",S.msgT=2.1,le(.12),ce(J.x,J.y,"#79d7ff",16,95),M(760,.07,"square",.024)):"nsh"===t&&S.labNsh>0?(S.labNsh--,Nt("nsh"),S.msg="nsh prototype ready",S.msgT=1.8,le(.12),ce(J.x,J.y,"#9de6ff",12,72),M(740,.06,"triangle",.022)):"mel"===t&&2!==S.sch.mel?(S.sch.mel=2,Nt("mel"),S.msg="mel",S.msgT=2.1,le(.12),ce(J.x,J.y,"#ffd58f",16,95),M(720,.07,"square",.024)):"mel"===t&&S.labMel>0?(S.labMel--,Nt("mel"),S.msg="mellon prototype ready",S.msgT=1.8,le(.12),ce(J.x,J.y,"#b6ef9d",12,72),M(720,.06,"triangle",.022)):"bak"===t&&2!==S.sch.bak?(S.sch.bak=2,Nt("bak"),S.msg="baker",S.msgT=2.1,le(.14),ce(J.x,J.y,"#9ec8ff",18,106),M(780,.07,"square",.024)):"bak"===t&&S.labBak>0&&(S.labBak--,Nt("bak"),S.msg="baker psych prototype ready",S.msgT=1.8,le(.12),ce(J.x,J.y,"#b7d6ff",12,76),M(760,.06,"triangle",.022)),Zt(),Bt(),S.labCd=3}function wt(t){return 3===t||4===t||5===t||9===t||11===t}function Dt(t){return 3===t?"cognitive freeze":2===t?"decoy scotty":"command bark"}function It(){if(2!==S.sch.bak)return 0;let t=1;return(S.kills>=320||S.mbd||S.bs||S.bd||S.bs2||S.bd2)&&(t=2),(S.kills>=1e3||S.bs2||S.bd2)&&(t=3),t}function Bt(){if(2!==S.sch.bak)return;const t=It();if(t<=0)return;const e=S.uq.indexOf("bak")>=0?1:0;let a=Ot(S.psyMask)+e+S.labBak;for(;a<t;)S.labBak++,a++,S.msg="baker: psych bench ready",S.msgT=1.4,M(700,.045,"triangle",.019)}function Wt(t){rt.length>=8&&rt.shift(),rt.push(t)}function Ft(t,e,a){const l=((t.psJ||0)>0?1:0)|((t.psF||0)>0?2:0)|((t.psD||0)>0?4:0);1===e?t.psJ=Math.max(t.psJ||0,a):2===e?t.psF=Math.max(t.psF||0,a):t.psD=Math.max(t.psD||0,a),t.fb=Math.max(t.fb||0,.9*a);const s=((t.psJ||0)>0?1:0)|((t.psF||0)>0?2:0)|((t.psD||0)>0?4:0);if(s===l||wt(t.k)||(t.psComboCd||0)>0)return;let n=0;if(1&s&&2&s?n=1:1&s&&4&s?n=2:2&s&&4&s&&(n=3),n){const e=t.x-J.x,a=t.y-J.y;!function(t,e,a,l,s){const n=Math.hypot(l,s)||1,o=l/n,r=s/n;3===t?(Wt({k:t,x:e,y:a,r:136,t:2.9,d:2.9}),ce(e,a,"#a0ffd7",12,88)):2===t?(Wt({k:t,x:e,y:a,dx:o,dy:r,len:220,w:44,t:2.2,d:2.2}),ce(e,a,"#bde8ff",14,96)):(Wt({k:t,x:e,y:a,dx:o,dy:r,len:250,w:56,t:2.4,d:2.4}),ce(e,a,"#9ed9ff",12,84)),S.msg=function(t){return 1===t?"snaplane":2===t?"whiplash rail":"trance pool"}(t),S.msgT=.9,M(2===t?860:3===t?680:760,.05,"triangle",.02)}(n,t.x,t.y,e,a),t.psComboCd=.9}}function Et(){if(2!==S.sch.nsh)return 0;let t=1;return(S.mbd||S.bs||S.bd||S.bs2||S.bd2)&&(t=2),(S.bs2||S.bd2)&&(t=3),t}function Ht(){if(2!==S.sch.mel)return 0;let t=1;return(S.bd||S.bs2||S.bd2)&&(t=2),(S.bs2||S.bd2)&&(t=3),t}function Lt(){let t=0,e=0;for(let a=0;a<i.length;a++){const l=i[a];if("home"===l.id)continue;const s=qt(l);s>e&&(e=s,t=l)}return{target:t,count:e}}function qt(t){if(!t)return 0;const e=t.r+230,a=e*e;let l=0;for(let e=0;e<tt.length;e++){const s=tt[e],n=s.x-t.x,o=s.y-t.y;n*n+o*o<a&&l++}return l}function Nt(t){S.uq.indexOf(t)<0&&S.uq.push(t)}function Ot(t){return(1&t?1:0)+(2&t?1:0)+(4&t?1:0)}function _t(){return J.zt>0||J.slT>0||J.slRecallT>0||J.slLinkT>0}function Vt(){return _t()||S.lvGrace>0}const Gt={1:{rate:1.15,dmg:1.6,range:620,fetch:72,pull:150,carry:1,grab:.42,pier:5,size:7.2,auraR:0,auraSl:0,healI:0,healAmt:0,pulse:1,col:"#9de6ff",body:"#93d8ff",ring:"#d0efff"},2:{rate:1.72,dmg:.95,range:520,fetch:118,pull:198,carry:2,grab:.34,pier:0,size:3.8,auraR:0,auraSl:0,healI:8,healAmt:18,pulse:0,col:"#7ae8a3",body:"#74de95",ring:"#d9ffe5"},3:{rate:2.85,dmg:.82,range:390,fetch:110,pull:205,carry:2,grab:.34,pier:2,size:8.5,auraR:124,auraSl:.46,healI:0,healAmt:0,pulse:1,kb:.35,col:"#ffd48c",body:"#ffd48c",ring:"#fff0c7"}};function Xt(t){const e=Gt[t]||Gt[1],a=Math.max(0,J.bCarryMax-2);return{rate:Math.max(.5,e.rate*(J.bRate/1.9)),dmg:e.dmg*(J.bDmg/1.15),range:e.range*(J.bRange/480),fetch:e.fetch*(J.bFetch/95),pull:e.pull*(J.bPull/195),carry:Math.max(1,e.carry+a),grab:Math.max(.14,e.grab*(J.bGrabI/.38)),pier:Math.max(0,Math.round(e.pier+(J.bPier-4))),size:Math.max(2.8,e.size*(J.bSize/6)),auraR:e.auraR,auraSl:e.auraSl,healI:e.healI>0?Math.max(1.9,e.healI*(J.bHealI/10)):0,healAmt:e.healAmt>0?e.healAmt*(J.bHealAmt/10):0,pulse:e.pulse,kb:e.kb||0,col:e.col,body:e.body,ring:e.ring}}function Kt(t){const e=[];for(let a=1;a<=3;a++)t&1<<a-1||e.push(a);return e}function Ut(t){return 1===t?{n:"Volt Buddy",d:"striker bot: rapid shock pulses, low cargo",f:()=>$t(1),bg:"rgba(29,53,79,.96)",st:"rgba(147,216,255,.88)",tx:"#f1f9ff",sub:"#b3d4ee"}:2===t?{n:"Medic Buddy",d:"green rounds + heals Scotty every 8s",f:()=>$t(2),bg:"rgba(24,72,44,.96)",st:"rgba(148,232,171,.9)",tx:"#e9ffef",sub:"#b9e5c6"}:{n:"Guard Buddy",d:"warden bot: slowing aura + sturdy pulse",f:()=>$t(3),bg:"rgba(73,50,27,.96)",st:"rgba(255,205,138,.9)",tx:"#fff4df",sub:"#e6cda5"}}function Yt(t){return 1===t?{n:"Acidic Puddle",d:"corrosive zone: burst + damage over time",f:()=>te(1),bg:"rgba(33,75,34,.96)",st:"rgba(160,236,146,.88)",tx:"#edffe9",sub:"#bce2b3"}:2===t?{n:"Heal Puddle",d:"restorative zone: heals Scotty while inside",f:()=>te(2),bg:"rgba(22,79,72,.96)",st:"rgba(151,242,228,.9)",tx:"#e8fffb",sub:"#b6e7df"}:{n:"Gravity Puddle",d:"black hole zone: drags enemies from far outside",f:()=>te(3),bg:"rgba(30,45,86,.96)",st:"rgba(156,190,255,.9)",tx:"#edf3ff",sub:"#bfd1f0"}}function Jt(t){return 1===t?{n:"Command Bark",d:"push + close stun, applies jolt mark",f:()=>ee(1),bg:"rgba(34,67,94,.96)",st:"rgba(158,214,255,.88)",tx:"#eef8ff",sub:"#c7def2"}:2===t?{n:"decoy scotty",d:"spawns decoy taunt, applies fixate mark",f:()=>ee(2),bg:"rgba(33,71,86,.96)",st:"rgba(143,234,255,.88)",tx:"#ecfcff",sub:"#c0e8f2"}:{n:"Cognitive Freeze",d:"mind-wave slow lock, applies daze mark",f:()=>ee(3),bg:"rgba(56,63,102,.96)",st:"rgba(185,191,255,.88)",tx:"#f0f2ff",sub:"#ccd0f1"}}function Zt(){for(;S.kills>=160*(S.labStep+1);)S.labStep++,S.labBank=Math.min(6,S.labBank+1),S.msg="new prototype intel",S.msgT=1.25,M(620,.04,"triangle",.018);for(;S.labBank>0;){const t=S.uq.indexOf("nsh")>=0?1:0,e=S.uq.indexOf("mel")>=0?1:0,a=Ot(S.botMask),l=Ot(S.chemMask),s=Et(),n=Ht(),o=a+S.labNsh+t,r=l+S.labMel+e,i=2===o+1?2:3,f=2===r+1?1:2,h=2===S.sch.nsh&&a>=1&&o<s&&S.labBank>=i,c=2===S.sch.mel&&l>=1&&r<n&&S.labBank>=f;if(!h&&!c)break;let b="";h&&c?(S.labFlip^=1,b=S.labFlip?"nsh":"mel"):b=h?"nsh":"mel","nsh"===b?(S.labNsh++,S.msg="nsh: prototype bench ready",S.msgT=1.6,M(700,.05,"triangle",.02),S.labBank-=i):(S.labMel++,S.msg="mellon: catalyst bench ready",S.msgT=1.6,M(680,.05,"triangle",.02),S.labBank-=f)}Bt()}function jt(t){S.lvup||S.pz||S.uq.length||S.labCd>0||("nsh"===t&&S.labNsh>0?(St("nsh","lab"),S.msg="nsh: run prototype trial",S.msgT=1.35,M(700,.05,"triangle",.02)):"mel"===t&&S.labMel>0?(St("mel","lab"),S.msg="mellon: run prototype trial",S.msgT=1.35,M(680,.05,"triangle",.02)):"bak"===t&&S.labBak>0&&(St("bak","lab"),S.msg="baker: run psych trial",S.msgT=1.35,M(720,.05,"triangle",.02)))}function Qt(){const t=function(){const t=[];for(let e=1;e<=3;e++)S.botMask&1<<e-1&&t.push(e);return t}(),e=J.bot?Math.max(1,Math.min(0|J.botCount,t.length||1)):0;for(;nt.length<e;){const e=t[Math.min(t.length-1,nt.length)]||1;nt.push({x:J.x,y:J.y,t:e,cd:ft(.05,.3),grabCd:ft(.03,.22),mcd:0,slx:0,sly:0,vx:0,vy:0})}for(;nt.length>e;)nt.pop();for(let e=0;e<nt.length;e++)nt[e].t=t[Math.min(t.length-1,e)]||nt[e].t||1;if(J.botSlots!==e){const t=40;for(let e=0;e<nt.length;e++){const a=J.ba+e*(2*Math.PI/Math.max(1,nt.length));nt[e].x=J.x+Math.cos(a)*t,nt[e].y=J.y+Math.sin(a)*t,nt[e].cd=ft(.05,.3),nt[e].grabCd=ft(.03,.22),nt[e].slx=0,nt[e].sly=0,nt[e].vx=0,nt[e].vy=0}J.botSlots=e}nt.length||(J.bx=J.x+20,J.by=J.y+4,J.botSlots=0)}function $t(t){const e=!J.bot;J.bot=1,J.bType=t,J.bx=J.x+20,J.by=J.y+4,J.ba=0,e&&(J.bcd=.45,J.bRate=1.9,J.bDmg=1.15,J.bRange=480,J.bFetch=95,J.bPull=195,J.bCarry=0,J.bCarryMax=2,J.bGrabCd=0,J.bGrabI=.38,J.bPier=4,J.bSize=6,J.bAtk=1,J.bAuraR=0,J.bAuraSl=0,J.bHealCd=0,J.bHealI=10,J.bHealAmt=10,J.bHealFx=0),S.botMask|=1<<t-1,J.botCount=Math.max(1,Ot(S.botMask)),Qt(),Zt()}function te(t){J.cat=1,J.catType=t,J.catM=0,J.chDo=14,J.chBurst=10,J.chHeal=8,J.chHealCd=0,J.chHealI=.85,1===t?(J.chDo=20,J.chBurst=13):2===t?(J.chHeal=10,J.chHealI=.85):J.mkSl=Math.max(J.mkSl,.6),S.chemMask|=1<<t-1,Zt()}function ee(t){const e=!J.fb;J.fb=1,J.fbT=0,J.fbFx=0,J.fbMode=1,J.fbAiT=0,it.on=0,it.t=0,it.pop=0,e&&(J.fbI=Math.min(J.fbI,7.4),J.fbR=Math.max(J.fbR,230),J.fbFear=Math.max(J.fbFear,2.8),J.fbKn=Math.max(J.fbKn,420)),S.psyMask|=1<<t-1,J.fbMode=t,Bt()}function ae(){if(S.lvup||S.dead||S.pz||!S.uq.length||Vt())return;const t=S.uq.shift();if(S.choices=[],"nsh"===t){const t=Kt(S.botMask);if(1===t.length){const e=t[0];return $t(e),S.msg="nsh: "+function(t){return 1===t?"Volt Buddy":2===t?"Medic Buddy":"Guard Buddy"}(e)+" calibrated",S.msgT=1.6,ce(J.x,J.y,"#9de6ff",14,84),void M(760,.06,"triangle",.025)}2===t.length?S.choices=[Ut(t[0]),Ut(t[1]),{n:"Wildcard Buddy",d:"installs one of the remaining buddy prototypes",f:()=>$t(t[Math.random()*t.length|0]),bg:"rgba(42,63,95,.96)",st:"rgba(167,207,255,.86)",tx:"#eef7ff",sub:"#c3d8ef"}]:3===t.length&&(S.choices=[Ut(1),Ut(2),Ut(3)])}else if("mel"===t){const t=Kt(S.chemMask);if(1===t.length){const e=t[0];return te(e),S.msg="mellon: "+function(t){return 1===t?"Acidic Puddle":2===t?"Heal Puddle":"Gravity Puddle"}(e)+" calibrated",S.msgT=1.6,ce(J.x,J.y,"#b6ef9d",14,84),void M(740,.06,"triangle",.025)}2===t.length?S.choices=[Yt(t[0]),Yt(t[1]),{n:"Wildcard Catalyst",d:"mixes one of the remaining catalyst variants",f:()=>te(t[Math.random()*t.length|0]),bg:"rgba(38,76,56,.96)",st:"rgba(159,236,184,.88)",tx:"#eaffef",sub:"#c2ebd0"}]:3===t.length&&(S.choices=[Yt(1),Yt(2),Yt(3)])}else if("bak"===t){const t=Kt(S.psyMask);if(1===t.length){const e=t[0];return ee(e),S.msg="baker: "+Dt(e)+" online",S.msgT=1.6,ce(J.x,J.y,"#b7d6ff",14,88),void M(760,.06,"triangle",.025)}2===t.length?S.choices=[Jt(t[0]),Jt(t[1]),{n:"Wildcard Psyche",d:"installs one of the remaining psych prototypes",f:()=>ee(t[Math.random()*t.length|0]),bg:"rgba(46,64,98,.96)",st:"rgba(174,199,255,.86)",tx:"#edf3ff",sub:"#c8d6ef"}]:3===t.length&&(S.choices=[Jt(1),Jt(2),Jt(3)])}S.choices.length&&(S.lvup=1,S.cardT=0,S.msg="up",S.msgT=1.4,M(760,.07,"triangle",.028))}function le(t){S.shake=ht(S.shake+t,0,1.3)}function se(t){S.stop=Math.max(S.stop,t)}function ne(){s=Math.max(1,Math.min(2,devicePixelRatio||1)),a=Math.max(320,0|innerWidth),l=Math.max(560,0|innerHeight),t.width=a*s|0,t.height=l*s|0,e.setTransform(s,0,0,s,0,0),e.imageSmoothingEnabled=!1;const n=$.r+16;$.act?($.x=ht($.x,n,a-n),$.y=ht($.y,n,l-n)):($.x=78,$.y=l-88)}function oe(t,e){let a=t-$.x,l=e-$.y;const s=Math.hypot(a,l)||1,n=$.r;s<10?(a=0,l=0):s>n&&(a=a/s*n,l=l/s*n),$.ttx=a,$.tty=l,$.tax=a/n,$.tay=l/n}function re(t){$.act=0,$.ttx=0,$.tty=0,$.tax=0,$.tay=0,t&&($.tx=0,$.ty=0,$.ax=0,$.ay=0,$.show=0)}function ie(t){st.length>=420||st.push(t)}function fe(t){at.length>=260||at.push(t)}function he(t){et.length>=260||et.push(t)}function ce(t,e,a,l,s){const n=tt.length>130?.5:tt.length>90?.7:1,o=Math.max(1,l*n|0);for(let l=0;l<o;l++){const l=Math.random()*Math.PI*2,n=(s||70)*(.4+Math.random());ie({x:t,y:e,vx:Math.cos(l)*n,vy:Math.sin(l)*n,t:ft(.2,.6),c:a})}}function be(t,e,a,l,s){const n=tt[t],o=!!s;if(6===n.k){const t=72+1.8*n.r,e=8+.18*S.time,a=J.x-n.x,l=J.y-n.y,s=Math.hypot(a,l);s<t&&!Mt(J.x,J.y,-8)&&(Ae(e*(1-s/t)),J.vx+=a/(s||1)*180,J.vy+=l/(s||1)*180),ce(n.x,n.y,"#ff6644",20,t),ce(n.x,n.y,"#ffaa44",12,.65*t),le(.1),M(180,.06,"sawtooth",.02)}if(9===n.k){S.pred=0,S.predDead=1,S.msg="predator down!",S.msgT=2.2,S.b2At=S.t+60,S.bossDownT=2,se(.1),le(.45),ce(n.x,n.y,"#ff2222",30,200),ce(n.x,n.y,"#ffa64d",18,140),M(240,.1,"sawtooth",.03),M(380,.1,"triangle",.022);for(let t=tt.length-1;t>=0;t--)10===tt[t].k&&(ce(tt[t].x,tt[t].y,"#882222",8,40),tt.splice(t,1))}if(11===n.k){S.moth=0,S.mothDead=1,S.won=1,S.msg="CAMPUS SECURED",S.msgT=999,S.bossDownT=5,se(.15),le(.7),ce(n.x,n.y,"#ff44ff",60,360),ce(n.x,n.y,"#ffd56d",50,300),ce(n.x,n.y,"#69f0c9",40,250),ce(n.x,n.y,"#8ec0ff",30,200),M(440,.22,"triangle",.035),M(554,.2,"triangle",.03),M(659,.24,"triangle",.035),M(880,.3,"triangle",.03);for(let t=tt.length-1;t>=0;t--)12===tt[t].k&&(ce(tt[t].x,tt[t].y,"#662266",6,34),tt.splice(t,1));K(1),U(1),Y()}if(5===n.k&&(S.mb=0,S.mbd=1,S.msg="the provost is down!",S.msgT=2,S.bossDownT=1.6,se(.08),le(.4),ce(n.x,n.y,"#ffa64d",36,190),ce(n.x,n.y,"#ffe0a0",20,130),M(240,.1,"sawtooth",.03),M(380,.1,"triangle",.02)),3===n.k){S.bd=1,S.bs=0,S.b2At=S.t+12,S.apWarn1=0,S.apWarn2=0,S.apStormHitCd=0;const t=n.b1Eat||0;S.msg=t>8?"the dean falls... stuffed with "+t+" mints":"the dean is defeated!",S.msgT=2.4,S.bossDownT=2.4,se(.12),le(.6),ce(n.x,n.y,"#ffe38f",48,240),ce(n.x,n.y,"#a789ff",30,180),t>4&&ce(n.x,n.y,"#69f0c9",20,160),M(200,.12,"sawtooth",.038),M(320,.12,"triangle",.024),M(500,.14,"square",.02)}else 4===n.k&&(S.bd2=1,S.bs2=0,S.msg="APEX DOWN ‚Äî ENDLESS MODE BEGINS",S.msgT=2.8,S.endWave=0,S.endT=0,S.endSpawnT=6,le(.42),se(.08),ce(n.x,n.y,"#c8b6ff",40,260),ce(n.x,n.y,"#ffd56d",24,180),M(210,.16,"sawtooth",.04),M(330,.12,"triangle",.025));S.kills++,S.spawnT=Math.min((S.spawnT||0)+.08,2),Zt(),o?ce(n.x,n.y,e||"#ff9675",Math.max(2,.35*(a||9)|0),Math.max(20,.6*(l||70))):(se(.03),le(.08),ce(n.x,n.y,e||"#ff9675",a||9,l||70),M(280,.03,"square",.012));const r=260-at.length;if(r>0){const t=o?Math.random()<.25?1:0:1+(Math.random()<.4?1:0);for(let e=0;e<Math.min(t,r);e++)fe({x:n.x+ft(-7,7),y:n.y+ft(-7,7),v:0|ft(5,8),m:1,t:0})}tt.splice(t,1)}function de(t){lt.length>=18&&lt.shift(),lt.push({x:J.x+4*J.gx,y:J.y+8,r:J.mkR,t:J.mkD,d:J.mkD,m:t});const e=1===t?"acid":2===t?"heal":3===t?"grav":"territory",a=1===t?"#8fdd73":2===t?"#7ad8cd":3===t?"#8fb6ff":"#ffd56d";S.msg=e,S.msgT=.5,ce(J.x,J.y+8,a,8,38),M(1===t?540:2===t?600:3===t?480:560,.03,"triangle",.018),se(.015),le(.035)}function me(){const t=[];if(J.cat)for(let e=1;e<=3;e++)S.chemMask&1<<e-1&&t.push(e);t.length||t.push(0),de(t[0]),J.mkS=.32,J.mkBurstQ=t.slice(1),J.mkBurst=J.mkBurstQ.length,J.mkBurstT=J.mkBurst>0?.5:0,J.mkBurst<=0&&(J.mkT=J.mkI)}function ye(t,e,a,l,s){(function(t,e,a,l){for(let s=0;s<ot.length;s++){const n=ot[s],o=e-n.x,r=a-n.y;if(n.k===t&&o*o+r*r<(l+n.r)*(l+n.r)*.22)return 1}return 0})(t,e,a,l)||(ot.length>=14&&ot.shift(),ot.push({k:t,x:e,y:a,r:l,t:s,d:s,pcd:0}),S.msg=function(t){return 1===t?"vortex: pull + melt":2===t?"sanctuary: heal + slow":3===t?"toxic bloom: chip + regen":"campus storm!"}(t),S.msgT=4===t?1.55:1.2,ce(e,a,function(t){return 1===t?"#95f0b8":2===t?"#89ffe8":3===t?"#ccff9b":"#c8f3ff"}(t),4===t?24:14,4===t?126:84),M(4===t?820:1===t?700:2===t?640:680,.06,"triangle",.022))}function xe(t,e,a){lt[t]&&(lt[t].t=Math.min(lt[t].t,.05)),lt[e]&&(lt[e].t=Math.min(lt[e].t,.05)),void 0!==a&&lt[a]&&(lt[a].t=Math.min(lt[a].t,.05))}function pe(){!S.start||S.dead||S.lvup||!S.paused&&S.pz||(S.paused=S.paused?0:1,S.paused?(T.pause(),M(520,.04,"triangle",.016)):(S.musicStarted&&T.play().catch(()=>{}),M(620,.04,"triangle",.018)))}function ge(t){if(S.dead=0,S.lvup=0,S.t=0,S.time=0,S.spawnT=0,S.nextSpawn=.8,S.kills=0,S.msg="",S.msgT=0,S.level=1,S.xp=0,S.nextXp=24,S.stop=0,S.shake=0,S.xpPulse=0,S.cardT=0,S.choices=[],S.homeGot=0,S.sch.nsh=0,S.sch.mel=0,S.sch.bak=0,S.pz=0,S.uq.length=0,S.inB="",S.mb=0,S.mbd=0,S.bs=0,S.bd=0,S.bs2=0,S.bd2=0,S.b2At=0,S.pred=0,S.predDead=0,S.moth=0,S.mothDead=0,S.bossDownT=0,S.won=0,S.endWave=0,S.endT=0,S.endSpawnT=0,S.apWarn1=0,S.apWarn2=0,S.apStormHitCd=0,S.botMask=0,S.chemMask=0,S.psyMask=0,S.labStep=0,S.labBank=0,S.labFlip=0,S.labNsh=0,S.labMel=0,S.labBak=0,S.labNshRuns=0,S.labMelRuns=0,S.stormCd=0,S.labCd=0,S.safeCampT=0,S.safeBreachCd=0,S.safeThreat=0,S.lvPend=0,S.lvGrace=0,S.lbSent=0,S.lbTopErr="",S.lbRankErr="",S.lbRankText="",S.lbFetchT=0,S.lbRankFetchT=0,S.lbRetryAt=0,S.lbBtnX=0,S.lbBtnY=0,S.lbBtnW=0,S.lbBtnH=0,S.paused=0,S.pauseBtnX=0,S.pauseBtnY=0,S.pauseBtnW=0,S.pauseBtnH=0,J.x=260,J.y=900,J.vx=0,J.vy=0,J.hp=100,J.maxHp=100,J.speed=185,J.fireCd=0,J.fireRate=.46,J.dmg=12,J.range=400,J.shots=1,J.magnet=88,J.face=1,J.rx=0,J.ry=0,J.flash=0,J.gx=1,J.gy=0,J.zc=0,J.zr=0,J.zt=0,J.zx=1,J.zy=0,J.zcd=0,J.zDur=1,J.zSpd=2.1,J.zLoad=1.5,J.zCool=5.5,J.zDmg=24,J.zDr=.55,J.zb=0,J.zp=0,J.zDriftVx=0,J.zDriftVy=0,J.mkOn=0,J.mkT=0,J.mkI=8.8,J.mkS=0,J.mkD=14,J.mkR=54,J.mkSl=.54,J.mkBurst=0,J.mkBurstT=0,J.mkBurstQ=[],J.chDo=14,J.chBurst=10,J.chHeal=8,J.chHealCd=0,J.chHealI=.85,J.cat=0,J.catM=0,J.catType=0,J.fb=0,J.fbT=0,J.fbI=8.6,J.fbR=210,J.fbFear=2.3,J.fbKn=320,J.fbFx=0,J.fbTier=0,J.fbMode=1,J.fbAiT=0,J.bot=0,J.botCount=0,J.botSlots=0,J.bType=0,J.bAtk=1,J.bAuraR=0,J.bAuraSl=0,J.bHealCd=0,J.bHealI=10,J.bHealAmt=10,J.bHealFx=0,J.triA=0,J.triFx=0,J.slCharge=0,J.slFocus=0,J.slT=0,J.slRecallT=0,J.slLinkT=0,J.slRecallPulse=0,J.slCarryVx=0,J.slCarryVy=0,J.slPow=0,J.slWave=0,J.slComboFx=0,J.slHitMask=0,J.slPerfect=0,J.slDx=1,J.slDy=0,J.bx=J.x+20,J.by=J.y+4,J.ba=0,J.bcd=.45,J.bRate=1.9,J.bDmg=1.15,J.bRange=480,J.bFetch=95,J.bPull=195,J.bCarry=0,J.bCarryMax=2,J.bGrabCd=0,J.bGrabI=.38,J.bPier=4,J.bSize=6,J.slRopeRest=0,tt.length=0,et.length=0,at.length=0,lt.length=0,st.length=0,nt.length=0,ot.length=0,rt.length=0,it.on=0,it.t=0,it.pop=0,Z.l=Z.r=Z.u=Z.d=Z.gr=0,Q=0,re(1),function(){const t=gt("nsh"),e=gt("mel"),a=gt("bak");for(let e=0;e<80;e++){const e=ft(720,2380),a=ft(220,1580);if(!(Math.hypot(e-o,a-r)<560)){t.x=e,t.y=a;break}}for(let a=0;a<80;a++){const a=ft(620,2380),l=ft(220,1580),s=Math.hypot(a-o,l-r),n=Math.hypot(a-t.x,l-t.y);if(!(s<560||n<520)){e.x=a,e.y=l;break}}for(let l=0;l<100;l++){const l=ft(670,2380),s=ft(220,1580),n=Math.hypot(l-o,s-r),i=Math.hypot(l-t.x,s-t.y),f=Math.hypot(l-e.x,s-e.y);if(!(n<560||i<520||f<520*.92)){a.x=l,a.y=s;break}}}(),S.msg="home: unlock",S.msgT=1.6,t){for(let t=0;t<24;t++)fe({x:1300+ft(-120,120),y:900+ft(-120,120),v:7,m:1,t:0});for(let t=0;t<10;t++)fe({x:330+58*t,y:900+ft(-60,60),v:5,m:1,t:0})}}function Me(){const t=Math.min(c,100+.12*S.kills+.5*(S.time||0));if(tt.length>=t)return;const e=Math.random()*Math.PI*2,a=ft(360,560),l=1+.045*S.time;let s=22+8*l+ft(-4,8),n=56+6*l+ft(-6,10),o=ft(12,18),r=8+.9*l,i=0;S.time>8&&Math.random()<.24&&(i=1,n*=1.28,s*=.66,o*=.88,r*=.82),S.time>18&&Math.random()<.18&&(i=2,n*=.74,s*=2.15,o*=1.35,r*=1.28);const f=S.bd?S.kills-800:0;if(f>0){const t=Math.random();f>800&&t<.1?(i=8,s*=1.1,n*=.62,o=ft(13,17),r*=.6):f>400&&t<.2?(i=7,s*=1.6,n*=.82,o=ft(14,19),r*=1.1):f>100&&t<.22&&(i=6,s*=.72,n*=.92,o=ft(12,16),r*=.7)}if(S.endT>0){const t=1+.02*S.endT+.08*S.endWave;s*=t,n=Math.min(n*(1+.006*S.endT),1.6*n),r*=Math.min(t,3.5)}let h=ht(J.x+Math.cos(e)*a,20,2580),b=ht(J.y+Math.sin(e)*a,20,1780);const d=Mt(h,b,10);if(d){const t=h-d.x,e=b-d.y,a=Math.hypot(t,e)||1;h=d.x+t/a*(d.r+18),b=d.y+e/a*(d.r+18)}const m={x:h,y:b,r:o,hp:s,s:n,dmg:r,vx:0,vy:0,ht:0,sl:0,ce:0,bm:0,bt:0,bi:"",k:i};8===i&&(m.healCd=ft(1.8,2.8)),tt.push(m)}function ue(t){if(tt.length>=159)return;const e=Math.random()*Math.PI*2,a=ft(60,120),l=80+1.5*S.time,s={x:ht(t.x+Math.cos(e)*a,20,2580),y:ht(t.y+Math.sin(e)*a,20,1780),r:.8*t.r,hp:l,s:.95*t.s,dmg:.3*t.dmg,vx:0,vy:0,ht:0,sl:0,ce:0,bm:0,bt:0,bi:"",k:10,cloneLife:ft(4,6)};ut(s,8),tt.push(s),ce(s.x,s.y,"rgba(180,20,40,.6)",6,40),M(140,.04,"sawtooth",.012)}function ke(t){if(tt.length>=159)return;const e=Math.random()*Math.PI*2,a=ft(40,100),l=60+1.2*S.time,s={x:ht(t.x+Math.cos(e)*a,20,2580),y:ht(t.y+Math.sin(e)*a,20,1780),r:ft(9,13),hp:l,s:ft(90,120),dmg:8+.2*S.time,vx:0,vy:0,ht:0,sl:0,ce:0,bm:0,bt:0,bi:"",k:12};ut(s,6),tt.push(s)}function Te(t,e,a){if(tt.length>=159)return;const l=Math.max(1,0|a);for(let a=0;a<e&&tt.length<c;a++){const e=Math.random()*Math.PI*2,a=ft(30,90),s=ht(t.x+Math.cos(e)*a,20,2580),n=ht(t.y+Math.sin(e)*a,20,1780),o=l>=2&&Math.random()<.38?2:1,r=2===o?110+5.6*S.time+ft(-8,12):68+4*S.time+ft(-6,10),i=2===o?78+ft(-8,12):108+ft(-10,20),f=2===o?22+.34*S.time:16+.28*S.time,h={x:s,y:n,r:2===o?ft(15,20):ft(12,17),hp:r,s:i,dmg:f,vx:0,vy:0,ht:0,sl:0,ce:0,bm:0,bt:0,bi:"",k:o};ut(h,10),tt.push(h)}}function Se(t,e,a,l){const s=ht(.78*a,44,86),n=Math.max(1.15,.72*l);for(let a=0;a<ot.length;a++){const l=ot[a];if(5!==l.k)continue;const o=l.x-t,r=l.y-e,i=.4*(l.r+s);if(o*o+r*r<i*i)return l.x=.5*(l.x+t),l.y=.5*(l.y+e),l.r=Math.max(l.r,s),l.t=Math.max(l.t,n),l.d=Math.max(l.d,n),void(l.pcd=0)}ot.length>=14&&ot.shift(),ot.push({k:5,x:t,y:e,r:s,t:n,d:n,pcd:0,ap:1}),ce(t,e,"#d4b8ff",8,52),M(250,.035,"sawtooth",.011)}function ve(){return function(){const t=Re.filter(t=>!t.req||t.req());S.choices=[];for(let e=0;e<3&&t.length;e++){const e=Math.random()*t.length|0;S.choices.push(t[e]),t.splice(e,1)}}(),S.choices.length?(S.lvup=1,S.cardT=0,S.xpPulse=.65,S.msg="upgrade",S.msgT=2.1,se(.06),le(.2),M(860,.08,"triangle",.03),1):0}function Pe(t,e){const a=at[t];if(!a)return;a.bc&&J.bCarry>0&&J.bCarry--,function(t){for(S.xp+=t;S.xp>=S.nextXp;){S.xp-=S.nextXp,S.level++,S.nextXp=1.36*S.nextXp+9|0,Vt()?(S.lvPend++,S.xpPulse=.65,S.msg="upgrade queued",S.msgT=1,M(760,.05,"triangle",.018)):ve();break}}(a.v),at.splice(t,1),S.xpPulse=Math.min(.5,S.xpPulse+.11);let l=J.x,s=J.y;if("bot"===e){const t=(0|a.bc)-1,e=t>=0&&t<nt.length?nt[t]:0;l=e?e.x:J.bx,s=e?e.y:J.by}ce(l,s,"#69f0c9",4,40),J.mkOn||(S.homeGot++,S.homeGot>=S.homeNeed&&(J.mkOn=1,J.mkT=0,me(),S.msg="territory online",S.msgT=2.2,M(820,.07,"triangle",.028),ce(J.x,J.y,"#ffd56d",16,95)))}function Ce(){return 1+S.kills/1200}const Re=[{n:"Rapid Fire",d:"shoot faster",f:()=>J.fireRate=Math.max(.06,J.fireRate*(1-.22*Math.min(Ce(),4))),req:()=>1},{n:"Big Bites",d:"more damage",f:()=>J.dmg+=10*Ce(),req:()=>1},{n:"Speed Paws",d:"move faster",f:()=>J.speed+=35*Ce(),req:()=>1},{n:"Extra Shot",d:"+projectiles",f:()=>{const t=1+Math.floor(Ce()/2);J.shots=Math.min(14,J.shots+t)},req:()=>1},{n:"Snack Magnet",d:"pickup range up",f:()=>J.magnet+=45*Ce(),req:()=>1},{n:"Tough Fur",d:"+max hp +heal",f:()=>{const t=40*Ce();J.maxHp+=t,J.hp=Math.min(J.maxHp,J.hp+t)},req:()=>1},{n:"Quick Heal",d:"heal now",f:()=>J.hp=Math.min(J.maxHp,J.hp+55*Ce()),req:()=>1},{n:"Range Up",d:"bullets fly farther",f:()=>J.range=Math.min(1200,J.range+60*Ce()),req:()=>1},{n:"Zoomies Time",d:"zoomies lasts longer",f:()=>J.zDur=Math.min(6,J.zDur+.38*Ce()),req:()=>1},{n:"Zoomies CD",d:"zoomies cooldown down",f:()=>J.zCool=Math.max(.4,J.zCool-.9*Ce()),req:()=>1},{n:"Zoomies Speed",d:"zoomies speed up",f:()=>J.zSpd=Math.min(8,J.zSpd+.5*Ce()),req:()=>1},{n:"Zoomies Charge",d:"zoomies charge faster",f:()=>J.zLoad=Math.max(.2,J.zLoad-.26*Ce()),req:()=>1},{n:"Zoomies Damage",d:"zoomies hit harder",f:()=>J.zDmg+=6*Ce(),req:()=>1},{n:"Zoomies Drift",d:"longer momentum after dash",f:()=>J.zDr=Math.min(1.6,J.zDr+.22*Ce()),req:()=>1},{n:"Territory CD",d:"territory cooldown down",f:()=>J.mkI=Math.max(1.2,J.mkI-.75*Ce()),req:()=>J.mkOn},{n:"Territory Radius",d:"territory area bigger",f:()=>J.mkR=Math.min(260,J.mkR+18*Ce()),req:()=>J.mkOn},{n:"Territory Duration",d:"territory lasts longer",f:()=>J.mkD=Math.min(90,J.mkD+6*Ce()),req:()=>J.mkOn},{n:"Territory Slow",d:"territory slows more",f:()=>J.mkSl=Math.min(.96,J.mkSl+.14*Math.min(Ce(),3)),req:()=>J.mkOn},{n:"Chemical Puddle",d:"chem damage up",f:()=>{const t=Ce();J.chDo=Math.min(200,J.chDo+12*t),J.chBurst=Math.min(120,J.chBurst+10*t)},req:()=>J.cat},{n:"Chemical Radius",d:"chem area bigger",f:()=>J.mkR=Math.min(280,J.mkR+15*Ce()),req:()=>J.cat},{n:"Chemical Tempo",d:"chem cooldown down",f:()=>J.mkI=Math.max(.8,J.mkI-.65*Ce()),req:()=>J.cat},{n:"Sanctuary Boost",d:"heal puddles restore more + faster",f:()=>{J.chHeal=Math.min(30,J.chHeal+4*Ce()),J.chHealI=Math.max(.3,J.chHealI-.08*Ce())},req:()=>J.cat&&2&S.chemMask},{n:"Psych Tempo",d:"psych cooldown down",f:()=>J.fbI=Math.max(2.4,J.fbI-.65*Ce()),req:()=>J.fb},{n:"Psych Radius",d:"psych effect radius up",f:()=>J.fbR=Math.min(360,J.fbR+22*Ce()),req:()=>J.fb},{n:"Psych Control",d:"control marks last longer",f:()=>J.fbFear=Math.min(8,J.fbFear+.35*Ce()),req:()=>J.fb},{n:"Psych Force",d:"stronger psych knockback",f:()=>J.fbKn=Math.min(1200,J.fbKn+90*Ce()),req:()=>J.fb},{n:"Bot Fetch",d:"bot grabs mints farther",f:()=>J.bFetch=Math.min(500,J.bFetch+40*Ce()),req:()=>J.bot},{n:"Bot Cargo",d:"bot carries more mints",f:()=>J.bCarryMax=Math.min(12,J.bCarryMax+1+Math.floor(Ce()/3)),req:()=>J.bot},{n:"Bot Speed",d:"bots move faster",f:()=>J.bPull=Math.min(600,J.bPull+35*Ce()),req:()=>J.bot},{n:"Medic Protocol",d:"medic buddy heals stronger + faster",f:()=>{const t=Math.min(Ce(),3.4);J.bHealAmt=Math.min(90,J.bHealAmt+6*t),J.bHealI=Math.max(1.9,J.bHealI-.9)},req:()=>J.bot&&2&S.botMask},{n:"Shock Tempo",d:"shock pulse cooldown down",f:()=>J.bRate=Math.max(.2,J.bRate*(1-.2*Math.min(Ce(),4))),req:()=>J.bot&&J.bAtk},{n:"Shock Pierce",d:"pulse pierces more + wider",f:()=>{J.bPier=Math.min(20,J.bPier+Math.ceil(1.2*Ce())),J.bSize=Math.min(36,J.bSize+1.6*Ce())},req:()=>J.bot&&J.bAtk},{n:"Shock Power",d:"shock pulse damage up",f:()=>J.bDmg=Math.min(8,J.bDmg+.4*Ce()),req:()=>J.bot&&J.bAtk},{n:"Shock Range",d:"shock pulse range up",f:()=>J.bRange=Math.min(900,J.bRange+55*Ce()),req:()=>J.bot&&J.bAtk}];function ze(t){S.lvup&&S.choices[t]&&(S.choices[t].f(),S.lvup=0,S.msg=S.choices[t].n+" applied",S.msgT=1.4,S.xpPulse=.25,S.labCd=Math.max(S.labCd,3),le(.08),ce(J.x,J.y,"#69f0c9",12,90),ae())}function Ae(t){if(J.zt>0)return void(J.flash=Math.max(J.flash,.03));let e=0;for(let t=0;t<i.length;t++){const a=i[t];Math.hypot(J.x-a.x,J.y-a.y)<a.r+25&&(e=Math.max(e,.93))}t*=1-e;const a=ht(J.zoomShield/3,0,1),l=Math.max(0,t*(1-.8*a));l<=0||(J.hp-=l,le(.03),J.hp<=0&&(J.hp=0,S.dead=1,S.start=1,S.kills>S.best&&(S.best=0|S.kills,localStorage.ss_best=S.best),S.msg="swarmed",S.msgT=999,se(.09),le(.42),M(120,.22,"sawtooth",.05),ce(J.x,J.y,"#ff6f89",26,130),K(1),U(1),Y()))}function we(){g||(g=new(window.AudioContext||window.webkitAudioContext)),S.start||(S.start=1,ge(1),M(430,.05,"triangle",.02))}function De(e,s){const n=t.getBoundingClientRect(),o=n.width?a/n.width:1,r=n.height?l/n.height:1;return{x:(e-n.left)*o,y:(s-n.top)*r}}function Ie(e){j===e.pointerId&&(Q=0,re(),t.hasPointerCapture(j)&&t.releasePointerCapture(j),j=-1)}addEventListener("resize",ne),addEventListener("keydown",function(t){const e=t.code;if("Space"!==e&&"ArrowUp"!==e&&"ArrowDown"!==e&&"ArrowLeft"!==e&&"ArrowRight"!==e||t.preventDefault(),"Escape"!==e||!S.start||S.dead){if("Space"!==e&&"Enter"!==e||we(),!S.paused){if(!S.dead||"KeyL"!==e)return!S.dead||"Space"!==e&&"Enter"!==e&&"KeyR"!==e?void(S.lvup?"Digit1"===e?ze(0):"Digit2"===e?ze(1):"Digit3"===e&&ze(2):S.pz?"Digit1"===e?Ct(0):"Digit2"===e?Ct(1):"Digit3"===e&&Ct(2):S.start&&!S.dead&&("KeyA"===e||"ArrowLeft"===e?Z.l=1:"KeyD"===e||"ArrowRight"===e?Z.r=1:"KeyW"===e||"ArrowUp"===e?Z.u=1:"KeyS"===e||"ArrowDown"===e?Z.d=1:"KeyE"!==e&&"ShiftLeft"!==e&&"ShiftRight"!==e||(Z.gr=1))):(ge(1),void M(360,.05,"triangle",.02));q()}}else pe()}),addEventListener("keyup",function(t){const e=t.code;"KeyA"===e||"ArrowLeft"===e?Z.l=0:"KeyD"===e||"ArrowRight"===e?Z.r=0:"KeyW"===e||"ArrowUp"===e?Z.u=0:"KeyS"===e||"ArrowDown"===e?Z.d=0:"KeyE"!==e&&"ShiftLeft"!==e&&"ShiftRight"!==e||(Z.gr=0)}),t.addEventListener("pointerdown",function(e){if(j>=0&&j!==e.pointerId)return;j=e.pointerId,t.setPointerCapture(j),we();const{x:s,y:n}=De(e.clientX,e.clientY);if(S.start&&!S.dead&&s>=S.pauseBtnX&&s<=S.pauseBtnX+S.pauseBtnW&&n>=S.pauseBtnY&&n<=S.pauseBtnY+S.pauseBtnH)pe();else if(S.paused&&S.start&&!S.dead)pe();else{if(S.dead)return s>=S.lbBtnX&&s<=S.lbBtnX+S.lbBtnW&&n>=S.lbBtnY&&n<=S.lbBtnY+S.lbBtnH?void q():(ge(1),void M(360,.05,"triangle",.02));if(S.lvup)!function(t,e){if(!S.lvup)return;const a=mt().rects;for(let l=0;l<a.length;l++){const s=a[l];if(t>=s.x&&t<=s.x+s.w&&e>=s.y&&e<=s.y+s.h){ze(l);break}}}(s,n);else{if(S.pz){const t=kt();for(let e=0;e<3;e++){const a=t.btn[e];if(s>=a.x&&s<=a.x+a.w&&n>=a.y&&n<=a.y+a.h)return void Ct(e)}return}"mouse"!==e.pointerType&&(Q=1,function(t,e){const s=$.r+16;$.x=ht(t,s,a-s),$.y=ht(e,s,l-s),$.tx=0,$.ty=0,$.ax=0,$.ay=0,$.ttx=0,$.tty=0,$.tax=0,$.tay=0,$.act=1}(s,n),oe(s,n))}}},{passive:1}),t.addEventListener("pointermove",function(t){if(j!==t.pointerId||!S.start||S.dead||S.lvup)return;if(!Q)return;const{x:e,y:a}=De(t.clientX,t.clientY);oe(e,a)},{passive:1}),t.addEventListener("pointerup",Ie,{passive:1}),t.addEventListener("pointercancel",Ie,{passive:1}),ne(),ge(1),requestAnimationFrame(function t(p){n||(n=p);let g=.001*(p-n);n=p,g=Math.max(0,Math.min(.034,g)),function(t){const e=t;if(function(t){const e=1-Math.exp(22*-t),a=1-Math.exp(16*-t);$.tx+=($.ttx-$.tx)*e,$.ty+=($.tty-$.ty)*e,$.ax+=($.tax-$.ax)*e,$.ay+=($.tay-$.ay)*e,$.show+=(($.act?1:0)-$.show)*a,!$.act&&$.show<.003&&($.show=0)}(e),S.paused)return;S.msgT>0&&(S.msgT-=e),S.bossDownT>0&&(S.bossDownT=Math.max(0,S.bossDownT-e)),S.apStormHitCd>0&&(S.apStormHitCd=Math.max(0,S.apStormHitCd-e)),S.stormCd>0&&(S.stormCd=Math.max(0,S.stormCd-e)),S.labCd>0&&(S.labCd=Math.max(0,S.labCd-e)),S.stop>0&&(S.stop=Math.max(0,S.stop-e),t*=.06),S.shake>0&&(S.shake=Math.max(0,S.shake-2.2*e)),S.xpPulse>0&&(S.xpPulse=Math.max(0,S.xpPulse-1.7*e)),J.flash>0&&(J.flash=Math.max(0,J.flash-7*e)),J.zb>0&&(J.zb=Math.max(0,J.zb-e)),J.zp>0&&(J.zp=Math.max(0,J.zp-e)),J.rx*=Math.max(0,1-18*e),J.ry*=Math.max(0,1-18*e),J.zcd>0&&(J.zcd=Math.max(0,J.zcd-e)),J.mkS>0&&(J.mkS=Math.max(0,J.mkS-e)),J.mkT>0&&J.zt<=0&&(J.mkT=Math.max(0,J.mkT-e)),J.fbT>0&&(J.fbT=Math.max(0,J.fbT-e)),J.fbFx>0&&(J.fbFx=Math.max(0,J.fbFx-e)),J.bHealFx>0&&(J.bHealFx=Math.max(0,J.bHealFx-e)),J.triFx>0&&(J.triFx=Math.max(0,J.triFx-e*(J.slT>0||J.slRecallT>0||J.slLinkT>0?1:1.7))),J.slWave>0&&(J.slWave=Math.max(0,J.slWave-2.6*e)),J.slComboFx>0&&(J.slComboFx=Math.max(0,J.slComboFx-2.1*e)),J.slLinkT>0&&(J.slLinkT=Math.max(0,J.slLinkT-e)),J.zoomShield>0&&(J.zoomShield=Math.max(0,J.zoomShield-e));for(let e=lt.length-1;e>=0;e--){const a=lt[e];a.t-=t,a.t<=0&&lt.splice(e,1)}for(let e=ot.length-1;e>=0;e--){const a=ot[e];a.t-=t,a.pcd>0&&(a.pcd=Math.max(0,a.pcd-t)),a.t<=0&&ot.splice(e,1)}for(let e=rt.length-1;e>=0;e--){const a=rt[e];a.t-=t,a.t<=0&&rt.splice(e,1)}for(let e=st.length-1;e>=0;e--){const a=st[e];a.t-=t,a.x+=a.vx*t,a.y+=a.vy*t,a.vy+=480*t,a.t<=0&&st.splice(e,1)}if(!S.start)return;if(S.dead)return K(0),U(0),void Y();if(function(t){it.pop>0&&(it.pop=Math.max(0,it.pop-t)),it.on&&(it.t-=t,it.t>0||(it.on=0,it.t=0,it.pop=.3,ce(it.x,it.y,"#9fe9ff",6,40),M(700,.04,"triangle",.014)))}(t),S.won)return void(S.bossDownT=Math.max(S.bossDownT,3));if(_t()?S.lvGrace=1:S.lvGrace>0&&(S.lvGrace=Math.max(0,S.lvGrace-e)),!S.lvup&&!S.pz&&S.lvPend>0&&!Vt()&&(S.lvPend--,ve()),S.lvup)return void(S.cardT=Math.min(.9,S.cardT+e));if(S.pz)return function(t){if(!S.pz||"bak"!==S.pz.id)return;const e=S.pz;if(e.wT-=t,!(e.wT>0)){if(e.miss++,le(.03),M(170,.05,"sawtooth",.016),e.miss>=e.maxMiss)return S.msg="panic spike: reset",S.msgT=.9,void Pt(e);S.msg="panic rising",S.msgT=.6,vt(e)}}(t),void(S.t+=t);if(S.t+=t,S.bd&&!S.bs2&&!S.bd2){const t=S.b2At-S.t;t<=8.5&&!S.apWarn1&&(S.apWarn1=1,S.msg="something big is approaching...",S.msgT=1.5,M(190,.055,"triangle",.016)),t<=3.6&&!S.apWarn2&&(S.apWarn2=1,S.msg="someone...",S.msgT=1.2,M(170,.06,"sawtooth",.02))}const a=gt("nsh"),l=gt("mel"),s=gt("bak");J.mkOn&&0===S.sch.nsh&&Math.hypot(J.x-a.x,J.y-a.y)<a.r&&zt("nsh"),2===S.sch.nsh&&0===S.sch.mel&&Math.hypot(J.x-l.x,J.y-l.y)<l.r&&zt("mel"),2===S.sch.mel&&S.mbd&&0===S.sch.bak&&Math.hypot(J.x-s.x,J.y-s.y)<s.r&&zt("bak"),2===S.sch.nsh&&2===S.sch.bak&&S.labNsh>0&&Math.hypot(J.x-a.x,J.y-a.y)<a.r&&jt("nsh"),2===S.sch.mel&&2===S.sch.bak&&S.labMel>0&&Math.hypot(J.x-l.x,J.y-l.y)<l.r&&jt("mel"),2===S.sch.bak&&S.labBak>0&&Math.hypot(J.x-s.x,J.y-s.y)<s.r&&jt("bak"),ae();const n=(Z.r?1:0)-(Z.l?1:0),i=(Z.d?1:0)-(Z.u?1:0),f=Math.hypot($.ax,$.ay);let h=n,x=i;Q&&f>.12&&(h+=$.ax,x+=$.ay);let p=Math.hypot(h,x);p>1&&(h/=p,x/=p);const g=(Math.hypot(n,i)>.05||Q&&f>.12)&&J.mkS<=0,u=Mt(J.x,J.y,-6);if(J.mkOn&&J.mkT<=0&&J.mkS<=0&&J.zt<=0&&J.zr<=0&&J.zc<=0&&J.mkBurst<=0&&me(),J.mkBurst>0&&(J.mkBurstT=Math.max(0,J.mkBurstT-t),J.mkBurstT<=0&&J.mkBurstQ.length>0&&(de(J.mkBurstQ.shift()),J.mkBurst--,J.mkBurst>0?J.mkBurstT=.5:J.mkT=J.mkI)),function(){const t=[];for(let e=0;e<lt.length;e++){const a=lt[e];a.t>.08&&a.m>=1&&a.m<=3&&t.push(e)}if(t.length<2)return;if(S.stormCd<=0&&t.length>=3)for(let e=0;e<t.length-2;e++){const a=lt[t[e]];for(let l=e+1;l<t.length-1;l++){const s=lt[t[l]];for(let n=l+1;n<t.length;n++){const o=lt[t[n]];if(14!=(1<<a.m|1<<s.m|1<<o.m))continue;const r=Math.hypot(a.x-s.x,a.y-s.y),i=Math.hypot(s.x-o.x,s.y-o.y),f=Math.hypot(o.x-a.x,o.y-a.y);if(r>.8*(a.r+s.r)||i>.8*(s.r+o.r)||f>.8*(o.r+a.r))continue;const h=(a.x+s.x+o.x)/3,c=(a.y+s.y+o.y)/3,b=Math.min(152,(a.r+s.r+o.r)/3+36);ye(4,h,c,b,6),S.stormCd=8,xe(t[e],t[l],t[n]);for(let t=ot.length-1;t>=0;t--){const e=ot[t];5===e.k&&Math.hypot(e.x-h,e.y-c)<b+e.r+80&&(ce(e.x,e.y,"#8effdc",12,72),ot.splice(t,1))}for(let t=tt.length-1;t>=0;t--){const e=tt[t],a=e.x-h,l=e.y-c,s=a*a+l*l;if(4===e.k&&s<1.8*b*(1.8*b)){e.hp-=4.5*J.chBurst+3.5*J.chDo,e.ht=.3,e.s*=.45,e.apStormCd=Math.max(e.apStormCd||0,4);const s=Math.hypot(a,l)||1;if(e.vx+=a/s*520,e.vy+=l/s*520,ce(e.x,e.y,"#8effdc",26,160),S.msg="campus storm: apex vulnerable!",S.msgT=1.8,M(860,.08,"triangle",.03),e.hp<=0){be(t,"#8effdc",18,130,1);continue}}if(s<b*b*1.2){const s=Math.hypot(a,l)||1;e.hp-=2.8*J.chBurst+1.5*J.chDo,e.ht=.2,e.vx+=a/s*360,e.vy+=l/s*360,e.hp<=0&&be(t,"#c8f3ff",12,96,1)}}return}}}const e={};for(let a=0;a<t.length-1;a++){const l=t[a];if(e[l])continue;const s=lt[l];for(let n=a+1;n<t.length;n++){const a=t[n];if(e[a])continue;const o=lt[a];if(s.m===o.m)continue;if(Math.hypot(s.x-o.x,s.y-o.y)>.7*(s.r+o.r))continue;const r=Math.min(s.m,o.m),i=Math.max(s.m,o.m),f=1===r&&3===i?1:2===r&&3===i?2:3;ye(f,.5*(s.x+o.x),.5*(s.y+o.y),Math.min(122,.44*(s.r+o.r)+18),1===f?5.4:2===f?6.1:5.8),xe(l,a),e[l]=1,e[a]=1;break}}}(),J.zt<=0)if(!u&&!g&&J.zcd<=0&&J.mkS<=0){if(J.zc=Math.min(J.zLoad,J.zc+t),J.zc>.25){const e=J.zc/J.zLoad;J.rx+=.9*(2*Math.random()-1)*e*60*t,J.ry+=.9*(2*Math.random()-1)*e*60*t,le(7e-4*e*60*t)}J.zc>=J.zLoad&&!J.zr&&(J.zr=1,S.msg="zoomies ready",S.msgT=1.1,le(.08),M(760,.05,"triangle",.024))}else if(J.zr){J.zt=J.zDur,J.zr=0,J.zc=0;const t=p||1;J.zx=h/t,J.zy=x/t,J.slCharge=0,J.slFocus=0,J.slPow=0,J.slScale=1,J.slLinkT=0,J.slHitMask=0,J.slPerfect=0,J.slRopeRest=0,se(.04),le(.28),J.flash=.09,J.gx=J.zx,J.gy=J.zy,ce(J.x,J.y,"#9dffea",22,140),ce(J.x,J.y,"#ffffff",6,60),M(980,.06,"square",.028)}else J.zc=0;const k=J.zt>0;if(J.zt>0){if(J.zt=Math.max(0,J.zt-t),g){const e=Math.min(1,t*(nt.length>=3?20:nt.length>=2?12:5));J.zx+=(h-J.zx)*e,J.zy+=(x-J.zy)*e;const a=Math.hypot(J.zx,J.zy)||1;J.zx/=a,J.zy/=a}const e=J.zb>0?1.35:1,a=1-J.zt/J.zDur,l=(.4+.6*(a<.15?a/.15:J.zt/J.zDur<.2?J.zt/(.2*J.zDur):1))*J.speed*J.zSpd*e;if(J.vx=J.zx*l+J.slCarryVx,J.vy=J.zy*l+J.slCarryVy,J.face=J.vx>=0?1:-1,J.rx-=8*J.zx*t*60,J.ry-=6*J.zy*t*60,Math.random()<.8&&ie({x:J.x+ft(-8,8),y:J.y+ft(-8,8),vx:.12*-J.vx+ft(-40,40),vy:.12*-J.vy+ft(-40,40),t:ft(.1,.25),c:"#8fffe5"}),Math.random()<.3&&ie({x:J.x+ft(-3,3),y:J.y+ft(-3,3),vx:.06*-J.vx+ft(-12,12),vy:.06*-J.vy+ft(-12,12),t:ft(.3,.6),c:"#d4fffa"}),J.zt<=0){if(J.bot&&nt.length>=2&&J.slCharge>=.25){const t=nt.length>=3?1:.62;J.slScale=t;const e=J.slPerfect&&J.slFocus>=.98?1:0,a=Math.min(1,J.slCharge*(e?1.15:1));J.slT=(.34+(.72-.34)*a)*t,J.slRecallT=0,J.slRecallPulse=0,J.slCarryVx=0,J.slCarryVy=0,J.slPow=(.68+.48*a+.34*e)*t,J.slLinkT=d*(.82+.34*a+.2*e)*t,J.slDx=J.zx,J.slDy=J.zy,J.slWave=1,J.triFx=1,J.slHitMask=0,J.slRopeRest=(176+72*a+36*e)*t,J.slComboFx=Math.max(J.slComboFx,e?.95*t:0);const l=(620*(1.02+.82*a+.46*e)+.6*Math.max(0,J.vx*J.zx+J.vy*J.zy))*t;for(let t=0;t<Math.min(3,nt.length);t++){const e=nt[t],s=.26*(t-1),n=Math.cos(s),o=Math.sin(s),r=J.zx*n-J.zy*o,i=J.zx*o+J.zy*n,f=l*(1-.06*Math.abs(t-1));e.slx=r*f+.28*J.vx,e.sly=i*f+.28*J.vy,e.vx=e.slx,e.vy=e.sly,ce(e.x,e.y,"#b6f6ff",6,50+44*a)}if(se((.05+.025*a)*t),le((.2+.14*a)*t),ce(J.x,J.y,"#8eefff",14,(92+58*a)*t),S.msg=e?"perfect slingshot":t<1?"duo slingshot":"slingshot pack",S.msgT=.82,M(e?1020:940,.05,"square",.026),M(e?1350:1220,.04,"triangle",.018),e){ce(J.x,J.y,"#ff4444",40,320),ce(J.x,J.y,"#ffffff",20,160),le(.45);for(let t=0;t<tt.length;t++){const e=tt[t],a=e.x-J.x,l=e.y-J.y,s=a*a+l*l;if(s<115600){const t=Math.sqrt(s)||1;e.vx+=a/t*1800,e.vy+=l/t*1800,e.hp-=25+.05*S.kills,e.ht=.2,ce(e.x,e.y,"#ff4444",8,60)}}for(let t=0;t<at.length;t++){const e=at[t];e.vx=4*(J.x-e.x),e.vy=4*(J.y-e.y)}}J.slPerfect=0,J.slFocus=0}else{if(J.zDriftVx=.6*J.vx,J.zDriftVy=.6*J.vy,J.slPerfect){ce(J.x,J.y,"#ff4444",40,320),ce(J.x,J.y,"#ffffff",20,160),le(.45);for(let t=0;t<tt.length;t++){const e=tt[t],a=e.x-J.x,l=e.y-J.y,s=a*a+l*l;if(s<115600){const t=Math.sqrt(s)||1;e.vx+=a/t*1800,e.vy+=l/t*1800,e.hp-=25+.05*S.kills,e.ht=.2,ce(e.x,e.y,"#ff4444",8,60)}}for(let t=0;t<at.length;t++){const e=at[t];e.vx=4*(J.x-e.x),e.vy=4*(J.y-e.y)}}J.slCharge=0,J.slFocus=0,J.slPerfect=0,J.slScale=1,J.slRecallT=0,J.slLinkT=0,J.slRecallPulse=0,J.slCarryVx=0,J.slCarryVy=0,J.slHitMask=0,J.slRopeRest=0,S.msg="zoomies cd",S.msgT=.65,M(420,.04,"triangle",.016),M(280,.1,"sawtooth",.01)}J.zcd=J.zCool}}else{const e=Math.max(0,1-t/J.zDr);J.zDriftVx*=e,J.zDriftVy*=e,Math.abs(J.zDriftVx)+Math.abs(J.zDriftVy)<1&&(J.zDriftVx=0,J.zDriftVy=0),J.vx=h*J.speed+J.slCarryVx+J.zDriftVx,J.vy=x*J.speed+J.slCarryVy+J.zDriftVy,J.zDriftVx*J.zDriftVx+J.zDriftVy*J.zDriftVy>400&&Math.random()<.25&&ie({x:J.x+ft(-4,4),y:J.y+ft(-4,4),vx:.06*-J.zDriftVx+ft(-15,15),vy:.06*-J.zDriftVy+ft(-15,15),t:ft(.08,.2),c:"#b8ffe8"}),Math.abs(J.vx)>.5&&(J.face=J.vx>0?1:-1),J.mkS>0&&(J.rx+=.5*Math.sin(45*S.t),Math.random()<.7&&ie({x:J.x+ft(-5,5),y:J.y+10+ft(-3,3),vx:ft(-14,14),vy:ft(6,30),t:ft(.12,.26),c:"#ffd56d"}))}if(k&&J.zt<=0&&(J.zoomShield=3),J.x=ht(J.x+J.vx*t,12,2588),J.y=ht(J.y+J.vy*t,12,1788),J.zt>0&&J.zp<=0)for(let t=0;t<lt.length;t++){const e=lt[t],a=J.x-e.x,l=J.y-e.y;if(a*a+l*l<e.r*e.r){J.zp=.22,J.zb=.48,ce(J.x,J.y,"#8fffe5",8,95),M(740,.03,"triangle",.02);for(let t=tt.length-1;t>=0;t--){const a=tt[t],l=a.x-e.x,s=a.y-e.y;l*l+s*s<e.r*e.r&&(a.hp-=2.2*J.zDmg,a.ht=.13,a.vx+=260*J.zx,a.vy+=260*J.zy,a.hp<=0&&be(t,"#8fffe5",10,80,1))}break}}const v=Mt(J.x,J.y,-6);S.time+=t;const P=v?v.id:"";if(S.inB=P,S.musicStarted||Math.hypot(J.x-o,J.y-r)>460&&(S.musicStarted=1,T.play().catch(()=>{})),function(t,e){if(!t)return S.safeCampT=0,S.safeBreachCd=0,void(S.safeThreat=0);if(S.safeCampT+=e,S.safeThreat=qt(t),S.safeCampT<24||S.safeThreat<6)return;if(S.safeBreachCd-=e,S.safeBreachCd>0)return;const a=S.safeCampT-24,l=Math.max(0,S.safeThreat-6);Ae(2.6+Math.min(7.5,.35*a)+Math.min(5.5,.45*l)),S.safeBreachCd=.9,S.msg="shelter breached - move!",S.msgT=.65,ce(J.x,J.y,"#ef4f6c",8,55),M(150,.04,"sawtooth",.018)}(v,t),Bt(),(!v||S.safeThreat>=6)&&function(t){if(!J.fb||J.fbT>0||!S.start||S.dead||S.lvup||S.pz)return 0;if(J.fbAiT>0)return J.fbAiT=Math.max(0,J.fbAiT-t),0;J.fbAiT=.32;const e=S.psyMask||1,a=Math.max(90,1.06*J.fbR),l=a*a,s=1.5*a,n=s*s;let o=0,r=0,i=0,f=0,h=0,c=0,b=0,d=0;for(let t=0;t<tt.length;t++){const e=tt[t],a=e.x-J.x,s=e.y-J.y,m=a*a+s*s;m<l&&(o++,wt(e.k)&&f++,a>=0&&s>=0?h=1:a<0&&s>=0?c=1:a<0&&s<0?b=1:d=1);const y=e.r+J.r+22;m<y*y&&r++,m<n&&i++}if(!o&&i<4)return 0;let m=0;m=2&e&&(h+c+b+d>=3||r>=4||f>0&&r>=1)?2:1&e&&(r>=2||o>=5)?1:4&e&&(i>=6||o>=8)?3:1&e?1:2&e?2:3,e&1<<m-1||(m=1&e?1:2&e?2:3),function(t){if(!J.fb||J.fbT>0||!S.start||S.dead||S.lvup||S.pz)return 0;const e=S.psyMask||1;let a=t||1;e&1<<a-1||(a=1&e?1:2&e?2:3),J.fbMode=a,J.fbT=J.fbI,J.fbFx=.62;const l=ht(J.fbFear/2.3,.7,2.2);if(2===a)return it.on=1,it.x=ht(J.x+62*J.gx,24,2576),it.y=ht(J.y+62*J.gy,24,1776),it.t=2.2,it.d=2.2,it.pop=0,le(.06),ce(it.x,it.y,"#9fe9ff",10,58),M(560,.05,"square",.022),M(760,.04,"triangle",.017),S.msg=Dt(a),S.msgT=1,0;const s=Math.max(82,J.fbR*(1===a?1.02:.95)),n=s*s;let o=0;const r=3===a?"#cabdff":"#86ddff";for(let t=tt.length-1;t>=0;t--){const e=tt[t],i=e.x-J.x,f=e.y-J.y,h=i*i+f*f;if(h>n)continue;const c=Math.sqrt(h)||1,b=1-c/s,d=wt(e.k);let m=0,y=0;if(1===a){const t=c<.38*s;m=(d?135:220)+b*(d?90:240)+.18*J.fbKn,e.fbSt=Math.max(e.fbSt||0,t?d?.22:.45+.26*b:d?.14:.24+.14*b),y=d?2+3*b:8+12*b,Ft(e,1,1.55*(.68+.32*b)*l)}else m=(d?75:120)+b*(d?45:90)+.08*J.fbKn,e.fbSt=Math.max(e.fbSt||0,d?.28:.62+.28*b),y=d?3+4*b:6+9*b,Ft(e,4,1.55*(.74+.26*b)*l);e.vx+=i/c*m,e.vy+=f/c*m,e.hp-=y,e.ht=Math.max(e.ht,.12),o++,e.hp<=0&&be(t,r,8,3===a?74:66,1)}le(.13),se(.03),3===a?(ce(J.x,J.y,"#c7bcff",22,.66*s),ce(J.x,J.y,"#eee6ff",10,.36*s),M(430,.06,"triangle",.024),M(640,.05,"sine",.018)):(ce(J.x,J.y,"#8adfff",20,.54*s),ce(J.x,J.y,"#d9f5ff",8,.26*s),M(560,.05,"square",.022),M(930,.04,"triangle",.018)),S.msg=Dt(a)+(o>0?" "+o:""),S.msgT=1}(m)}(t),J.cat){J.chHealCd>0&&(J.chHealCd=Math.max(0,J.chHealCd-t));let e=0;for(let t=0;t<lt.length;t++){const a=lt[t],l=J.x-a.x,s=J.y-a.y;if(2===a.m&&l*l+s*s<a.r*a.r){e=1;break}}if(e&&J.chHealCd<=0&&J.hp<J.maxHp){const t=Math.min(J.chHeal,J.maxHp-J.hp);J.hp+=t,J.chHealCd=J.chHealI,ce(J.x,J.y,"#7fe8dd",8,52),S.msg="heal +"+(0|t),S.msgT=.65}}let C=0,R=0,z=0,A=0;for(let t=0;t<ot.length;t++){const e=ot[t],a=J.x-e.x,l=J.y-e.y;a*a+l*l<e.r*e.r&&(2===e.k?(!z||e.t>z.t)&&(z=e):3===e.k?C=1:4===e.k?R=1:5===e.k&&(A=e))}if(z&&z.pcd<=0&&J.hp<J.maxHp){const t=Math.min(10,J.maxHp-J.hp);J.hp+=t,z.pcd=1.6,ce(J.x,J.y,"#95ffe8",10,70),S.msg="well +"+(0|t),S.msgT=.6}if(C&&J.hp<J.maxHp){const e=Math.min(J.maxHp-J.hp,1.6*t);e>0&&(J.hp+=e)}if(R&&J.hp<J.maxHp){const e=Math.min(J.maxHp-J.hp,8*t);e>0&&(J.hp+=e)}if(A&&!v){const e=A.x-J.x,a=A.y-J.y,l=Math.hypot(e,a)||1;let s=(32+(A.d-A.t)/Math.max(.001,A.d)*20)*(.35+.65*ht(l/Math.max(1,A.r),0,1));J.zt>0&&(s*=.28),J.x=ht(J.x+e/l*s*t,12,2588),J.y=ht(J.y+a/l*s*t,12,1788),S.apStormHitCd<=0&&l<.82*A.r&&(Ae(J.zt>0?1.62:3.6),S.apStormHitCd=.34),Math.random()<.28&&ie({x:J.x+ft(-8,8),y:J.y+ft(-8,8),vx:ft(-18,18),vy:ft(-30,10),t:ft(.08,.18),c:"#d4b8ff"})}let w=0;if(J.bot&&J.botCount>0){if(Qt(),w=J.zt>0&&nt.length>=2,w){const e=g?Math.max(0,h*J.zx+x*J.zy):0,a=.6+.95*e;J.slCharge=Math.min(1,J.slCharge+t*a),J.zt<=.24?g&&e>.82?(J.slFocus=Math.min(1,J.slFocus+4.5*t),J.slFocus>=1&&!J.slPerfect&&(J.slPerfect=1,J.slComboFx=Math.max(J.slComboFx,.55),S.msg="perfect line",S.msgT=.45,M(1180,.03,"triangle",.014))):J.slPerfect||(J.slFocus=Math.max(0,J.slFocus-3.8*t)):J.slPerfect||(J.slFocus=Math.max(0,J.slFocus-1.6*t)),J.triFx=Math.min(1,J.triFx+t*(J.slPerfect?4.1:3.2))}else J.slT<=0&&J.slRecallT<=0&&J.slLinkT<=0&&(J.slCharge>0||J.slFocus>0||J.slPerfect)&&(J.slCharge=Math.max(0,J.slCharge-2.6*t),J.slFocus=Math.max(0,J.slFocus-2.8*t),J.slFocus<=.02&&(J.slPerfect=0));J.slT>0?(J.slT=Math.max(0,J.slT-t),J.slT<=0&&(nt.length>=2&&J.slPow>.08?(J.slRecallT=b*(.86+.28*Math.min(1,J.slPow)),J.slRecallPulse=0,S.msg="recall strike",S.msgT=.52,M(860,.03,"triangle",.014)):J.slHitMask=0)):J.slRecallT>0&&(J.slRecallT=Math.max(0,J.slRecallT-t),J.slRecallT<=0&&(J.slRecallPulse=1,J.slLinkT=Math.max(J.slLinkT,.652),J.slHitMask=0)),J.ba+=t*(w||J.slT>0||J.slRecallT>0||J.slLinkT>0?4.9:2.3),J.triA+=t*(w||J.slLinkT>0?9.2:4.2);const e=nt.length>=2&&J.slLinkT>0;if((J.slT>0||J.slRecallT>0||e)&&g){const e=Math.hypot(h,x)||1,a=h/e,l=x/e,s=J.slT>0?9.2:J.slRecallT>0?7.4:6.1,n=Math.min(1,t*s);J.slDx+=(a-J.slDx)*n,J.slDy+=(l-J.slDy)*n;const o=Math.hypot(J.slDx,J.slDy)||1;J.slDx/=o,J.slDy/=o}if(nt.length>=2&&(J.slT>0||J.slRecallT>0||e)){(J.slRopeRest||0)<=0&&(J.slRopeRest=176);const e=142*(.7+.45*Math.min(1,J.slPow)+(J.slT>0?.24:0));J.slRopeRest=Math.max(44,J.slRopeRest-t*e)}else(J.slRopeRest||0)>0&&(J.slRopeRest=Math.max(0,J.slRopeRest-220*t));let a=0,l=0,s=0,n=0,o=.18,r=0,i=0,f=0;nt.length>=2&&(J.slT>0?(a=2,o=.46*J.slScale):J.slRecallT>0?(a=3,o=.33*J.slScale):e?(a=4,o=.29*J.slScale):w&&(a=1,o=.18));for(let o=0;o<nt.length;o++){const h=nt[o],c=h.x,m=h.y,y=Math.max(.001,t);if(J.slT>0&&o<3){const e=860*(.62+.48*Math.min(1,J.slPow));h.slx+=J.slDx*e*t,h.sly+=J.slDy*e*t,h.x=ht(h.x+h.slx*t,16,2584),h.y=ht(h.y+h.sly*t,16,1784);const a=Math.max(0,1-t*(2.35+1.2*Math.max(0,.9-J.slPow)));h.slx*=a,h.sly*=a}else{let e=0,a=0;if(J.slRecallT>0&&o<3){const l=ht(J.slRecallT/b,0,1),s=24+22*l,n=(o-1)*(24+12*l);e=J.x+J.slDx*s-J.slDy*n,a=J.y+J.slDy*s+J.slDx*n;const r=22+20*(1-l);h.vx+=(e-h.x)*r*t,h.vy+=(a-h.y)*r*t;const i=Math.max(0,1-t*(7.2+1.8*(1-l)));h.vx*=i,h.vy*=i,h.x=ht(h.x+h.vx*t,16,2584),h.y=ht(h.y+h.vy*t,16,1784)}else if(w&&o<3){const l=94+34*J.slCharge,s=(o-1)*(34+12*J.slCharge),n=Math.sin(18*S.t+1.6*o)*(4+8*J.slCharge);e=J.x-J.zx*l-J.zy*s,a=J.y-J.zy*l+J.zx*s+n;const r=18+20*J.slCharge;h.vx+=(e-h.x)*r*t,h.vy+=(a-h.y)*r*t;const i=Math.max(0,1-t*(7.4+1.8*J.slCharge));h.vx*=i,h.vy*=i,h.x=ht(h.x+h.vx*t,16,2584),h.y=ht(h.y+h.vy*t,16,1784)}else{const l=J.ba+o*(2*Math.PI/nt.length),s=38+2*Math.sin(2*S.t+.7*o);e=J.x+Math.cos(l)*s,a=J.y+Math.sin(l)*s,h.x+=(e-h.x)*Math.min(1,8*t),h.y+=(a-h.y)*Math.min(1,8*t)}h.slx*=Math.max(0,1-7.8*t),h.sly*=Math.max(0,1-7.8*t)}if(h.vx=(h.x-c)/y,h.vy=(h.y-m)/y,J.slT>0&&o<3||(h.slx=.74*h.slx+.26*h.vx,h.sly=.74*h.sly+.26*h.vy),e&&o<3){const e=h.x-J.x,a=h.y-J.y,l=Math.hypot(e,a)||1,s=e/l,n=a/l,o=ht(J.slLinkT/d,0,1);let c=Math.max(44,J.slRopeRest||92)+11.56*o+20*Math.min(1,J.slPow);J.slT>0?c+=28:J.slRecallT>0&&(c=Math.max(44,.74*c));const b=h.vx-J.vx,m=h.vy-J.vy,y=ht((13.2*(l-c)+13.2*.58*(b*s+m*n))*t,-125,125),x=-n,p=s,g=ht(.32*-(b*x+m*p)*(.65+.55*Math.min(1,J.slPow))*t,-84,84),M=-s*y+x*g,u=-n*y+p*g;h.slx+=M,h.sly+=u,h.vx+=M,h.vy+=u,h.x=ht(h.x+M*t,16,2584),h.y=ht(h.y+u*t,16,1784);const k=.62*(.76+.34*Math.min(1,J.slPow));r-=M*k,i-=u*k,f++,Math.random()<.18&&Math.abs(l-c)>10&&ie({x:.5*(J.x+h.x)+ft(-4,4),y:.5*(J.y+h.y)+ft(-4,4),vx:ft(-16,16),vy:ft(-16,16),t:ft(.06,.14),c:"#d6f7ff"})}if(a&&o<3){let t=0,e=0;if(2===a)t=.6*h.vx+.4*h.slx,e=.6*h.vy+.4*h.sly;else if(3===a){const a=J.x-h.x,l=J.y-h.y,s=Math.hypot(a,l)||1,n=190+110*J.slPow;t=a/s*n+.45*h.vx+.2*h.slx,e=l/s*n+.45*h.vy+.2*h.sly}else 4===a?(t=.78*h.vx+.38*h.slx,e=.78*h.vy+.38*h.sly):(t=.72*h.vx+.25*h.slx,e=.72*h.vy+.25*h.sly);l+=t,s+=e,n++}h.grabCd>0&&(h.grabCd=Math.max(0,h.grabCd-t)),h.mcd>0&&(h.mcd=Math.max(0,h.mcd-t))}if(f>0&&(l+=r,s+=i,n+=f),n>0){const e=l/n*o,r=s/n*o,i=Math.min(1,t*(2===a?9.2:3===a?8.4:4===a?7.8:6.8));J.slCarryVx+=(e-J.slCarryVx)*i,J.slCarryVy+=(r-J.slCarryVy)*i}else{const e=Math.max(0,1-8.5*t);J.slCarryVx*=e,J.slCarryVy*=e,Math.abs(J.slCarryVx)+Math.abs(J.slCarryVy)<.5&&(J.slCarryVx=0,J.slCarryVy=0)}J.slT>0||J.slRecallT>0||J.slLinkT>0?J.triFx=Math.min(1,J.triFx+4.1*t):!w&&J.slLinkT<=0&&J.slPow>0&&(J.slPow=Math.max(0,J.slPow-2.2*t)),J.slT<=0&&J.slRecallT<=0&&J.slLinkT<=0&&J.slWave<=0&&J.slPow<.01&&(J.slPow=0,J.slRopeRest=0,J.triFx=Math.max(0,J.triFx-2.2*t)),J.bx=nt[0].x,J.by=nt[0].y;let c=0,m=8,y=18;for(let t=0;t<nt.length;t++)if(2==(0|nt[t].t)){const t=Xt(2);c=1,m=Math.min(m,t.healI||8),y=Math.max(y,t.healAmt||18)}if(c&&(J.bHealCd>0&&(J.bHealCd=Math.max(0,J.bHealCd-t)),J.bHealCd<=0&&J.hp<J.maxHp)){const t=Math.min(y,J.maxHp-J.hp);J.hp+=t,J.bHealCd=m,J.bHealFx=.7,S.msg="medic +"+(0|t),S.msgT=.9,ce(J.x,J.y,"#84f0a6",10,62),M(760,.05,"triangle",.018)}if(!v&&J.bAtk)for(let e=0;e<nt.length;e++){const a=nt[e],l=Xt(0|a.t||1);if(a.cd-=t,a.cd>0)continue;let s=0,n=l.range*l.range;for(let t=0;t<tt.length;t++){const e=tt[t],l=e.x-a.x,o=e.y-a.y,r=l*l+o*o;r<n&&(n=r,s=e)}if(s){const t=Math.hypot(s.x-a.x,s.y-a.y)||1,e=!!l.pulse,n=l.col,o=l.pier;he({x:a.x,y:a.y,vx:(s.x-a.x)/t*420,vy:(s.y-a.y)/t*420,d:J.dmg*l.dmg,life:1.35,pier:o,c:n,r:l.size,pulse:e,kb:l.kb,bounces:1==(0|a.t)?3:0}),a.cd=l.rate,ce(a.x,a.y,n,4,36)}else a.cd=.35}}else nt.length=0,J.bCarry=0,J.botSlots=0,w=0,J.slCharge=0,J.slFocus=0,J.slT=0,J.slRecallT=0,J.slLinkT=0,J.slRecallPulse=0,J.slCarryVx=0,J.slCarryVy=0,J.slPow=0,J.slHitMask=0,J.slPerfect=0,J.slScale=1,J.slComboFx=0,J.slRopeRest=0;J.fireCd-=t,!v&&J.fireCd<=0&&(J.fireCd=J.fireRate,function(){const t=function(){let t=0,e=1e9;for(let a=0;a<tt.length;a++){const l=tt[a],s=l.x-J.x,n=l.y-J.y,o=s*s+n*n;o<e&&(e=o,t=l)}return t}();if(!t)return;let e=t.x-J.x,a=t.y-J.y,l=Math.hypot(e,a)||1;if(l>J.range)return;e/=l,a/=l;const s=J.shots;for(let t=0;t<s;t++){const l=1===s?0:.18*(t-(s-1)/2),n=Math.cos(l),o=Math.sin(l),r=e*n-a*o,i=e*o+a*n;he({x:J.x,y:J.y,vx:520*r,vy:520*i,d:J.dmg,life:1.05,pier:1})}J.gx=e,J.gy=a,J.rx-=6*e,J.ry-=4*a,J.flash=.07,J.face=e>=0?1:-1,ce(J.x+16*e,J.y+10*a,"#ffd56d",3,35),le(.025),M(640,.04,"square",.018)}()),S.bd2&&(S.endT+=t),!S.won&&S.kills>=m&&!S.mothDead&&0===tt.length&&(S.won=1,S.msg="CAMPUS SECURED",S.msgT=999,S.bossDownT=4,le(.5),se(.12),ce(J.x,J.y,"#ffd56d",50,300),ce(J.x,J.y,"#69f0c9",40,250),ce(J.x,J.y,"#8ec0ff",30,200),M(523,.2,"triangle",.03),M(659,.18,"triangle",.025),M(784,.25,"triangle",.03),K(1),U(1),Y());const D=S.kills<m&&!S.won&&!S.mothDead;S.spawnT-=t,D&&S.bd&&!S.pred&&!S.predDead&&!S.bs2&&!S.bd2&&S.kills>=1690&&function(){if(S.pred||S.predDead||tt.length>=c)return;const t=Math.random()*Math.PI*2,e=1600+8*S.time,a={x:ht(J.x+500*Math.cos(t),50,2550),y:ht(J.y+500*Math.sin(t),50,1750),r:32,hp:e,s:76,dmg:24,vx:0,vy:0,ht:0,sl:0,ce:0,bm:0,bt:0,bi:"",k:9,prMax:e,prCloak:0,prCloakCd:ft(5,7),prLunge:0,prLungeDx:0,prLungeDy:0,prCloneCd:ft(10,15),prPhase:1,prTrailT:0};ut(a,26),tt.push(a),S.pred=1,S.msg="the predator stalks...",S.msgT=2,M(80,.2,"sawtooth",.03),M(55,.25,"sawtooth",.018),le(.22)}(),D&&S.bd2&&!S.moth&&!S.mothDead&&S.kills>=y&&function(){if(S.moth||S.mothDead||tt.length>=c)return;const t=Math.random()*Math.PI*2,e=8400+22*S.time,a={x:ht(J.x+600*Math.cos(t),60,2540),y:ht(J.y+600*Math.sin(t),60,1740),r:52,hp:e,s:54,dmg:48,vx:0,vy:0,ht:0,sl:0,ce:0,bm:0,bt:0,bi:"",k:11,moMax:e,moPhase:1,moScreamCd:ft(6,9),moScreamT:0,moBroodCd:ft(5,8),moWaveCd:ft(4,6),moWaveT:0,moRage:0};ut(a,40),tt.push(a),S.moth=1,S.msg="THE MOTHER AWAKENS",S.msgT=3,M(60,.4,"sawtooth",.05),M(40,.5,"sawtooth",.035),M(90,.3,"triangle",.025),le(.42)}(),D&&2===S.sch.nsh&&!S.mb&&!S.mbd&&!S.bs&&!S.bd&&S.kills>=200&&function(){if(S.mb||S.mbd||S.bs||S.bd||S.bs2||S.bd2||tt.length>=c)return;const t=Math.random()*Math.PI*2,e=320+8*S.time,a={x:ht(J.x+440*Math.cos(t),40,2560),y:ht(J.y+440*Math.sin(t),40,1760),r:28,hp:e,s:78,dmg:18,vx:0,vy:0,ht:0,sl:0,ce:0,bm:0,bt:0,bi:"",k:5,mbMax:e,mbChargeCd:ft(2.2,3.4),mbChargeT:0,mbDx:0,mbDy:0};ut(a,22),tt.push(a),S.mb=1,S.msg="the provost charges in!",S.msgT=1.6,M(200,.12,"sawtooth",.028),le(.18)}();const I=S.kills>800||S.time>999;if(D&&2===S.sch.bak&&!S.bs&&!S.bd&&!S.bs2&&!S.bd2&&S.kills>=600&&I&&function(){if(S.bs||S.bd||S.bs2||S.bd2||tt.length>=c)return;const t=Math.random()*Math.PI*2,e=880+14*S.time,a={x:ht(J.x+520*Math.cos(t),40,2560),y:ht(J.y+520*Math.sin(t),40,1760),r:38,hp:e,s:52,dmg:28,vx:0,vy:0,ht:0,sl:0,ce:0,bm:0,bt:0,bi:"",k:3,b1Max:e,b1Eat:0,b1Cd:0,b1BaseR:38,b1BaseS:52,b1BaseDmg:28,b1Pulse:0,b1Roar:0};ut(a,28),tt.push(a),S.bs=1,S.msg="the dean hungers...",S.msgT=1.8,M(170,.15,"sawtooth",.03),M(85,.25,"sawtooth",.02),le(.24)}(),D&&S.bd&&!S.pred&&!S.bs2&&!S.bd2&&S.predDead&&S.t>=S.b2At&&function(){if(S.bs2||S.bd2||tt.length>=c)return;const t=Math.random()*Math.PI*2,e=3200+42*S.time,a={x:ht(J.x+560*Math.cos(t),44,2556),y:ht(J.y+560*Math.sin(t),44,1756),r:46,hp:e,s:68,dmg:52,vx:0,vy:0,ht:0,sl:0,ce:0,bm:0,bt:0,bi:"",k:4,apMax:e,apBaseS:68,apCd:ft(1.1,1.8),apTele:0,apTeleD:0,apAimX:0,apAimY:0,apBurstLeft:0,apBurstSpd:920,apPhase:1,apStormCd:ft(2.8,4.2),apSummonCd:ft(2.6,3.8),apEvadeCd:0,apImpactCd:0,apSlamCd:0,apRegenCd:0,apShieldT:0};ut(a,36),tt.push(a),S.bs2=1,S.msg="APEX DEAN APPROACHES",S.msgT=2,M(120,.2,"sawtooth",.04),M(60,.3,"sawtooth",.03),le(.38)}(),D&&S.spawnT<=0){S.spawnT=S.nextSpawn;const t=.8-.0056*S.time,e=S.endT>0?.014*S.endT:0;S.nextSpawn=Math.max(.12,t-e),Me(),!S.bs&&!S.bs2&&S.time>26&&Math.random()<.28&&Me(),S.endT>0&&(Math.random()<.35+.04*S.endWave&&Me(),S.endWave>=2&&Math.random()<.2&&Me())}if(D&&S.endT>0&&(S.endSpawnT-=t,S.endSpawnT<=0)){S.endWave++,S.endSpawnT=Math.max(18,35-2.5*S.endWave),S.msg="ENDLESS WAVE "+S.endWave,S.msgT=2,le(.12),M(320,.08,"square",.02),M(440,.06,"triangle",.015);const t=4+2*S.endWave;for(let e=0;e<Math.min(t,12);e++)Me()}for(let e=et.length-1;e>=0;e--){const a=et[e];if(a.life-=t,a.x+=a.vx*t,a.y+=a.vy*t,a.life<=0||a.x<-20||a.y<-20||a.x>2620||a.y>1820)et.splice(e,1);else for(let t=tt.length-1;t>=0;t--){const l=tt[t],s=l.x-a.x,n=l.y-a.y,o=a.r||3;if(s*s+n*n<(l.r+o)*(l.r+o)){let s=1;if(4===l.k&&l.apShieldT>0&&(s=.72),7===l.k){const t=Math.atan2(J.y-l.y,J.x-l.x),e=Math.atan2(l.vy||.001,l.vx||.001),a=Math.abs(t-e);(a<1.2||a>2*Math.PI-1.2)&&(s*=.35)}l.hp-=a.d*s,l.ht=a.pulse?.12:.09;const n=a.kb||(a.pulse?.11:.07);if(l.vx+=a.vx*n,l.vy+=a.vy*n,a.pulse&&ce(l.x,l.y,"#9de6ff",3,28),a.pier--,l.hp<=0&&be(t,a.pulse?"#9de6ff":"#ff9675",a.pulse?7:9,a.pulse?58:70,a.pulse?1:0),a.pier<0){if(a.pulse&&(a.bounces||0)>0){let e=0,l=48400;for(let s=0;s<tt.length;s++){if(s===t)continue;const n=tt[s],o=n.x-a.x,r=n.y-a.y,i=o*o+r*r;i<l&&(l=i,e=n)}if(e){const t=e.x-a.x,l=e.y-a.y,s=Math.hypot(t,l)||1;a.vx=t/s*420,a.vy=l/s*420,a.pier=0,a.bounces--,a.d*=.8,a.life=Math.max(a.life,.6),ce(a.x,a.y,"#6ecfff",4,32),M(680+80*(3-a.bounces),.02,"triangle",.01);break}}et.splice(e,1);break}}}}let B=0,W=0,F=0,E=0,H=0;const L=v;for(let e=tt.length-1;e>=0;e--){const a=tt[e];a.fb>0&&(a.fb=Math.max(0,a.fb-t)),a.fbSt>0&&(a.fbSt=Math.max(0,a.fbSt-t)),a.psJ>0&&(a.psJ=Math.max(0,a.psJ-t)),a.psF>0&&(a.psF=Math.max(0,a.psF-t)),a.psD>0&&(a.psD=Math.max(0,a.psD-t)),a.psComboCd>0&&(a.psComboCd=Math.max(0,a.psComboCd-t));let l=J.x,s=J.y;if(L)if(a.bi!==L.id&&(a.bi=L.id,a.bm=0,a.bt=ft(.9,1.7)),a.bt-=t,a.bt<=0&&(0===a.bm?(a.bm=1,a.bt=ft(1.1,2.1)):(a.bm=0,a.bt=ft(.9,1.7))),0===a.bm){const t=J.x-L.x,e=J.y-L.y,a=Math.hypot(t,e)||1;l=L.x+t/a*(L.r+8),s=L.y+e/a*(L.r+8)}else{const t=a.x-L.x,n=a.y-L.y,o=Math.hypot(t,n)||1;l=a.x+t/o*220+-n/o*Math.sin(2*S.t+e)*30,s=a.y+n/o*220+t/o*Math.sin(2*S.t+e)*30}else a.bi="",a.bt=0,a.bm=0;if(it.on&&!wt(a.k)){const t=it.x-a.x,e=it.y-a.y;t*t+e*e<25600&&(l=it.x,s=it.y,a.psF=Math.max(a.psF||0,.8))}if(a.fb>0&&3!==a.k&&4!==a.k&&5!==a.k&&9!==a.k&&11!==a.k){const t=a.x-J.x,e=a.y-J.y,n=Math.hypot(t,e)||1;l=a.x+t/n*280,s=a.y+e/n*280}if(11===a.k){a.moMax||(a.moMax=a.hp);const e=ht(a.hp/(a.moMax||1),0,1);if(a.moPhase=e>.6?1:e>.25?2:3,a.moRage=a.moPhase-1,a.moScreamCd-=t,a.moScreamT>0){if(a.moScreamT=Math.max(0,a.moScreamT-t),!v){const e=J.x-a.x,l=J.y-a.y,s=Math.hypot(e,l)||1;s<320+60*a.moRage&&(J.vx*=Math.max(.3,1-3.5*t),J.vy*=Math.max(.3,1-3.5*t),J.vx-=e/s*80*t,J.vy-=l/s*80*t)}Math.random()<.4&&ie({x:a.x+ft(2*-a.r,2*a.r),y:a.y+ft(2*-a.r,2*a.r),vx:ft(-30,30),vy:ft(-30,30),t:ft(.1,.22),c:"#cc44cc"})}else a.moScreamCd<=0&&(a.moScreamT=1.2+.4*a.moRage,a.moScreamCd=ft(Math.max(3,6-1.5*a.moRage),Math.max(5,9-2*a.moRage)),ce(a.x,a.y,"#dd66dd",16+4*a.moRage,200+40*a.moRage),M(70,.12,"sawtooth",.03),S.msg=3===a.moPhase?"MOTHER SCREAMS!":"mother scream!",S.msgT=.8);if(a.moBroodCd-=t,a.moBroodCd<=0){const t=2+a.moPhase;for(let e=0;e<t;e++)ke(a);a.moBroodCd=ft(Math.max(3,6-a.moRage),Math.max(4,8-a.moRage)),ce(a.x,a.y,"#993399",8,80),M(100,.05,"sawtooth",.015)}if(a.moWaveCd-=t,a.moWaveT>0)a.moWaveT=Math.max(0,a.moWaveT-t);else if(a.moWaveCd<=0){a.moWaveT=.6,a.moWaveCd=ft(Math.max(2.5,4.5-.8*a.moRage),Math.max(3.5,6-a.moRage));const t=180+50*a.moRage,e=10+5*a.moRage,l=Math.hypot(J.x-a.x,J.y-a.y);l<t&&!v&&Ae(e*(1-l/t)),ce(a.x,a.y,"#ee55ee",14+4*a.moRage,.6*t),M(90,.08,"sawtooth",.022)}a.s=54+12*a.moRage}if(9===a.k){a.prMax||(a.prMax=a.hp),a.prCloakCd||(a.prCloakCd=ft(4,6)),a.prCloneCd||(a.prCloneCd=ft(8,12));const e=ht(a.hp/(a.prMax||1),0,1);a.prPhase=e>.5?1:2;const n=2===a.prPhase?1:0;if(a.prCloakCd-=t,a.prCloak>0){a.prCloak=Math.max(0,a.prCloak-t);const e=Math.atan2(J.y-a.y,J.x-a.x)+(.7+.3*n),o=180+40*n;if(l=J.x+Math.cos(e)*o,s=J.y+Math.sin(e)*o,a.s=1.5*(88+30*n),Math.random()<.3&&ie({x:a.x+ft(-a.r,a.r),y:a.y+ft(-a.r,a.r),vx:ft(-10,10),vy:ft(-10,10),t:ft(.06,.14),c:"rgba(180,20,20,.5)"}),a.prCloak<=0){const t=J.x-a.x,e=J.y-a.y,l=Math.hypot(t,e)||1;a.prLunge=.35,a.prLungeDx=t/l,a.prLungeDy=e/l,a.prCloakCd=ft(Math.max(2.5,4.5-1.5*n),Math.max(3.5,6-1.5*n)),ce(a.x,a.y,"#ff3333",14,100),M(160,.06,"sawtooth",.025),S.msg=2===a.prPhase?"PREDATOR STRIKES!":"predator lunges!",S.msgT=.7}}else a.prCloakCd<=0&&(a.prCloak=ft(2.2+.8*n,3.5+1*n),a.prCloakCd=99,ce(a.x,a.y,"rgba(120,10,10,.6)",10,70),M(100,.08,"sawtooth",.018),S.msg="predator cloaks...",S.msgT=1);if(a.prLunge>0&&(a.prLunge=Math.max(0,a.prLunge-t),a.vx+=1100*(a.prLungeDx||0)*t,a.vy+=1100*(a.prLungeDy||0)*t,Math.random()<.5&&ie({x:a.x+ft(-8,8),y:a.y+ft(-8,8),vx:-(a.prLungeDx||0)*ft(40,100),vy:-(a.prLungeDy||0)*ft(40,100),t:ft(.08,.2),c:"#ff3333"})),a.s=a.prCloak>0?1.5*(88+30*n):88+30*n,a.prCloneCd-=t,a.prCloneCd<=0){const t=2===a.prPhase?3:2;for(let e=0;e<t;e++)ue(a);a.prCloneCd=ft(Math.max(5,9-3*n),Math.max(7,12-3*n)),ce(a.x,a.y,"#881111",10,80),M(110,.06,"sawtooth",.016),S.msg="predator summons shadows",S.msgT=.9}a.prTrailT-=t,a.prTrailT<=0&&a.prCloak<=0&&(a.prTrailT=.08,ie({x:a.x+ft(-4,4),y:a.y+ft(-4,4),vx:ft(-12,12),vy:ft(5,20),t:ft(.12,.24),c:"#aa2222"}))}if(10===a.k&&void 0!==a.cloneLife&&(a.cloneLife-=t,a.cloneLife<=0)){ce(a.x,a.y,"#661111",6,30),tt.splice(e,1);continue}if(5===a.k)if(a.mbMax||(a.mbMax=a.hp),a.mbChargeCd||(a.mbChargeCd=ft(2.2,3.4)),a.mbChargeT||(a.mbChargeT=0),a.mbChargeCd-=t,a.mbChargeT>0)a.mbChargeT=Math.max(0,a.mbChargeT-t),a.vx+=680*(a.mbDx||0)*t,a.vy+=680*(a.mbDy||0)*t,Math.random()<.4&&ie({x:a.x+ft(-6,6),y:a.y+ft(-6,6),vx:-(a.mbDx||0)*ft(30,80),vy:-(a.mbDy||0)*ft(30,80),t:ft(.08,.18),c:"#ffa64d"});else if(a.mbChargeCd<=0&&!v){const t=J.x-a.x,e=J.y-a.y,l=Math.hypot(t,e)||1;a.mbDx=t/l,a.mbDy=e/l,a.mbChargeT=.42,a.mbChargeCd=ft(2,3.2),ce(a.x,a.y,"#ffa64d",8,60),M(220,.05,"sawtooth",.02),S.msg="provost charges!",S.msgT=.7}if(8===a.k&&(a.healCd||(a.healCd=ft(1.8,2.8)),a.healCd-=t,a.healCd<=0)){a.healCd=ft(1.6,2.6);const t=120,l=15+.4*S.time;let s=0;for(let n=0;n<tt.length;n++){if(n===e||tt[n].k>=3)continue;const o=tt[n].x-a.x,r=tt[n].y-a.y;o*o+r*r<t*t&&(tt[n].hp+=l,tt[n].ht=Math.max(tt[n].ht,.06),s++)}s>0&&(ce(a.x,a.y,"#7fff7f",6+2*s,.6*t),Math.random()<.5&&ie({x:a.x,y:a.y-10,vx:0,vy:-30,t:.3,c:"#7fff7f"}))}if(3===a.k&&(a.b1Max||(a.b1Max=a.hp),a.b1BaseR||(a.b1BaseR=a.r),a.b1BaseS||(a.b1BaseS=a.s),a.b1BaseDmg||(a.b1BaseDmg=a.dmg),a.b1Cd>0&&(a.b1Cd=Math.max(0,a.b1Cd-t)),a.b1Pulse>0&&(a.b1Pulse=Math.max(0,a.b1Pulse-t)),a.b1Roar>0&&(a.b1Roar=Math.max(0,a.b1Roar-t))),4===a.k){a.apMax||(a.apMax=a.hp),a.apBaseS||(a.apBaseS=a.s),a.apCd||(a.apCd=ft(1.1,1.8)),a.apStormCd||(a.apStormCd=ft(2.8,4.2)),a.apSummonCd||(a.apSummonCd=ft(2.6,3.8)),a.apBurstSpd||(a.apBurstSpd=920),a.apTele||(a.apTele=0),a.apBurstLeft||(a.apBurstLeft=0),a.apEvadeCd||(a.apEvadeCd=0),a.apImpactCd||(a.apImpactCd=0),a.apSlamCd||(a.apSlamCd=0),a.apRegenCd||(a.apRegenCd=0),a.apShieldT||(a.apShieldT=0);const e=ht(a.hp/(a.apMax||1),0,1),l=e>.66?1:e>.33?2:3,s=l-1;a.apPhase=l,a.s=(a.apBaseS||68)*(1+.18*s+(J.zt>0?.22:0)),a.apCd-=t,a.apStormCd-=t,a.apSummonCd-=t,a.apEvadeCd>0&&(a.apEvadeCd=Math.max(0,a.apEvadeCd-t)),a.apImpactCd>0&&(a.apImpactCd=Math.max(0,a.apImpactCd-t)),a.apSlamCd>0&&(a.apSlamCd=Math.max(0,a.apSlamCd-t)),a.apRegenCd>0&&(a.apRegenCd=Math.max(0,a.apRegenCd-t)),a.apShieldT>0&&(a.apShieldT=Math.max(0,a.apShieldT-t));const n=J.x-a.x,o=J.y-a.y,r=Math.hypot(n,o)||1,i=1===l?.38:2===l?.58:.78,f=ht(J.x+J.vx*i+34*(J.zx||0),20,2580),h=ht(J.y+J.vy*i+34*(J.zy||0),20,1780);if(!v&&r<140+20*l&&a.apSlamCd<=0&&a.apTele<=0){a.apSlamCd=Math.max(2.2,4.2-1.1*s),r<120+28*l&&Ae(14+6*l+4*s);const t=320+80*l;J.vx+=(J.x-a.x)/r*t,J.vy+=(J.y-a.y)/r*t,le(.22+.08*s),se(.04),ce(a.x,a.y,"#e0c8ff",22+6*l,160+30*l),ce(a.x,a.y,"#ff8bd9",10+3*l,100+20*l),Se(ht(a.x+ft(-18,18),24,2576),ht(a.y+ft(-18,18),24,1776),52+14*l,1.6+.4*l),M(90,.1,"sawtooth",.035),M(55,.14,"sawtooth",.025),S.msg=3===l?"APEX SLAM! OMEGA FURY!":"apex ground slam!",S.msgT=.9,a.vx*=.1,a.vy*=.1}if(l>=3&&a.apRegenCd<=0&&a.apShieldT<=0&&a.ht<=.01&&r>220){const t=Math.max(0,a.apMax-a.hp),e=Math.min(7e-4*a.apMax,t);e>0&&(a.hp+=e,Math.random()<.35&&ie({x:a.x+ft(-14,14),y:a.y+ft(-14,14),vx:ft(-10,10),vy:ft(-30,-10),t:ft(.15,.3),c:"#d8b4ff"})),a.apRegenCd=e>0?.7:.32}if(a.apShieldT>0&&Math.random()<.5&&ie({x:a.x+ft(-a.r,a.r),y:a.y+ft(-a.r,a.r),vx:ft(-16,16),vy:ft(-16,16),t:ft(.08,.16),c:"#c8b6ff"}),l>1&&!a.apLastPhase&&(a.apLastPhase=1),a.apLastPhase&&l!==a.apLastPhase&&(a.apShieldT=1.8,a.apLastPhase=l,ce(a.x,a.y,"#c8b6ff",18,140),M(180,.08,"triangle",.022),S.msg=2===l?"APEX RAGE MODE":"APEX OMEGA FRENZY",S.msgT=1.2,Te(a,l+1,l)),!v&&J.zt>0&&a.apEvadeCd<=0){const t=Math.random()<.5?-1:1,e=300+90*s;a.vx+=-J.zy*t*e,a.vy+=J.zx*t*e,l>=2&&Math.random()<.35&&(a.vx+=n/r*180,a.vy+=o/r*180),a.apEvadeCd=Math.max(.35,.55-.1*s),l>=2&&Math.random()<.55+.15*s&&Se(ht(a.x+-J.zy*t*60,24,2576),ht(a.y+J.zx*t*60,24,1776),62+14*s,2+.45*s),ce(a.x,a.y,"#d7c1ff",12+2*l,80+10*l),M(176-.05*s,.05,"sawtooth",.02)}if(a.apTele>0){if(a.apTele=Math.max(0,a.apTele-t),a.vx*=Math.max(0,1-13*t),a.vy*=Math.max(0,1-13*t),Math.random()<.65&&ie({x:a.x+ft(-8,8),y:a.y+ft(-8,8),vx:ft(-26,26),vy:ft(-26,26),t:ft(.1,.2),c:"#dab9ff"}),Math.random()<.6&&ie({x:a.apAimX+ft(-10,10),y:a.apAimY+ft(-10,10),vx:ft(-20,20),vy:ft(-20,20),t:ft(.08,.18),c:"#f4dcff"}),a.apTele<=0){const t=a.apAimX-a.x,e=a.apAimY-a.y,n=Math.hypot(t,e)||1,o=(a.apBurstSpd||920)+180*s+ft(-45,70);a.vx+=t/n*o,a.vy+=e/n*o,a.ht=Math.max(a.ht,.18),le(.22+.06*s),se(.035),ce(a.x,a.y,"#c7a9ff",24,160),Se(ht(a.apAimX+ft(-22,22),24,2576),ht(a.apAimY+ft(-22,22),24,1776),72+16*s,2.4+.6*s),l>=2?Te(a,3===l?4:2,l):Math.random()<.3&&Te(a,1,l),a.apBurstLeft=(0|a.apBurstLeft)-1,a.apBurstLeft>0?(a.apTeleD=Math.max(.16,.3-.04*s),a.apTele=a.apTeleD,a.apAimX=ht(J.x+J.vx*(.7*i)+ft(-36,36),20,2580),a.apAimY=ht(J.y+J.vy*(.7*i)+ft(-36,36),20,1780)):a.apCd=ft(Math.max(.36,1-.28*s),Math.max(.65,1.6-.34*s)),M(140-10*s,.07,"sawtooth",.035)}}else if(a.apCd<=0){const t=r<180,e=r>360;let i=1===l?2:2===l?3:4;if(t&&l>=2&&i++,e&&(i=Math.max(i,3)),a.apBurstLeft=i,a.apTeleD=Math.max(.2,.46-.09*s-(t?.08:0)),a.apTele=a.apTeleD,a.apAimX=f,a.apAimY=h,a.apBurstSpd=880+190*s+(e?110:0),Math.random()<.45+.25*s){const t=Math.random()<.5?-1:1;a.apAimX=ht(a.apAimX+-o/r*t*(80+50*s),20,2580),a.apAimY=ht(a.apAimY+n/r*t*(80+50*s),20,1780)}S.msg=3===l?"APEX FRENZY!":"apex charging",S.msgT=.6,ce(a.x,a.y,"#b59bff",14+5*l,100+22*l),M(185-12*s,.06,"square",.022),a.apSummonCd<=0&&(Te(a,l+1,l),a.apSummonCd=ft(Math.max(.9,2.4-.7*s),Math.max(1.4,3.4-.8*s)))}if(a.apStormCd<=0&&!v){if(Se(ht(J.x+.36*J.vx+ft(-40,40),24,2576),ht(J.y+.36*J.vy+ft(-40,40),24,1776),68+14*l,2.2+.55*l),l>=2&&Math.random()<.35+.15*s&&Se(ht(a.x+ft(-140,140),24,2576),ht(a.y+ft(-140,140),24,1776),60+12*l,2+.45*l),l>=3&&Math.random()<.28){const t=Math.random()*Math.PI*2;Se(ht(J.x+130*Math.cos(t)+ft(-30,30),24,2576),ht(J.y+130*Math.sin(t)+ft(-30,30),24,1776),56+10*s,1.8+.4*s)}a.apStormCd=ft(Math.max(2,3.8-.55*s),Math.max(2.8,5-.55*s))}if(!v){const e=a.x-J.x,s=a.y-J.y,n=Math.hypot(e,s)||1,o=340+50*l;if(n<o){const a=(1-n/o)*(130+48*l);J.x=ht(J.x+e/n*a*t,12,2588),J.y=ht(J.y+s/n*a*t,12,1788),J.rx-=e/n*(1.8+.42*l),J.ry-=s/n*(1.5+.36*l)}}}const n=l-a.x,o=s-a.y,r=Math.hypot(n,o)||1;let i=1,f=0,h=0,c=0,b=0,d=0;for(let e=0;e<ot.length;e++){const l=ot[e],s=a.x-l.x,n=a.y-l.y,o=s*s+n*n;if(5!==l.k){if(1===l.k){const e=1.9*l.r;if(o<e*e){const r=Math.sqrt(o)||1,f=1-r/e,h=120+f*f*390;a.vx+=-s/r*h*t,a.vy+=-n/r*h*t,i=Math.min(i,.8),o<l.r*l.r&&(i=Math.min(i,.48),b+=.82*J.chDo+6)}continue}if(!(o>=l.r*l.r))if(2===l.k)i=Math.min(i,.5);else if(3===l.k)i=Math.min(i,.72),b+=1.02*J.chDo+7;else if(4===l.k){const e=Math.sqrt(o)||1,r=1-e/l.r,f=170+r*r*420;a.vx+=-s/e*f*t,a.vy+=-n/e*f*t,i=Math.min(i,.28),b+=1.75*J.chDo+18,d=1,(a.sc||0)<=0&&(a.sc=.24,ce(a.x,a.y,"#c8f3ff",4,34))}}else o<l.r*l.r&&4!==a.k&&(i=Math.min(i,1.15))}a.sc>0&&(a.sc=Math.max(0,a.sc-t));for(let e=0;e<rt.length;e++){const l=rt[e];if(3===l.k){const e=a.x-l.x,s=a.y-l.y,n=e*e+s*s;if(n<l.r*l.r){let o=0,r=1e18;for(let t=0;t<lt.length;t++){const e=lt[t];if(e.t<=.08)continue;const l=e.x-a.x,s=e.y-a.y,n=l*l+s*s;n<r&&(r=n,o=e)}if(o){const e=o.x-a.x,s=o.y-a.y,r=Math.hypot(e,s)||1,f=Math.max(16,.84*o.r),h=o.x-e/r*f,c=o.y-s/r*f,b=h-a.x,d=c-a.y,m=Math.hypot(b,d)||1,y=120+220*(1-Math.min(1,Math.sqrt(n)/Math.max(1,l.r)));a.vx+=b/m*y*t,a.vy+=d/m*y*t,i=Math.min(i,.64)}else{const l=Math.hypot(e,s)||1;a.vx+=-e/l*(90*t),a.vy+=-s/l*(90*t),i=Math.min(i,.7)}}continue}const s=a.x-l.x,n=a.y-l.y,o=s*l.dx+n*l.dy;if(Math.abs(o)>l.len)continue;const r=s-l.dx*o,f=n-l.dy*o,h=Math.hypot(r,f)||1,c=l.w*(2===l.k?1.35:1.55);if(h>c)continue;const b=1-h/c,d=(2===l.k?180:140)+b*(2===l.k?280:230);if(a.vx+=-r/h*d*t,a.vy+=-f/h*d*t,2===l.k){const e=120+340*(.55+.45*Math.sin((1-l.t/Math.max(.001,l.d))*Math.PI*8));a.vx+=l.dx*e*t,a.vy+=l.dy*e*t,i=Math.min(i,.58)}else i=Math.min(i,.66);if(J.zt>0){const e=(2===l.k?340:260)+220*b;a.vx+=l.dx*e*t,a.vy+=l.dy*e*t,a.hp-=(2===l.k?.75*J.zDmg+8:.45*J.zDmg+4)*t}}for(let e=0;e<lt.length;e++){const l=lt[e],s=a.x-l.x,n=a.y-l.y,o=s*s+n*n,r=0|l.m;if(3===r){const e=2.35*l.r;if(o<e*e){const r=Math.sqrt(o)||1,c=1-r/e,b=90+c*c*350;a.vx+=-s/r*b*t,a.vy+=-n/r*b*t,i=Math.min(i,.88),o<l.r*l.r&&(1!==h&&(h=3),i=Math.min(i,.42),f=1)}continue}if(o<l.r*l.r){1===r?(c=1,h=1):1!==h&&(h=r);const t=1===r?.3:2===r?.18:J.mkSl;i=Math.min(i,1-t),f=1,1===r&&J.cat&&a.ce<=0&&(a.ce=.55,a.hp-=J.chBurst,ce(a.x,a.y,"#ffd58f",5,44))}}if(J.bot&&nt.length)for(let t=0;t<nt.length;t++){const l=nt[t],s=a.x-l.x,n=a.y-l.y,o=s*s+n*n,r=Xt(0|l.t||1);if(o<400&&(i=Math.min(i,.65)),r.auraR>0&&o<r.auraR*r.auraR&&(i=Math.min(i,1-r.auraSl)),nt.length>=3&&o<484&&l.mcd<=0){const t=Math.sqrt(o)||1;if(a.hp-=8*r.dmg,a.ht=Math.max(a.ht,.1),a.vx+=s/t*140,a.vy+=n/t*140,l.mcd=.3,ce(l.x,l.y,r.col,4,28),a.hp<=0){be(e,r.col,7,52);break}}}if((w||J.slRecallT>0||J.slLinkT>0)&&nt.length>=2){i=Math.min(i,w?.58:.66);let t=0;for(let e=0;e<Math.min(3,nt.length);e++){const l=nt[e],s=a.r+14;if(ct(a.x,a.y,J.x,J.y,l.x,l.y)<s*s){t=1;break}}if(t&&(a.tc||0)<=0){const t=w?Math.max(.1,J.slCharge):Math.max(.32,J.slPow),l=(w?.24+.38*t:.34+.92*t)*J.slScale,s=J.zDmg*l*(a.k>=3?.82:1);a.hp-=s,a.ht=Math.max(a.ht,w?.12:.16);const n=(w?170:230)+(w?120:250)*t,o=w?J.zx:J.slDx,r=w?J.zy:J.slDy;if(a.vx+=o*n,a.vy+=r*n,a.tc=w?.08:.06,W++,ce(a.x,a.y,w?"#95edff":"#bff8ff",w?3:5,w?34:48),a.hp<=0){be(e,w?"#95edff":"#bff8ff",w?9:11,w?70:84,1),F++;continue}}}if((J.slT>0||J.slRecallT>0)&&nt.length>=2){const t=J.slT<=0&&J.slRecallT>0;let l=0;for(let s=0;s<Math.min(3,nt.length);s++){const n=nt[s],o=a.x-n.x,r=a.y-n.y,i=a.r+(t?20:22);if(o*o+r*r<i*i&&(a.tc||0)<=0){const i=((t?1.05:1.45)+(t?1.05:1.75)*J.slPow)*J.slScale,f=J.zDmg*i*(a.k>=3?.82:t?1:1.05);a.hp-=f,a.ht=.18;const h=Math.hypot(o,r)||1,c=Math.hypot(J.x-n.x,J.y-n.y)||1,b=t?(J.x-n.x)/c:J.slDx,d=t?(J.y-n.y)/c:J.slDy,m=(t?240:340)+(t?190:320)*J.slPow;if(a.vx+=b*m+o/h*(130+100*J.slPow),a.vy+=d*m+r/h*(130+100*J.slPow),a.tc=t?.08:.095,W++,ce(a.x,a.y,t?"#bdf7ff":"#8eefff",t?5:7,t?52:64),l=1,!t){const t=1<<s;J.slHitMask&t||(J.slHitMask|=t);const e=(1<<Math.min(nt.length,3))-1;E||J.slHitMask!==e||(E=1,H=Math.max(H,J.slPow),J.slLinkT=Math.max(J.slLinkT,.8140000000000001*J.slScale),J.slWave=Math.max(J.slWave,.95*J.slScale),J.slComboFx=Math.max(J.slComboFx,1.2*J.slScale),S.msg=nt.length>=3?"triple crack":"duo crack",S.msgT=.7,M(1240,.04,"square",.024),M(820,.05,"triangle",.017))}if(a.hp<=0){be(e,t?"#bdf7ff":"#8eefff",t?9:12,t?76:92,1),F++;break}}}if(l&&a.hp<=0)continue}if(a.tc>0&&(a.tc=Math.max(0,a.tc-t)),4===a.k){const t=a.apPhase||1;d?(i=Math.min(i,.22),b+=3.5*J.chDo+38,(a.sc||0)<=0&&(a.sc=.18,ce(a.x,a.y,"#8effdc",8,58))):i=Math.max(i,t>=3?.72:2===t?.62:.54)}if(a.fb>0&&3!==a.k&&4!==a.k&&5!==a.k&&9!==a.k&&11!==a.k&&(i=Math.max(i,1.08)),a.fbSt>0&&(i=Math.min(i,wt(a.k)?.78:.56),a.ht=Math.max(a.ht,.1)),a.sl=f,f){const l=J.cat&&c?J.chDo:0;if(l>0&&(a.hp-=l*t),a.ht=Math.max(a.ht,.08),a.hp<=0){be(e,"#f7d96b",8,60);continue}}if(b>0&&(a.hp-=b*t,a.ht=Math.max(a.ht,.11),a.hp<=0)){be(e,"#c8f3ff",10,76,1);continue}a.ce>0&&(a.ce=Math.max(0,a.ce-t)),a.vx*=Math.max(0,1-8*t),a.vy*=Math.max(0,1-8*t),a.ht=Math.max(0,a.ht-t),a.x+=(n/r*a.s*i+a.vx)*t,a.y+=(o/r*a.s*i+a.vy)*t,ut(a,6)&&(a.vx*=.4,a.vy*=.4);const m=J.x-a.x,y=J.y-a.y;if((Math.hypot(m,y)||1)<a.r+J.r-1){if(J.zt>0){if(a.hp-=J.zDmg,a.ht=.12,a.vx+=280*J.zx,a.vy+=280*J.zy,W++,a.hp<=0){be(e,"#8fffe5",12,90,1),F++;continue}B+=.35*a.dmg;continue}4===a.k&&a.apImpactCd<=0&&!v&&(a.apImpactCd=.9,Se(ht(J.x+ft(-16,16),24,2576),ht(J.y+ft(-16,16),24,1776),68+10*(a.apPhase||1),2.2+.35*(a.apPhase||1)),ce(J.x,J.y,"#e1c6ff",10,84),le(.15));let t=4===a.k?1.2*a.dmg:a.dmg;a.fb>0&&(t*=3===a.k||4===a.k||5===a.k||9===a.k||11===a.k?.8:.35),B+=t}}if(J.slRecallPulse){J.slRecallPulse=0;const t=132*(.88+.24*Math.min(1,J.slPow))*J.slScale,e=t*t,a=J.zDmg*(.48+.62*Math.min(1,J.slPow))*J.slScale;let l=0;for(let s=tt.length-1;s>=0;s--){const n=tt[s],o=n.x-J.x,r=n.y-J.y,i=o*o+r*r;if(i>e)continue;const f=Math.sqrt(i)||1,h=1-f/t;n.hp-=a*(.58+.42*h),n.ht=Math.max(n.ht,.13);const c=170+220*h*(.7+.3*Math.min(1,J.slPow));n.vx+=o/f*c,n.vy+=r/f*c,l++,W++,Math.random()<.26&&ce(n.x,n.y,"#cdf9ff",3,34),n.hp<=0&&(be(s,"#cdf9ff",10,78,1),F++)}J.slWave=Math.max(J.slWave,.78),J.slComboFx=Math.max(J.slComboFx,.48),ce(J.x,J.y,"#cdf9ff",16,104+66*Math.min(1,J.slPow)),l>0&&(S.msg="recall burst",S.msgT=.55,se(.035+.015*Math.min(1,J.slPow)),le(.08+.07*Math.min(1,J.slPow)),M(900,.03,"square",.018))}if(E){const t=165*(.9+.35*H)*J.slScale,e=t*t,a=J.zDmg*(.7+1.1*H)*J.slScale;for(let l=tt.length-1;l>=0;l--){const s=tt[l],n=s.x-J.x,o=s.y-J.y,r=n*n+o*o;if(r>e)continue;const i=Math.sqrt(r)||1,f=1-i/t;s.hp-=a*(.55+.45*f),s.ht=Math.max(s.ht,.14);const h=220+280*H*f;s.vx+=n/i*h,s.vy+=o/i*h,W++,Math.random()<.32&&ce(s.x,s.y,"#b8f6ff",3,40),s.hp<=0&&(be(l,"#b8f6ff",11,86,1),F++)}se(.06+.03*Math.min(1,H)),le(.2+.14*Math.min(1,H)),ce(J.x,J.y,"#b8f6ff",20,130+90*H)}W>0&&(se(Math.min(.04,.012*W)),le(Math.min(.24,.04*W)),S.xpPulse=Math.min(.6,S.xpPulse+.06*W),M(260,.02,"square",.016),F>1&&M(310,.02,"square",.013)),B>0&&Ae(B*t);for(let e=at.length-1;e>=0;e--){const a=at[e],l=J.x-a.x,s=J.y-a.y,n=Math.hypot(l,s)||1;if(J.bot&&nt.length)if(a.bc){const e=(0|a.bc)-1,l=e>=0&&e<nt.length?nt[e]:nt[0],s=Xt(0|l.t||1),n=l.x-a.x,o=l.y-a.y,r=Math.hypot(n,o)||1,i=Math.min(1.3*s.pull,13*r);a.x+=n/r*i*t,a.y+=o/r*i*t}else{let e=0;for(let t=0;t<nt.length;t++)e+=Xt(0|nt[t].t||1).carry;if(J.bCarry<e&&n>1.45*J.magnet)for(let e=0;e<nt.length;e++){const l=nt[e];if(l.grabCd>0)continue;const s=Xt(0|l.t||1),n=l.x-a.x,o=l.y-a.y,r=Math.hypot(n,o)||1;if(r<s.fetch){a.x+=n/r*s.pull*t,a.y+=o/r*s.pull*t,r<10&&(a.bc=e+1,J.bCarry++,l.grabCd=s.grab,ce(a.x,a.y,"#9de6ff",3,24));break}}}n<J.magnet&&(a.x+=l/n*240*t,a.y+=s/n*240*t),n<J.r+8&&Pe(e,a.bc?"bot":"player")}if((Z.gr||Q)&&Math.random()<.04&&S.time>2&&fe({x:ht(J.x+ft(-20,20),12,2588),y:ht(J.y+ft(-20,20),12,1788),v:4,m:1,t:0}),S.bs)for(let t=0;t<tt.length;t++){const e=tt[t];if(!(3!==e.k||e.b1Cd>0))for(let t=at.length-1;t>=0;t--){const a=at[t],l=a.x-e.x,s=a.y-e.y;if(Math.hypot(l,s)<e.r){if(Math.hypot(a.x-J.x,a.y-J.y)<J.magnet)continue;at.splice(t,1),e.b1Eat=(e.b1Eat||0)+1,e.b1Cd=.14,e.b1Pulse=.35;const l=e.b1Eat,s=1/(1+.035*l);e.r=e.b1BaseR+1.6*l*s,e.hp=Math.min(e.hp+35*s,e.b1Max+35*s),e.b1Max+=35*s,e.dmg=e.b1BaseDmg+2*l*s,e.s=e.b1BaseS+2.4*l*s,ce(e.x,e.y,"#69f0c9",6,e.r+18),M(120+6*l,.06,"sawtooth",.018),l%5==0&&(e.b1Roar=.6,le(.14),ce(e.x,e.y,"#a789ff",14,e.r+50),M(80,.12,"sawtooth",.028),S.msg="the dean grows stronger!",S.msgT=1.4)}}}}(g),function(){const t=S.shake*S.shake,n=10*(2*Math.random()-1)*t,o=10*(2*Math.random()-1)*t;e.setTransform(s,0,0,s,n,o);const r=ht(J.x-.5*a,0,2600-a),c=ht(J.y-.5*l,0,1800-l),p=e.createLinearGradient(0,0,0,l);p.addColorStop(0,"#263f60"),p.addColorStop(.55,"#16273f"),p.addColorStop(1,"#0b111a"),e.fillStyle=p,e.fillRect(0,0,a,l),e.strokeStyle="rgba(63,96,132,.35)",e.lineWidth=1;const g=-r%56;for(let t=-c%56;t<l;t+=56)e.beginPath(),e.moveTo(0,0|t),e.lineTo(a,0|t),e.stroke();for(let t=g;t<a;t+=56)e.beginPath(),e.moveTo(0|t,0),e.lineTo(0|t,l),e.stroke();const M=1300-r,u=900-c;e.fillStyle="rgba(105,240,201,.07)",e.beginPath(),e.arc(M,u,210,0,2*Math.PI),e.fill();const k=Mt(J.x,J.y,-8);for(let t=0;t<i.length;t++){const s=i[t],n=s.x-r,o=s.y-c;if(n<-s.r-30||o<-s.r-30||n>a+s.r+30||o>l+s.r+30)continue;const b="home"===s.id?0:2===S.sch[s.id],d="home"===s.id?!J.mkOn:1===S.sch[s.id]||"nsh"===s.id&&(0===S.sch.nsh||2===S.sch.nsh&&2===S.sch.bak&&S.labNsh>0)||"mel"===s.id&&(2===S.sch.nsh&&0===S.sch.mel||2===S.sch.mel&&2===S.sch.bak&&S.labMel>0)||"bak"===s.id&&(1===S.sch.bak||2===S.sch.mel&&0===S.sch.bak);e.globalAlpha=b?.18:d?.14:.08,e.fillStyle=s.c,e.beginPath(),e.arc(n,o,s.r,0,2*Math.PI),e.fill(),e.globalAlpha=.65,e.strokeStyle=b?"#9effc8":s.c,e.lineWidth=2,e.beginPath(),e.arc(n,o,s.r,0,2*Math.PI),e.stroke(),e.globalAlpha=1,e.fillStyle="#dce8ff",e.font="600 12px Trebuchet MS,sans-serif",e.fillText(s.n,n-s.r+10,o-s.r-8);const m="home"===s.id?48:44,y=30,x=n-.5*m,p=o-.5*y;if(e.fillStyle="rgba(18,25,37,.9)",e.fillRect(x,p,m,y),e.strokeStyle="rgba(165,190,220,.55)",e.lineWidth=1,e.strokeRect(x+.5|0,p+.5|0,m-1,y-1),e.fillStyle="rgba(248,234,164,.86)",e.fillRect(x+6|0,p+6|0,11,8),e.fillRect(x+m-17|0,p+6|0,11,8),e.fillStyle="rgba(44,56,72,.95)",e.beginPath(),e.arc(x+11+Math.sin(2*S.t+t),p+11,1.7,0,2*Math.PI),e.fill(),e.beginPath(),e.arc(x+m-11+Math.sin(2*S.t+t+1),p+11,1.7,0,2*Math.PI),e.fill(),S.start&&!S.dead){const a=k?h:f,l=a[(.45*S.t+2*t|0)%a.length],r=o-.44*s.r,i=4.6*l.length+12;e.fillStyle="rgba(8,12,20,.82)",dt(n-.5*i,r-9,i,16,7),e.fill(),e.fillStyle="rgba(220,240,255,.9)",e.font="600 9px Trebuchet MS,sans-serif",e.fillText(l,n-.5*i+6,r+3)}}for(let t=0;t<at.length;t++){const s=at[t],n=s.x-r,o=s.y-c;n<-10||o<-10||n>a+10||o>l+10||(e.fillStyle="#69f0c9",e.beginPath(),e.arc(n,o,5,0,2*Math.PI),e.fill(),e.fillStyle="#ceffef",e.fillRect(n-1|0,o-1|0,2,2))}for(let t=0;t<lt.length;t++){const s=lt[t],n=s.x-r,o=s.y-c;if(n<-s.r-20||o<-s.r-20||n>a+s.r+20||o>l+s.r+20)continue;const i=s.t/s.d;e.globalAlpha=.24+.22*i;let f="#f4d96e",h="#fff0a9";J.cat&&(1===s.m?(f="#53d93d",h="#baff87"):2===s.m?(f="#42cdb9",h="#a8f6ea"):3===s.m&&(f="#597fd6",h="#bdd4ff")),e.fillStyle=f,e.beginPath(),e.arc(n,o,s.r,0,2*Math.PI),e.fill(),e.globalAlpha=.34+.28*Math.sin(5*(S.t+t))*i,e.strokeStyle=h,e.lineWidth=1.9,e.beginPath(),e.arc(n,o,.68*s.r+2*Math.sin(4*(S.t+t)),0,2*Math.PI),e.stroke(),J.cat&&(3===s.m&&(e.globalAlpha=.1+.08*i,e.strokeStyle="rgba(175,205,255,.72)",e.lineWidth=1.25,e.beginPath(),e.arc(n,o,2.35*s.r*(.97+.03*Math.sin(2*S.t+t)),0,2*Math.PI),e.stroke(),e.globalAlpha=.08+.07*i,e.strokeStyle="rgba(140,174,255,.58)",e.lineWidth=1,e.beginPath(),e.arc(n,o,1.6*s.r*(.96+.04*Math.sin(2.7*S.t+.8*t)),0,2*Math.PI),e.stroke()),e.globalAlpha=.18+.24*i,1===s.m?e.fillStyle="#dbff8f":2===s.m?e.fillStyle="#d8fff7":3===s.m?e.fillStyle="#e1ebff":e.fillStyle="#f1ffb3",e.beginPath(),e.arc(n+Math.sin(4*S.t+t)*s.r*.22,o-.16*s.r,2.4+.7*Math.sin(7*S.t+t),0,2*Math.PI),e.fill(),e.beginPath(),e.arc(n-.18*s.r,o+Math.sin(3*S.t+.7*t)*s.r*.14,1.9+.5*Math.sin(8*S.t+.4*t),0,2*Math.PI),e.fill(),e.beginPath(),e.arc(n+.12*s.r,o+.2*s.r,1.6+.4*Math.sin(6*S.t+.5*t),0,2*Math.PI),e.fill()),e.globalAlpha=1}for(let t=0;t<ot.length;t++){const s=ot[t],n=s.x-r,o=s.y-c;if(n<-s.r-40||o<-s.r-40||n>a+s.r+40||o>l+s.r+40)continue;const i=s.t/s.d,f=.86+.12*Math.sin(5*S.t+t),h=s.r*f;let b="#95f0b8",d="#d6ffea",m="#6ae9b4";if(2===s.k?(b="#7cf6e7",d="#d8fff7",m="#a0fff0"):3===s.k?(b="#c5f690",d="#efffd0",m="#d9ffab"):4===s.k?(b="#bde9ff",d="#f0fbff",m="#d4f2ff"):5===s.k&&(b="#b89edf",d="#d8c4f0",m="#c4a8e8"),e.globalAlpha=.14+.16*i,e.fillStyle=b,e.beginPath(),e.arc(n,o,h,0,2*Math.PI),e.fill(),e.globalAlpha=.28+.24*i,e.strokeStyle=d,e.lineWidth=2,e.beginPath(),e.arc(n,o,.78*h,0,2*Math.PI),e.stroke(),e.globalAlpha=.2+.2*i,e.strokeStyle=m,e.lineWidth=1.4,e.beginPath(),e.arc(n,o,h*(1.08+.05*Math.sin(7*S.t+t)),0,2*Math.PI),e.stroke(),4===s.k)for(let t=0;t<3;t++){const a=5.6*S.t+2.1*t,l=n+Math.cos(a)*h*.62,s=o+Math.sin(a)*h*.62;e.globalAlpha=.5+.3*i,e.fillStyle="#f2fcff",e.beginPath(),e.arc(l,s,2.3,0,2*Math.PI),e.fill()}if(5===s.k){for(let t=0;t<4;t++){const a=-4.2*S.t+1.57*t,l=n+Math.cos(a)*h*.55,s=o+Math.sin(a)*h*.55;e.globalAlpha=.35+.25*i,e.fillStyle="#e0c8ff",e.beginPath(),e.arc(l,s,2,0,2*Math.PI),e.fill()}e.globalAlpha=.08+.1*i,e.strokeStyle="#9b7ccc",e.lineWidth=1.8,e.beginPath(),e.arc(n,o,h*(.5+.08*Math.sin(9*S.t+t)),0,2*Math.PI),e.stroke()}e.globalAlpha=1}for(let t=0;t<rt.length;t++){const a=rt[t],l=ht(a.t/Math.max(.001,a.d),0,1);if(3===a.k){const s=a.x-r,n=a.y-c,o=a.r*(.92+.08*Math.sin(4*S.t+t));e.globalAlpha=.12+.16*l,e.fillStyle="#9af5c8",e.beginPath(),e.arc(s,n,o,0,2*Math.PI),e.fill(),e.globalAlpha=.34+.24*l,e.strokeStyle="#d7ffe9",e.lineWidth=2,e.beginPath(),e.arc(s,n,.72*o,0,2*Math.PI),e.stroke(),e.globalAlpha=1;continue}const s=a.x-a.dx*a.len-r,n=a.y-a.dy*a.len-c,o=a.x+a.dx*a.len-r,i=a.y+a.dy*a.len-c;if(e.globalAlpha=.1+.16*l,e.strokeStyle=2===a.k?"#bedfff":"#a9d9ff",e.lineWidth=a.w*(2===a.k?1.7:1.45),e.beginPath(),e.moveTo(s,n),e.lineTo(o,i),e.stroke(),e.globalAlpha=.38+.24*l,e.strokeStyle=2===a.k?"#e4f3ff":"#d1ecff",e.lineWidth=2,e.beginPath(),e.moveTo(s,n),e.lineTo(o,i),e.stroke(),2===a.k){const t=.5+.5*Math.sin((1-l)*Math.PI*8),a=s+(o-s)*(.2+.6*t),r=n+(i-n)*(.2+.6*t);e.globalAlpha=.6+.24*l,e.fillStyle="#eef8ff",e.beginPath(),e.arc(a,r,3.2,0,2*Math.PI),e.fill()}e.globalAlpha=1}for(let t=0;t<tt.length;t++){const s=tt[t],n=s.x-r,o=s.y-c;if(n<-40||o<-40||n>a+40||o>l+40)continue;const i=(s.fb||0)>0,f=i?"#8bcfff":12===s.k?"#884488":11===s.k?"#aa22aa":10===s.k?"#661122":9===s.k?"#bb1122":8===s.k?"#3dba5a":7===s.k?"#8899aa":6===s.k?"#d95530":5===s.k?"#cc7a2e":4===s.k?"#713ce8":3===s.k?"#a789ff":2===s.k?"#665a78":1===s.k?"#5687a1":s.sl?"#70805a":"#4b667f";if(9===s.k&&(s.prCloak||0)>0)ht((s.prCloak||0)/1.5,0,1),e.globalAlpha=.06+.08*Math.sin(12*S.t+t),e.fillStyle="#bb1122",e.beginPath(),e.arc(n,o,s.r,0,2*Math.PI),e.fill(),e.globalAlpha=.04+.03*Math.sin(20*S.t+3*t),e.strokeStyle="#ff4444",e.lineWidth=1,e.beginPath(),e.arc(n+4*Math.sin(8*S.t),o+4*Math.cos(7*S.t),s.r+6,0,2*Math.PI),e.stroke(),e.globalAlpha=1;else if(10===s.k){const a=ht((s.cloneLife||0)/2,0,1);e.globalAlpha=.3+.2*a+.1*Math.sin(14*S.t+t),e.fillStyle=f,e.beginPath(),e.arc(n,o,s.r,0,2*Math.PI),e.fill(),e.fillStyle="#ff3344",e.fillRect(n-3|0,o-2|0,2,2),e.fillRect(n+1|0,o-2|0,2,2),e.globalAlpha=1}else e.fillStyle=s.ht>0?"#9db4d1":f,e.beginPath(),e.arc(n,o,s.r,0,2*Math.PI),e.fill();if((9!==s.k||(s.prCloak||0)<=0)&&10!==s.k&&(e.fillStyle="#f0627c",e.fillRect(n-4|0,o-2|0,3,3),e.fillRect(n+1|0,o-2|0,3,3)),i){const a=ht((s.fb||0)/Math.max(.001,J.fbFear),0,1);e.globalAlpha=.14+.2*a,e.strokeStyle="#c5ebff",e.lineWidth=1.6,e.beginPath(),e.arc(n,o,s.r+4+1.6*Math.sin(12*S.t+t),0,2*Math.PI),e.stroke(),e.globalAlpha=1}if((s.psJ||0)>0||(s.psF||0)>0||(s.psD||0)>0){let t=n-8;(s.psJ||0)>0&&(e.fillStyle="#9ed9ff",e.beginPath(),e.arc(t,o-s.r-8,2.1,0,2*Math.PI),e.fill(),t+=8),(s.psF||0)>0&&(e.fillStyle="#9fe9ff",e.beginPath(),e.arc(t,o-s.r-8,2.1,0,2*Math.PI),e.fill(),t+=8),(s.psD||0)>0&&(e.fillStyle="#c8d4ff",e.beginPath(),e.arc(t,o-s.r-8,2.1,0,2*Math.PI),e.fill())}if(5===s.k){const a=ht(s.hp/(s.mbMax||s.hp||1),0,1);e.globalAlpha=.3+.15*Math.sin(6*S.t+t),e.strokeStyle="#ffa64d",e.lineWidth=2.2,e.beginPath(),e.arc(n,o,s.r+7+2*Math.sin(5*S.t),0,2*Math.PI),e.stroke(),(s.mbChargeT||0)>0&&(e.globalAlpha=.25,e.fillStyle="#ffa64d",e.beginPath(),e.arc(n-22*(s.mbDx||0),o-22*(s.mbDy||0),.7*s.r,0,2*Math.PI),e.fill());const l=2.2*s.r,r=n-.5*l,i=o-s.r-12;e.globalAlpha=.85,e.fillStyle="rgba(10,14,22,.9)",e.fillRect(r-1,i-1,l+2,5),e.fillStyle="#664420",e.fillRect(r,i,l,3),e.fillStyle=a>.5?"#ffa64d":"#ff6633",e.fillRect(r,i,l*a,3),e.globalAlpha=1}if(6===s.k){const a=.5+.5*Math.sin(8*S.t+t);e.globalAlpha=.12+.1*a,e.fillStyle="#ff4422",e.beginPath(),e.arc(n,o,s.r+6+4*a,0,2*Math.PI),e.fill(),e.globalAlpha=.4,e.fillStyle="#ffaa44",e.beginPath(),e.arc(n,o,2.5,0,2*Math.PI),e.fill(),e.globalAlpha=1}if(7===s.k){const a=Math.atan2(J.y-s.y,J.x-s.x);e.globalAlpha=.22+.08*Math.sin(4*S.t+t),e.strokeStyle="#aabbcc",e.lineWidth=3,e.beginPath(),e.arc(n,o,s.r+5,a-.8,a+.8),e.stroke(),e.globalAlpha=1}if(8===s.k&&(e.globalAlpha=.6,e.fillStyle="#7fff7f",e.fillRect(n-1.5|0,o-5|0,3,10),e.fillRect(n-5|0,o-1.5|0,10,3),(s.healCd||0)<.4&&(e.globalAlpha=.1+.08*(1-(s.healCd||0)/.4),e.strokeStyle="#7fff7f",e.lineWidth=1.2,e.beginPath(),e.arc(n,o,120*(1-(s.healCd||0)/.4),0,2*Math.PI),e.stroke()),e.globalAlpha=1),9===s.k&&(s.prCloak||0)<=0){const a=ht(s.hp/(s.prMax||s.hp||1),0,1),l=a<=.5?1:0,r=.5+.5*Math.sin(4*S.t+t);e.globalAlpha=.12+.08*r+.06*l,e.fillStyle=l?"#ff1111":"#bb2233",e.beginPath(),e.arc(n,o,s.r+16+5*r,0,2*Math.PI),e.fill(),e.globalAlpha=.35+.15*Math.sin(6*S.t),e.strokeStyle=l?"#ff3333":"#cc2244",e.lineWidth=2.5,e.beginPath(),e.arc(n,o,s.r+10+3*Math.sin(5*S.t),0,2*Math.PI),e.stroke(),e.globalAlpha=.9,e.fillStyle="#ff2222",e.beginPath(),e.arc(n-5,o-3,2.5+.5*l,0,2*Math.PI),e.fill(),e.beginPath(),e.arc(n+5,o-3,2.5+.5*l,0,2*Math.PI),e.fill(),(s.prLunge||0)>0&&(e.globalAlpha=.2,e.fillStyle="#ff2222",e.beginPath(),e.arc(n-30*(s.prLungeDx||0),o-30*(s.prLungeDy||0),.8*s.r,0,2*Math.PI),e.fill(),e.beginPath(),e.arc(n-55*(s.prLungeDx||0),o-55*(s.prLungeDy||0),.5*s.r,0,2*Math.PI),e.fill());const i=Math.max(50,2.6*s.r),f=6,h=n-.5*i,c=o-s.r-18;e.globalAlpha=.88,e.fillStyle="rgba(10,6,6,.92)",e.fillRect(h-2,c-2,i+4,f+4),e.fillStyle="#3a1015",e.fillRect(h,c,i,f);const b=e.createLinearGradient(h,0,h+i,0);b.addColorStop(0,l?"#ff2222":"#cc2244"),b.addColorStop(1,l?"#ff6644":"#ee4466"),e.fillStyle=b,e.fillRect(h,c,i*a,f),e.globalAlpha=1}if(11===s.k){const a=ht(s.hp/(s.moMax||s.hp||1),0,1),l=s.moRage||0,r=.5+.5*Math.sin(3.5*S.t+t);if(e.globalAlpha=.1+.06*r+.05*l,e.fillStyle=l>1?"#dd22dd":"#aa33aa",e.beginPath(),e.arc(n,o,s.r+22+6*r+8*l,0,2*Math.PI),e.fill(),e.globalAlpha=.3+.15*Math.sin(5*S.t),e.strokeStyle=l>1?"#ff44ff":"#cc44cc",e.lineWidth=3+l,e.beginPath(),e.arc(n,o,s.r+12+3*Math.sin(4.5*S.t),0,2*Math.PI),e.stroke(),(s.moScreamT||0)>0){const t=ht((s.moScreamT||0)/1.6,0,1);e.globalAlpha=.15*t,e.strokeStyle="#ff66ff",e.lineWidth=4,e.beginPath(),e.arc(n,o,(320+60*l)*(1-.3*t),0,2*Math.PI),e.stroke()}if((s.moWaveT||0)>0){const t=(s.moWaveT||0)/.6;e.globalAlpha=.2*t,e.fillStyle="#ee55ee",e.beginPath(),e.arc(n,o,(180+50*l)*(1-.4*t),0,2*Math.PI),e.fill()}e.globalAlpha=.9,e.fillStyle="#ff44ff",e.beginPath(),e.arc(n-8,o-4,3+.5*l,0,2*Math.PI),e.fill(),e.beginPath(),e.arc(n+8,o-4,3+.5*l,0,2*Math.PI),e.fill(),e.fillStyle="#ffaaff",e.beginPath(),e.arc(n,o+6,2,0,2*Math.PI),e.fill();const i=Math.max(60,2.8*s.r),f=7,h=n-.5*i,c=o-s.r-20;e.globalAlpha=.9,e.fillStyle="rgba(12,4,12,.92)",e.fillRect(h-2,c-2,i+4,f+4),e.fillStyle="#2a0e2a",e.fillRect(h,c,i,f);const b=e.createLinearGradient(h,0,h+i,0);l>1?(b.addColorStop(0,"#ff22ff"),b.addColorStop(1,"#ff77ff")):l>0?(b.addColorStop(0,"#cc33cc"),b.addColorStop(1,"#ee55ee")):(b.addColorStop(0,"#993399"),b.addColorStop(1,"#cc55cc")),e.fillStyle=b,e.fillRect(h,c,i*a,f),e.globalAlpha=1}if(3===s.k){const a=s.b1Eat||0,l=ht(s.hp/(s.b1Max||s.hp||1),0,1),r=(s.b1Pulse||0)>.01?s.b1Pulse/.35:0,i=(s.b1Roar||0)>.01?s.b1Roar/.6:0,f=Math.min(1,a/20),h=s.r+10+2.2*a+3*Math.sin(4*S.t);e.globalAlpha=.08+.08*f+.14*r,e.fillStyle=a>15?"#ff8f8f":a>8?"#ffd58f":"#a789ff",e.beginPath(),e.arc(n,o,h,0,2*Math.PI),e.fill();const c=a>15?"#ff6b6b":a>8?"#ffaa44":"#c8a0ff";if(e.globalAlpha=.28+.12*Math.sin(5*S.t+t)+.08*i,e.strokeStyle=c,e.lineWidth=2.2+.08*a,e.beginPath(),e.arc(n,o,s.r+8+2.5*Math.sin(5.5*S.t+t),0,2*Math.PI),e.stroke(),i>.01&&(e.globalAlpha=.22*i,e.strokeStyle="#c8a0ff",e.lineWidth=3,e.beginPath(),e.arc(n,o,s.r+20+50*(1-i),0,2*Math.PI),e.stroke()),a>0)for(let t=0;t<Math.min(a,8);t++){const l=S.t*(3.2+.4*t)+t*(.78+.04*a),r=s.r+8+2.5*t+3*Math.sin(6*S.t+t),i=n+Math.cos(l)*r,f=o+Math.sin(l)*r;e.globalAlpha=.35+.2*Math.sin(8*S.t+t),e.fillStyle="#69f0c9",e.beginPath(),e.arc(i,f,2.2+.06*a,0,2*Math.PI),e.fill()}r>.01&&(e.globalAlpha=.3*r,e.fillStyle="#69f0c9",e.beginPath(),e.arc(n,o,s.r+8+24*(1-r),0,2*Math.PI),e.fill());const b=Math.max(44,2.2*s.r),d=5,m=n-.5*b,y=o-s.r-16;e.globalAlpha=.85,e.fillStyle="rgba(10,14,22,.9)",e.fillRect(m-2,y-2,b+4,d+4),e.fillStyle="#3a2255",e.fillRect(m,y,b,d),e.fillStyle=l>.5?"#a789ff":l>.25?"#d88fff":"#ff6b9a",e.fillRect(m,y,b*l,d),a>0&&(e.fillStyle="#69f0c9",e.font="700 9px Trebuchet MS,sans-serif",e.fillText("√ó"+a,m+b+5,y+5)),e.globalAlpha=1}if(4===s.k){const a=ht(s.hp/(s.apMax||s.hp||1),0,1),l=a>.66?"#bfa1ff":a>.33?"#d8b4ff":"#ffb6f2",i=Math.hypot(s.vx||0,s.vy||0);if(i>220){const a=(s.vx||0)/(i||1),l=(s.vy||0)/(i||1);e.globalAlpha=.14+.06*Math.sin(20*S.t+t),e.fillStyle="rgba(165,126,242,.7)",e.beginPath(),e.ellipse(n-a*(18+.02*i),o-l*(18+.02*i),.7*s.r,.44*s.r,Math.atan2(l,a),0,2*Math.PI),e.fill()}if(e.globalAlpha=.25+.12*Math.sin(8*S.t+t),e.strokeStyle=l,e.lineWidth=2,e.beginPath(),e.arc(n,o,s.r+10+2*Math.sin(6*S.t+t),0,2*Math.PI),e.stroke(),s.apTele>0&&void 0!==s.apAimX){const t=1-ht(s.apTele/(s.apTeleD||.001),0,1),a=s.apAimX-r,l=s.apAimY-c;e.globalAlpha=.22+.5*t,e.strokeStyle="#f2d6ff",e.lineWidth=2.2+1.8*t,e.setLineDash([7,6]),e.lineDashOffset=90*-S.t,e.beginPath(),e.moveTo(n,o),e.lineTo(a,l),e.stroke(),e.setLineDash([]),e.beginPath(),e.arc(a,l,26+26*t,0,2*Math.PI),e.stroke(),e.globalAlpha=.12+.3*t,e.fillStyle="rgba(234,203,255,.85)",e.beginPath(),e.arc(a,l,18+22*t,0,2*Math.PI),e.fill(),e.fillStyle="rgba(248,232,255,.75)",e.beginPath(),e.arc(a,l,3.2,0,2*Math.PI),e.fill()}if(s.apShieldT>0){const t=ht(s.apShieldT/1.8,0,1);e.globalAlpha=.12+.22*t,e.fillStyle="rgba(200,182,255,.8)",e.beginPath(),e.arc(n,o,s.r+16+3*Math.sin(14*S.t),0,2*Math.PI),e.fill(),e.globalAlpha=.35+.4*t,e.strokeStyle="rgba(220,200,255,.9)",e.lineWidth=2.5+2*t,e.beginPath(),e.arc(n,o,s.r+14+2*Math.sin(10*S.t),0,2*Math.PI),e.stroke()}if((s.apSlamCd||0)<.8&&(s.apSlamCd||0)>0){const t=1-ht((s.apSlamCd||0)/.8,0,1);e.globalAlpha=.08+.18*t,e.strokeStyle="#ff8bd9",e.lineWidth=1.5+2*t,e.setLineDash([6,4]),e.lineDashOffset=60*-S.t;const a=120+28*(s.apPhase||1);e.beginPath(),e.arc(n,o,a,0,2*Math.PI),e.stroke(),e.setLineDash([])}if((s.apPhase||1)>=3&&Math.random()<.12){const a=Math.random()*Math.PI*2,l=.6*s.r;e.globalAlpha=.25+.15*Math.sin(12*S.t+t),e.fillStyle="#d8b4ff",e.beginPath(),e.arc(n+Math.cos(a)*l,o+Math.sin(a)*l,1.8,0,2*Math.PI),e.fill()}e.globalAlpha=1}}for(let t=0;t<et.length;t++){const a=et[t],l=a.x-r,s=a.y-c;if(a.pulse){const t=a.r||8;e.fillStyle="rgba(157,230,255,.2)",e.beginPath(),e.arc(l,s,1.4*t,0,2*Math.PI),e.fill(),e.strokeStyle=a.c||"#9de6ff",e.lineWidth=2,e.beginPath(),e.arc(l,s,t,0,2*Math.PI),e.stroke(),e.fillStyle="rgba(224,250,255,.88)",e.beginPath(),e.arc(l,s,.34*t,0,2*Math.PI),e.fill()}else e.fillStyle=a.c||"#ffd56d",e.fillRect(l-2|0,s-2|0,4,4)}if(it.on||it.pop>0){const t=it.x-r,a=it.y-c,l=it.on?ht(it.t/Math.max(.001,it.d),0,1):0,s=it.pop>0?ht(it.pop/.55,0,1):0,n=18+1.4*Math.sin(8*S.t)+16*s;e.globalAlpha=.14+.18*(l+s),e.fillStyle="#9fe9ff",e.beginPath(),e.arc(t,a,n+8,0,2*Math.PI),e.fill(),e.globalAlpha=.55+.25*(l+s),e.strokeStyle="#d9f7ff",e.lineWidth=2,e.beginPath(),e.arc(t,a,n,0,2*Math.PI),e.stroke(),e.globalAlpha=1,e.fillStyle="rgba(220,246,255,.85)",e.fillRect(t-5|0,a-7|0,3,3),e.fillRect(t+2|0,a-7|0,3,3)}const T=J.x-r+J.rx,v=J.y-c+J.ry,P=Math.abs(J.vx)>=Math.abs(J.vy)?J.face>0?x.e:x.w:J.vy<0?J.face>0?x.ne:x.nw:J.face>0?x.se:x.sw;if(e.fillStyle="rgba(0,0,0,.35)",e.beginPath(),e.ellipse(T,v+14,17,6,0,0,2*Math.PI),e.fill(),P&&P.complete?e.drawImage(P,T-22,v-18,44,30):(e.fillStyle="#0b0f14",e.beginPath(),e.arc(T,v,12,0,2*Math.PI),e.fill(),e.fillStyle="#ef4f6c",e.fillRect(T+3|0,v-6|0,7,3)),J.bHealFx>0){const t=Math.min(1,J.bHealFx/.7),a=24+2*Math.sin(18*S.t);e.globalAlpha=.18+.26*t,e.fillStyle="#79f2ad",e.beginPath(),e.arc(T,v,a+9*t,0,2*Math.PI),e.fill(),e.globalAlpha=.55+.35*t,e.strokeStyle="#bfffd6",e.lineWidth=2.2,e.beginPath(),e.arc(T,v,a,0,2*Math.PI),e.stroke(),e.globalAlpha=1}if(J.fbFx>0){const t=ht(J.fbFx/.55,0,1),a=42+(1-t)*Math.max(88,.78*J.fbR),l=3===J.fbMode?"rgba(198,183,255,.96)":2===J.fbMode?"rgba(150,236,255,.96)":"rgba(126,225,255,.96)",s=3===J.fbMode?"rgba(239,231,255,.98)":2===J.fbMode?"rgba(208,247,255,.98)":"rgba(219,247,255,.98)",n=3===J.fbMode?"rgba(203,183,255,.92)":2===J.fbMode?"rgba(176,236,255,.9)":"rgba(160,233,255,.92)";if(e.globalAlpha=.08+.18*t,e.fillStyle=l,e.beginPath(),e.arc(T,v,1.08*a,0,2*Math.PI),e.fill(),e.globalAlpha=.56+.34*t,e.strokeStyle=s,e.lineWidth=2.4+1.6*t,e.beginPath(),e.arc(T,v,a,0,2*Math.PI),e.stroke(),e.strokeStyle=n,e.lineWidth=1.8+1.2*t,e.beginPath(),e.arc(T,v,.64*a,0,2*Math.PI),e.stroke(),1===J.fbMode){e.strokeStyle="rgba(209,247,255,.95)",e.lineWidth=1.3+.9*t;for(let t=0;t<7;t++){const l=10*S.t+t*(2*Math.PI/7),s=.34*a,n=a*(.92+.05*Math.sin(6*S.t+t));e.beginPath(),e.moveTo(T+Math.cos(l)*s,v+Math.sin(l)*s),e.lineTo(T+Math.cos(l)*n,v+Math.sin(l)*n),e.stroke()}}else if(3===J.fbMode){e.strokeStyle="rgba(247,238,255,.94)",e.lineWidth=1.4+.8*t;for(let t=0;t<6;t++){const l=Math.PI/6+t*(Math.PI/3),s=.22*a,n=.86*a;e.beginPath(),e.moveTo(T+Math.cos(l)*s,v+Math.sin(l)*s),e.lineTo(T+Math.cos(l)*n,v+Math.sin(l)*n),e.stroke()}e.beginPath();for(let t=0;t<6;t++){const l=Math.PI/6+t*(Math.PI/3),s=T+Math.cos(l)*a*.86,n=v+Math.sin(l)*a*.86;0===t?e.moveTo(s,n):e.lineTo(s,n)}e.closePath(),e.stroke()}e.globalAlpha=1}if(J.bot&&nt.length){for(let t=0;t<nt.length;t++){const a=Xt(0|nt[t].t||1),l=a.body,s=a.ring,n=nt[t],o=n.x-r,i=n.y-c;e.fillStyle="rgba(0,0,0,.25)",e.beginPath(),e.ellipse(o,i+8,11,4,0,0,2*Math.PI),e.fill(),e.fillStyle=l,e.beginPath(),e.arc(o,i,9,0,2*Math.PI),e.fill(),e.fillStyle="#16314a",e.fillRect(o-3|0,i-2|0,2,2),e.fillRect(o+1|0,i-2|0,2,2),e.strokeStyle=s,e.lineWidth=1.2,e.beginPath(),e.arc(o,i,12+1.5*Math.sin(9*S.t+t),0,2*Math.PI),e.stroke(),a.auraR>0&&(e.strokeStyle="rgba(255,231,176,.42)",e.lineWidth=1.5,e.beginPath(),e.arc(o,i,a.auraR*(.84+.08*Math.sin(4*S.t+.7*t)),0,2*Math.PI),e.stroke())}if((J.zt>0||J.slT>0||J.slRecallT>0||J.slLinkT>0)&&nt.length>=2){const t=ht(J.slLinkT/d,0,1),a=Math.max(J.triFx,J.slCharge,J.slFocus,J.slPow*(J.slT>0||J.slRecallT>0||J.slLinkT>0?1:.35),.85*t,.55*J.slComboFx),l=1-ht((Math.max(44,J.slRopeRest||92)-44)/132,0,1),s=J.zt>0?J.zx:J.slT>0||J.slRecallT>0?J.slDx:J.gx,n=J.zt>0?J.zy:J.slT>0||J.slRecallT>0?J.slDy:J.gy,o=4.6*S.t;for(let t=0;t<Math.min(3,nt.length);t++){const i=nt[t],f=i.x-r,h=i.y-c,b=(t-1)*(12+(9+6*(1-l))*a),d=.5*(T+f)+-n*b,m=.5*(v+h)+s*b;e.strokeStyle="rgba(150,238,255,"+(.28+.42*a+.08*l)+")",e.lineWidth=1.8+1.6*a,e.beginPath(),e.moveTo(T,v),e.quadraticCurveTo(d,m,f,h),e.stroke(),e.strokeStyle="rgba(223,252,255,"+(.2+.48*a+.06*l)+")",e.lineWidth=.9+.9*a,e.beginPath(),e.moveTo(T,v),e.quadraticCurveTo(d,m,f,h),e.stroke();const y=(o+.27*t)%1,x=1-y,p=x*x*T+2*x*y*d+y*y*f,g=x*x*v+2*x*y*m+y*y*h;if(e.fillStyle="rgba(219,250,255,"+(.5+.45*a+.04*l)+")",e.beginPath(),e.arc(p,g,1.9+1.1*a,0,2*Math.PI),e.fill(),J.slT>0||J.slRecallT>0||J.slLinkT>0){const t=(i.slx||0)+J.slDx*(28+44*l),s=(i.sly||0)+J.slDy*(28+44*l),n=Math.hypot(t,s)||1,o=f-t/n*(18+10*a),r=h-s/n*(18+10*a);e.strokeStyle="rgba(167,244,255,"+(.22+.44*a+.14*l)+")",e.lineWidth=2.2+.9*a,e.beginPath(),e.moveTo(o,r),e.lineTo(f,h),e.stroke()}}if(J.zt>0&&J.slFocus>0){const t=Math.min(1,J.slFocus),a=30+9*t+1.1*Math.sin(20*S.t);e.strokeStyle=J.slPerfect?"rgba(255,233,160,.95)":"rgba(196,239,255,"+(.35+.45*t)+")",e.lineWidth=1.4+1.6*t,e.beginPath(),e.arc(T,v,a,.5*-Math.PI,.5*-Math.PI+2*Math.PI*t),e.stroke(),J.slPerfect&&(e.fillStyle="rgba(255,240,190,.96)",e.font="700 10px Trebuchet MS,sans-serif",e.fillText("PERFECT",T-22,v-28))}}if(J.bCarry>0){const t=nt[0].x-r,a=nt[0].y-c;e.fillStyle="rgba(6,10,16,.84)",e.beginPath(),e.arc(t+10,a-10,8,0,2*Math.PI),e.fill(),e.fillStyle="#dfffff",e.font="700 10px Trebuchet MS,sans-serif",e.fillText(""+J.bCarry,t+7,a-7)}}if(J.mkS>0&&J.zt<=0){const t=J.face>0?-1:1,a=ht(J.mkS/.32,0,1),l=T+13*t,s=v+8,n=l+t*(11+2.2*Math.sin(36*S.t)),o=s+7+1.1*Math.sin(22*S.t);e.strokeStyle="rgba(248,220,112,"+(.38+.45*a)+")",e.lineWidth=2,e.beginPath(),e.moveTo(l,s),e.quadraticCurveTo(.5*(l+n),s+2,n,o),e.stroke(),e.fillStyle="rgba(250,214,103,.72)",e.beginPath(),e.arc(n+2*t,o+2,2.1,0,2*Math.PI),e.fill(),e.fillStyle="rgba(244,205,93,.38)",e.beginPath(),e.ellipse(n+5*t,o+7,5.2,2.7,0,0,2*Math.PI),e.fill()}if((J.zc>0||J.zcd>0)&&J.zt<=0){const t=J.zcd>0?0:Math.min(1,J.zc/J.zLoad),a=t<=0?Math.max(0,1-J.zcd/J.zCool):0,l=18+8*t+1.2*Math.sin(22*S.t);e.strokeStyle=J.zr?"#8fffe5":"#ffd56d",e.lineWidth=2+1.8*t,e.beginPath(),e.arc(T,v,l,.5*-Math.PI,.5*-Math.PI+2*Math.PI*t),e.stroke(),J.zcd>0&&(e.strokeStyle="rgba(158,200,255,.7)",e.lineWidth=2,e.beginPath(),e.arc(T,v,16,.5*-Math.PI,.5*-Math.PI+2*Math.PI*a),e.stroke())}if(J.zt>0||J.slT>0||J.slRecallT>0||J.slLinkT>0){const t=J.zt>0?J.zt/2:Math.max(.55*J.slPow,.46*ht(J.slLinkT/d,0,1)),a=J.zt>0?J.zx:J.slT>0||J.slRecallT>0?J.slDx:J.gx,l=J.zt>0?J.zy:J.slT>0||J.slRecallT>0?J.slDy:J.gy;if(e.strokeStyle="rgba(143,255,229,.7)",e.lineWidth=2.5,e.beginPath(),e.arc(T,v,20+2*Math.sin(30*S.t)+4*t,0,2*Math.PI),e.stroke(),e.fillStyle="rgba(143,255,229,.16)",e.beginPath(),e.ellipse(T-10*a,v-7*l,20,10,Math.atan2(l,a),0,2*Math.PI),e.fill(),J.zt>0){const t=ht(.04*Math.hypot(J.vx,J.vy),6,22),s=-l,n=a;e.strokeStyle="rgba(200,255,240,.45)",e.lineWidth=1.5;for(let o=0;o<4;o++){const r=9*(o-1.5),i=T-18*a+s*r,f=v-14*l+n*r;e.beginPath(),e.moveTo(i,f),e.lineTo(i-a*t,f-l*t),e.stroke()}}}if(J.slWave>0){const t=J.slWave,a=30+88*(1-t);e.globalAlpha=.06+.16*t,e.fillStyle="rgba(142,238,255,.95)",e.beginPath(),e.arc(T,v,1.08*a,0,2*Math.PI),e.fill(),e.globalAlpha=.74*t,e.strokeStyle="rgba(214,250,255,.96)",e.lineWidth=2+2.4*t,e.beginPath(),e.arc(T,v,a,0,2*Math.PI),e.stroke(),e.globalAlpha=1}if(J.slComboFx>0){const t=Math.min(1,J.slComboFx),a=42+58*(1-t);e.globalAlpha=.07+.2*t,e.fillStyle="rgba(185,244,255,.95)",e.beginPath(),e.arc(T,v,1.1*a,0,2*Math.PI),e.fill(),e.globalAlpha=.2+.45*t,e.strokeStyle="rgba(229,251,255,.96)",e.lineWidth=1.8+1.5*t,e.beginPath(),e.arc(T,v,a,0,2*Math.PI),e.stroke(),e.globalAlpha=1}J.flash>0&&(e.globalAlpha=J.flash/.07,e.fillStyle="#ffe598",e.beginPath(),e.moveTo(T+16*J.gx,v+8*J.gy),e.lineTo(T+24*J.gx-5*J.gy,v+24*J.gy+4*J.gx),e.lineTo(T+24*J.gx+5*J.gy,v+24*J.gy-4*J.gx),e.closePath(),e.fill(),e.globalAlpha=1);for(let t=0;t<st.length;t++){const s=st[t],n=s.x-r,o=s.y-c;n<-8||o<-8||n>a+8||o>l+8||(e.globalAlpha=Math.max(0,Math.min(1,2.4*s.t)),e.fillStyle=s.c,e.fillRect(0|n,0|o,3,3))}e.globalAlpha=1;const C=44,R=a-18-C,z=a<420;let A=62,w=74;const D=Math.max(96,a-190);if(e.fillStyle="rgba(7,10,16,.76)",e.fillRect(10,10,a-20,104),e.fillStyle="#eef4ff",e.font="700 17px Trebuchet MS,sans-serif",e.fillText("SCOTTY",20,32),S.start&&!S.dead){const t=28,l=28,s=a-t-14,n=14;S.pauseBtnX=s,S.pauseBtnY=n,S.pauseBtnW=t,S.pauseBtnH=l,e.fillStyle="rgba(28,42,64,.85)",e.fillRect(s,n,t,l),e.strokeStyle="rgba(140,170,200,.7)",e.lineWidth=1.2,e.strokeRect(s+.5,n+.5,t-1,l-1),e.fillStyle="#9ec8ff",S.paused?(e.beginPath(),e.moveTo(s+.35*t,n+.25*l),e.lineTo(s+.35*t,n+.75*l),e.lineTo(s+.7*t,n+.5*l),e.closePath(),e.fill()):(e.fillRect(s+.3*t,n+.25*l,.15*t,.5*l),e.fillRect(s+.55*t,n+.25*l,.15*t,.5*l))}if(z){const t=52,a=R-8;e.font="600 12px Trebuchet MS,sans-serif",e.fillStyle="#9ec8ff",e.fillText("Time "+S.time.toFixed(1)+"s",20,t),e.fillStyle="#ffd56d",e.fillText(S.bd2?S.kills+"/"+y:"Kills "+S.kills,118,t),S.endWave>0&&(e.fillStyle="#ff9a7a",e.fillText("W"+S.endWave,210,t)),e.textAlign="right",e.fillStyle="#dce8ff",e.fillText("Best "+S.best,a,t),e.textAlign="left",A=62,w=74}else e.font="600 14px Trebuchet MS,sans-serif",e.fillStyle="#9ec8ff",e.fillText("Time "+S.time.toFixed(1)+"s",20,54),e.fillStyle="#ffd56d",e.fillText(S.bd2?S.kills+"/"+y:"Kills "+S.kills,150,54),S.endWave>0&&(e.fillStyle="#ff9a7a",e.fillText("Wave "+S.endWave,280,54)),e.textAlign="right",e.fillStyle="#dce8ff",e.fillText("Best "+S.best,a-24,54),e.textAlign="left";e.fillStyle="#2a3346",e.fillRect(20,A,D,10),e.fillStyle="#ef4f6c",e.fillRect(20,A,D*(J.hp/J.maxHp),10),e.fillStyle="#24374d",e.fillRect(20,w,D,8),e.fillStyle="#69f0c9",e.fillRect(20,w,D*(S.xp/S.nextXp),8);let I=0;for(let t=0;t<tt.length;t++)if(11===tt[t].k){I=tt[t];break}let B=0;for(let t=0;t<tt.length;t++)if(9===tt[t].k){B=tt[t];break}let W=0;for(let t=0;t<tt.length;t++)if(5===tt[t].k){W=tt[t];break}let F=0;for(let t=0;t<tt.length;t++)if(3===tt[t].k){F=tt[t];break}let E=0;for(let t=0;t<tt.length;t++)if(4===tt[t].k){E=tt[t];break}let H=118;if(I&&S.moth){const t=ht(I.hp/(I.moMax||I.hp||1),0,1),l=t>.6?"AWAKENED":t>.25?"FURIOUS":"BERSERK",s=ht(.62*a,260,660),n=14,o=.5*(a-s),r=H+2;e.fillStyle="rgba(14,4,14,.92)",dt(o-10,r-20,s+20,42,11),e.fill(),e.fillStyle="rgba(50,10,50,.95)",e.fillRect(o,r,s,n);const i=e.createLinearGradient(o,0,o+s,0);t>.6?(i.addColorStop(0,"#993399"),i.addColorStop(1,"#cc55cc")):t>.25?(i.addColorStop(0,"#cc33cc"),i.addColorStop(1,"#ee55ee")):(i.addColorStop(0,"#ff22ff"),i.addColorStop(1,"#ff77ff")),e.fillStyle=i,e.fillRect(o,r,s*t,n),e.strokeStyle="rgba(255,100,255,.5)",e.lineWidth=1.2,e.strokeRect(o+.5,r+.5,s-1,n-1),e.fillStyle=t>.25?"#ffaaff":"#ff66ff",e.font="700 12px Trebuchet MS,sans-serif",e.textAlign="center",e.fillText("THE MOTHER // "+l,o+.5*s,r-7),e.textAlign="left",H+=38}if(B&&S.pred){const t=ht(B.hp/(B.prMax||B.hp||1),0,1),l=t>.5?"STALKING":"ENRAGED",s=(B.prCloak||0)>0,n=ht(.6*a,240,640),o=13,r=.5*(a-n),i=H+2;e.fillStyle="rgba(14,4,4,.92)",dt(r-10,i-20,n+20,40,11),e.fill(),e.fillStyle="rgba(60,10,15,.95)",e.fillRect(r,i,n,o);const f=e.createLinearGradient(r,0,r+n,0);t>.5?(f.addColorStop(0,"#bb1122"),f.addColorStop(1,"#ee3344")):(f.addColorStop(0,"#ff2222"),f.addColorStop(1,"#ff6644")),e.fillStyle=f,e.fillRect(r,i,n*t,o),e.strokeStyle="rgba(255,80,80,.5)",e.lineWidth=1.2,e.strokeRect(r+.5,i+.5,n-1,o-1),e.fillStyle=t>.5?"#ffaaaa":"#ff6666",e.font="700 12px Trebuchet MS,sans-serif",e.textAlign="center",e.fillText("THE PREDATOR // "+l+(s?" [CLOAKED]":""),r+.5*n,i-7),e.textAlign="left",H+=36}if(W&&S.mb){const t=ht(W.hp/(W.mbMax||W.hp||1),0,1),l=ht(.48*a,180,500),s=9,n=.5*(a-l),o=H+2;e.fillStyle="rgba(10,14,22,.88)",dt(n-10,o-16,l+20,32,11),e.fill(),e.fillStyle="rgba(50,36,18,.95)",e.fillRect(n,o,l,s);const r=e.createLinearGradient(n,0,n+l,0);r.addColorStop(0,"#cc7a2e"),r.addColorStop(1,"#ffa64d"),e.fillStyle=r,e.fillRect(n,o,l*t,s),e.strokeStyle="rgba(200,180,140,.55)",e.lineWidth=1.2,e.strokeRect(n+.5,o+.5,l-1,s-1),e.fillStyle="#ffe0a0",e.font="700 10px Trebuchet MS,sans-serif",e.textAlign="center",e.fillText("THE PROVOST",n+.5*l,o-5),e.textAlign="left",H+=28}if(F&&S.bs){const t=ht(F.hp/(F.b1Max||F.hp||1),0,1),l=F.b1Eat||0,s=l>20?"THE DEAN // BLOATED":l>12?"THE DEAN // GORGED":l>5?"THE DEAN // HUNGRY":"THE DEAN",n=ht(.54*a,200,560),o=11,r=.5*(a-n),i=H+2;e.fillStyle="rgba(10,14,22,.88)",dt(r-10,i-18,n+20,36,11),e.fill(),e.fillStyle="rgba(40,28,62,.95)",e.fillRect(r,i,n,o);const f=e.createLinearGradient(r,0,r+n,0);l>20?(f.addColorStop(0,"#ff3333"),f.addColorStop(1,"#ff7755")):l>12?(f.addColorStop(0,"#ff5656"),f.addColorStop(1,"#ff9a7a")):l>5?(f.addColorStop(0,"#ffaa44"),f.addColorStop(1,"#ffd58f")):(f.addColorStop(0,"#9a7dff"),f.addColorStop(1,"#c8a0ff")),e.fillStyle=f,e.fillRect(r,i,n*t,o),e.strokeStyle="rgba(200,190,240,.55)",e.lineWidth=1.2,e.strokeRect(r+.5,i+.5,n-1,o-1),e.fillStyle=l>20?"#ffaaaa":l>12?"#ffc4c4":l>5?"#ffe0b3":"#e4d8ff",e.font="700 11px Trebuchet MS,sans-serif",e.textAlign="center",e.fillText(s+(l>0?" ["+l+" mints]":""),r+.5*n,i-7),e.textAlign="left",H+=32}if(E){const t=ht(E.hp/(E.apMax||E.hp||1),0,1),l=E.apPhase||1,s=1===l?"ALPHA":2===l?"RAGE":"OMEGA",n=ht(.58*a,220,620),o=12,r=.5*(a-n),i=H+2;e.fillStyle="rgba(10,14,22,.88)",dt(r-10,i-18,n+20,38,11),e.fill();const f=e.createLinearGradient(0,i,0,i+o);f.addColorStop(0,"rgba(54,71,103,.95)"),f.addColorStop(1,"rgba(30,40,63,.95)"),e.fillStyle=f,e.fillRect(r,i,n,o);const h=e.createLinearGradient(r,0,r+n,0);1===l?(h.addColorStop(0,"#9a7dff"),h.addColorStop(1,"#c8b6ff")):2===l?(h.addColorStop(0,"#d28cff"),h.addColorStop(1,"#ffbfd8")):(h.addColorStop(0,"#ff8bd9"),h.addColorStop(1,"#ffc3f1")),e.fillStyle=h,e.fillRect(r,i,n*t,o),e.strokeStyle="rgba(220,234,255,.65)",e.lineWidth=1.2,e.strokeRect(r+.5,i+.5,n-1,o-1),e.fillStyle="#f4ecff",e.font="700 11px Trebuchet MS,sans-serif",e.textAlign="center",e.fillText("APEX DEAN // "+s,r+.5*n,i-7),e.textAlign="left",H+=34}const L=function(){if(!J.mkOn)return"collect mints "+S.homeGot+"/"+S.homeNeed+" to unlock territory puddles";if(S.inB&&S.safeCampT>=6&&S.safeThreat>=6)return"shelter breached - move out and clear pressure";if(S.won)return"CAMPUS SECURED - you did it!";if(S.moth)return"defeat the mother to secure campus!";if(S.pred)return"defeat the predator!";if(S.kills>=m)return"clear remaining enemies! "+tt.length+" left";if(S.pz&&"nsh"===S.pz.id)return"solve nsh lab sequence";if(S.pz&&"mel"===S.pz.id)return"solve mellon lab sequence";if(S.pz&&"bak"===S.pz.id)return"baker: calm panic waves";if(0===S.sch.nsh)return"reach nsh and request robotics support";if(1===S.sch.nsh)return"complete nsh puzzle to unlock first buddy";if(0===S.sch.mel)return"reach mellon institute and request catalyst support";if(1===S.sch.mel)return"complete mellon puzzle to unlock first catalyst";if(0===S.sch.bak)return S.mbd?"reach baker hall and request psychology support":"keep evac routes clear - eliminate threats";if(1===S.sch.bak)return"baker: stabilize panic waves";if(S.bd2)return S.kills>=2800?"WAVE "+S.endWave+" - "+S.kills+"/"+y+" - something stirs...":S.endWave>0?"WAVE "+S.endWave+" - "+S.kills+"/"+y+" kills":"endless cleanup - "+S.kills+"/"+y+" kills to final boss";if(S.bs2&&Ot(S.chemMask)>=3)return"triple burst! overlap all 3 puddles to storm apex!";if(S.bs2)return"defeat apex dean";if(S.bs)return"defeat dean and keep evac mints out of his reach";if(S.mb)return"defeat the provost!";const t=Ot(S.botMask),e=Ot(S.chemMask),a=Ot(S.psyMask);return 2===S.sch.nsh&&t<Et()?2!==Et()||S.mbd?3!==Et()||S.bs2||S.bd2?"visit nsh for buddy prototype trial":"reach apex phase to unlock final buddy prototype":"push midgame pressure to unlock buddy prototype tier 2":2===S.sch.mel&&e<Ht()?2!==Ht()||S.bd?3!==Ht()||S.bs2||S.bd2?"visit mellon institute for catalyst prototype trial":"reach apex phase to unlock final catalyst":"take down dean to unlock catalyst tier 2":2===S.sch.bak&&a<It()?2===It()&&S.kills<320&&!S.mbd?"stabilize pressure to unlock psych prototype tier 2":3===It()&&S.kills<1e3&&!S.bs2&&!S.bd2?"reach apex phase to unlock final psych prototype":S.labBak>0?"visit baker hall for psych prototype trial":"baker psych prototypes calibrating":(S.labNsh>0?1:0)+(S.labMel>0?1:0)+(S.labBak>0?1:0)>1?"visit schools for prototype upgrades":S.labNsh>0?"visit nsh for buddy prototype":S.labMel>0?"visit mellon institute for catalyst prototype":S.labBak>0?"visit baker hall for psych prototype trial":2!==S.sch.nsh||2!==S.sch.mel||2!==S.sch.bak||S.mb||S.bs||S.bd||S.bs2||S.bd2?2===S.sch.bak&&a>0?"auto "+Dt(J.fbMode)+" - combos ready":!S.bd||S.bs2||S.bd2?"clear routes and protect evac paths - "+S.kills+" threats down":"hold campus perimeter - apex eta "+Math.max(0,S.b2At-S.t).toFixed(1)+"s":function(){if(!tt.length)return"evac routes stable - scout schools for upgrades";const t=Lt();return t.target&&t.count>=6?"clear evac path near "+t.target.n+" - "+t.count+" enemies pressuring":"clear routes and protect evac paths - "+tt.length+" enemies active"}()}();if(e.fillStyle="rgba(8,12,19,.62)",e.fillRect(14,H,a-28,26),e.fillStyle="#d7ffe8",e.font="600 12px Trebuchet MS,sans-serif",e.fillText(L,22,H+17),S.start&&!S.dead){let t=0;if(J.mkOn?0===S.sch.nsh||1===S.sch.nsh?t=gt("nsh"):0===S.sch.mel||1===S.sch.mel?t=gt("mel"):0===S.sch.bak||1===S.sch.bak?t=gt("bak"):S.labNsh>0?t=gt("nsh"):S.labMel>0?t=gt("mel"):S.labBak>0?t=gt("bak"):2!==S.sch.nsh||2!==S.sch.mel||2!==S.sch.bak||S.mb||S.bs||S.bd||S.bs2||S.bd2||(t=function(){const t=Lt();return t.target&&t.count>=5?t.target:function(){if(!tt.length)return 0;let t=0,e=1e18;for(let a=0;a<tt.length;a++){const l=tt[a],s=l.x-J.x,n=l.y-J.y,o=s*s+n*n;o<e&&(e=o,t=l)}return t?{x:t.x,y:t.y,r:22,c:"#ef6f7f",n:"THREATS"}:0}()}()):t=gt("home"),t){const s=t.x-r,n=t.y-c;if(!(s>-t.r&&s<a+t.r&&n>-t.r&&n<l+t.r)){const s=t.x-J.x,n=t.y-J.y,o=Math.atan2(n,s),r=28,i=.5*a,f=.5*l;let h=i+400*Math.cos(o),c=f+400*Math.sin(o);h<r?(c=f+(r-i)/(h-i)*(c-f),h=r):h>a-r&&(c=f+(a-r-i)/(h-i)*(c-f),h=a-r),c<r?(h=i+(r-f)/(c-f)*(h-i),c=r):c>l-r&&(h=i+(l-r-f)/(c-f)*(h-i),c=l-r);const b=Math.hypot(s,n),d=.6+.4*Math.sin(3.6*S.t),m=9+2*d,y=t.c;e.globalAlpha=.18*d,e.fillStyle=y,e.beginPath(),e.arc(h,c,m+6,0,2*Math.PI),e.fill(),e.globalAlpha=.65+.25*d,e.fillStyle=y,e.beginPath(),e.moveTo(h+Math.cos(o)*m,c+Math.sin(o)*m),e.lineTo(h+Math.cos(o+2.5)*m*.7,c+Math.sin(o+2.5)*m*.7),e.lineTo(h+Math.cos(o-2.5)*m*.7,c+Math.sin(o-2.5)*m*.7),e.closePath(),e.fill(),e.globalAlpha=.7,e.fillStyle="#dce8ff",e.font="600 9px Trebuchet MS,sans-serif",e.textAlign="center",e.fillText(t.n,h,c-m-4);const x=b<1e3?(0|b)+"":(b/1e3).toFixed(1)+"k";e.fillText(x,h,c+m+11),e.textAlign="left",e.globalAlpha=1}}}if(J.bot&&nt.length>=2){const t=H+30,l=a-44,s=J.zt>0&&J.slT<=0&&J.slRecallT<=0,n=s?ht(J.slCharge,0,1):J.slT>0?ht(J.slT/.72,0,1):J.slRecallT>0?ht(J.slRecallT/b,0,1):J.slLinkT>0?ht(J.slLinkT/d,0,1):0,o=nt.length>=3?"triple":"duo",r=s?o+" buddy: rope windup":J.slT>0?o+" buddy: blade throw":J.slRecallT>0?o+" buddy: blade recall":J.slLinkT>0?o+" buddy: ropes tightening":o+" buddy: zoomies to arm";e.fillStyle="rgba(8,12,19,.64)",e.fillRect(14,t,a-28,22),e.fillStyle="rgba(48,72,98,.9)",e.fillRect(22,t+8,l,8),e.fillStyle=J.slRecallT>0?"#c9f7ff":J.slT>0?"#8eefff":J.slLinkT>0?"#a8f4ff":"#9fdfff",e.fillRect(22,t+8,l*n,8),e.fillStyle="#d5f2ff",e.font="600 11px Trebuchet MS,sans-serif",e.fillText(r,22,t+16),H+=26}if(S.start&&!S.dead){const t=(t,a,l,s,n,o)=>{if(e.fillStyle="rgba(8,12,19,.92)",e.fillRect(R,t,C,C),e.strokeStyle=s?a:"rgba(129,157,187,.7)",e.lineWidth=2,e.strokeRect(R+.5,t+.5,43,43),e.strokeStyle="rgba(72,88,109,.85)",e.lineWidth=3,e.beginPath(),e.arc(R+22,t+22,14.96,0,2*Math.PI),e.stroke(),e.strokeStyle=a,e.beginPath(),e.arc(R+22,t+22,14.96,.5*-Math.PI,.5*-Math.PI+2*Math.PI*ht(l,0,1)),e.stroke(),e.fillStyle=a,o<1)e.beginPath(),e.moveTo(R+21.56,t+8.36),e.lineTo(R+.35*C,t+23.32),e.lineTo(R+21.56,t+23.32),e.lineTo(R+17.16,t+36.08),e.lineTo(R+29.48,t+18.04),e.lineTo(R+22.44,t+18.04),e.closePath(),e.fill();else if(o<2)e.beginPath(),e.arc(R+22,t+19.36,4.4,0,2*Math.PI),e.fill(),e.beginPath(),e.moveTo(R+22,t+8.8),e.bezierCurveTo(R+30.36,t+19.8,R+28.16,t+29.48,R+22,t+34.32),e.bezierCurveTo(R+15.84,t+29.48,R+13.64,t+19.8,R+22,t+8.8),e.fill();else if(o<3)e.lineWidth=2,e.beginPath(),e.arc(R+22,t+22,.12*C,0,2*Math.PI),e.stroke(),e.beginPath(),e.arc(R+22,t+22,9.68,0,2*Math.PI),e.stroke();else if(o<4)e.lineWidth=1.8,e.beginPath(),e.ellipse(R+22,t+22,9.68,6.6,0,0,2*Math.PI),e.stroke(),e.beginPath(),e.arc(R+22,t+22,.06*C,0,2*Math.PI),e.fill();else{e.lineWidth=1.8;for(let a=0;a<3;a++){const l=a*Math.PI/3;e.beginPath(),e.moveTo(R+22+Math.cos(l)*C*.07,t+22+Math.sin(l)*C*.07),e.lineTo(R+22+Math.cos(l)*C*.27,t+22+Math.sin(l)*C*.27),e.stroke(),e.beginPath(),e.moveTo(R+22-Math.cos(l)*C*.07,t+22-Math.sin(l)*C*.07),e.lineTo(R+22-Math.cos(l)*C*.27,t+22-Math.sin(l)*C*.27),e.stroke()}}n>0?(e.fillStyle="#dce8ff",e.font="700 10px Trebuchet MS,sans-serif",e.fillText(n.toFixed(1)+"s",R+8,t+C-6)):s&&(e.fillStyle="rgba(255,255,255,.8)",e.beginPath(),e.arc(R+C-8,t+8,3,0,2*Math.PI),e.fill())};t(14,"#8fffe5",J.zcd>0?1-J.zcd/J.zCool:J.zr?1:J.zc/J.zLoad,J.zt>0,J.zcd>0?J.zcd:0,0);const a=J.mkOn?J.mkT>0?1-J.mkT/J.mkI:1:0;t(66,J.cat?function(){const t=Ot(S.chemMask);return t>=3?"#5ccba0":2===t?"#7ae88a":1&S.chemMask?"#8fdd73":2&S.chemMask?"#7ad8cd":4&S.chemMask?"#8fb6ff":"#f4d96e"}():"#f4d96e",a,J.mkS>0,J.mkOn&&J.mkT>0?J.mkT:0,1);const l=J.fb?J.fbT>0?1-J.fbT/J.fbI:1:0,s=3===J.fbMode?"#ccb8ff":2===J.fbMode?"#95ebff":"#7edfff",n=3===J.fbMode?4:2===J.fbMode?3:2;J.fb&&t(118,s,l,J.fbFx>0,J.fbT>0?J.fbT:0,n),J.cat&&(e.fillStyle="rgba(7,10,16,.75)",e.fillRect(R-56,78,50,20),e.fillStyle="#dce8ff",e.font="600 10px Trebuchet MS,sans-serif",e.fillText(function(){const t=Ot(S.chemMask);return t>=3?"triple burst":2===t?"dual burst":1&S.chemMask?"acid":2&S.chemMask?"heal":4&S.chemMask?"grav":"chem"}(),R-50,91)),J.fb&&(e.fillStyle="rgba(7,10,16,.75)",e.fillRect(R-72,130,66,20),e.fillStyle="#dce8ff",e.font="600 10px Trebuchet MS,sans-serif",e.fillText(3===(q=J.fbMode)?"freeze":2===q?"mirror":"bark",R-66,143))}var q;if(S.msgT>0&&(e.fillStyle="rgba(8,12,19,.74)",e.fillRect(14,H+30,a-28,28),e.fillStyle="#d7ffe8",e.font="600 13px Trebuchet MS,sans-serif",e.fillText(S.msg,22,H+49)),S.bossDownT>0){const t=ht(S.bossDownT/2.4,0,1),s=.96+.08*Math.sin(18*S.t)*t,n=.5*a,o=.52*l;e.fillStyle="rgba(7,10,16,"+(.2+.26*t)+")",e.fillRect(0,0,a,l),e.save(),e.translate(n,o),e.scale(s,s),e.translate(-n,-o),e.textAlign="center",e.fillStyle="rgba(255,227,143,"+(.44+.4*t)+")",e.font=(a<520?"700 30px":"700 40px")+" Trebuchet MS,sans-serif";const r=S.won?"CAMPUS SECURED":S.moth?"THE MOTHER HAS AWAKENED":!S.predDead||S.bs2||S.bd2?S.bd&&!S.bd2?"THE DEAN IS DOWN":S.mbd&&!S.bd?"THE PROVOST IS DOWN":S.bd2?"APEX DOWN ‚Äî ENDLESS MODE":"BOSS DOWN":"PREDATOR DOWN";e.fillText(r,n,o-8),e.fillStyle="rgba(209,231,255,"+(.58+.32*t)+")",e.font=(a<520?"600 13px":"600 15px")+" Trebuchet MS,sans-serif";const i=S.won?S.kills+" kills - "+S.time.toFixed(1)+"s - scotty saved campus!":S.bd2&&!S.moth?"restore campus flow: "+S.kills+"/"+y+" threats":S.bd?"something big is approaching...":"keep going...";e.fillText(i,n,o+20),e.restore(),e.textAlign="left"}if(S.start&&!S.dead&&!S.lvup&&!S.pz&&$.show>.01){const t=$.x+$.tx,a=$.y+$.ty;e.fillStyle="rgba(7,11,17,"+.42*$.show+")",e.beginPath(),e.arc($.x,$.y,$.r+8,0,2*Math.PI),e.fill(),e.strokeStyle="rgba(158,200,255,"+.45*$.show+")",e.lineWidth=2,e.beginPath(),e.arc($.x,$.y,$.r,0,2*Math.PI),e.stroke(),e.fillStyle="rgba(105,240,201,"+(Q?.65:.42)*$.show+")",e.beginPath(),e.arc(t,a,$.kr,0,2*Math.PI),e.fill(),e.strokeStyle="rgba(220,248,255,"+.65*$.show+")",e.lineWidth=1.5,e.beginPath(),e.arc(t,a,$.kr,0,2*Math.PI),e.stroke()}if(!S.start){const t=20,s=.16*l,n=a-40,o=.68*l,r=t+16;e.fillStyle="rgba(6,9,14,.86)",e.fillRect(t,s,n,o),e.fillStyle="#fff",e.font="700 30px Trebuchet MS,sans-serif",e.fillText("Project: Zoomies",r,s+42),e.fillStyle="#9ec8ff",e.font="600 15px Trebuchet MS,sans-serif",e.fillText("what the dog doing?",r,s+64),e.fillStyle="#d8e6ff",e.font="600 14px Trebuchet MS,sans-serif",yt("Goop swallowed CMU paths. People are trapped inside buildings. Scotty is the only one fast enough to move across campus.",r,s+98,n-32,18,5),e.fillStyle="#9ec8ff",e.font="600 13px Trebuchet MS,sans-serif",yt("Collaborate with school labs (NSH, Mellon, Baker) to keep evacuation routes open and push back the goop across campus in escalating phases.",r,s+200,n-32,17,3),e.fillStyle="#dce8ff",e.font="600 12px Trebuchet MS,sans-serif",yt("Controls: drag to move. Remove finger to charge Zoomies, then move to dash. Catalyst and psych abilities auto-trigger from threat patterns. Buildings are temporary shelters, not permanent safety.",r,s+250,n-32,16,4),e.fillStyle="#69f0c9",e.font="700 23px Trebuchet MS,sans-serif",e.fillText("tap start",r,s+o-22)}if(S.lvup&&!S.dead){e.fillStyle="rgba(6,10,15,.16)",e.fillRect(0,0,a,l);const t=mt(),s=t.bx,n=t.by,o=t.bw,r=t.bh,i=t.rects,f=t.mobile;e.fillStyle="rgba(17,29,45,.95)",dt(s,n,o,r,16),e.fill(),e.strokeStyle="rgba(90,125,163,.8)",e.lineWidth=1.2,dt(s+.5,n+.5,o-1,r-1,16),e.stroke(),e.fillStyle="#ecf3ff",e.font=(f?"700 18px":"700 20px")+" Trebuchet MS,sans-serif",e.fillText("SKILL BOOK",s+14,n+24),e.fillStyle="#9ec8ff",e.font="600 12px Trebuchet MS,sans-serif",e.fillText("choose",s+14,n+39);for(let t=0;t<3;t++){const a=S.choices[t],l=i[t],s=.9+.1*bt(ht((S.cardT-.07*t)/.28,0,1)),n=l.x+.5*l.w,o=l.y+.5*l.h;e.save(),e.translate(n,o),e.scale(s,s),e.translate(-n,-o);const r=a&&a.bg?a.bg:"rgba(27,44,66,.96)",h=a&&a.st?a.st:"rgba(116,150,186,.85)",c=a&&a.tx?a.tx:"#eef5ff",b=a&&a.sub?a.sub:"#a9c3e2";if(e.fillStyle=r,dt(l.x,l.y,l.w,l.h,10),e.fill(),e.strokeStyle=h,e.lineWidth=1.2,dt(l.x+.5,l.y+.5,l.w-1,l.h-1,10),e.stroke(),a){const t=pt(a.n)+" "+a.n;let s=f?16:17;for(;s>12&&(e.font="700 "+s+"px Trebuchet MS,sans-serif",!(e.measureText(t).width<=l.w-22));s--);e.fillStyle=c,e.fillText(t,l.x+12,l.y+30),e.fillStyle=b,e.font="600 12px Trebuchet MS,sans-serif",yt(a.d,l.x+12,l.y+48,l.w-24,14,2)}e.restore()}e.fillStyle="#95bce8",e.font="600 12px Trebuchet MS,sans-serif",e.fillText("tap 1/2/3",s+14,n+r-12)}if(S.pz&&!S.dead&&!S.lvup&&S.start){const t=kt(),s=S.pz;if(e.fillStyle="rgba(5,9,14,.5)",e.fillRect(0,0,a,l),e.fillStyle="rgba(16,24,37,.96)",dt(t.bx,t.by,t.bw,t.bh,14),e.fill(),e.strokeStyle="rgba(106,145,185,.85)",e.lineWidth=1.2,dt(t.bx+.5,t.by+.5,t.bw-1,t.bh-1,14),e.stroke(),e.fillStyle="#ecf3ff",e.font="700 19px Trebuchet MS,sans-serif",e.fillText("nsh"===s.id?"NSH lab":"mel"===s.id?"Mellon lab":"Baker lab",t.bx+14,t.by+27),"nsh"===s.id){e.fillStyle="#dce8ff",e.font="600 12px Trebuchet MS,sans-serif",e.fillText("order",t.bx+14,t.by+66);for(let a=0;a<s.seq.length;a++){const l=t.bx+24+34*a,n=t.by+86,o=a<s.step;e.fillStyle=o?"#8cffc2":"#79d7ff",e.beginPath(),e.arc(l,n,12,0,2*Math.PI),e.fill(),e.fillStyle="#12243a",e.font="700 11px Trebuchet MS,sans-serif",e.fillText(s.seq[a]+1+"",l-3,n+4)}}else if("mel"===s.id){const a=["#8fd3ff","#ffd58f","#ff9fb7"];e.fillStyle="#dce8ff",e.font="600 12px Trebuchet MS,sans-serif",e.fillText("mix",t.bx+14,t.by+66);for(let l=0;l<s.seq.length;l++){const n=t.bx+24+30*l,o=t.by+86,r=l<s.step;e.fillStyle=a[s.seq[l]],e.beginPath(),e.arc(n,o,10,0,2*Math.PI),e.fill(),r&&(e.strokeStyle="#8cffc2",e.lineWidth=2,e.beginPath(),e.arc(n,o,12,0,2*Math.PI),e.stroke())}}else{e.fillStyle="#dce8ff",e.font="600 12px Trebuchet MS,sans-serif",e.fillText("calm waves "+s.hit+"/"+s.need+"  misses "+s.miss+"/"+s.maxMiss,t.bx+14,t.by+66);const a=t.btn[s.lane],l=ht(s.wT/Math.max(.001,s.wMax),0,1),n=16+30*(1-l),o=a.x+.5*a.w,r=a.y+.5*a.h;e.globalAlpha=.16+.24*(1-l),e.fillStyle="#9ec8ff",e.beginPath(),e.arc(o,r,1.06*n,0,2*Math.PI),e.fill(),e.globalAlpha=.8,e.strokeStyle="#d4ecff",e.lineWidth=2.2,e.beginPath(),e.arc(o,r,n,0,2*Math.PI),e.stroke(),e.globalAlpha=1}for(let a=0;a<3;a++){const l=t.btn[a];e.fillStyle="nsh"===s.id?"rgba(37,87,129,.96)":"mel"===s.id?["#3c6588","#9a6f3f","#8e4f64"][a]:a===s.lane?"rgba(67,112,152,.98)":"rgba(33,59,86,.94)",dt(l.x,l.y,l.w,l.h,10),e.fill(),e.strokeStyle="rgba(196,223,255,.72)",e.lineWidth=1.1,dt(l.x+.5,l.y+.5,l.w-1,l.h-1,10),e.stroke(),e.fillStyle="#eef5ff",e.font="700 13px Trebuchet MS,sans-serif",e.fillText("nsh"===s.id?"terminal "+(a+1):"mel"===s.id?["blue","amber","rose"][a]:["north wing","atrium","garden"][a],l.x+9,l.y+28)}e.fillStyle="#9ec8ff",e.font="600 11px Trebuchet MS,sans-serif",e.fillText("tap 1/2/3",t.bx+14,t.by+t.bh-10)}if(S.dead){let t=24,s=.2*l,n=a-48,o=Math.min(.62*l,430);s+o>l-14&&(s=14,o=l-28),e.fillStyle="rgba(5,8,13,.88)",e.fillRect(t,s,n,o);const r=a<420||l<760,i=r?14:16,f=Math.min(210,a-90),h=34,c=.5*(a-f),b=s+o-h-12;S.lbBtnX=c,S.lbBtnY=b,S.lbBtnW=f,S.lbBtnH=h;let d=s+44;if(e.fillStyle="#ff8298",e.font=(r?"700 29px":"700 33px")+" Trebuchet MS,sans-serif",e.fillText("GAME OVER",t+Math.max(10,.5*(n-196)),d),d+=30,e.fillStyle="#dce8ff",e.font="600 20px Trebuchet MS,sans-serif",e.fillText("Kills "+S.kills,t+Math.max(12,.5*(n-86)),d),d+=26,e.fillText("Best "+S.best,t+Math.max(12,.5*(n-74)),d),S.endWave>0&&(d+=26,e.fillStyle="#ff9a7a",e.fillText("Wave "+S.endWave,t+Math.max(12,.5*(n-74)),d)),d+=26,e.fillStyle="#9ec8ff",e.font="600 13px Trebuchet MS,sans-serif",e.fillText("Top 5 global",t+16,d),d+=18,e.font="600 12px Trebuchet MS,sans-serif",S.lbTop.length){for(let a=0;a<S.lbTop.length&&a<5;a++){const l=S.lbTop[a],s=d+a*i,o=a+1+". "+xt(l.name,Math.max(40,n-170));e.fillStyle="#dce8ff",e.textAlign="left",e.fillText(o,t+16,s),e.fillStyle="#bdd8ff",e.textAlign="right",e.fillText(l.kills+" / "+Number(l.time_seconds).toFixed(1)+"s",t+n-16,s)}e.textAlign="left"}else e.fillStyle="#dce8ff",e.fillText(S.lbTopErr||"loading leaderboard...",t+16,d);const m=d+5*i+6;e.fillStyle="#9de6ff",e.font="600 12px Trebuchet MS,sans-serif",e.fillText(xt(S.lbRankText||S.lbRankErr||"checking your rank...",n-32),t+16,m);const y=Math.min(b-8,m+24);e.fillStyle="#69f0c9",e.font=(r?"700 18px":"700 20px")+" Trebuchet MS,sans-serif",e.fillText("tap retry (anywhere)",t+16,y),e.fillStyle="rgba(19,38,58,.95)",dt(c,b,f,h,10),e.fill(),e.strokeStyle="rgba(130,190,255,.9)",e.lineWidth=1.4,dt(c+.5,b+.5,f-1,h-1,10),e.stroke(),e.fillStyle="#9de6ff",e.font="700 15px Trebuchet MS,sans-serif",e.textAlign="center",e.fillText("open leaderboard",c+.5*f,b+22),e.textAlign="left"}if(S.paused&&S.start&&!S.dead){e.fillStyle="rgba(5,8,13,.75)",e.fillRect(0,0,a,l);const t=.5*a,s=.4*l;e.fillStyle="#9ec8ff",e.font="700 42px Trebuchet MS,sans-serif",e.textAlign="center",e.fillText("PAUSED",t,s),e.fillStyle="#dce8ff",e.font="600 16px Trebuchet MS,sans-serif",e.fillText("press ESC or click pause button to resume",t,s+40),e.textAlign="left"}}(),requestAnimationFrame(t)})})();</script></body></html>