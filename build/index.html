<!doctype html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover"><title>Scotty Survival</title><style>:root{--bg:#0a0d12;--sky:#1a2940;--ink:#ecf3ff;--red:#ef4f6c;--mint:#69f0c9;--gold:#ffd56d;--line:#2f4868}*{box-sizing:border-box}html,body{margin:0;width:100%;height:100%;overflow:hidden;background:var(--bg);color:var(--ink);font-family:Trebuchet MS,Avenir Next,Segoe UI,sans-serif}body{touch-action:none}canvas{display:block;width:100%;height:100%}</style></head><body><canvas id="c"></canvas><script>(()=>{const t=document.getElementById("c"),e=t.getContext("2d");let l=360,a=740,n=1,s=0;const i=[{id:"home",n:"Cohon Centre",x:260,y:900,r:170,c:"#8ec0ff"},{id:"nsh",n:"NSH",x:980,y:460,r:170,c:"#79d7ff"},{id:"mel",n:"Mellon Inst",x:1880,y:1260,r:185,c:"#ffd58f"}],r=["i need to go out","these things are scary","may lord help us","can we ever go out?"],o=["a dog?","scotty??","what the dog doing?"],h=180,f={};function c(t){const e=new Image;return e.src="black_scottish_terrier_dog_with_red_scarf/rotations/"+t+".png",e}f.e=c("east"),f.w=c("west"),f.ne=c("north-east"),f.nw=c("north-west"),f.se=c("south-east"),f.sw=c("south-west");let b=0;function m(t,e,l,a){if(!b)return;const n=b.createOscillator(),s=b.createGain();n.type=l||"triangle",n.frequency.value=t,s.gain.value=a||.02,s.gain.exponentialRampToValueAtTime(1e-4,b.currentTime+e),n.connect(s).connect(b.destination),n.start(),n.stop(b.currentTime+e)}let y=0;function d(){if(!x.start)return;const t=performance.now();t-y<1200||(y=t,m(392,.07,"square",.02),m(523,.08,"triangle",.014))}const x={start:0,dead:0,lvup:0,t:0,time:0,kills:0,spawnT:0,nextSpawn:.8,msg:"",msgT:0,level:1,xp:0,nextXp:24,stop:0,shake:0,xpPulse:0,cardT:0,best:+localStorage.ss_best||0,choices:[],homeNeed:2,homeGot:0,sch:{nsh:0,mel:0},pz:0,uq:[],inB:"",bs:0,bd:0,bs2:0,bd2:0,b2At:0,bossDownT:0,botMask:0,chemMask:0,labStep:0,labBank:0,labFlip:0,labNsh:0,labMel:0,labNshRuns:0,labMelRuns:0,stormCd:0},g={x:260,y:900,vx:0,vy:0,r:15,hp:100,maxHp:100,speed:185,fireCd:0,fireRate:.46,dmg:12,range:400,shots:1,magnet:88,face:1,rx:0,ry:0,flash:0,gx:1,gy:0,zc:0,zr:0,zt:0,zx:1,zy:0,zcd:0,zDur:1,zSpd:2.1,zLoad:1.5,zCool:5.5,zDmg:24,zDr:.55,zb:0,zp:0,mkOn:0,mkT:0,mkI:8.8,mkS:0,mkD:14,mkR:54,mkSl:.54,chDo:14,chBurst:10,chHeal:8,chHealCd:0,chHealI:.85,cat:0,catM:0,catType:0,bot:0,botCount:0,botSlots:0,bType:0,bAtk:1,bAuraR:0,bAuraSl:0,bHealCd:0,bHealI:10,bHealAmt:10,bHealFx:0,triA:0,triFx:0,bx:0,by:0,ba:0,bcd:0,bRate:1.9,bDmg:1.15,bRange:480,bFetch:95,bPull:195,bCarry:0,bCarryMax:2,bGrabCd:0,bGrabI:.38,bPier:4,bSize:6},p={l:0,r:0,u:0,d:0,gr:0};let u=-1,M=0;const S={x:78,y:0,r:42,kr:16,tx:0,ty:0,ax:0,ay:0,ttx:0,tty:0,tax:0,tay:0,show:0,act:0},k=[],T=[],z=[],P=[],v=[],w=[],C=[];function I(t,e){return t+Math.random()*(e-t)}function R(t,e,l){return t<e?e:t>l?l:t}function A(t,e,l,a,n,s){const i=n-l,r=s-a;let o=((t-l)*i+(e-a)*r)/(i*i+r*r||1);o=R(o,0,1);const h=t-(l+i*o),f=e-(a+r*o);return h*h+f*f}function q(t,e,l,a,n,s){return(t-n)*(a-s)-(l-n)*(e-s)}function H(t,e,l,a,n,s,i,r){const o=q(t,e,l,a,n,s)<0,h=q(t,e,n,s,i,r)<0,f=q(t,e,i,r,l,a)<0;return o===h&&h===f}function D(t){const e=t-1;return 1+2.70158*e*e*e+1.70158*e*e}function F(t,l,a,n,s){const i=Math.max(0,Math.min(s,.5*Math.min(a,n)));e.beginPath(),e.moveTo(t+i,l),e.lineTo(t+a-i,l),e.quadraticCurveTo(t+a,l,t+a,l+i),e.lineTo(t+a,l+n-i),e.quadraticCurveTo(t+a,l+n,t+a-i,l+n),e.lineTo(t+i,l+n),e.quadraticCurveTo(t,l+n,t,l+n-i),e.lineTo(t,l+i),e.quadraticCurveTo(t,l,t+i,l),e.closePath()}function B(){const t=l<560,e=t?l-14:Math.min(l-20,620),n=t?R(.48*a,296,390):R(.4*a,268,340),s=.5*(l-e),i=a-n-12,r=[];if(t){const t=8,l=e-22,a=Math.max(74,Math.min(100,(n-84-2*t)/3)),o=i+50;for(let e=0;e<3;e++)r.push({x:s+14,y:o+e*(a+t),w:l,h:a})}else{const t=10,l=(e-32-2*t)/3,a=Math.max(102,Math.min(130,n-82)),o=i+52;for(let e=0;e<3;e++)r.push({x:s+16+e*(l+t),y:o,w:l,h:a})}return{mobile:t,bx:s,by:i,bw:e,bh:n,rects:r}}function W(t,l,a,n,s,i){const r=t.split(" ");let o="",h=0;for(let t=0;t<r.length;t++){const f=o?o+" "+r[t]:r[t];if(e.measureText(f).width<=n)o=f;else{if(e.fillText(o,l,a+h*s),h++,h>=i)return;o=r[t]}}h<i&&o&&e.fillText(o,l,a+h*s)}function O(t){return t.includes("Chemical")?"ðŸ§ª":t.includes("Bot")?"ðŸ¤–":t.includes("Shock")||t.includes("Zoomies")?"âš¡":t.includes("Territory")?"ðŸ’§":"â­"}function L(t){for(let e=0;e<i.length;e++)if(i[e].id===t)return i[e];return 0}function N(t,e,l){const a=l||0;for(let l=0;l<i.length;l++){const n=i[l],s=t-n.x,r=e-n.y;if(s*s+r*r<(n.r+a)*(n.r+a))return n}return 0}function G(t,e){const l=e||0;let a=0;for(let e=0;e<i.length;e++){const n=i[e];let s=t.x-n.x,r=t.y-n.y,o=Math.hypot(s,r)||1;const h=n.r+l;if(o<h){if(o<.001){const t=Math.random()*Math.PI*2;s=Math.cos(t),r=Math.sin(t),o=1}t.x=n.x+s/o*h,t.y=n.y+r/o*h,a=1}}return a}function K(){const t=Math.min(l-24,420),e=Math.min(a-130,260),n=.5*(l-t),s=.5*(a-e)+24,i=(t-36-20)/3,r=s+e-72;return{bx:n,by:s,bw:t,bh:e,btn:[{x:n+18,y:r,w:i,h:46},{x:n+18+i+10,y:r,w:i,h:46},{x:n+18+2*(i+10),y:r,w:i,h:46}]}}function E(t){const e=[];let l=-1;for(let a=0;a<t;a++){let t=3*Math.random()|0;t===l&&(t=(t+1+(2*Math.random()|0))%3),e.push(t),l=t}return e}function X(t,e){if(!x.pz)if("lab"===e&&"nsh"===t){const t=1+(x.labNshRuns/2|0),e=3+Math.min(2,t-1);x.pz={id:"nsh",seq:E(e),step:0,lab:1,trial:x.labNshRuns+1,tier:t},x.msg="research",x.msgT=1.2}else if("lab"===e&&"mel"===t){const t=1+(x.labMelRuns/2|0),e=4+Math.min(2,t-1);x.pz={id:"mel",seq:E(e),step:0,lab:1,trial:x.labMelRuns+1,tier:t},x.msg="research",x.msgT=1.2}else if("nsh"===t){const t=3*Math.random()|0,e=(t+1+(2*Math.random()|0))%3;x.pz={id:"nsh",seq:[t,e],step:0},x.msg="research",x.msgT=1.2}else"mel"===t&&(x.pz={id:"mel",seq:[3*Math.random()|0,3*Math.random()|0,3*Math.random()|0],step:0},x.msg="research",x.msgT=1.2)}function Y(t){if(!x.pz)return;const e=x.pz;if(t===e.seq[e.step]){if(e.step++,m(620+70*e.step,.04,"triangle",.018),e.step>=e.seq.length){const t=e.id;x.pz=0,function(t){"nsh"===t&&2!==x.sch.nsh?(x.sch.nsh=2,V("nsh"),x.msg="nsh",x.msgT=2.1,ot(.12),xt(g.x,g.y,"#79d7ff",16,95),m(760,.07,"square",.024)):"nsh"===t&&x.labNsh>0?(x.labNsh--,V("nsh"),x.msg="nsh prototype ready",x.msgT=1.8,ot(.12),xt(g.x,g.y,"#9de6ff",12,72),m(740,.06,"triangle",.022)):"mel"===t&&2!==x.sch.mel?(x.sch.mel=2,V("mel"),x.msg="mel",x.msgT=2.1,ot(.12),xt(g.x,g.y,"#ffd58f",16,95),m(720,.07,"square",.024)):"mel"===t&&x.labMel>0&&(x.labMel--,V("mel"),x.msg="mellon prototype ready",x.msgT=1.8,ot(.12),xt(g.x,g.y,"#b6ef9d",12,72),m(720,.06,"triangle",.022)),lt()}(t),e.lab&&("nsh"===t?x.labNshRuns++:"mel"===t&&x.labMelRuns++)}}else e.step=0,ot(.03),m(180,.06,"square",.02),x.msg="retry",x.msgT=.55}function _(t){"nsh"===t&&0===x.sch.nsh?(x.sch.nsh=1,d(),X("nsh"),x.msg="help",x.msgT=1.4,m(640,.05,"triangle",.02)):"mel"===t&&0===x.sch.mel&&(x.sch.mel=1,d(),X("mel"),x.msg="help",x.msgT=1.4,m(680,.05,"triangle",.02))}function Z(){return 1===g.catType?"acid":2===g.catType?"heal":3===g.catType?"grav":"chem"}function U(){g.cat&&(x.msg="chem: "+Z(),x.msgT=.95,m(1===g.catType?540:2===g.catType?620:470,.04,"triangle",.02))}function V(t){x.uq.indexOf(t)<0&&x.uq.push(t)}function j(t){return(1&t?1:0)+(2&t?1:0)+(4&t?1:0)}const Q={1:{rate:1.15,dmg:1.6,range:620,fetch:72,pull:150,carry:1,grab:.42,pier:5,size:7.2,auraR:0,auraSl:0,healI:0,healAmt:0,pulse:1,col:"#9de6ff",body:"#93d8ff",ring:"#d0efff"},2:{rate:1.72,dmg:.95,range:520,fetch:118,pull:198,carry:2,grab:.34,pier:0,size:3.8,auraR:0,auraSl:0,healI:18,healAmt:10,pulse:0,col:"#7ae8a3",body:"#74de95",ring:"#d9ffe5"},3:{rate:2.45,dmg:.95,range:390,fetch:110,pull:205,carry:2,grab:.34,pier:2,size:8.5,auraR:124,auraSl:.46,healI:0,healAmt:0,pulse:1,col:"#ffd48c",body:"#ffd48c",ring:"#fff0c7"}};function J(t){const e=Q[t]||Q[1],l=Math.max(0,g.bCarryMax-2);return{rate:Math.max(.5,e.rate*(g.bRate/1.9)),dmg:e.dmg*(g.bDmg/1.15),range:e.range*(g.bRange/480),fetch:e.fetch*(g.bFetch/95),pull:e.pull*(g.bPull/195),carry:Math.max(1,e.carry+l),grab:Math.max(.14,e.grab*(g.bGrabI/.38)),pier:Math.max(0,Math.round(e.pier+(g.bPier-4))),size:Math.max(2.8,e.size*(g.bSize/6)),auraR:e.auraR,auraSl:e.auraSl,healI:e.healI,healAmt:e.healAmt,pulse:e.pulse,col:e.col,body:e.body,ring:e.ring}}function $(t){const e=[];for(let l=1;l<=3;l++)t&1<<l-1||e.push(l);return e}function tt(t){return 1===t?{n:"Volt Buddy",d:"striker bot: rapid shock pulses, low cargo",f:()=>st(1),bg:"rgba(29,53,79,.96)",st:"rgba(147,216,255,.88)",tx:"#f1f9ff",sub:"#b3d4ee"}:2===t?{n:"Medic Buddy",d:"green rounds + heals Scotty every 18s",f:()=>st(2),bg:"rgba(24,72,44,.96)",st:"rgba(148,232,171,.9)",tx:"#e9ffef",sub:"#b9e5c6"}:{n:"Guard Buddy",d:"warden bot: slowing aura + sturdy pulse",f:()=>st(3),bg:"rgba(73,50,27,.96)",st:"rgba(255,205,138,.9)",tx:"#fff4df",sub:"#e6cda5"}}function et(t){return 1===t?{n:"Acidic Puddle",d:"corrosive zone: burst + damage over time",f:()=>it(1),bg:"rgba(33,75,34,.96)",st:"rgba(160,236,146,.88)",tx:"#edffe9",sub:"#bce2b3"}:2===t?{n:"Heal Puddle",d:"restorative zone: heals Scotty while inside",f:()=>it(2),bg:"rgba(22,79,72,.96)",st:"rgba(151,242,228,.9)",tx:"#e8fffb",sub:"#b6e7df"}:{n:"Gravity Puddle",d:"black hole zone: drags enemies from far outside",f:()=>it(3),bg:"rgba(30,45,86,.96)",st:"rgba(156,190,255,.9)",tx:"#edf3ff",sub:"#bfd1f0"}}function lt(){for(;x.kills>=30*(x.labStep+1);)x.labStep++,x.labBank++,x.msg="new prototype intel",x.msgT=1.25,m(620,.04,"triangle",.018);for(;x.labBank>0;){const t=x.uq.indexOf("nsh")>=0?1:0,e=x.uq.indexOf("mel")>=0?1:0,l=2===x.sch.nsh&&j(x.botMask)+x.labNsh+t<3,a=2===x.sch.mel&&j(x.chemMask)+x.labMel+e<3;if(!l&&!a)break;let n="";l&&a?(x.labFlip^=1,n=x.labFlip?"nsh":"mel"):n=l?"nsh":"mel","nsh"===n?(x.labNsh++,x.msg="nsh: prototype bench ready",x.msgT=1.6,m(700,.05,"triangle",.02)):(x.labMel++,x.msg="mellon: catalyst bench ready",x.msgT=1.6,m(680,.05,"triangle",.02)),x.labBank--}}function at(t){x.lvup||x.pz||x.uq.length||("nsh"===t&&x.labNsh>0?(X("nsh","lab"),x.msg="nsh: run prototype trial",x.msgT=1.35,m(700,.05,"triangle",.02)):"mel"===t&&x.labMel>0&&(X("mel","lab"),x.msg="mellon: run prototype trial",x.msgT=1.35,m(680,.05,"triangle",.02)))}function nt(){const t=function(){const t=[];for(let e=1;e<=3;e++)x.botMask&1<<e-1&&t.push(e);return t}(),e=g.bot?Math.max(1,Math.min(0|g.botCount,t.length||1)):0;for(;w.length<e;){const e=t[Math.min(t.length-1,w.length)]||1;w.push({x:g.x,y:g.y,t:e,cd:I(.05,.3),grabCd:I(.03,.22)})}for(;w.length>e;)w.pop();for(let e=0;e<w.length;e++)w[e].t=t[Math.min(t.length-1,e)]||w[e].t||1;if(g.botSlots!==e){const t=40;for(let e=0;e<w.length;e++){const l=g.ba+e*(2*Math.PI/Math.max(1,w.length));w[e].x=g.x+Math.cos(l)*t,w[e].y=g.y+Math.sin(l)*t,w[e].cd=I(.05,.3),w[e].grabCd=I(.03,.22)}g.botSlots=e}w.length||(g.bx=g.x+20,g.by=g.y+4,g.botSlots=0)}function st(t){const e=!g.bot;g.bot=1,g.bType=t,g.bx=g.x+20,g.by=g.y+4,g.ba=0,e&&(g.bcd=.45,g.bRate=1.9,g.bDmg=1.15,g.bRange=480,g.bFetch=95,g.bPull=195,g.bCarry=0,g.bCarryMax=2,g.bGrabCd=0,g.bGrabI=.38,g.bPier=4,g.bSize=6,g.bAtk=1,g.bAuraR=0,g.bAuraSl=0,g.bHealCd=0,g.bHealI=10,g.bHealAmt=10,g.bHealFx=0),x.botMask|=1<<t-1,g.botCount=Math.max(1,j(x.botMask)),nt(),lt()}function it(t){g.cat=1,g.catType=t,g.catM=0,g.chDo=14,g.chBurst=10,g.chHeal=8,g.chHealCd=0,g.chHealI=.85,1===t?(g.chDo=20,g.chBurst=13):2===t?(g.chHeal=10,g.chHealI=.85):g.mkSl=Math.max(g.mkSl,.6),x.chemMask|=1<<t-1,lt()}function rt(){if(x.lvup||x.dead||x.pz||!x.uq.length)return;const t=x.uq.shift();if(x.choices=[],"nsh"===t){const t=$(x.botMask);if(1===t.length){const e=t[0];return st(e),x.msg="nsh: "+function(t){return 1===t?"Volt Buddy":2===t?"Medic Buddy":"Guard Buddy"}(e)+" calibrated",x.msgT=1.6,xt(g.x,g.y,"#9de6ff",14,84),void m(760,.06,"triangle",.025)}2===t.length?x.choices=[tt(t[0]),tt(t[1]),{n:"Wildcard Buddy",d:"installs one of the remaining buddy prototypes",f:()=>st(t[Math.random()*t.length|0]),bg:"rgba(42,63,95,.96)",st:"rgba(167,207,255,.86)",tx:"#eef7ff",sub:"#c3d8ef"}]:3===t.length&&(x.choices=[tt(1),tt(2),tt(3)])}else if("mel"===t){const t=$(x.chemMask);if(1===t.length){const e=t[0];return it(e),x.msg="mellon: "+function(t){return 1===t?"Acidic Puddle":2===t?"Heal Puddle":"Gravity Puddle"}(e)+" calibrated",x.msgT=1.6,xt(g.x,g.y,"#b6ef9d",14,84),void m(740,.06,"triangle",.025)}2===t.length?x.choices=[et(t[0]),et(t[1]),{n:"Wildcard Catalyst",d:"mixes one of the remaining catalyst variants",f:()=>it(t[Math.random()*t.length|0]),bg:"rgba(38,76,56,.96)",st:"rgba(159,236,184,.88)",tx:"#eaffef",sub:"#c2ebd0"}]:3===t.length&&(x.choices=[et(1),et(2),et(3)])}x.choices.length&&(x.lvup=1,x.cardT=0,x.msg="up",x.msgT=1.4,m(760,.07,"triangle",.028))}function ot(t){x.shake=R(x.shake+t,0,1.3)}function ht(t){x.stop=Math.max(x.stop,t)}function ft(){n=Math.max(1,Math.min(2,devicePixelRatio||1)),l=Math.max(320,0|innerWidth),a=Math.max(560,0|innerHeight),t.width=l*n|0,t.height=a*n|0,e.setTransform(n,0,0,n,0,0),e.imageSmoothingEnabled=!1;const s=S.r+16;S.act?(S.x=R(S.x,s,l-s),S.y=R(S.y,s,a-s)):(S.x=78,S.y=a-88)}function ct(t,e){let l=t-S.x,a=e-S.y;const n=Math.hypot(l,a)||1,s=S.r;n<10?(l=0,a=0):n>s&&(l=l/n*s,a=a/n*s),S.ttx=l,S.tty=a,S.tax=l/s,S.tay=a/s}function bt(t){S.act=0,S.ttx=0,S.tty=0,S.tax=0,S.tay=0,t&&(S.tx=0,S.ty=0,S.ax=0,S.ay=0,S.show=0)}function mt(t){v.length>=420||v.push(t)}function yt(t){z.length>=260||z.push(t)}function dt(t){T.length>=260||T.push(t)}function xt(t,e,l,a,n){const s=k.length>130?.5:k.length>90?.7:1,i=Math.max(1,a*s|0);for(let a=0;a<i;a++){const a=Math.random()*Math.PI*2,s=(n||70)*(.4+Math.random());mt({x:t,y:e,vx:Math.cos(a)*s,vy:Math.sin(a)*s,t:I(.2,.6),c:l})}}function gt(t,e,l,a,n){const s=k[t],i=!!n;3===s.k?(x.bd=1,x.bs=0,x.b2At=x.t+10,x.msg="boss down: apex incoming",x.msgT=2.6,x.bossDownT=2.4,ht(.09),ot(.55),xt(s.x,s.y,"#ffe38f",44,210),xt(s.x,s.y,"#9de6ff",26,150),m(200,.12,"sawtooth",.038),m(320,.12,"triangle",.024),m(500,.14,"square",.02)):4===s.k&&(x.bd2=1,x.bs2=0,x.msg="apex down",x.msgT=1.8,ot(.32),m(210,.16,"sawtooth",.04)),x.kills++,lt(),i?xt(s.x,s.y,e||"#ff9675",Math.max(2,.35*(l||9)|0),Math.max(20,.6*(a||70))):(ht(.03),ot(.08),xt(s.x,s.y,e||"#ff9675",l||9,a||70),m(280,.03,"square",.012));const r=260-z.length;if(r>0){const t=i?Math.random()<.25?1:0:1+(Math.random()<.4?1:0);for(let e=0;e<Math.min(t,r);e++)yt({x:s.x+I(-7,7),y:s.y+I(-7,7),v:0|I(5,8),m:1,t:0})}k.splice(t,1)}function pt(t,e,l,a,n){(function(t,e,l,a){for(let n=0;n<C.length;n++){const s=C[n],i=e-s.x,r=l-s.y;if(s.k===t&&i*i+r*r<(a+s.r)*(a+s.r)*.22)return 1}return 0})(t,e,l,a)||(C.length>=14&&C.shift(),C.push({k:t,x:e,y:l,r:a,t:n,d:n,pcd:0}),x.msg=function(t){return 1===t?"vortex: pull + melt":2===t?"sanctuary: heal + slow":3===t?"toxic bloom: chip + regen":"campus storm!"}(t),x.msgT=4===t?1.55:1.2,xt(e,l,function(t){return 1===t?"#95f0b8":2===t?"#89ffe8":3===t?"#ccff9b":"#c8f3ff"}(t),4===t?24:14,4===t?126:84),m(4===t?820:1===t?700:2===t?640:680,.06,"triangle",.022))}function ut(t,e,l){P[t]&&(P[t].t=Math.min(P[t].t,.05)),P[e]&&(P[e].t=Math.min(P[e].t,.05)),void 0!==l&&P[l]&&(P[l].t=Math.min(P[l].t,.05))}function Mt(t){if(x.dead=0,x.lvup=0,x.t=0,x.time=0,x.spawnT=0,x.nextSpawn=.8,x.kills=0,x.msg="",x.msgT=0,x.level=1,x.xp=0,x.nextXp=24,x.stop=0,x.shake=0,x.xpPulse=0,x.cardT=0,x.choices=[],x.homeGot=0,x.sch.nsh=0,x.sch.mel=0,x.pz=0,x.uq.length=0,x.inB="",x.bs=0,x.bd=0,x.bs2=0,x.bd2=0,x.b2At=0,x.bossDownT=0,x.botMask=0,x.chemMask=0,x.labStep=0,x.labBank=0,x.labFlip=0,x.labNsh=0,x.labMel=0,x.labNshRuns=0,x.labMelRuns=0,x.stormCd=0,g.x=260,g.y=900,g.vx=0,g.vy=0,g.hp=100,g.maxHp=100,g.speed=185,g.fireCd=0,g.fireRate=.46,g.dmg=12,g.range=400,g.shots=1,g.magnet=88,g.face=1,g.rx=0,g.ry=0,g.flash=0,g.gx=1,g.gy=0,g.zc=0,g.zr=0,g.zt=0,g.zx=1,g.zy=0,g.zcd=0,g.zDur=1,g.zSpd=2.1,g.zLoad=1.5,g.zCool=5.5,g.zDmg=24,g.zDr=.55,g.zb=0,g.zp=0,g.mkOn=0,g.mkT=0,g.mkI=8.8,g.mkS=0,g.mkD=14,g.mkR=54,g.mkSl=.54,g.chDo=14,g.chBurst=10,g.chHeal=8,g.chHealCd=0,g.chHealI=.85,g.cat=0,g.catM=0,g.catType=0,g.bot=0,g.botCount=0,g.botSlots=0,g.bType=0,g.bAtk=1,g.bAuraR=0,g.bAuraSl=0,g.bHealCd=0,g.bHealI=10,g.bHealAmt=10,g.bHealFx=0,g.triA=0,g.triFx=0,g.bx=g.x+20,g.by=g.y+4,g.ba=0,g.bcd=.45,g.bRate=1.9,g.bDmg=1.15,g.bRange=480,g.bFetch=95,g.bPull=195,g.bCarry=0,g.bCarryMax=2,g.bGrabCd=0,g.bGrabI=.38,g.bPier=4,g.bSize=6,k.length=0,T.length=0,z.length=0,P.length=0,v.length=0,w.length=0,C.length=0,p.l=p.r=p.u=p.d=p.gr=0,M=0,bt(1),x.msg="home: unlock",x.msgT=1.6,t){for(let t=0;t<24;t++)yt({x:1300+I(-120,120),y:900+I(-120,120),v:7,m:1,t:0});for(let t=0;t<10;t++)yt({x:330+58*t,y:900+I(-60,60),v:5,m:1,t:0})}}function St(){if(k.length>=h)return;const t=Math.random()*Math.PI*2,e=I(360,560),l=1+.045*x.time;let a=22+8*l+I(-4,8),n=56+6*l+I(-6,10),s=I(12,18),i=8+.9*l,r=0;x.time>8&&Math.random()<.24&&(r=1,n*=1.65,a*=.66,s*=.82,i*=.82),x.time>18&&Math.random()<.18&&(r=2,n*=.74,a*=2.15,s*=1.35,i*=1.28);let o=R(g.x+Math.cos(t)*e,20,2580),f=R(g.y+Math.sin(t)*e,20,1780);const c=N(o,f,10);if(c){const t=o-c.x,e=f-c.y,l=Math.hypot(t,e)||1;o=c.x+t/l*(c.r+18),f=c.y+e/l*(c.r+18)}k.push({x:o,y:f,r:s,hp:a,s:n,dmg:i,vx:0,vy:0,ht:0,sl:0,ce:0,bm:0,bt:0,bi:"",k:r})}function kt(t,e){const l=z[t];if(!l)return;l.bc&&g.bCarry>0&&g.bCarry--,function(t){for(x.xp+=t;x.xp>=x.nextXp;){x.xp-=x.nextXp,x.level++,x.nextXp=1.36*x.nextXp+9|0,zt(),x.lvup=1,x.cardT=0,x.xpPulse=.65,x.msg="upgrade",x.msgT=2.1,ht(.06),ot(.2),m(860,.08,"triangle",.03);break}}(l.v),z.splice(t,1),x.xpPulse=Math.min(.5,x.xpPulse+.11);let a=g.x,n=g.y;if("bot"===e){const t=(0|l.bc)-1,e=t>=0&&t<w.length?w[t]:0;a=e?e.x:g.bx,n=e?e.y:g.by}xt(a,n,"#69f0c9",4,40),g.mkOn||(x.homeGot++,x.homeGot>=x.homeNeed&&(g.mkOn=1,g.mkT=.25,x.msg="open",x.msgT=2.2,m(820,.07,"triangle",.028),xt(g.x,g.y,"#ffd56d",16,95)))}const Tt=[{n:"Rapid Fire",d:"shoot faster",f:()=>g.fireRate=Math.max(.15,.8*g.fireRate),req:()=>1},{n:"Big Bites",d:"more damage",f:()=>g.dmg+=8,req:()=>1},{n:"Speed Paws",d:"move faster",f:()=>g.speed+=30,req:()=>1},{n:"Extra Shot",d:"+1 projectile",f:()=>g.shots=Math.min(5,g.shots+1),req:()=>1},{n:"Snack Magnet",d:"pickup range up",f:()=>g.magnet+=40,req:()=>1},{n:"Tough Fur",d:"+max hp +heal",f:()=>{g.maxHp+=32,g.hp=Math.min(g.maxHp,g.hp+32)},req:()=>1},{n:"Quick Heal",d:"heal now",f:()=>g.hp=Math.min(g.maxHp,g.hp+45),req:()=>1},{n:"Zoomies Time",d:"zoomies lasts longer",f:()=>g.zDur=Math.min(2.6,g.zDur+.32),req:()=>1},{n:"Zoomies CD",d:"zoomies cooldown down",f:()=>g.zCool=Math.max(1.4,g.zCool-.85),req:()=>1},{n:"Zoomies Speed",d:"zoomies speed up",f:()=>g.zSpd=Math.min(4,g.zSpd+.45),req:()=>1},{n:"Zoomies Charge",d:"zoomies charge faster",f:()=>g.zLoad=Math.max(.55,g.zLoad-.24),req:()=>1},{n:"Territory CD",d:"territory cooldown down",f:()=>g.mkI=Math.max(3.2,g.mkI-.68),req:()=>g.mkOn},{n:"Territory Radius",d:"territory area bigger",f:()=>g.mkR=Math.min(110,g.mkR+16),req:()=>g.mkOn},{n:"Territory Duration",d:"territory lasts longer",f:()=>g.mkD=Math.min(40,g.mkD+5),req:()=>g.mkOn},{n:"Territory Slow",d:"territory slows more",f:()=>g.mkSl=Math.min(.88,g.mkSl+.12),req:()=>g.mkOn},{n:"Chemical Puddle",d:"chem damage up",f:()=>{g.chDo=Math.min(58,g.chDo+10),g.chBurst=Math.min(42,g.chBurst+8)},req:()=>g.cat},{n:"Chemical Radius",d:"chem area bigger",f:()=>g.mkR=Math.min(120,g.mkR+13),req:()=>g.cat},{n:"Chemical Tempo",d:"chem cooldown down",f:()=>g.mkI=Math.max(2.6,g.mkI-.58),req:()=>g.cat},{n:"Bot Fetch",d:"bot grabs mints farther away",f:()=>g.bFetch=Math.min(220,g.bFetch+34),req:()=>g.bot},{n:"Bot Cargo",d:"bot carries more mints",f:()=>g.bCarryMax=Math.min(5,g.bCarryMax+1),req:()=>g.bot},{n:"Shock Tempo",d:"shock pulse cooldown down",f:()=>g.bRate=Math.max(.62,.82*g.bRate),req:()=>g.bot&&g.bAtk},{n:"Shock Pierce",d:"pulse pierces more + wider",f:()=>{g.bPier=Math.min(8,g.bPier+1),g.bSize=Math.min(18,g.bSize+1.4)},req:()=>g.bot&&g.bAtk},{n:"Shock Power",d:"shock pulse damage up",f:()=>g.bDmg=Math.min(2.8,g.bDmg+.33),req:()=>g.bot&&g.bAtk}];function zt(){const t=Tt.filter(t=>!t.req||t.req());x.choices=[];for(let e=0;e<3&&t.length;e++){const e=Math.random()*t.length|0;x.choices.push(t[e]),t.splice(e,1)}}function Pt(t){x.lvup&&x.choices[t]&&(x.choices[t].f(),x.lvup=0,x.msg=x.choices[t].n+" applied",x.msgT=1.4,x.xpPulse=.25,ot(.08),xt(g.x,g.y,"#69f0c9",12,90),rt())}function vt(){b||(b=new(window.AudioContext||window.webkitAudioContext)),x.start||(x.start=1,Mt(1),m(430,.05,"triangle",.02))}function wt(e){u===e.pointerId&&(M=0,bt(),t.hasPointerCapture(u)&&t.releasePointerCapture(u),u=-1)}addEventListener("resize",ft),addEventListener("keydown",function(t){const e=t.code;if("Space"!==e&&"ArrowUp"!==e&&"ArrowDown"!==e&&"ArrowLeft"!==e&&"ArrowRight"!==e||t.preventDefault(),"Space"!==e&&"Enter"!==e||vt(),x.dead&&("Space"===e||"Enter"===e||"KeyR"===e))return Mt(1),void m(360,.05,"triangle",.02);x.lvup?"Digit1"===e?Pt(0):"Digit2"===e?Pt(1):"Digit3"===e&&Pt(2):x.pz?"Digit1"===e?Y(0):"Digit2"===e?Y(1):"Digit3"===e&&Y(2):x.start&&!x.dead&&("KeyQ"!==e?"KeyA"===e||"ArrowLeft"===e?p.l=1:"KeyD"===e||"ArrowRight"===e?p.r=1:"KeyW"===e||"ArrowUp"===e?p.u=1:"KeyS"===e||"ArrowDown"===e?p.d=1:"KeyE"!==e&&"ShiftLeft"!==e&&"ShiftRight"!==e||(p.gr=1):U())}),addEventListener("keyup",function(t){const e=t.code;"KeyA"===e||"ArrowLeft"===e?p.l=0:"KeyD"===e||"ArrowRight"===e?p.r=0:"KeyW"===e||"ArrowUp"===e?p.u=0:"KeyS"===e||"ArrowDown"===e?p.d=0:"KeyE"!==e&&"ShiftLeft"!==e&&"ShiftRight"!==e||(p.gr=0)}),t.addEventListener("pointerdown",function(e){if(!(u>=0&&u!==e.pointerId)){if(u=e.pointerId,t.setPointerCapture(u),vt(),x.dead)return Mt(1),void m(360,.05,"triangle",.02);if(x.lvup)!function(t,e){if(!x.lvup)return;const l=B().rects;for(let a=0;a<l.length;a++){const n=l[a];if(t>=n.x&&t<=n.x+n.w&&e>=n.y&&e<=n.y+n.h){Pt(a);break}}}(e.clientX,e.clientY);else{if(x.pz){const t=K();for(let l=0;l<3;l++){const a=t.btn[l];if(e.clientX>=a.x&&e.clientX<=a.x+a.w&&e.clientY>=a.y&&e.clientY<=a.y+a.h)return void Y(l)}return}x.start&&!x.dead&&g.cat&&function(t,e){const a=l-18-44;return t>=a&&t<=a+44&&e>=66&&e<=110}(e.clientX,e.clientY)?U():"mouse"!==e.pointerType&&(M=1,function(t,e){const n=S.r+16;S.x=R(t,n,l-n),S.y=R(e,n,a-n),S.tx=0,S.ty=0,S.ax=0,S.ay=0,S.ttx=0,S.tty=0,S.tax=0,S.tay=0,S.act=1}(e.clientX,e.clientY),ct(e.clientX,e.clientY))}}},{passive:1}),t.addEventListener("pointermove",function(t){u!==t.pointerId||!x.start||x.dead||x.lvup||M&&ct(t.clientX,t.clientY)},{passive:1}),t.addEventListener("pointerup",wt,{passive:1}),t.addEventListener("pointercancel",wt,{passive:1}),ft(),Mt(1),requestAnimationFrame(function t(c){s||(s=c);let b=.001*(c-s);s=c,b=Math.max(0,Math.min(.034,b)),function(t){const e=t;!function(t){const e=1-Math.exp(22*-t),l=1-Math.exp(16*-t);S.tx+=(S.ttx-S.tx)*e,S.ty+=(S.tty-S.ty)*e,S.ax+=(S.tax-S.ax)*e,S.ay+=(S.tay-S.ay)*e,S.show+=((S.act?1:0)-S.show)*l,!S.act&&S.show<.003&&(S.show=0)}(e),x.msgT>0&&(x.msgT-=e),x.bossDownT>0&&(x.bossDownT=Math.max(0,x.bossDownT-e)),x.stormCd>0&&(x.stormCd=Math.max(0,x.stormCd-e)),x.stop>0&&(x.stop=Math.max(0,x.stop-e),t*=.06),x.shake>0&&(x.shake=Math.max(0,x.shake-2.2*e)),x.xpPulse>0&&(x.xpPulse=Math.max(0,x.xpPulse-1.7*e)),g.flash>0&&(g.flash=Math.max(0,g.flash-7*e)),g.zb>0&&(g.zb=Math.max(0,g.zb-e)),g.zp>0&&(g.zp=Math.max(0,g.zp-e)),g.rx*=Math.max(0,1-18*e),g.ry*=Math.max(0,1-18*e),g.zcd>0&&(g.zcd=Math.max(0,g.zcd-e)),g.mkS>0&&(g.mkS=Math.max(0,g.mkS-e)),g.mkT>0&&g.zt<=0&&(g.mkT=Math.max(0,g.mkT-e)),g.bHealFx>0&&(g.bHealFx=Math.max(0,g.bHealFx-e)),g.triFx>0&&(g.triFx=Math.max(0,g.triFx-1.4*e));for(let e=P.length-1;e>=0;e--){const l=P[e];l.t-=t,l.t<=0&&P.splice(e,1)}for(let e=C.length-1;e>=0;e--){const l=C[e];l.t-=t,l.pcd>0&&(l.pcd=Math.max(0,l.pcd-t)),l.t<=0&&C.splice(e,1)}for(let e=v.length-1;e>=0;e--){const l=v[e];l.t-=t,l.x+=l.vx*t,l.y+=l.vy*t,l.vy+=480*t,l.t<=0&&v.splice(e,1)}if(!x.start||x.dead)return;if(x.lvup)return void(x.cardT=Math.min(.9,x.cardT+e));if(x.pz)return void(x.t+=t);x.t+=t;const l=L("nsh"),a=L("mel");g.mkOn&&0===x.sch.nsh&&Math.hypot(g.x-l.x,g.y-l.y)<l.r&&_("nsh"),2===x.sch.nsh&&0===x.sch.mel&&Math.hypot(g.x-a.x,g.y-a.y)<a.r&&_("mel"),2===x.sch.nsh&&x.labNsh>0&&Math.hypot(g.x-l.x,g.y-l.y)<l.r&&at("nsh"),2===x.sch.mel&&x.labMel>0&&Math.hypot(g.x-a.x,g.y-a.y)<a.r&&at("mel"),rt();const n=(p.r?1:0)-(p.l?1:0),s=(p.d?1:0)-(p.u?1:0),i=Math.hypot(S.ax,S.ay);let r=n,o=s;M&&i>.12&&(r+=S.ax,o+=S.ay);let f=Math.hypot(r,o);f>1&&(r/=f,o/=f);const c=(Math.hypot(n,s)>.05||M&&i>.12)&&g.mkS<=0,b=N(g.x,g.y,-6);if(g.mkOn&&g.mkT<=0&&g.mkS<=0&&g.zt<=0&&g.zr<=0&&g.zc<=0&&(P.length>=18&&P.shift(),P.push({x:g.x+4*g.gx,y:g.y+8,r:g.mkR,t:g.mkD,d:g.mkD,m:g.cat?g.catType||1:0}),g.mkS=.32,g.mkT=g.mkI,x.msg="territory",x.msgT=.7,ht(.02),ot(.05),xt(g.x,g.y+8,"#ffd56d",10,46),m(560,.04,"triangle",.02)),function(){const t=[];for(let e=0;e<P.length;e++){const l=P[e];l.t>.08&&l.m>=1&&l.m<=3&&t.push(e)}if(t.length<2)return;if(x.stormCd<=0&&t.length>=3)for(let e=0;e<t.length-2;e++){const l=P[t[e]];for(let a=e+1;a<t.length-1;a++){const n=P[t[a]];for(let s=a+1;s<t.length;s++){const i=P[t[s]];if(14!=(1<<l.m|1<<n.m|1<<i.m))continue;const r=Math.hypot(l.x-n.x,l.y-n.y),o=Math.hypot(n.x-i.x,n.y-i.y),h=Math.hypot(i.x-l.x,i.y-l.y);if(r>.72*(l.r+n.r)||o>.72*(n.r+i.r)||h>.72*(i.r+l.r))continue;const f=(l.x+n.x+i.x)/3,c=(l.y+n.y+i.y)/3,b=Math.min(138,(l.r+n.r+i.r)/3+30);pt(4,f,c,b,4.8),x.stormCd=8,ut(t[e],t[a],t[s]);for(let t=k.length-1;t>=0;t--){const e=k[t],l=e.x-f,a=e.y-c;if(l*l+a*a<b*b*1.2){const n=Math.hypot(l,a)||1;e.hp-=2.4*g.chBurst+1.2*g.chDo,e.ht=.2,e.vx+=l/n*320,e.vy+=a/n*320,e.hp<=0&&gt(t,"#c8f3ff",12,96,1)}}return}}}const e={};for(let l=0;l<t.length-1;l++){const a=t[l];if(e[a])continue;const n=P[a];for(let s=l+1;s<t.length;s++){const l=t[s];if(e[l])continue;const i=P[l];if(n.m===i.m)continue;if(Math.hypot(n.x-i.x,n.y-i.y)>.66*(n.r+i.r))continue;const r=Math.min(n.m,i.m),o=Math.max(n.m,i.m),h=1===r&&3===o?1:2===r&&3===o?2:3;pt(h,.5*(n.x+i.x),.5*(n.y+i.y),Math.min(122,.44*(n.r+i.r)+18),1===h?5.4:2===h?6.1:5.8),ut(a,l),e[a]=1,e[l]=1;break}}}(),g.zt<=0)if(!b&&!c&&g.zcd<=0&&g.mkS<=0){if(g.zc=Math.min(g.zLoad,g.zc+t),g.zc>.25){const e=g.zc/g.zLoad;g.rx+=.9*(2*Math.random()-1)*e*60*t,g.ry+=.9*(2*Math.random()-1)*e*60*t,ot(7e-4*e*60*t)}g.zc>=g.zLoad&&!g.zr&&(g.zr=1,x.msg="zoomies ready",x.msgT=1.1,ot(.08),m(760,.05,"triangle",.024))}else if(g.zr){g.zt=g.zDur,g.zr=0,g.zc=0;const t=f||1;g.zx=r/t,g.zy=o/t,ht(.04),ot(.28),g.flash=.09,g.gx=g.zx,g.gy=g.zy,xt(g.x,g.y,"#9dffea",18,120),m(980,.06,"square",.028)}else g.zc=0;if(g.zt>0){if(g.zt=Math.max(0,g.zt-t),c){g.zx=.85*g.zx+.15*r,g.zy=.85*g.zy+.15*o;const t=Math.hypot(g.zx,g.zy)||1;g.zx/=t,g.zy/=t}const e=g.zb>0?1.35:1;g.vx=g.zx*g.speed*g.zSpd*e,g.vy=g.zy*g.speed*g.zSpd*e,g.face=g.vx>=0?1:-1,g.rx-=8*g.zx*t*60,g.ry-=6*g.zy*t*60,Math.random()<.65&&mt({x:g.x-I(-6,6),y:g.y-I(-6,6),vx:.12*-g.vx+I(-35,35),vy:.12*-g.vy+I(-35,35),t:I(.1,.25),c:"#8fffe5"}),g.zt<=0&&(g.zcd=g.zCool,x.msg="zoomies cd",x.msgT=.65,m(420,.04,"triangle",.016))}else g.vx=r*g.speed,g.vy=o*g.speed,Math.abs(g.vx)>.5&&(g.face=g.vx>0?1:-1),g.mkS>0&&(g.rx+=.5*Math.sin(45*x.t),Math.random()<.7&&mt({x:g.x+I(-5,5),y:g.y+10+I(-3,3),vx:I(-14,14),vy:I(6,30),t:I(.12,.26),c:"#ffd56d"}));if(g.x=R(g.x+g.vx*t,12,2588),g.y=R(g.y+g.vy*t,12,1788),g.zt>0&&g.zp<=0)for(let t=0;t<P.length;t++){const e=P[t],l=g.x-e.x,a=g.y-e.y;if(l*l+a*a<e.r*e.r){g.zp=.22,g.zb=.48,xt(g.x,g.y,"#8fffe5",8,95),m(740,.03,"triangle",.02);for(let t=k.length-1;t>=0;t--){const l=k[t],a=l.x-e.x,n=l.y-e.y;a*a+n*n<e.r*e.r&&(l.hp-=2.2*g.zDmg,l.ht=.13,l.vx+=260*g.zx,l.vy+=260*g.zy,l.hp<=0&&gt(t,"#8fffe5",10,80,1))}break}}const y=N(g.x,g.y,-6);y||(x.time+=t);const d=y?y.id:"";if(x.inB=d,2===g.catType){g.chHealCd>0&&(g.chHealCd=Math.max(0,g.chHealCd-t));let e=0;for(let t=0;t<P.length;t++){const l=P[t],a=g.x-l.x,n=g.y-l.y;if(2===l.m&&a*a+n*n<l.r*l.r){e=1;break}}if(e&&g.chHealCd<=0&&g.hp<g.maxHp){const t=Math.min(g.chHeal,g.maxHp-g.hp);g.hp+=t,g.chHealCd=g.chHealI,xt(g.x,g.y,"#7fe8dd",8,52),x.msg="heal +"+(0|t),x.msgT=.65}}let u=0,q=0,D=0;for(let t=0;t<C.length;t++){const e=C[t],l=g.x-e.x,a=g.y-e.y;l*l+a*a<e.r*e.r&&(2===e.k?(!D||e.t>D.t)&&(D=e):3===e.k?u=1:4===e.k&&(q=1))}if(D&&D.pcd<=0&&g.hp<g.maxHp){const t=Math.min(10,g.maxHp-g.hp);g.hp+=t,D.pcd=1.6,xt(g.x,g.y,"#95ffe8",10,70),x.msg="well +"+(0|t),x.msgT=.6}if(u&&g.hp<g.maxHp){const e=Math.min(g.maxHp-g.hp,1.6*t);e>0&&(g.hp+=e)}if(q&&g.hp<g.maxHp){const e=Math.min(g.maxHp-g.hp,6*t);e>0&&(g.hp+=e)}let F=0;if(g.bot&&g.botCount>0){nt(),F=g.zt>0&&w.length>=3,g.ba+=t*(F?5.8:2.3),F&&(g.triA+=11.8*t);for(let e=0;e<w.length;e++){const l=w[e];let a=0,n=0;if(F&&e<3){const t=g.triA+e*(2*Math.PI/3),l=78+4.4*Math.sin(12*x.t+e);a=g.x+Math.cos(t)*l,n=g.y+Math.sin(t)*l}else{const t=g.ba+e*(2*Math.PI/w.length),l=38+2*Math.sin(2*x.t+.7*e);a=g.x+Math.cos(t)*l,n=g.y+Math.sin(t)*l}l.x+=(a-l.x)*Math.min(1,8*t),l.y+=(n-l.y)*Math.min(1,8*t),l.grabCd>0&&(l.grabCd=Math.max(0,l.grabCd-t))}F&&(g.triFx=Math.min(1,g.triFx+4*t)),g.bx=w[0].x,g.by=w[0].y;let e=0,l=18,a=10;for(let t=0;t<w.length;t++)if(2==(0|w[t].t)){const t=J(2);e=1,l=Math.min(l,t.healI||18),a=Math.max(a,t.healAmt||10)}if(e&&(g.bHealCd>0&&(g.bHealCd=Math.max(0,g.bHealCd-t)),g.bHealCd<=0&&g.hp<g.maxHp)){const t=Math.min(a,g.maxHp-g.hp);g.hp+=t,g.bHealCd=l,g.bHealFx=.7,x.msg="medic +"+(0|t),x.msgT=.9,xt(g.x,g.y,"#84f0a6",10,62),m(760,.05,"triangle",.018)}if(!y&&g.bAtk)for(let e=0;e<w.length;e++){const l=w[e],a=J(0|l.t||1);if(l.cd-=t,l.cd>0)continue;let n=0,s=a.range*a.range;for(let t=0;t<k.length;t++){const e=k[t],a=e.x-l.x,i=e.y-l.y,r=a*a+i*i;r<s&&(s=r,n=e)}if(n){const t=Math.hypot(n.x-l.x,n.y-l.y)||1,e=!!a.pulse,s=a.col,i=a.pier;dt({x:l.x,y:l.y,vx:(n.x-l.x)/t*420,vy:(n.y-l.y)/t*420,d:g.dmg*a.dmg,life:1.35,pier:i,c:s,r:a.size,pulse:e}),l.cd=a.rate,xt(l.x,l.y,s,4,36)}else l.cd=.35}}else w.length=0,g.bCarry=0,g.botSlots=0,F=0;g.fireCd-=t,!y&&g.fireCd<=0&&(g.fireCd=g.fireRate,function(){const t=function(){let t=0,e=1e9;for(let l=0;l<k.length;l++){const a=k[l],n=a.x-g.x,s=a.y-g.y,i=n*n+s*s;i<e&&(e=i,t=a)}return t}();if(!t)return;let e=t.x-g.x,l=t.y-g.y,a=Math.hypot(e,l)||1;if(a>g.range)return;e/=a,l/=a;const n=g.shots;for(let t=0;t<n;t++){const a=1===n?0:.18*(t-(n-1)/2),s=Math.cos(a),i=Math.sin(a),r=e*s-l*i,o=e*i+l*s;dt({x:g.x,y:g.y,vx:520*r,vy:520*o,d:g.dmg,life:1.05,pier:1})}g.gx=e,g.gy=l,g.rx-=6*e,g.ry-=4*l,g.flash=.07,g.face=e>=0?1:-1,xt(g.x+16*e,g.y+10*l,"#ffd56d",3,35),ot(.025),m(640,.04,"square",.018)}()),x.spawnT-=t;const B=x.kills>26||x.time>52;2===x.sch.mel&&!x.bs&&!x.bd&&!x.bs2&&!x.bd2&&x.kills>=20&&B&&function(){if(x.bs||x.bd||x.bs2||x.bd2||k.length>=h)return;const t=Math.random()*Math.PI*2,e={x:R(g.x+520*Math.cos(t),40,2560),y:R(g.y+520*Math.sin(t),40,1760),r:35,hp:640+11*x.time,s:46,dmg:24,vx:0,vy:0,ht:0,sl:0,ce:0,bm:0,bt:0,bi:"",k:3};G(e,28),k.push(e),x.bs=1,x.msg="boss!",x.msgT=1.2,m(170,.15,"sawtooth",.03),ot(.2)}(),x.bd&&!x.bs2&&!x.bd2&&x.t>=x.b2At&&function(){if(x.bs2||x.bd2||k.length>=h)return;const t=Math.random()*Math.PI*2,e={x:R(g.x+560*Math.cos(t),44,2556),y:R(g.y+560*Math.sin(t),44,1756),r:42,hp:980+16*x.time,s:52,dmg:30,vx:0,vy:0,ht:0,sl:0,ce:0,bm:0,bt:0,bi:"",k:4,apCd:I(2.2,3.4)};G(e,36),k.push(e),x.bs2=1,x.msg="apex boss!",x.msgT=1.5,m(120,.2,"sawtooth",.04),ot(.34)}(),x.spawnT<=0&&(x.spawnT=x.nextSpawn,x.nextSpawn=Math.max(.18,.78-.018*x.time),St(),!x.bs&&!x.bs2&&x.time>26&&Math.random()<.28&&St());for(let e=T.length-1;e>=0;e--){const l=T[e];if(l.life-=t,l.x+=l.vx*t,l.y+=l.vy*t,l.life<=0||l.x<-20||l.y<-20||l.x>2620||l.y>1820)T.splice(e,1);else for(let t=k.length-1;t>=0;t--){const a=k[t],n=a.x-l.x,s=a.y-l.y,i=l.r||3;if(n*n+s*s<(a.r+i)*(a.r+i)&&(a.hp-=l.d,a.ht=l.pulse?.12:.09,a.vx+=l.vx*(l.pulse?.11:.07),a.vy+=l.vy*(l.pulse?.11:.07),l.pulse&&xt(a.x,a.y,"#9de6ff",3,28),l.pier--,a.hp<=0&&gt(t,l.pulse?"#9de6ff":"#ff9675",l.pulse?7:9,l.pulse?58:70,l.pulse?1:0),l.pier<0)){T.splice(e,1);break}}}let W=0,O=0,K=0;const E=y;for(let e=k.length-1;e>=0;e--){const l=k[e];let a=g.x,n=g.y;if(E)if(l.bi!==E.id&&(l.bi=E.id,l.bm=0,l.bt=I(.9,1.7)),l.bt-=t,l.bt<=0&&(0===l.bm?(l.bm=1,l.bt=I(1.1,2.1)):(l.bm=0,l.bt=I(.9,1.7))),0===l.bm){const t=g.x-E.x,e=g.y-E.y,l=Math.hypot(t,e)||1;a=E.x+t/l*(E.r+8),n=E.y+e/l*(E.r+8)}else{const t=l.x-E.x,s=l.y-E.y,i=Math.hypot(t,s)||1;a=l.x+t/i*220+-s/i*Math.sin(2*x.t+e)*30,n=l.y+s/i*220+t/i*Math.sin(2*x.t+e)*30}else l.bi="",l.bt=0,l.bm=0;if(4===l.k){if(l.apCd||(l.apCd=I(2.2,3.4)),l.apCd-=t,l.apCd<=0){l.apCd=I(2,3.1);const t=g.x-l.x,e=g.y-l.y,a=Math.hypot(t,e)||1;if(l.vx+=t/a*280,l.vy+=e/a*280,k.length<179)for(let t=0;t<2&&k.length<h;t++){const t=Math.random()*Math.PI*2,e=I(26,54),a={x:R(l.x+Math.cos(t)*e,20,2580),y:R(l.y+Math.sin(t)*e,20,1780),r:I(11,16),hp:40+3*x.time,s:80+I(-8,16),dmg:11+.22*x.time,vx:0,vy:0,ht:0,sl:0,ce:0,bm:0,bt:0,bi:"",k:1};G(a,8),k.push(a)}xt(l.x,l.y,"#b59bff",16,120),ot(.16),ht(.03),m(155,.08,"sawtooth",.03)}if(!y){const e=l.x-g.x,a=l.y-g.y,n=Math.hypot(e,a)||1;if(n<280){const l=95*(1-n/280);g.x=R(g.x+e/n*l*t,12,2588),g.y=R(g.y+a/n*l*t,12,1788),g.rx-=e/n*1.3,g.ry-=a/n*1.1}}}const s=a-l.x,i=n-l.y,r=Math.hypot(s,i)||1;let o=1,f=0,c=0,b=0;for(let e=0;e<C.length;e++){const a=C[e],n=l.x-a.x,s=l.y-a.y,i=n*n+s*s;if(1===a.k){const e=1.9*a.r;if(i<e*e){const r=Math.sqrt(i)||1,h=1-r/e,f=120+h*h*390;l.vx+=-n/r*f*t,l.vy+=-s/r*f*t,o=Math.min(o,.8),i<a.r*a.r&&(o=Math.min(o,.48),b+=.95*g.chDo+7)}continue}if(!(i>=a.r*a.r))if(2===a.k)o=Math.min(o,.5);else if(3===a.k)o=Math.min(o,.72),b+=.75*g.chDo+4;else if(4===a.k){const e=Math.sqrt(i)||1,r=1-e/a.r,h=170+r*r*420;l.vx+=-n/e*h*t,l.vy+=-s/e*h*t,o=Math.min(o,.28),b+=2.1*g.chDo+22,(l.sc||0)<=0&&(l.sc=.24,xt(l.x,l.y,"#c8f3ff",4,34))}}l.sc>0&&(l.sc=Math.max(0,l.sc-t));for(let e=0;e<P.length;e++){const a=P[e],n=l.x-a.x,s=l.y-a.y,i=n*n+s*s,r=0|a.m;if(3===r){const e=2.35*a.r;if(i<e*e){const r=Math.sqrt(i)||1,h=1-r/e,b=90+h*h*350;l.vx+=-n/r*b*t,l.vy+=-s/r*b*t,o=Math.min(o,.88),i<a.r*a.r&&(c=3,o=Math.min(o,.42),f=1)}continue}if(i<a.r*a.r){c=r;const t=1===c?.3:2===c?.18:g.mkSl;o=Math.min(o,1-t),f=1,1===c&&g.cat&&l.ce<=0&&(l.ce=.55,l.hp-=g.chBurst,xt(l.x,l.y,"#ffd58f",5,44));break}}if(g.bot&&w.length)for(let t=0;t<w.length;t++){const e=w[t],a=l.x-e.x,n=l.y-e.y,s=a*a+n*n,i=J(0|e.t||1);s<400&&(o=Math.min(o,.65)),i.auraR>0&&s<i.auraR*i.auraR&&(o=Math.min(o,1-i.auraSl))}if(F&&w.length>=3){const a=w[0],n=w[1],s=w[2],i=l.r+20,r=i*i,h=A(l.x,l.y,a.x,a.y,n.x,n.y)<r||A(l.x,l.y,n.x,n.y,s.x,s.y)<r||A(l.x,l.y,s.x,s.y,a.x,a.y)<r,f=H(l.x,l.y,a.x,a.y,n.x,n.y,s.x,s.y);if((h||f)&&(o=Math.min(o,.52),(l.tc||0)<=0)){const t=g.zDmg*(l.k>=3?.58:.92);l.hp-=t,l.ht=.16;const a=l.x-g.x,n=l.y-g.y,s=Math.hypot(a,n)||1;if(l.vx+=a/s*360,l.vy+=n/s*360,l.tc=.09,O++,xt(l.x,l.y,"#8eefff",5,52),l.hp<=0){gt(e,"#8eefff",11,88,1),K++;continue}}l.tc>0&&(l.tc=Math.max(0,l.tc-t))}if(l.sl=f,f){const a=g.cat&&1===c?g.chDo:0;if(a>0&&(l.hp-=a*t),l.ht=Math.max(l.ht,.08),l.hp<=0){gt(e,"#f7d96b",8,60);continue}}if(b>0&&(l.hp-=b*t,l.ht=Math.max(l.ht,.11),l.hp<=0)){gt(e,"#c8f3ff",10,76,1);continue}l.ce>0&&(l.ce=Math.max(0,l.ce-t)),l.vx*=Math.max(0,1-8*t),l.vy*=Math.max(0,1-8*t),l.ht=Math.max(0,l.ht-t),l.x+=(s/r*l.s*o+l.vx)*t,l.y+=(i/r*l.s*o+l.vy)*t,G(l,6)&&(l.vx*=.4,l.vy*=.4);const d=g.x-l.x,p=g.y-l.y;if((Math.hypot(d,p)||1)<l.r+g.r-1){if(g.zt>0){if(l.hp-=g.zDmg,l.ht=.12,l.vx+=280*g.zx,l.vy+=280*g.zy,O++,l.hp<=0){gt(e,"#8fffe5",12,90,1),K++;continue}W+=.35*l.dmg;continue}W+=l.dmg}}var X;O>0&&(ht(Math.min(.04,.012*O)),ot(Math.min(.24,.04*O)),x.xpPulse=Math.min(.6,x.xpPulse+.06*O),m(260,.02,"square",.016),K>1&&m(310,.02,"square",.013)),W>0&&(X=W*t,g.zt>0&&(X*=g.zDr),g.hp-=X,ot(.03),g.hp<=0&&(g.hp=0,x.dead=1,x.start=1,x.kills>x.best&&(x.best=0|x.kills,localStorage.ss_best=x.best),x.msg="swarmed",x.msgT=999,ht(.09),ot(.42),m(120,.22,"sawtooth",.05),xt(g.x,g.y,"#ff6f89",26,130)));for(let e=z.length-1;e>=0;e--){const l=z[e],a=g.x-l.x,n=g.y-l.y,s=Math.hypot(a,n)||1;if(g.bot&&w.length)if(l.bc){const e=(0|l.bc)-1,a=e>=0&&e<w.length?w[e]:w[0],n=J(0|a.t||1),s=a.x-l.x,i=a.y-l.y,r=Math.hypot(s,i)||1,o=Math.min(1.3*n.pull,13*r);l.x+=s/r*o*t,l.y+=i/r*o*t}else{let e=0;for(let t=0;t<w.length;t++)e+=J(0|w[t].t||1).carry;if(g.bCarry<e&&s>1.45*g.magnet)for(let e=0;e<w.length;e++){const a=w[e];if(a.grabCd>0)continue;const n=J(0|a.t||1),s=a.x-l.x,i=a.y-l.y,r=Math.hypot(s,i)||1;if(r<n.fetch){l.x+=s/r*n.pull*t,l.y+=i/r*n.pull*t,r<10&&(l.bc=e+1,g.bCarry++,a.grabCd=n.grab,xt(l.x,l.y,"#9de6ff",3,24));break}}}s<g.magnet&&(l.x+=a/s*240*t,l.y+=n/s*240*t),s<g.r+8&&kt(e,l.bc?"bot":"player")}(p.gr||M)&&Math.random()<.04&&x.time>2&&yt({x:R(g.x+I(-20,20),12,2588),y:R(g.y+I(-20,20),12,1788),v:4,m:1,t:0})}(b),function(){const t=x.shake*x.shake,s=10*(2*Math.random()-1)*t,h=10*(2*Math.random()-1)*t;e.setTransform(n,0,0,n,s,h);const c=R(g.x-.5*l,0,2600-l),b=R(g.y-.5*a,0,1800-a),m=e.createLinearGradient(0,0,0,a);m.addColorStop(0,"#263f60"),m.addColorStop(.55,"#16273f"),m.addColorStop(1,"#0b111a"),e.fillStyle=m,e.fillRect(0,0,l,a),e.strokeStyle="rgba(63,96,132,.35)",e.lineWidth=1;const y=-c%56;for(let t=-b%56;t<a;t+=56)e.beginPath(),e.moveTo(0,0|t),e.lineTo(l,0|t),e.stroke();for(let t=y;t<l;t+=56)e.beginPath(),e.moveTo(0|t,0),e.lineTo(0|t,a),e.stroke();const d=1300-c,p=900-b;e.fillStyle="rgba(105,240,201,.07)",e.beginPath(),e.arc(d,p,210,0,2*Math.PI),e.fill();const u=N(g.x,g.y,-8);for(let t=0;t<i.length;t++){const n=i[t],s=n.x-c,h=n.y-b;if(s<-n.r-30||h<-n.r-30||s>l+n.r+30||h>a+n.r+30)continue;const f="home"===n.id?0:2===x.sch[n.id],m="home"===n.id?!g.mkOn:1===x.sch[n.id]||"nsh"===n.id&&(0===x.sch.nsh||2===x.sch.nsh&&x.labNsh>0)||"mel"===n.id&&(2===x.sch.nsh&&0===x.sch.mel||2===x.sch.mel&&x.labMel>0);e.globalAlpha=f?.18:m?.14:.08,e.fillStyle=n.c,e.beginPath(),e.arc(s,h,n.r,0,2*Math.PI),e.fill(),e.globalAlpha=.65,e.strokeStyle=f?"#9effc8":n.c,e.lineWidth=2,e.beginPath(),e.arc(s,h,n.r,0,2*Math.PI),e.stroke(),e.globalAlpha=1,e.fillStyle="#dce8ff",e.font="600 12px Trebuchet MS,sans-serif",e.fillText(n.n,s-n.r+10,h-n.r-8);const y="home"===n.id?48:44,d=30,p=s-.5*y,M=h-.5*d;if(e.fillStyle="rgba(18,25,37,.9)",e.fillRect(p,M,y,d),e.strokeStyle="rgba(165,190,220,.55)",e.lineWidth=1,e.strokeRect(p+.5|0,M+.5|0,y-1,d-1),e.fillStyle="rgba(248,234,164,.86)",e.fillRect(p+6|0,M+6|0,11,8),e.fillRect(p+y-17|0,M+6|0,11,8),e.fillStyle="rgba(44,56,72,.95)",e.beginPath(),e.arc(p+11+Math.sin(2*x.t+t),M+11,1.7,0,2*Math.PI),e.fill(),e.beginPath(),e.arc(p+y-11+Math.sin(2*x.t+t+1),M+11,1.7,0,2*Math.PI),e.fill(),x.start&&!x.dead){const l=u?o:r,a=l[(.45*x.t+2*t|0)%l.length],i=h-.44*n.r,f=4.6*a.length+12;e.fillStyle="rgba(8,12,20,.82)",F(s-.5*f,i-9,f,16,7),e.fill(),e.fillStyle="rgba(220,240,255,.9)",e.font="600 9px Trebuchet MS,sans-serif",e.fillText(a,s-.5*f+6,i+3)}}for(let t=0;t<z.length;t++){const n=z[t],s=n.x-c,i=n.y-b;s<-10||i<-10||s>l+10||i>a+10||(e.fillStyle="#69f0c9",e.beginPath(),e.arc(s,i,5,0,2*Math.PI),e.fill(),e.fillStyle="#ceffef",e.fillRect(s-1|0,i-1|0,2,2))}for(let t=0;t<P.length;t++){const n=P[t],s=n.x-c,i=n.y-b;if(s<-n.r-20||i<-n.r-20||s>l+n.r+20||i>a+n.r+20)continue;const r=n.t/n.d;e.globalAlpha=.12+.1*r;let o="#f4d96e",h="#fff0a9";g.cat&&(1===n.m?(o="#53d93d",h="#baff87"):2===n.m?(o="#42cdb9",h="#a8f6ea"):3===n.m&&(o="#597fd6",h="#bdd4ff")),e.fillStyle=o,e.beginPath(),e.arc(s,i,n.r,0,2*Math.PI),e.fill(),e.globalAlpha=.2+.2*Math.sin(5*(x.t+t))*r,e.strokeStyle=h,e.lineWidth=1.5,e.beginPath(),e.arc(s,i,.68*n.r+2*Math.sin(4*(x.t+t)),0,2*Math.PI),e.stroke(),g.cat&&(3===n.m&&(e.globalAlpha=.1+.08*r,e.strokeStyle="rgba(175,205,255,.72)",e.lineWidth=1.25,e.beginPath(),e.arc(s,i,2.35*n.r*(.97+.03*Math.sin(2*x.t+t)),0,2*Math.PI),e.stroke(),e.globalAlpha=.08+.07*r,e.strokeStyle="rgba(140,174,255,.58)",e.lineWidth=1,e.beginPath(),e.arc(s,i,1.6*n.r*(.96+.04*Math.sin(2.7*x.t+.8*t)),0,2*Math.PI),e.stroke()),e.globalAlpha=.18+.24*r,1===n.m?e.fillStyle="#dbff8f":2===n.m?e.fillStyle="#d8fff7":3===n.m?e.fillStyle="#e1ebff":e.fillStyle="#f1ffb3",e.beginPath(),e.arc(s+Math.sin(4*x.t+t)*n.r*.22,i-.16*n.r,2.4+.7*Math.sin(7*x.t+t),0,2*Math.PI),e.fill(),e.beginPath(),e.arc(s-.18*n.r,i+Math.sin(3*x.t+.7*t)*n.r*.14,1.9+.5*Math.sin(8*x.t+.4*t),0,2*Math.PI),e.fill(),e.beginPath(),e.arc(s+.12*n.r,i+.2*n.r,1.6+.4*Math.sin(6*x.t+.5*t),0,2*Math.PI),e.fill()),e.globalAlpha=1}for(let t=0;t<C.length;t++){const n=C[t],s=n.x-c,i=n.y-b;if(s<-n.r-40||i<-n.r-40||s>l+n.r+40||i>a+n.r+40)continue;const r=n.t/n.d,o=.86+.12*Math.sin(5*x.t+t),h=n.r*o;let f="#95f0b8",m="#d6ffea",y="#6ae9b4";if(2===n.k?(f="#7cf6e7",m="#d8fff7",y="#a0fff0"):3===n.k?(f="#c5f690",m="#efffd0",y="#d9ffab"):4===n.k&&(f="#bde9ff",m="#f0fbff",y="#d4f2ff"),e.globalAlpha=.14+.16*r,e.fillStyle=f,e.beginPath(),e.arc(s,i,h,0,2*Math.PI),e.fill(),e.globalAlpha=.28+.24*r,e.strokeStyle=m,e.lineWidth=2,e.beginPath(),e.arc(s,i,.78*h,0,2*Math.PI),e.stroke(),e.globalAlpha=.2+.2*r,e.strokeStyle=y,e.lineWidth=1.4,e.beginPath(),e.arc(s,i,h*(1.08+.05*Math.sin(7*x.t+t)),0,2*Math.PI),e.stroke(),4===n.k)for(let t=0;t<3;t++){const l=5.6*x.t+2.1*t,a=s+Math.cos(l)*h*.62,n=i+Math.sin(l)*h*.62;e.globalAlpha=.5+.3*r,e.fillStyle="#f2fcff",e.beginPath(),e.arc(a,n,2.3,0,2*Math.PI),e.fill()}e.globalAlpha=1}for(let t=0;t<k.length;t++){const n=k[t],s=n.x-c,i=n.y-b;if(s<-40||i<-40||s>l+40||i>a+40)continue;const r=4===n.k?"#713ce8":3===n.k?"#a789ff":2===n.k?"#665a78":1===n.k?"#5687a1":n.sl?"#70805a":"#4b667f";e.fillStyle=n.ht>0?"#9db4d1":r,e.beginPath(),e.arc(s,i,n.r,0,2*Math.PI),e.fill(),e.fillStyle="#f0627c",e.fillRect(s-4|0,i-2|0,3,3),e.fillRect(s+1|0,i-2|0,3,3)}for(let t=0;t<T.length;t++){const l=T[t],a=l.x-c,n=l.y-b;if(l.pulse){const t=l.r||8;e.fillStyle="rgba(157,230,255,.2)",e.beginPath(),e.arc(a,n,1.4*t,0,2*Math.PI),e.fill(),e.strokeStyle=l.c||"#9de6ff",e.lineWidth=2,e.beginPath(),e.arc(a,n,t,0,2*Math.PI),e.stroke(),e.fillStyle="rgba(224,250,255,.88)",e.beginPath(),e.arc(a,n,.34*t,0,2*Math.PI),e.fill()}else e.fillStyle=l.c||"#ffd56d",e.fillRect(a-2|0,n-2|0,4,4)}const I=g.x-c+g.rx,A=g.y-b+g.ry,q=Math.abs(g.vx)>=Math.abs(g.vy)?g.face>0?f.e:f.w:g.vy<0?g.face>0?f.ne:f.nw:g.face>0?f.se:f.sw;if(e.fillStyle="rgba(0,0,0,.35)",e.beginPath(),e.ellipse(I,A+14,17,6,0,0,2*Math.PI),e.fill(),q&&q.complete?e.drawImage(q,I-22,A-18,44,30):(e.fillStyle="#0b0f14",e.beginPath(),e.arc(I,A,12,0,2*Math.PI),e.fill(),e.fillStyle="#ef4f6c",e.fillRect(I+3|0,A-6|0,7,3)),g.bHealFx>0){const t=Math.min(1,g.bHealFx/.7),l=24+2*Math.sin(18*x.t);e.globalAlpha=.18+.26*t,e.fillStyle="#79f2ad",e.beginPath(),e.arc(I,A,l+9*t,0,2*Math.PI),e.fill(),e.globalAlpha=.55+.35*t,e.strokeStyle="#bfffd6",e.lineWidth=2.2,e.beginPath(),e.arc(I,A,l,0,2*Math.PI),e.stroke(),e.globalAlpha=1}if(g.bot&&w.length){for(let t=0;t<w.length;t++){const l=J(0|w[t].t||1),a=l.body,n=l.ring,s=w[t],i=s.x-c,r=s.y-b;e.fillStyle="rgba(0,0,0,.25)",e.beginPath(),e.ellipse(i,r+8,11,4,0,0,2*Math.PI),e.fill(),e.fillStyle=a,e.beginPath(),e.arc(i,r,9,0,2*Math.PI),e.fill(),e.fillStyle="#16314a",e.fillRect(i-3|0,r-2|0,2,2),e.fillRect(i+1|0,r-2|0,2,2),e.strokeStyle=n,e.lineWidth=1.2,e.beginPath(),e.arc(i,r,12+1.5*Math.sin(9*x.t+t),0,2*Math.PI),e.stroke(),l.auraR>0&&(e.strokeStyle="rgba(255,231,176,.42)",e.lineWidth=1.5,e.beginPath(),e.arc(i,r,l.auraR*(.84+.08*Math.sin(4*x.t+.7*t)),0,2*Math.PI),e.stroke())}if(g.zt>0&&w.length>=3){const t=w[0],l=w[1],a=w[2],n=t.x-c,s=t.y-b,i=l.x-c,r=l.y-b,o=a.x-c,h=a.y-b,f=.35+.65*Math.max(g.triFx,g.zt/g.zDur);e.globalAlpha=.15+.14*f,e.fillStyle="rgba(126,236,255,.9)",e.beginPath(),e.moveTo(n,s),e.lineTo(i,r),e.lineTo(o,h),e.closePath(),e.fill(),e.globalAlpha=.62+.3*f,e.strokeStyle="#9de6ff",e.lineWidth=2.6,e.beginPath(),e.moveTo(n,s),e.lineTo(i,r),e.lineTo(o,h),e.closePath(),e.stroke();const m=3.6*x.t,y=[[n,s,i,r,0],[i,r,o,h,.33],[o,h,n,s,.66]];for(let t=0;t<3;t++){const l=y[t],a=(m+l[4])%1,n=l[0]+(l[2]-l[0])*a,s=l[1]+(l[3]-l[1])*a;e.fillStyle="rgba(213,250,255,.95)",e.beginPath(),e.arc(n,s,2.4,0,2*Math.PI),e.fill()}e.globalAlpha=1}if(g.bCarry>0){const t=w[0].x-c,l=w[0].y-b;e.fillStyle="rgba(6,10,16,.84)",e.beginPath(),e.arc(t+10,l-10,8,0,2*Math.PI),e.fill(),e.fillStyle="#dfffff",e.font="700 10px Trebuchet MS,sans-serif",e.fillText(""+g.bCarry,t+7,l-7)}}if(g.mkS>0&&g.zt<=0){const t=g.face>0?-1:1,l=R(g.mkS/.32,0,1),a=I+13*t,n=A+8,s=a+t*(11+2.2*Math.sin(36*x.t)),i=n+7+1.1*Math.sin(22*x.t);e.strokeStyle="rgba(248,220,112,"+(.38+.45*l)+")",e.lineWidth=2,e.beginPath(),e.moveTo(a,n),e.quadraticCurveTo(.5*(a+s),n+2,s,i),e.stroke(),e.fillStyle="rgba(250,214,103,.72)",e.beginPath(),e.arc(s+2*t,i+2,2.1,0,2*Math.PI),e.fill(),e.fillStyle="rgba(244,205,93,.38)",e.beginPath(),e.ellipse(s+5*t,i+7,5.2,2.7,0,0,2*Math.PI),e.fill()}if((g.zc>0||g.zcd>0)&&g.zt<=0){const t=g.zcd>0?0:Math.min(1,g.zc/g.zLoad),l=t<=0?Math.max(0,1-g.zcd/g.zCool):0,a=18+8*t+1.2*Math.sin(22*x.t);e.strokeStyle=g.zr?"#8fffe5":"#ffd56d",e.lineWidth=2+1.8*t,e.beginPath(),e.arc(I,A,a,.5*-Math.PI,.5*-Math.PI+2*Math.PI*t),e.stroke(),g.zcd>0&&(e.strokeStyle="rgba(158,200,255,.7)",e.lineWidth=2,e.beginPath(),e.arc(I,A,16,.5*-Math.PI,.5*-Math.PI+2*Math.PI*l),e.stroke())}if(g.zt>0){const t=g.zt/2;e.strokeStyle="rgba(143,255,229,.7)",e.lineWidth=2.5,e.beginPath(),e.arc(I,A,20+2*Math.sin(30*x.t)+4*t,0,2*Math.PI),e.stroke(),e.fillStyle="rgba(143,255,229,.16)",e.beginPath(),e.ellipse(I-10*g.zx,A-7*g.zy,20,10,Math.atan2(g.zy,g.zx),0,2*Math.PI),e.fill()}g.flash>0&&(e.globalAlpha=g.flash/.07,e.fillStyle="#ffe598",e.beginPath(),e.moveTo(I+16*g.gx,A+8*g.gy),e.lineTo(I+24*g.gx-5*g.gy,A+24*g.gy+4*g.gx),e.lineTo(I+24*g.gx+5*g.gy,A+24*g.gy-4*g.gx),e.closePath(),e.fill(),e.globalAlpha=1);for(let t=0;t<v.length;t++){const n=v[t],s=n.x-c,i=n.y-b;s<-8||i<-8||s>l+8||i>a+8||(e.globalAlpha=Math.max(0,Math.min(1,2.4*n.t)),e.fillStyle=n.c,e.fillRect(0|s,0|i,3,3))}e.globalAlpha=1;const H=44,L=l-18-H,G=l<420;let E=62,X=74;const Y=Math.max(96,l-190);if(e.fillStyle="rgba(7,10,16,.76)",e.fillRect(10,10,l-20,104),e.fillStyle="#eef4ff",e.font="700 17px Trebuchet MS,sans-serif",e.fillText("SCOTTY",20,32),G){const t=52,l=L-8;e.font="600 12px Trebuchet MS,sans-serif",e.fillStyle="#9ec8ff",e.fillText("Time "+x.time.toFixed(1)+"s",20,t),e.fillStyle="#ffd56d",e.fillText("Kills "+x.kills,118,t),e.textAlign="right",e.fillStyle="#dce8ff",e.fillText("Best "+x.best,l,t),e.textAlign="left",E=62,X=74}else e.font="600 14px Trebuchet MS,sans-serif",e.fillStyle="#9ec8ff",e.fillText("Time "+x.time.toFixed(1)+"s",20,54),e.fillStyle="#ffd56d",e.fillText("Kills "+x.kills,150,54),e.textAlign="right",e.fillStyle="#dce8ff",e.fillText("Best "+x.best,l-24,54),e.textAlign="left";e.fillStyle="#2a3346",e.fillRect(20,E,Y,10),e.fillStyle="#ef4f6c",e.fillRect(20,E,Y*(g.hp/g.maxHp),10),e.fillStyle="#24374d",e.fillRect(20,X,Y,8),e.fillStyle="#69f0c9",e.fillRect(20,X,Y*(x.xp/x.nextXp),8);const _=g.mkOn?x.bd2?"campus secured":x.bs2?"defeat apex boss":x.bd?"apex signal rising":x.bs?"defeat boss":x.pz&&"nsh"===x.pz.id?"solve nsh puzzle":x.pz&&"mel"===x.pz.id?"solve mellon puzzle":0===x.sch.nsh?"find nsh":1===x.sch.nsh?"solve nsh puzzle":0===x.sch.mel?"find mellon institute":1===x.sch.mel?"solve mellon puzzle":x.labNsh>0&&x.labMel>0?"visit nsh / mellon for prototype upgrades":x.labNsh>0?"visit nsh for buddy prototype":x.labMel>0?"visit mellon institute for catalyst prototype":2===x.sch.mel&&x.kills<20?"defeat 20 enemies to summon boss":"survive phase 2":"collect mints "+x.homeGot+"/"+x.homeNeed;if(e.fillStyle="rgba(8,12,19,.62)",e.fillRect(14,118,l-28,26),e.fillStyle="#d7ffe8",e.font="600 12px Trebuchet MS,sans-serif",e.fillText(_,22,135),x.start&&!x.dead){const t=(t,l,a,n,s,i)=>{e.fillStyle="rgba(8,12,19,.92)",e.fillRect(L,t,H,H),e.strokeStyle=n?l:"rgba(129,157,187,.7)",e.lineWidth=2,e.strokeRect(L+.5,t+.5,43,43),e.strokeStyle="rgba(72,88,109,.85)",e.lineWidth=3,e.beginPath(),e.arc(L+22,t+22,14.96,0,2*Math.PI),e.stroke(),e.strokeStyle=l,e.beginPath(),e.arc(L+22,t+22,14.96,.5*-Math.PI,.5*-Math.PI+2*Math.PI*R(a,0,1)),e.stroke(),e.fillStyle=l,i<1?(e.beginPath(),e.moveTo(L+21.56,t+8.36),e.lineTo(L+.35*H,t+23.32),e.lineTo(L+21.56,t+23.32),e.lineTo(L+17.16,t+36.08),e.lineTo(L+29.48,t+18.04),e.lineTo(L+22.44,t+18.04),e.closePath(),e.fill()):i<2?(e.beginPath(),e.arc(L+22,t+19.36,4.4,0,2*Math.PI),e.fill(),e.beginPath(),e.moveTo(L+22,t+8.8),e.bezierCurveTo(L+30.36,t+19.8,L+28.16,t+29.48,L+22,t+34.32),e.bezierCurveTo(L+15.84,t+29.48,L+13.64,t+19.8,L+22,t+8.8),e.fill()):(e.lineWidth=2,e.beginPath(),e.arc(L+22,t+22,.12*H,0,2*Math.PI),e.stroke(),e.beginPath(),e.arc(L+22,t+22,9.68,0,2*Math.PI),e.stroke()),s>0?(e.fillStyle="#dce8ff",e.font="700 10px Trebuchet MS,sans-serif",e.fillText(s.toFixed(1)+"s",L+8,t+H-6)):n&&(e.fillStyle="rgba(255,255,255,.8)",e.beginPath(),e.arc(L+H-8,t+8,3,0,2*Math.PI),e.fill())};t(14,"#8fffe5",g.zcd>0?1-g.zcd/g.zCool:g.zr?1:g.zc/g.zLoad,g.zt>0,g.zcd>0?g.zcd:0,0);const l=g.mkOn?g.mkT>0?1-g.mkT/g.mkI:1:0;t(66,g.cat?1===g.catType?"#8fdd73":2===g.catType?"#7ad8cd":3===g.catType?"#8fb6ff":"#f4d96e":"#f4d96e",l,g.mkS>0,g.mkOn&&g.mkT>0?g.mkT:0,1);const a=g.rf?g.rfT>0?1-g.rfT/g.rfI:1:0;g.rf&&t(118,"#a8b8ff",a,1,g.rfT>0?g.rfT:0,2),g.cat&&(e.fillStyle="rgba(7,10,16,.75)",e.fillRect(L-56,78,50,20),e.fillStyle="#dce8ff",e.font="600 10px Trebuchet MS,sans-serif",e.fillText(Z(),L-50,91))}if(x.msgT>0&&(e.fillStyle="rgba(8,12,19,.74)",e.fillRect(14,148,l-28,28),e.fillStyle="#d7ffe8",e.font="600 13px Trebuchet MS,sans-serif",e.fillText(x.msg,22,167)),x.bossDownT>0){const t=R(x.bossDownT/2.4,0,1),n=.96+.08*Math.sin(18*x.t)*t,s=.5*l,i=.52*a;e.fillStyle="rgba(7,10,16,"+(.2+.26*t)+")",e.fillRect(0,0,l,a),e.save(),e.translate(s,i),e.scale(n,n),e.translate(-s,-i),e.textAlign="center",e.fillStyle="rgba(255,227,143,"+(.44+.4*t)+")",e.font=(l<520?"700 30px":"700 40px")+" Trebuchet MS,sans-serif",e.fillText("BOSS DOWN",s,i-8),e.fillStyle="rgba(209,231,255,"+(.58+.32*t)+")",e.font=(l<520?"600 13px":"600 15px")+" Trebuchet MS,sans-serif",e.fillText("Apex signal detected",s,i+20),e.restore(),e.textAlign="left"}if(x.start&&!x.dead&&!x.lvup&&!x.pz&&S.show>.01){const t=S.x+S.tx,l=S.y+S.ty;e.fillStyle="rgba(7,11,17,"+.42*S.show+")",e.beginPath(),e.arc(S.x,S.y,S.r+8,0,2*Math.PI),e.fill(),e.strokeStyle="rgba(158,200,255,"+.45*S.show+")",e.lineWidth=2,e.beginPath(),e.arc(S.x,S.y,S.r,0,2*Math.PI),e.stroke(),e.fillStyle="rgba(105,240,201,"+(M?.65:.42)*S.show+")",e.beginPath(),e.arc(t,l,S.kr,0,2*Math.PI),e.fill(),e.strokeStyle="rgba(220,248,255,"+.65*S.show+")",e.lineWidth=1.5,e.beginPath(),e.arc(t,l,S.kr,0,2*Math.PI),e.stroke()}if(!x.start){const t=20,n=.16*a,s=l-40,i=.68*a,r=t+16;e.fillStyle="rgba(6,9,14,.86)",e.fillRect(t,n,s,i),e.fillStyle="#fff",e.font="700 30px Trebuchet MS,sans-serif",e.fillText("Project: Zoomies",r,n+42),e.fillStyle="#9ec8ff",e.font="600 15px Trebuchet MS,sans-serif",e.fillText("what the dog doing?",r,n+64),e.fillStyle="#d8e6ff",e.font="600 14px Trebuchet MS,sans-serif",W("Goop swallowed CMU paths. People are trapped inside buildings. Scotty is the only one fast enough to move across campus.",r,n+98,s-32,18,5),e.fillStyle="#9ec8ff",e.font="600 13px Trebuchet MS,sans-serif",W("Collaborate with each college, unlock abilities, and defeat the infestation. Overlap different puddles to make combo zones.",r,n+200,s-32,17,3),e.fillStyle="#dce8ff",e.font="600 12px Trebuchet MS,sans-serif",W("Controls: drag to move. Remove finger to charge Zoomies, then move to dash. Different puddles can mix into stronger effects.",r,n+250,s-32,16,4),e.fillStyle="#69f0c9",e.font="700 23px Trebuchet MS,sans-serif",e.fillText("tap start",r,n+i-22)}if(x.lvup&&!x.dead){e.fillStyle="rgba(6,10,15,.16)",e.fillRect(0,0,l,a);const t=B(),n=t.bx,s=t.by,i=t.bw,r=t.bh,o=t.rects,h=t.mobile;e.fillStyle="rgba(17,29,45,.95)",F(n,s,i,r,16),e.fill(),e.strokeStyle="rgba(90,125,163,.8)",e.lineWidth=1.2,F(n+.5,s+.5,i-1,r-1,16),e.stroke(),e.fillStyle="#ecf3ff",e.font=(h?"700 18px":"700 20px")+" Trebuchet MS,sans-serif",e.fillText("SKILL BOOK",n+14,s+24),e.fillStyle="#9ec8ff",e.font="600 12px Trebuchet MS,sans-serif",e.fillText("choose",n+14,s+39);for(let t=0;t<3;t++){const l=x.choices[t],a=o[t],n=.9+.1*D(R((x.cardT-.07*t)/.28,0,1)),s=a.x+.5*a.w,i=a.y+.5*a.h;e.save(),e.translate(s,i),e.scale(n,n),e.translate(-s,-i);const r=l&&l.bg?l.bg:"rgba(27,44,66,.96)",f=l&&l.st?l.st:"rgba(116,150,186,.85)",c=l&&l.tx?l.tx:"#eef5ff",b=l&&l.sub?l.sub:"#a9c3e2";if(e.fillStyle=r,F(a.x,a.y,a.w,a.h,10),e.fill(),e.strokeStyle=f,e.lineWidth=1.2,F(a.x+.5,a.y+.5,a.w-1,a.h-1,10),e.stroke(),l){const t=O(l.n)+" "+l.n;let n=h?16:17;for(;n>12&&(e.font="700 "+n+"px Trebuchet MS,sans-serif",!(e.measureText(t).width<=a.w-22));n--);e.fillStyle=c,e.fillText(t,a.x+12,a.y+30),e.fillStyle=b,e.font="600 12px Trebuchet MS,sans-serif",W(l.d,a.x+12,a.y+48,a.w-24,14,2)}e.restore()}e.fillStyle="#95bce8",e.font="600 12px Trebuchet MS,sans-serif",e.fillText("tap 1/2/3",n+14,s+r-12)}if(x.pz&&!x.dead&&!x.lvup&&x.start){const t=K(),n=x.pz;if(e.fillStyle="rgba(5,9,14,.5)",e.fillRect(0,0,l,a),e.fillStyle="rgba(16,24,37,.96)",F(t.bx,t.by,t.bw,t.bh,14),e.fill(),e.strokeStyle="rgba(106,145,185,.85)",e.lineWidth=1.2,F(t.bx+.5,t.by+.5,t.bw-1,t.bh-1,14),e.stroke(),e.fillStyle="#ecf3ff",e.font="700 19px Trebuchet MS,sans-serif",e.fillText("nsh"===n.id?"NSH lab":"Mellon lab",t.bx+14,t.by+27),"nsh"===n.id){e.fillStyle="#dce8ff",e.font="600 12px Trebuchet MS,sans-serif",e.fillText("order",t.bx+14,t.by+66);for(let l=0;l<n.seq.length;l++){const a=t.bx+24+34*l,s=t.by+86,i=l<n.step;e.fillStyle=i?"#8cffc2":"#79d7ff",e.beginPath(),e.arc(a,s,12,0,2*Math.PI),e.fill(),e.fillStyle="#12243a",e.font="700 11px Trebuchet MS,sans-serif",e.fillText(n.seq[l]+1+"",a-3,s+4)}}else{const l=["#8fd3ff","#ffd58f","#ff9fb7"];e.fillStyle="#dce8ff",e.font="600 12px Trebuchet MS,sans-serif",e.fillText("mix",t.bx+14,t.by+66);for(let a=0;a<n.seq.length;a++){const s=t.bx+24+30*a,i=t.by+86,r=a<n.step;e.fillStyle=l[n.seq[a]],e.beginPath(),e.arc(s,i,10,0,2*Math.PI),e.fill(),r&&(e.strokeStyle="#8cffc2",e.lineWidth=2,e.beginPath(),e.arc(s,i,12,0,2*Math.PI),e.stroke())}}for(let l=0;l<3;l++){const a=t.btn[l];e.fillStyle="nsh"===n.id?"rgba(37,87,129,.96)":["#3c6588","#9a6f3f","#8e4f64"][l],F(a.x,a.y,a.w,a.h,10),e.fill(),e.strokeStyle="rgba(196,223,255,.72)",e.lineWidth=1.1,F(a.x+.5,a.y+.5,a.w-1,a.h-1,10),e.stroke(),e.fillStyle="#eef5ff",e.font="700 13px Trebuchet MS,sans-serif",e.fillText("nsh"===n.id?"terminal "+(l+1):["blue","amber","rose"][l],a.x+9,a.y+28)}e.fillStyle="#9ec8ff",e.font="600 11px Trebuchet MS,sans-serif",e.fillText("tap 1/2/3",t.bx+14,t.by+t.bh-10)}x.dead&&(e.fillStyle="rgba(5,8,13,.86)",e.fillRect(24,.24*a,l-48,.5*a),e.fillStyle="#ff8298",e.font="700 33px Trebuchet MS,sans-serif",e.fillText("GAME OVER",.5*l-98,.38*a),e.fillStyle="#dce8ff",e.font="600 20px Trebuchet MS,sans-serif",e.fillText("Kills "+x.kills,.5*l-43,.47*a),e.fillText("Best "+x.best,.5*l-37,.53*a),e.fillStyle="#69f0c9",e.font="700 24px Trebuchet MS,sans-serif",e.fillText("tap retry",.5*l-56,.65*a))}(),requestAnimationFrame(t)})})();</script></body></html>