<!doctype html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover"><title>Scotty Survival</title><style>:root{--bg:#0a0d12;--sky:#1a2940;--ink:#ecf3ff;--red:#ef4f6c;--mint:#69f0c9;--gold:#ffd56d;--line:#2f4868}*{box-sizing:border-box}html,body{margin:0;width:100%;height:100%;overflow:hidden;background:var(--bg);color:var(--ink);font-family:Trebuchet MS,Avenir Next,Segoe UI,sans-serif}body{touch-action:none}canvas{display:block;width:100%;height:100%}</style></head><body><canvas id="c"></canvas><script>(()=>{const t=document.getElementById("c"),e=t.getContext("2d");let a=360,l=740,n=1,i=0;const r=[{id:"home",n:"Cohon Centre",x:260,y:900,r:170,c:"#8ec0ff"},{id:"nsh",n:"NSH",x:980,y:460,r:170,c:"#79d7ff"},{id:"mel",n:"Mellon Inst",x:1880,y:1260,r:185,c:"#ffd58f"}],s=["i need to go out","these things are scary","may lord help us","can we ever go out?"],o=["a dog?","scotty??","what the dog doing?"],h=180,f={};function c(t){const e=new Image;return e.src="black_scottish_terrier_dog_with_red_scarf/rotations/"+t+".png",e}f.e=c("east"),f.w=c("west"),f.ne=c("north-east"),f.nw=c("north-west"),f.se=c("south-east"),f.sw=c("south-west");let b=0;function m(t,e,a,l){if(!b)return;const n=b.createOscillator(),i=b.createGain();n.type=a||"triangle",n.frequency.value=t,i.gain.value=l||.02,i.gain.exponentialRampToValueAtTime(1e-4,b.currentTime+e),n.connect(i).connect(b.destination),n.start(),n.stop(b.currentTime+e)}let d=0;function y(){if(!x.start)return;const t=performance.now();t-d<1200||(d=t,m(392,.07,"square",.02),m(523,.08,"triangle",.014))}const x={start:0,dead:0,lvup:0,t:0,time:0,kills:0,spawnT:0,nextSpawn:.8,msg:"",msgT:0,level:1,xp:0,nextXp:24,stop:0,shake:0,xpPulse:0,cardT:0,best:+localStorage.ss_best||0,choices:[],homeNeed:2,homeGot:0,sch:{nsh:0,mel:0},pz:0,uq:[],inB:"",bs:0,bd:0,bs2:0,bd2:0,b2At:0,bossDownT:0,botMask:0,chemMask:0,labStep:0,labBank:0,labFlip:0,labNsh:0,labMel:0,labNshRuns:0,labMelRuns:0,stormCd:0},p={x:260,y:900,vx:0,vy:0,r:15,hp:100,maxHp:100,speed:185,fireCd:0,fireRate:.46,dmg:12,range:400,shots:1,magnet:88,face:1,rx:0,ry:0,flash:0,gx:1,gy:0,zc:0,zr:0,zt:0,zx:1,zy:0,zcd:0,zDur:1,zSpd:2.1,zLoad:1.5,zCool:5.5,zDmg:24,zDr:.55,zb:0,zp:0,mkOn:0,mkT:0,mkI:8.8,mkS:0,mkD:14,mkR:54,mkSl:.54,chDo:14,chBurst:10,chHeal:8,chHealCd:0,chHealI:.85,cat:0,catM:0,catType:0,bot:0,botCount:0,botSlots:0,bType:0,bAtk:1,bAuraR:0,bAuraSl:0,bHealCd:0,bHealI:10,bHealAmt:10,bHealFx:0,triA:0,triFx:0,bx:0,by:0,ba:0,bcd:0,bRate:1.9,bDmg:1.15,bRange:480,bFetch:95,bPull:195,bCarry:0,bCarryMax:2,bGrabCd:0,bGrabI:.38,bPier:4,bSize:6},g={l:0,r:0,u:0,d:0,gr:0};let u=-1,M=0;const S={x:78,y:0,r:42,kr:16,tx:0,ty:0,ax:0,ay:0,ttx:0,tty:0,tax:0,tay:0,show:0,act:0},k=[],T=[],z=[],v=[],P=[],C=[],w=[];function A(t,e){return t+Math.random()*(e-t)}function I(t,e,a){return t<e?e:t>a?a:t}function R(t,e,a,l,n,i){const r=n-a,s=i-l;let o=((t-a)*r+(e-l)*s)/(r*r+s*s||1);o=I(o,0,1);const h=t-(a+r*o),f=e-(l+s*o);return h*h+f*f}function D(t,e,a,l,n,i){return(t-n)*(l-i)-(a-n)*(e-i)}function q(t,e,a,l,n,i,r,s){const o=D(t,e,a,l,n,i)<0,h=D(t,e,n,i,r,s)<0,f=D(t,e,r,s,a,l)<0;return o===h&&h===f}function H(t){const e=t-1;return 1+2.70158*e*e*e+1.70158*e*e}function B(t,a,l,n,i){const r=Math.max(0,Math.min(i,.5*Math.min(l,n)));e.beginPath(),e.moveTo(t+r,a),e.lineTo(t+l-r,a),e.quadraticCurveTo(t+l,a,t+l,a+r),e.lineTo(t+l,a+n-r),e.quadraticCurveTo(t+l,a+n,t+l-r,a+n),e.lineTo(t+r,a+n),e.quadraticCurveTo(t,a+n,t,a+n-r),e.lineTo(t,a+r),e.quadraticCurveTo(t,a,t+r,a),e.closePath()}function L(){const t=a<560,e=t?a-14:Math.min(a-20,620),n=t?I(.48*l,296,390):I(.4*l,268,340),i=.5*(a-e),r=l-n-12,s=[];if(t){const t=8,a=e-22,l=Math.max(74,Math.min(100,(n-84-2*t)/3)),o=r+50;for(let e=0;e<3;e++)s.push({x:i+14,y:o+e*(l+t),w:a,h:l})}else{const t=10,a=(e-32-2*t)/3,l=Math.max(102,Math.min(130,n-82)),o=r+52;for(let e=0;e<3;e++)s.push({x:i+16+e*(a+t),y:o,w:a,h:l})}return{mobile:t,bx:i,by:r,bw:e,bh:n,rects:s}}function W(t,a,l,n,i,r){const s=t.split(" ");let o="",h=0;for(let t=0;t<s.length;t++){const f=o?o+" "+s[t]:s[t];if(e.measureText(f).width<=n)o=f;else{if(e.fillText(o,a,l+h*i),h++,h>=r)return;o=s[t]}}h<r&&o&&e.fillText(o,a,l+h*i)}function F(t){return t.includes("Chemical")?"ðŸ§ª":t.includes("Bot")?"ðŸ¤–":t.includes("Shock")||t.includes("Zoomies")?"âš¡":t.includes("Territory")?"ðŸ’§":"â­"}function E(t){for(let e=0;e<r.length;e++)if(r[e].id===t)return r[e];return 0}function O(t,e,a){const l=a||0;for(let a=0;a<r.length;a++){const n=r[a],i=t-n.x,s=e-n.y;if(i*i+s*s<(n.r+l)*(n.r+l))return n}return 0}function X(t,e){const a=e||0;let l=0;for(let e=0;e<r.length;e++){const n=r[e];let i=t.x-n.x,s=t.y-n.y,o=Math.hypot(i,s)||1;const h=n.r+a;if(o<h){if(o<.001){const t=Math.random()*Math.PI*2;i=Math.cos(t),s=Math.sin(t),o=1}t.x=n.x+i/o*h,t.y=n.y+s/o*h,l=1}}return l}function G(){const t=Math.min(a-24,420),e=Math.min(l-130,260),n=.5*(a-t),i=.5*(l-e)+24,r=(t-36-20)/3,s=i+e-72;return{bx:n,by:i,bw:t,bh:e,btn:[{x:n+18,y:s,w:r,h:46},{x:n+18+r+10,y:s,w:r,h:46},{x:n+18+2*(r+10),y:s,w:r,h:46}]}}function N(t){const e=[];let a=-1;for(let l=0;l<t;l++){let t=3*Math.random()|0;t===a&&(t=(t+1+(2*Math.random()|0))%3),e.push(t),a=t}return e}function K(t,e){if(!x.pz)if("lab"===e&&"nsh"===t){const t=1+(x.labNshRuns/2|0),e=3+Math.min(2,t-1);x.pz={id:"nsh",seq:N(e),step:0,lab:1,trial:x.labNshRuns+1,tier:t},x.msg="research",x.msgT=1.2}else if("lab"===e&&"mel"===t){const t=1+(x.labMelRuns/2|0),e=4+Math.min(2,t-1);x.pz={id:"mel",seq:N(e),step:0,lab:1,trial:x.labMelRuns+1,tier:t},x.msg="research",x.msgT=1.2}else if("nsh"===t){const t=3*Math.random()|0,e=(t+1+(2*Math.random()|0))%3;x.pz={id:"nsh",seq:[t,e],step:0},x.msg="research",x.msgT=1.2}else"mel"===t&&(x.pz={id:"mel",seq:[3*Math.random()|0,3*Math.random()|0,3*Math.random()|0],step:0},x.msg="research",x.msgT=1.2)}function Y(t){if(!x.pz)return;const e=x.pz;if(t===e.seq[e.step]){if(e.step++,m(620+70*e.step,.04,"triangle",.018),e.step>=e.seq.length){const t=e.id;x.pz=0,function(t){"nsh"===t&&2!==x.sch.nsh?(x.sch.nsh=2,V("nsh"),x.msg="nsh",x.msgT=2.1,ot(.12),xt(p.x,p.y,"#79d7ff",16,95),m(760,.07,"square",.024)):"nsh"===t&&x.labNsh>0?(x.labNsh--,V("nsh"),x.msg="nsh prototype ready",x.msgT=1.8,ot(.12),xt(p.x,p.y,"#9de6ff",12,72),m(740,.06,"triangle",.022)):"mel"===t&&2!==x.sch.mel?(x.sch.mel=2,V("mel"),x.msg="mel",x.msgT=2.1,ot(.12),xt(p.x,p.y,"#ffd58f",16,95),m(720,.07,"square",.024)):"mel"===t&&x.labMel>0&&(x.labMel--,V("mel"),x.msg="mellon prototype ready",x.msgT=1.8,ot(.12),xt(p.x,p.y,"#b6ef9d",12,72),m(720,.06,"triangle",.022)),at()}(t),e.lab&&("nsh"===t?x.labNshRuns++:"mel"===t&&x.labMelRuns++)}}else e.step=0,ot(.03),m(180,.06,"square",.02),x.msg="retry",x.msgT=.55}function _(t){"nsh"===t&&0===x.sch.nsh?(x.sch.nsh=1,y(),K("nsh"),x.msg="help",x.msgT=1.4,m(640,.05,"triangle",.02)):"mel"===t&&0===x.sch.mel&&(x.sch.mel=1,y(),K("mel"),x.msg="help",x.msgT=1.4,m(680,.05,"triangle",.02))}function Z(){return 1===p.catType?"acid":2===p.catType?"heal":3===p.catType?"grav":"chem"}function U(){p.cat&&(x.msg="chem: "+Z(),x.msgT=.95,m(1===p.catType?540:2===p.catType?620:470,.04,"triangle",.02))}function V(t){x.uq.indexOf(t)<0&&x.uq.push(t)}function j(t){return(1&t?1:0)+(2&t?1:0)+(4&t?1:0)}const Q={1:{rate:1.15,dmg:1.6,range:620,fetch:72,pull:150,carry:1,grab:.42,pier:5,size:7.2,auraR:0,auraSl:0,healI:0,healAmt:0,pulse:1,col:"#9de6ff",body:"#93d8ff",ring:"#d0efff"},2:{rate:1.72,dmg:.95,range:520,fetch:118,pull:198,carry:2,grab:.34,pier:0,size:3.8,auraR:0,auraSl:0,healI:18,healAmt:10,pulse:0,col:"#7ae8a3",body:"#74de95",ring:"#d9ffe5"},3:{rate:2.45,dmg:.95,range:390,fetch:110,pull:205,carry:2,grab:.34,pier:2,size:8.5,auraR:124,auraSl:.46,healI:0,healAmt:0,pulse:1,col:"#ffd48c",body:"#ffd48c",ring:"#fff0c7"}};function J(t){const e=Q[t]||Q[1],a=Math.max(0,p.bCarryMax-2);return{rate:Math.max(.5,e.rate*(p.bRate/1.9)),dmg:e.dmg*(p.bDmg/1.15),range:e.range*(p.bRange/480),fetch:e.fetch*(p.bFetch/95),pull:e.pull*(p.bPull/195),carry:Math.max(1,e.carry+a),grab:Math.max(.14,e.grab*(p.bGrabI/.38)),pier:Math.max(0,Math.round(e.pier+(p.bPier-4))),size:Math.max(2.8,e.size*(p.bSize/6)),auraR:e.auraR,auraSl:e.auraSl,healI:e.healI,healAmt:e.healAmt,pulse:e.pulse,col:e.col,body:e.body,ring:e.ring}}function $(t){const e=[];for(let a=1;a<=3;a++)t&1<<a-1||e.push(a);return e}function tt(t){return 1===t?{n:"Volt Buddy",d:"striker bot: rapid shock pulses, low cargo",f:()=>it(1),bg:"rgba(29,53,79,.96)",st:"rgba(147,216,255,.88)",tx:"#f1f9ff",sub:"#b3d4ee"}:2===t?{n:"Medic Buddy",d:"green rounds + heals Scotty every 18s",f:()=>it(2),bg:"rgba(24,72,44,.96)",st:"rgba(148,232,171,.9)",tx:"#e9ffef",sub:"#b9e5c6"}:{n:"Guard Buddy",d:"warden bot: slowing aura + sturdy pulse",f:()=>it(3),bg:"rgba(73,50,27,.96)",st:"rgba(255,205,138,.9)",tx:"#fff4df",sub:"#e6cda5"}}function et(t){return 1===t?{n:"Acidic Puddle",d:"corrosive zone: burst + damage over time",f:()=>rt(1),bg:"rgba(33,75,34,.96)",st:"rgba(160,236,146,.88)",tx:"#edffe9",sub:"#bce2b3"}:2===t?{n:"Heal Puddle",d:"restorative zone: heals Scotty while inside",f:()=>rt(2),bg:"rgba(22,79,72,.96)",st:"rgba(151,242,228,.9)",tx:"#e8fffb",sub:"#b6e7df"}:{n:"Gravity Puddle",d:"black hole zone: drags enemies from far outside",f:()=>rt(3),bg:"rgba(30,45,86,.96)",st:"rgba(156,190,255,.9)",tx:"#edf3ff",sub:"#bfd1f0"}}function at(){for(;x.kills>=30*(x.labStep+1);)x.labStep++,x.labBank++,x.msg="new prototype intel",x.msgT=1.25,m(620,.04,"triangle",.018);for(;x.labBank>0;){const t=x.uq.indexOf("nsh")>=0?1:0,e=x.uq.indexOf("mel")>=0?1:0,a=2===x.sch.nsh&&j(x.botMask)+x.labNsh+t<3,l=2===x.sch.mel&&j(x.chemMask)+x.labMel+e<3;if(!a&&!l)break;let n="";a&&l?(x.labFlip^=1,n=x.labFlip?"nsh":"mel"):n=a?"nsh":"mel","nsh"===n?(x.labNsh++,x.msg="nsh: prototype bench ready",x.msgT=1.6,m(700,.05,"triangle",.02)):(x.labMel++,x.msg="mellon: catalyst bench ready",x.msgT=1.6,m(680,.05,"triangle",.02)),x.labBank--}}function lt(t){x.lvup||x.pz||x.uq.length||("nsh"===t&&x.labNsh>0?(K("nsh","lab"),x.msg="nsh: run prototype trial",x.msgT=1.35,m(700,.05,"triangle",.02)):"mel"===t&&x.labMel>0&&(K("mel","lab"),x.msg="mellon: run prototype trial",x.msgT=1.35,m(680,.05,"triangle",.02)))}function nt(){const t=function(){const t=[];for(let e=1;e<=3;e++)x.botMask&1<<e-1&&t.push(e);return t}(),e=p.bot?Math.max(1,Math.min(0|p.botCount,t.length||1)):0;for(;C.length<e;){const e=t[Math.min(t.length-1,C.length)]||1;C.push({x:p.x,y:p.y,t:e,cd:A(.05,.3),grabCd:A(.03,.22)})}for(;C.length>e;)C.pop();for(let e=0;e<C.length;e++)C[e].t=t[Math.min(t.length-1,e)]||C[e].t||1;if(p.botSlots!==e){const t=40;for(let e=0;e<C.length;e++){const a=p.ba+e*(2*Math.PI/Math.max(1,C.length));C[e].x=p.x+Math.cos(a)*t,C[e].y=p.y+Math.sin(a)*t,C[e].cd=A(.05,.3),C[e].grabCd=A(.03,.22)}p.botSlots=e}C.length||(p.bx=p.x+20,p.by=p.y+4,p.botSlots=0)}function it(t){const e=!p.bot;p.bot=1,p.bType=t,p.bx=p.x+20,p.by=p.y+4,p.ba=0,e&&(p.bcd=.45,p.bRate=1.9,p.bDmg=1.15,p.bRange=480,p.bFetch=95,p.bPull=195,p.bCarry=0,p.bCarryMax=2,p.bGrabCd=0,p.bGrabI=.38,p.bPier=4,p.bSize=6,p.bAtk=1,p.bAuraR=0,p.bAuraSl=0,p.bHealCd=0,p.bHealI=10,p.bHealAmt=10,p.bHealFx=0),x.botMask|=1<<t-1,p.botCount=Math.max(1,j(x.botMask)),nt(),at()}function rt(t){p.cat=1,p.catType=t,p.catM=0,p.chDo=14,p.chBurst=10,p.chHeal=8,p.chHealCd=0,p.chHealI=.85,1===t?(p.chDo=20,p.chBurst=13):2===t?(p.chHeal=10,p.chHealI=.85):p.mkSl=Math.max(p.mkSl,.6),x.chemMask|=1<<t-1,at()}function st(){if(x.lvup||x.dead||x.pz||!x.uq.length)return;const t=x.uq.shift();if(x.choices=[],"nsh"===t){const t=$(x.botMask);if(1===t.length){const e=t[0];return it(e),x.msg="nsh: "+function(t){return 1===t?"Volt Buddy":2===t?"Medic Buddy":"Guard Buddy"}(e)+" calibrated",x.msgT=1.6,xt(p.x,p.y,"#9de6ff",14,84),void m(760,.06,"triangle",.025)}2===t.length?x.choices=[tt(t[0]),tt(t[1]),{n:"Wildcard Buddy",d:"installs one of the remaining buddy prototypes",f:()=>it(t[Math.random()*t.length|0]),bg:"rgba(42,63,95,.96)",st:"rgba(167,207,255,.86)",tx:"#eef7ff",sub:"#c3d8ef"}]:3===t.length&&(x.choices=[tt(1),tt(2),tt(3)])}else if("mel"===t){const t=$(x.chemMask);if(1===t.length){const e=t[0];return rt(e),x.msg="mellon: "+function(t){return 1===t?"Acidic Puddle":2===t?"Heal Puddle":"Gravity Puddle"}(e)+" calibrated",x.msgT=1.6,xt(p.x,p.y,"#b6ef9d",14,84),void m(740,.06,"triangle",.025)}2===t.length?x.choices=[et(t[0]),et(t[1]),{n:"Wildcard Catalyst",d:"mixes one of the remaining catalyst variants",f:()=>rt(t[Math.random()*t.length|0]),bg:"rgba(38,76,56,.96)",st:"rgba(159,236,184,.88)",tx:"#eaffef",sub:"#c2ebd0"}]:3===t.length&&(x.choices=[et(1),et(2),et(3)])}x.choices.length&&(x.lvup=1,x.cardT=0,x.msg="up",x.msgT=1.4,m(760,.07,"triangle",.028))}function ot(t){x.shake=I(x.shake+t,0,1.3)}function ht(t){x.stop=Math.max(x.stop,t)}function ft(){n=Math.max(1,Math.min(2,devicePixelRatio||1)),a=Math.max(320,0|innerWidth),l=Math.max(560,0|innerHeight),t.width=a*n|0,t.height=l*n|0,e.setTransform(n,0,0,n,0,0),e.imageSmoothingEnabled=!1;const i=S.r+16;S.act?(S.x=I(S.x,i,a-i),S.y=I(S.y,i,l-i)):(S.x=78,S.y=l-88)}function ct(t,e){let a=t-S.x,l=e-S.y;const n=Math.hypot(a,l)||1,i=S.r;n<10?(a=0,l=0):n>i&&(a=a/n*i,l=l/n*i),S.ttx=a,S.tty=l,S.tax=a/i,S.tay=l/i}function bt(t){S.act=0,S.ttx=0,S.tty=0,S.tax=0,S.tay=0,t&&(S.tx=0,S.ty=0,S.ax=0,S.ay=0,S.show=0)}function mt(t){P.length>=420||P.push(t)}function dt(t){z.length>=260||z.push(t)}function yt(t){T.length>=260||T.push(t)}function xt(t,e,a,l,n){const i=k.length>130?.5:k.length>90?.7:1,r=Math.max(1,l*i|0);for(let l=0;l<r;l++){const l=Math.random()*Math.PI*2,i=(n||70)*(.4+Math.random());mt({x:t,y:e,vx:Math.cos(l)*i,vy:Math.sin(l)*i,t:A(.2,.6),c:a})}}function pt(t,e,a,l,n){const i=k[t],r=!!n;3===i.k?(x.bd=1,x.bs=0,x.b2At=x.t+10,x.msg="boss down: apex incoming",x.msgT=2.6,x.bossDownT=2.4,ht(.09),ot(.55),xt(i.x,i.y,"#ffe38f",44,210),xt(i.x,i.y,"#9de6ff",26,150),m(200,.12,"sawtooth",.038),m(320,.12,"triangle",.024),m(500,.14,"square",.02)):4===i.k&&(x.bd2=1,x.bs2=0,x.msg="apex down",x.msgT=1.8,ot(.32),m(210,.16,"sawtooth",.04)),x.kills++,at(),r?xt(i.x,i.y,e||"#ff9675",Math.max(2,.35*(a||9)|0),Math.max(20,.6*(l||70))):(ht(.03),ot(.08),xt(i.x,i.y,e||"#ff9675",a||9,l||70),m(280,.03,"square",.012));const s=260-z.length;if(s>0){const t=r?Math.random()<.25?1:0:1+(Math.random()<.4?1:0);for(let e=0;e<Math.min(t,s);e++)dt({x:i.x+A(-7,7),y:i.y+A(-7,7),v:0|A(5,8),m:1,t:0})}k.splice(t,1)}function gt(t,e,a,l,n){(function(t,e,a,l){for(let n=0;n<w.length;n++){const i=w[n],r=e-i.x,s=a-i.y;if(i.k===t&&r*r+s*s<(l+i.r)*(l+i.r)*.22)return 1}return 0})(t,e,a,l)||(w.length>=14&&w.shift(),w.push({k:t,x:e,y:a,r:l,t:n,d:n,pcd:0}),x.msg=function(t){return 1===t?"vortex: pull + melt":2===t?"sanctuary: heal + slow":3===t?"toxic bloom: chip + regen":"campus storm!"}(t),x.msgT=4===t?1.55:1.2,xt(e,a,function(t){return 1===t?"#95f0b8":2===t?"#89ffe8":3===t?"#ccff9b":"#c8f3ff"}(t),4===t?24:14,4===t?126:84),m(4===t?820:1===t?700:2===t?640:680,.06,"triangle",.022))}function ut(t,e,a){v[t]&&(v[t].t=Math.min(v[t].t,.05)),v[e]&&(v[e].t=Math.min(v[e].t,.05)),void 0!==a&&v[a]&&(v[a].t=Math.min(v[a].t,.05))}function Mt(t){if(x.dead=0,x.lvup=0,x.t=0,x.time=0,x.spawnT=0,x.nextSpawn=.8,x.kills=0,x.msg="",x.msgT=0,x.level=1,x.xp=0,x.nextXp=24,x.stop=0,x.shake=0,x.xpPulse=0,x.cardT=0,x.choices=[],x.homeGot=0,x.sch.nsh=0,x.sch.mel=0,x.pz=0,x.uq.length=0,x.inB="",x.bs=0,x.bd=0,x.bs2=0,x.bd2=0,x.b2At=0,x.bossDownT=0,x.botMask=0,x.chemMask=0,x.labStep=0,x.labBank=0,x.labFlip=0,x.labNsh=0,x.labMel=0,x.labNshRuns=0,x.labMelRuns=0,x.stormCd=0,p.x=260,p.y=900,p.vx=0,p.vy=0,p.hp=100,p.maxHp=100,p.speed=185,p.fireCd=0,p.fireRate=.46,p.dmg=12,p.range=400,p.shots=1,p.magnet=88,p.face=1,p.rx=0,p.ry=0,p.flash=0,p.gx=1,p.gy=0,p.zc=0,p.zr=0,p.zt=0,p.zx=1,p.zy=0,p.zcd=0,p.zDur=1,p.zSpd=2.1,p.zLoad=1.5,p.zCool=5.5,p.zDmg=24,p.zDr=.55,p.zb=0,p.zp=0,p.mkOn=0,p.mkT=0,p.mkI=8.8,p.mkS=0,p.mkD=14,p.mkR=54,p.mkSl=.54,p.chDo=14,p.chBurst=10,p.chHeal=8,p.chHealCd=0,p.chHealI=.85,p.cat=0,p.catM=0,p.catType=0,p.bot=0,p.botCount=0,p.botSlots=0,p.bType=0,p.bAtk=1,p.bAuraR=0,p.bAuraSl=0,p.bHealCd=0,p.bHealI=10,p.bHealAmt=10,p.bHealFx=0,p.triA=0,p.triFx=0,p.bx=p.x+20,p.by=p.y+4,p.ba=0,p.bcd=.45,p.bRate=1.9,p.bDmg=1.15,p.bRange=480,p.bFetch=95,p.bPull=195,p.bCarry=0,p.bCarryMax=2,p.bGrabCd=0,p.bGrabI=.38,p.bPier=4,p.bSize=6,k.length=0,T.length=0,z.length=0,v.length=0,P.length=0,C.length=0,w.length=0,g.l=g.r=g.u=g.d=g.gr=0,M=0,bt(1),x.msg="home: unlock",x.msgT=1.6,t){for(let t=0;t<24;t++)dt({x:1300+A(-120,120),y:900+A(-120,120),v:7,m:1,t:0});for(let t=0;t<10;t++)dt({x:330+58*t,y:900+A(-60,60),v:5,m:1,t:0})}}function St(){if(k.length>=h)return;const t=Math.random()*Math.PI*2,e=A(360,560),a=1+.045*x.time;let l=22+8*a+A(-4,8),n=56+6*a+A(-6,10),i=A(12,18),r=8+.9*a,s=0;x.time>8&&Math.random()<.24&&(s=1,n*=1.65,l*=.66,i*=.82,r*=.82),x.time>18&&Math.random()<.18&&(s=2,n*=.74,l*=2.15,i*=1.35,r*=1.28);let o=I(p.x+Math.cos(t)*e,20,2580),f=I(p.y+Math.sin(t)*e,20,1780);const c=O(o,f,10);if(c){const t=o-c.x,e=f-c.y,a=Math.hypot(t,e)||1;o=c.x+t/a*(c.r+18),f=c.y+e/a*(c.r+18)}k.push({x:o,y:f,r:i,hp:l,s:n,dmg:r,vx:0,vy:0,ht:0,sl:0,ce:0,bm:0,bt:0,bi:"",k:s})}function kt(t,e,a){if(k.length>=179)return;const l=Math.max(1,0|a);for(let a=0;a<e&&k.length<h;a++){const e=Math.random()*Math.PI*2,a=A(30,82),n=I(t.x+Math.cos(e)*a,20,2580),i=I(t.y+Math.sin(e)*a,20,1780),r=l>=3&&Math.random()<.34?2:1,s=2===r?86+4.8*x.time+A(-8,10):54+3.4*x.time+A(-6,8),o=2===r?70+A(-8,10):96+A(-10,18),h=2===r?18+.28*x.time:13+.24*x.time,f={x:n,y:i,r:2===r?A(14,19):A(11,16),hp:s,s:o,dmg:h,vx:0,vy:0,ht:0,sl:0,ce:0,bm:0,bt:0,bi:"",k:r};X(f,10),k.push(f)}}function Tt(t,e,a,l){w.length>=14&&w.shift(),w.push({k:4,x:t,y:e,r:a,t:l,d:l,pcd:0}),xt(t,e,"#c8f3ff",14,84),m(780,.04,"triangle",.018)}function zt(t,e){const a=z[t];if(!a)return;a.bc&&p.bCarry>0&&p.bCarry--,function(t){for(x.xp+=t;x.xp>=x.nextXp;){x.xp-=x.nextXp,x.level++,x.nextXp=1.36*x.nextXp+9|0,Pt(),x.lvup=1,x.cardT=0,x.xpPulse=.65,x.msg="upgrade",x.msgT=2.1,ht(.06),ot(.2),m(860,.08,"triangle",.03);break}}(a.v),z.splice(t,1),x.xpPulse=Math.min(.5,x.xpPulse+.11);let l=p.x,n=p.y;if("bot"===e){const t=(0|a.bc)-1,e=t>=0&&t<C.length?C[t]:0;l=e?e.x:p.bx,n=e?e.y:p.by}xt(l,n,"#69f0c9",4,40),p.mkOn||(x.homeGot++,x.homeGot>=x.homeNeed&&(p.mkOn=1,p.mkT=.25,x.msg="open",x.msgT=2.2,m(820,.07,"triangle",.028),xt(p.x,p.y,"#ffd56d",16,95)))}const vt=[{n:"Rapid Fire",d:"shoot faster",f:()=>p.fireRate=Math.max(.15,.8*p.fireRate),req:()=>1},{n:"Big Bites",d:"more damage",f:()=>p.dmg+=8,req:()=>1},{n:"Speed Paws",d:"move faster",f:()=>p.speed+=30,req:()=>1},{n:"Extra Shot",d:"+1 projectile",f:()=>p.shots=Math.min(5,p.shots+1),req:()=>1},{n:"Snack Magnet",d:"pickup range up",f:()=>p.magnet+=40,req:()=>1},{n:"Tough Fur",d:"+max hp +heal",f:()=>{p.maxHp+=32,p.hp=Math.min(p.maxHp,p.hp+32)},req:()=>1},{n:"Quick Heal",d:"heal now",f:()=>p.hp=Math.min(p.maxHp,p.hp+45),req:()=>1},{n:"Zoomies Time",d:"zoomies lasts longer",f:()=>p.zDur=Math.min(2.6,p.zDur+.32),req:()=>1},{n:"Zoomies CD",d:"zoomies cooldown down",f:()=>p.zCool=Math.max(1.4,p.zCool-.85),req:()=>1},{n:"Zoomies Speed",d:"zoomies speed up",f:()=>p.zSpd=Math.min(4,p.zSpd+.45),req:()=>1},{n:"Zoomies Charge",d:"zoomies charge faster",f:()=>p.zLoad=Math.max(.55,p.zLoad-.24),req:()=>1},{n:"Territory CD",d:"territory cooldown down",f:()=>p.mkI=Math.max(3.2,p.mkI-.68),req:()=>p.mkOn},{n:"Territory Radius",d:"territory area bigger",f:()=>p.mkR=Math.min(110,p.mkR+16),req:()=>p.mkOn},{n:"Territory Duration",d:"territory lasts longer",f:()=>p.mkD=Math.min(40,p.mkD+5),req:()=>p.mkOn},{n:"Territory Slow",d:"territory slows more",f:()=>p.mkSl=Math.min(.88,p.mkSl+.12),req:()=>p.mkOn},{n:"Chemical Puddle",d:"chem damage up",f:()=>{p.chDo=Math.min(58,p.chDo+10),p.chBurst=Math.min(42,p.chBurst+8)},req:()=>p.cat},{n:"Chemical Radius",d:"chem area bigger",f:()=>p.mkR=Math.min(120,p.mkR+13),req:()=>p.cat},{n:"Chemical Tempo",d:"chem cooldown down",f:()=>p.mkI=Math.max(2.6,p.mkI-.58),req:()=>p.cat},{n:"Bot Fetch",d:"bot grabs mints farther away",f:()=>p.bFetch=Math.min(220,p.bFetch+34),req:()=>p.bot},{n:"Bot Cargo",d:"bot carries more mints",f:()=>p.bCarryMax=Math.min(5,p.bCarryMax+1),req:()=>p.bot},{n:"Shock Tempo",d:"shock pulse cooldown down",f:()=>p.bRate=Math.max(.62,.82*p.bRate),req:()=>p.bot&&p.bAtk},{n:"Shock Pierce",d:"pulse pierces more + wider",f:()=>{p.bPier=Math.min(8,p.bPier+1),p.bSize=Math.min(18,p.bSize+1.4)},req:()=>p.bot&&p.bAtk},{n:"Shock Power",d:"shock pulse damage up",f:()=>p.bDmg=Math.min(2.8,p.bDmg+.33),req:()=>p.bot&&p.bAtk}];function Pt(){const t=vt.filter(t=>!t.req||t.req());x.choices=[];for(let e=0;e<3&&t.length;e++){const e=Math.random()*t.length|0;x.choices.push(t[e]),t.splice(e,1)}}function Ct(t){x.lvup&&x.choices[t]&&(x.choices[t].f(),x.lvup=0,x.msg=x.choices[t].n+" applied",x.msgT=1.4,x.xpPulse=.25,ot(.08),xt(p.x,p.y,"#69f0c9",12,90),st())}function wt(){b||(b=new(window.AudioContext||window.webkitAudioContext)),x.start||(x.start=1,Mt(1),m(430,.05,"triangle",.02))}function At(e){u===e.pointerId&&(M=0,bt(),t.hasPointerCapture(u)&&t.releasePointerCapture(u),u=-1)}addEventListener("resize",ft),addEventListener("keydown",function(t){const e=t.code;if("Space"!==e&&"ArrowUp"!==e&&"ArrowDown"!==e&&"ArrowLeft"!==e&&"ArrowRight"!==e||t.preventDefault(),"Space"!==e&&"Enter"!==e||wt(),x.dead&&("Space"===e||"Enter"===e||"KeyR"===e))return Mt(1),void m(360,.05,"triangle",.02);x.lvup?"Digit1"===e?Ct(0):"Digit2"===e?Ct(1):"Digit3"===e&&Ct(2):x.pz?"Digit1"===e?Y(0):"Digit2"===e?Y(1):"Digit3"===e&&Y(2):x.start&&!x.dead&&("KeyQ"!==e?"KeyA"===e||"ArrowLeft"===e?g.l=1:"KeyD"===e||"ArrowRight"===e?g.r=1:"KeyW"===e||"ArrowUp"===e?g.u=1:"KeyS"===e||"ArrowDown"===e?g.d=1:"KeyE"!==e&&"ShiftLeft"!==e&&"ShiftRight"!==e||(g.gr=1):U())}),addEventListener("keyup",function(t){const e=t.code;"KeyA"===e||"ArrowLeft"===e?g.l=0:"KeyD"===e||"ArrowRight"===e?g.r=0:"KeyW"===e||"ArrowUp"===e?g.u=0:"KeyS"===e||"ArrowDown"===e?g.d=0:"KeyE"!==e&&"ShiftLeft"!==e&&"ShiftRight"!==e||(g.gr=0)}),t.addEventListener("pointerdown",function(e){if(!(u>=0&&u!==e.pointerId)){if(u=e.pointerId,t.setPointerCapture(u),wt(),x.dead)return Mt(1),void m(360,.05,"triangle",.02);if(x.lvup)!function(t,e){if(!x.lvup)return;const a=L().rects;for(let l=0;l<a.length;l++){const n=a[l];if(t>=n.x&&t<=n.x+n.w&&e>=n.y&&e<=n.y+n.h){Ct(l);break}}}(e.clientX,e.clientY);else{if(x.pz){const t=G();for(let a=0;a<3;a++){const l=t.btn[a];if(e.clientX>=l.x&&e.clientX<=l.x+l.w&&e.clientY>=l.y&&e.clientY<=l.y+l.h)return void Y(a)}return}x.start&&!x.dead&&p.cat&&function(t,e){const l=a-18-44;return t>=l&&t<=l+44&&e>=66&&e<=110}(e.clientX,e.clientY)?U():"mouse"!==e.pointerType&&(M=1,function(t,e){const n=S.r+16;S.x=I(t,n,a-n),S.y=I(e,n,l-n),S.tx=0,S.ty=0,S.ax=0,S.ay=0,S.ttx=0,S.tty=0,S.tax=0,S.tay=0,S.act=1}(e.clientX,e.clientY),ct(e.clientX,e.clientY))}}},{passive:1}),t.addEventListener("pointermove",function(t){u!==t.pointerId||!x.start||x.dead||x.lvup||M&&ct(t.clientX,t.clientY)},{passive:1}),t.addEventListener("pointerup",At,{passive:1}),t.addEventListener("pointercancel",At,{passive:1}),ft(),Mt(1),requestAnimationFrame(function t(c){i||(i=c);let b=.001*(c-i);i=c,b=Math.max(0,Math.min(.034,b)),function(t){const e=t;!function(t){const e=1-Math.exp(22*-t),a=1-Math.exp(16*-t);S.tx+=(S.ttx-S.tx)*e,S.ty+=(S.tty-S.ty)*e,S.ax+=(S.tax-S.ax)*e,S.ay+=(S.tay-S.ay)*e,S.show+=((S.act?1:0)-S.show)*a,!S.act&&S.show<.003&&(S.show=0)}(e),x.msgT>0&&(x.msgT-=e),x.bossDownT>0&&(x.bossDownT=Math.max(0,x.bossDownT-e)),x.stormCd>0&&(x.stormCd=Math.max(0,x.stormCd-e)),x.stop>0&&(x.stop=Math.max(0,x.stop-e),t*=.06),x.shake>0&&(x.shake=Math.max(0,x.shake-2.2*e)),x.xpPulse>0&&(x.xpPulse=Math.max(0,x.xpPulse-1.7*e)),p.flash>0&&(p.flash=Math.max(0,p.flash-7*e)),p.zb>0&&(p.zb=Math.max(0,p.zb-e)),p.zp>0&&(p.zp=Math.max(0,p.zp-e)),p.rx*=Math.max(0,1-18*e),p.ry*=Math.max(0,1-18*e),p.zcd>0&&(p.zcd=Math.max(0,p.zcd-e)),p.mkS>0&&(p.mkS=Math.max(0,p.mkS-e)),p.mkT>0&&p.zt<=0&&(p.mkT=Math.max(0,p.mkT-e)),p.bHealFx>0&&(p.bHealFx=Math.max(0,p.bHealFx-e)),p.triFx>0&&(p.triFx=Math.max(0,p.triFx-1.4*e));for(let e=v.length-1;e>=0;e--){const a=v[e];a.t-=t,a.t<=0&&v.splice(e,1)}for(let e=w.length-1;e>=0;e--){const a=w[e];a.t-=t,a.pcd>0&&(a.pcd=Math.max(0,a.pcd-t)),a.t<=0&&w.splice(e,1)}for(let e=P.length-1;e>=0;e--){const a=P[e];a.t-=t,a.x+=a.vx*t,a.y+=a.vy*t,a.vy+=480*t,a.t<=0&&P.splice(e,1)}if(!x.start||x.dead)return;if(x.lvup)return void(x.cardT=Math.min(.9,x.cardT+e));if(x.pz)return void(x.t+=t);x.t+=t;const a=E("nsh"),l=E("mel");p.mkOn&&0===x.sch.nsh&&Math.hypot(p.x-a.x,p.y-a.y)<a.r&&_("nsh"),2===x.sch.nsh&&0===x.sch.mel&&Math.hypot(p.x-l.x,p.y-l.y)<l.r&&_("mel"),2===x.sch.nsh&&x.labNsh>0&&Math.hypot(p.x-a.x,p.y-a.y)<a.r&&lt("nsh"),2===x.sch.mel&&x.labMel>0&&Math.hypot(p.x-l.x,p.y-l.y)<l.r&&lt("mel"),st();const n=(g.r?1:0)-(g.l?1:0),i=(g.d?1:0)-(g.u?1:0),r=Math.hypot(S.ax,S.ay);let s=n,o=i;M&&r>.12&&(s+=S.ax,o+=S.ay);let f=Math.hypot(s,o);f>1&&(s/=f,o/=f);const c=(Math.hypot(n,i)>.05||M&&r>.12)&&p.mkS<=0,b=O(p.x,p.y,-6);if(p.mkOn&&p.mkT<=0&&p.mkS<=0&&p.zt<=0&&p.zr<=0&&p.zc<=0&&(v.length>=18&&v.shift(),v.push({x:p.x+4*p.gx,y:p.y+8,r:p.mkR,t:p.mkD,d:p.mkD,m:p.cat?p.catType||1:0}),p.mkS=.32,p.mkT=p.mkI,x.msg="territory",x.msgT=.7,ht(.02),ot(.05),xt(p.x,p.y+8,"#ffd56d",10,46),m(560,.04,"triangle",.02)),function(){const t=[];for(let e=0;e<v.length;e++){const a=v[e];a.t>.08&&a.m>=1&&a.m<=3&&t.push(e)}if(t.length<2)return;if(x.stormCd<=0&&t.length>=3)for(let e=0;e<t.length-2;e++){const a=v[t[e]];for(let l=e+1;l<t.length-1;l++){const n=v[t[l]];for(let i=l+1;i<t.length;i++){const r=v[t[i]];if(14!=(1<<a.m|1<<n.m|1<<r.m))continue;const s=Math.hypot(a.x-n.x,a.y-n.y),o=Math.hypot(n.x-r.x,n.y-r.y),h=Math.hypot(r.x-a.x,r.y-a.y);if(s>.72*(a.r+n.r)||o>.72*(n.r+r.r)||h>.72*(r.r+a.r))continue;const f=(a.x+n.x+r.x)/3,c=(a.y+n.y+r.y)/3,b=Math.min(138,(a.r+n.r+r.r)/3+30);gt(4,f,c,b,4.8),x.stormCd=8,ut(t[e],t[l],t[i]);for(let t=k.length-1;t>=0;t--){const e=k[t],a=e.x-f,l=e.y-c;if(a*a+l*l<b*b*1.2){const n=Math.hypot(a,l)||1;e.hp-=2.4*p.chBurst+1.2*p.chDo,e.ht=.2,e.vx+=a/n*320,e.vy+=l/n*320,e.hp<=0&&pt(t,"#c8f3ff",12,96,1)}}return}}}const e={};for(let a=0;a<t.length-1;a++){const l=t[a];if(e[l])continue;const n=v[l];for(let i=a+1;i<t.length;i++){const a=t[i];if(e[a])continue;const r=v[a];if(n.m===r.m)continue;if(Math.hypot(n.x-r.x,n.y-r.y)>.66*(n.r+r.r))continue;const s=Math.min(n.m,r.m),o=Math.max(n.m,r.m),h=1===s&&3===o?1:2===s&&3===o?2:3;gt(h,.5*(n.x+r.x),.5*(n.y+r.y),Math.min(122,.44*(n.r+r.r)+18),1===h?5.4:2===h?6.1:5.8),ut(l,a),e[l]=1,e[a]=1;break}}}(),p.zt<=0)if(!b&&!c&&p.zcd<=0&&p.mkS<=0){if(p.zc=Math.min(p.zLoad,p.zc+t),p.zc>.25){const e=p.zc/p.zLoad;p.rx+=.9*(2*Math.random()-1)*e*60*t,p.ry+=.9*(2*Math.random()-1)*e*60*t,ot(7e-4*e*60*t)}p.zc>=p.zLoad&&!p.zr&&(p.zr=1,x.msg="zoomies ready",x.msgT=1.1,ot(.08),m(760,.05,"triangle",.024))}else if(p.zr){p.zt=p.zDur,p.zr=0,p.zc=0;const t=f||1;p.zx=s/t,p.zy=o/t,ht(.04),ot(.28),p.flash=.09,p.gx=p.zx,p.gy=p.zy,xt(p.x,p.y,"#9dffea",18,120),m(980,.06,"square",.028)}else p.zc=0;if(p.zt>0){if(p.zt=Math.max(0,p.zt-t),c){p.zx=.85*p.zx+.15*s,p.zy=.85*p.zy+.15*o;const t=Math.hypot(p.zx,p.zy)||1;p.zx/=t,p.zy/=t}const e=p.zb>0?1.35:1;p.vx=p.zx*p.speed*p.zSpd*e,p.vy=p.zy*p.speed*p.zSpd*e,p.face=p.vx>=0?1:-1,p.rx-=8*p.zx*t*60,p.ry-=6*p.zy*t*60,Math.random()<.65&&mt({x:p.x-A(-6,6),y:p.y-A(-6,6),vx:.12*-p.vx+A(-35,35),vy:.12*-p.vy+A(-35,35),t:A(.1,.25),c:"#8fffe5"}),p.zt<=0&&(p.zcd=p.zCool,x.msg="zoomies cd",x.msgT=.65,m(420,.04,"triangle",.016))}else p.vx=s*p.speed,p.vy=o*p.speed,Math.abs(p.vx)>.5&&(p.face=p.vx>0?1:-1),p.mkS>0&&(p.rx+=.5*Math.sin(45*x.t),Math.random()<.7&&mt({x:p.x+A(-5,5),y:p.y+10+A(-3,3),vx:A(-14,14),vy:A(6,30),t:A(.12,.26),c:"#ffd56d"}));if(p.x=I(p.x+p.vx*t,12,2588),p.y=I(p.y+p.vy*t,12,1788),p.zt>0&&p.zp<=0)for(let t=0;t<v.length;t++){const e=v[t],a=p.x-e.x,l=p.y-e.y;if(a*a+l*l<e.r*e.r){p.zp=.22,p.zb=.48,xt(p.x,p.y,"#8fffe5",8,95),m(740,.03,"triangle",.02);for(let t=k.length-1;t>=0;t--){const a=k[t],l=a.x-e.x,n=a.y-e.y;l*l+n*n<e.r*e.r&&(a.hp-=2.2*p.zDmg,a.ht=.13,a.vx+=260*p.zx,a.vy+=260*p.zy,a.hp<=0&&pt(t,"#8fffe5",10,80,1))}break}}const d=O(p.x,p.y,-6);d||(x.time+=t);const y=d?d.id:"";if(x.inB=y,2===p.catType){p.chHealCd>0&&(p.chHealCd=Math.max(0,p.chHealCd-t));let e=0;for(let t=0;t<v.length;t++){const a=v[t],l=p.x-a.x,n=p.y-a.y;if(2===a.m&&l*l+n*n<a.r*a.r){e=1;break}}if(e&&p.chHealCd<=0&&p.hp<p.maxHp){const t=Math.min(p.chHeal,p.maxHp-p.hp);p.hp+=t,p.chHealCd=p.chHealI,xt(p.x,p.y,"#7fe8dd",8,52),x.msg="heal +"+(0|t),x.msgT=.65}}let u=0,D=0,H=0;for(let t=0;t<w.length;t++){const e=w[t],a=p.x-e.x,l=p.y-e.y;a*a+l*l<e.r*e.r&&(2===e.k?(!H||e.t>H.t)&&(H=e):3===e.k?u=1:4===e.k&&(D=1))}if(H&&H.pcd<=0&&p.hp<p.maxHp){const t=Math.min(10,p.maxHp-p.hp);p.hp+=t,H.pcd=1.6,xt(p.x,p.y,"#95ffe8",10,70),x.msg="well +"+(0|t),x.msgT=.6}if(u&&p.hp<p.maxHp){const e=Math.min(p.maxHp-p.hp,1.6*t);e>0&&(p.hp+=e)}if(D&&p.hp<p.maxHp){const e=Math.min(p.maxHp-p.hp,6*t);e>0&&(p.hp+=e)}let B=0;if(p.bot&&p.botCount>0){nt(),B=p.zt>0&&C.length>=3,p.ba+=t*(B?5.8:2.3),B&&(p.triA+=11.8*t);for(let e=0;e<C.length;e++){const a=C[e];let l=0,n=0;if(B&&e<3){const t=p.triA+e*(2*Math.PI/3),a=78+4.4*Math.sin(12*x.t+e);l=p.x+Math.cos(t)*a,n=p.y+Math.sin(t)*a}else{const t=p.ba+e*(2*Math.PI/C.length),a=38+2*Math.sin(2*x.t+.7*e);l=p.x+Math.cos(t)*a,n=p.y+Math.sin(t)*a}a.x+=(l-a.x)*Math.min(1,8*t),a.y+=(n-a.y)*Math.min(1,8*t),a.grabCd>0&&(a.grabCd=Math.max(0,a.grabCd-t))}B&&(p.triFx=Math.min(1,p.triFx+4*t)),p.bx=C[0].x,p.by=C[0].y;let e=0,a=18,l=10;for(let t=0;t<C.length;t++)if(2==(0|C[t].t)){const t=J(2);e=1,a=Math.min(a,t.healI||18),l=Math.max(l,t.healAmt||10)}if(e&&(p.bHealCd>0&&(p.bHealCd=Math.max(0,p.bHealCd-t)),p.bHealCd<=0&&p.hp<p.maxHp)){const t=Math.min(l,p.maxHp-p.hp);p.hp+=t,p.bHealCd=a,p.bHealFx=.7,x.msg="medic +"+(0|t),x.msgT=.9,xt(p.x,p.y,"#84f0a6",10,62),m(760,.05,"triangle",.018)}if(!d&&p.bAtk)for(let e=0;e<C.length;e++){const a=C[e],l=J(0|a.t||1);if(a.cd-=t,a.cd>0)continue;let n=0,i=l.range*l.range;for(let t=0;t<k.length;t++){const e=k[t],l=e.x-a.x,r=e.y-a.y,s=l*l+r*r;s<i&&(i=s,n=e)}if(n){const t=Math.hypot(n.x-a.x,n.y-a.y)||1,e=!!l.pulse,i=l.col,r=l.pier;yt({x:a.x,y:a.y,vx:(n.x-a.x)/t*420,vy:(n.y-a.y)/t*420,d:p.dmg*l.dmg,life:1.35,pier:r,c:i,r:l.size,pulse:e}),a.cd=l.rate,xt(a.x,a.y,i,4,36)}else a.cd=.35}}else C.length=0,p.bCarry=0,p.botSlots=0,B=0;p.fireCd-=t,!d&&p.fireCd<=0&&(p.fireCd=p.fireRate,function(){const t=function(){let t=0,e=1e9;for(let a=0;a<k.length;a++){const l=k[a],n=l.x-p.x,i=l.y-p.y,r=n*n+i*i;r<e&&(e=r,t=l)}return t}();if(!t)return;let e=t.x-p.x,a=t.y-p.y,l=Math.hypot(e,a)||1;if(l>p.range)return;e/=l,a/=l;const n=p.shots;for(let t=0;t<n;t++){const l=1===n?0:.18*(t-(n-1)/2),i=Math.cos(l),r=Math.sin(l),s=e*i-a*r,o=e*r+a*i;yt({x:p.x,y:p.y,vx:520*s,vy:520*o,d:p.dmg,life:1.05,pier:1})}p.gx=e,p.gy=a,p.rx-=6*e,p.ry-=4*a,p.flash=.07,p.face=e>=0?1:-1,xt(p.x+16*e,p.y+10*a,"#ffd56d",3,35),ot(.025),m(640,.04,"square",.018)}()),x.spawnT-=t;const L=x.kills>26||x.time>52;2===x.sch.mel&&!x.bs&&!x.bd&&!x.bs2&&!x.bd2&&x.kills>=20&&L&&function(){if(x.bs||x.bd||x.bs2||x.bd2||k.length>=h)return;const t=Math.random()*Math.PI*2,e={x:I(p.x+520*Math.cos(t),40,2560),y:I(p.y+520*Math.sin(t),40,1760),r:35,hp:640+11*x.time,s:46,dmg:24,vx:0,vy:0,ht:0,sl:0,ce:0,bm:0,bt:0,bi:"",k:3};X(e,28),k.push(e),x.bs=1,x.msg="boss!",x.msgT=1.2,m(170,.15,"sawtooth",.03),ot(.2)}(),x.bd&&!x.bs2&&!x.bd2&&x.t>=x.b2At&&function(){if(x.bs2||x.bd2||k.length>=h)return;const t=Math.random()*Math.PI*2,e=2280+30*x.time,a={x:I(p.x+560*Math.cos(t),44,2556),y:I(p.y+560*Math.sin(t),44,1756),r:42,hp:e,s:62,dmg:42,vx:0,vy:0,ht:0,sl:0,ce:0,bm:0,bt:0,bi:"",k:4,apMax:e,apBaseS:62,apCd:A(1.4,2.2),apTele:0,apTeleD:0,apAimX:0,apAimY:0,apBurstLeft:0,apBurstSpd:860,apPhase:1,apStormCd:A(2.6,3.8),apSummonCd:A(3.4,4.8),apEvadeCd:0,apImpactCd:0};X(a,36),k.push(a),x.bs2=1,x.msg="apex boss! phase omega",x.msgT=1.7,m(120,.2,"sawtooth",.04),ot(.34)}(),x.spawnT<=0&&(x.spawnT=x.nextSpawn,x.nextSpawn=Math.max(.18,.78-.018*x.time),St(),!x.bs&&!x.bs2&&x.time>26&&Math.random()<.28&&St());for(let e=T.length-1;e>=0;e--){const a=T[e];if(a.life-=t,a.x+=a.vx*t,a.y+=a.vy*t,a.life<=0||a.x<-20||a.y<-20||a.x>2620||a.y>1820)T.splice(e,1);else for(let t=k.length-1;t>=0;t--){const l=k[t],n=l.x-a.x,i=l.y-a.y,r=a.r||3;if(n*n+i*i<(l.r+r)*(l.r+r)&&(l.hp-=a.d,l.ht=a.pulse?.12:.09,l.vx+=a.vx*(a.pulse?.11:.07),l.vy+=a.vy*(a.pulse?.11:.07),a.pulse&&xt(l.x,l.y,"#9de6ff",3,28),a.pier--,l.hp<=0&&pt(t,a.pulse?"#9de6ff":"#ff9675",a.pulse?7:9,a.pulse?58:70,a.pulse?1:0),a.pier<0)){T.splice(e,1);break}}}let W=0,F=0,G=0;const N=d;for(let e=k.length-1;e>=0;e--){const a=k[e];let l=p.x,n=p.y;if(N)if(a.bi!==N.id&&(a.bi=N.id,a.bm=0,a.bt=A(.9,1.7)),a.bt-=t,a.bt<=0&&(0===a.bm?(a.bm=1,a.bt=A(1.1,2.1)):(a.bm=0,a.bt=A(.9,1.7))),0===a.bm){const t=p.x-N.x,e=p.y-N.y,a=Math.hypot(t,e)||1;l=N.x+t/a*(N.r+8),n=N.y+e/a*(N.r+8)}else{const t=a.x-N.x,i=a.y-N.y,r=Math.hypot(t,i)||1;l=a.x+t/r*220+-i/r*Math.sin(2*x.t+e)*30,n=a.y+i/r*220+t/r*Math.sin(2*x.t+e)*30}else a.bi="",a.bt=0,a.bm=0;if(4===a.k){a.apMax||(a.apMax=a.hp),a.apBaseS||(a.apBaseS=a.s),a.apCd||(a.apCd=A(1.4,2.2)),a.apStormCd||(a.apStormCd=A(2.6,3.8)),a.apSummonCd||(a.apSummonCd=A(3.4,4.8)),a.apBurstSpd||(a.apBurstSpd=860),a.apTele||(a.apTele=0),a.apBurstLeft||(a.apBurstLeft=0),a.apEvadeCd||(a.apEvadeCd=0),a.apImpactCd||(a.apImpactCd=0);const e=I(a.hp/(a.apMax||1),0,1),l=e>.66?1:e>.33?2:3,n=l-1;a.apPhase=l,a.s=(a.apBaseS||62)*(1+.14*n+(p.zt>0?.18:0)),a.apCd-=t,a.apStormCd-=t,a.apSummonCd-=t,a.apEvadeCd>0&&(a.apEvadeCd=Math.max(0,a.apEvadeCd-t)),a.apImpactCd>0&&(a.apImpactCd=Math.max(0,a.apImpactCd-t));const i=p.x-a.x,r=p.y-a.y,s=Math.hypot(i,r)||1,o=1===l?.34:2===l?.52:.72,h=I(p.x+p.vx*o+28*(p.zx||0),20,2580),f=I(p.y+p.vy*o+28*(p.zy||0),20,1780);if(!d&&p.zt>0&&a.apEvadeCd<=0){const t=Math.random()<.5?-1:1,e=260+70*n;a.vx+=-p.zy*t*e,a.vy+=p.zx*t*e,a.apEvadeCd=.65-.08*n,l>=2&&Math.random()<.65&&Tt(I(a.x+-p.zy*t*54,24,2576),I(a.y+p.zx*t*54,24,1776),72+14*n,2.6+.55*n),xt(a.x,a.y,"#d7c1ff",10,70),m(176,.05,"sawtooth",.02)}if(a.apTele>0){if(a.apTele=Math.max(0,a.apTele-t),a.vx*=Math.max(0,1-13*t),a.vy*=Math.max(0,1-13*t),Math.random()<.6&&mt({x:a.x+A(-8,8),y:a.y+A(-8,8),vx:A(-26,26),vy:A(-26,26),t:A(.1,.2),c:"#dab9ff"}),Math.random()<.55&&mt({x:a.apAimX+A(-10,10),y:a.apAimY+A(-10,10),vx:A(-20,20),vy:A(-20,20),t:A(.08,.18),c:"#f4dcff"}),a.apTele<=0){const t=a.apAimX-a.x,e=a.apAimY-a.y,i=Math.hypot(t,e)||1,r=(a.apBurstSpd||860)+140*n+A(-45,60);a.vx+=t/i*r,a.vy+=e/i*r,a.ht=Math.max(a.ht,.18),ot(.2+.05*n),ht(.03),xt(a.x,a.y,"#c7a9ff",20,140),Tt(I(a.apAimX+A(-22,22),24,2576),I(a.apAimY+A(-22,22),24,1776),86+18*n,3.2+.8*n),l>=2&&Math.random()<.7&&kt(a,3===l?3:2,l),a.apBurstLeft=(0|a.apBurstLeft)-1,a.apBurstLeft>0?(a.apTeleD=Math.max(.18,.34-.04*n),a.apTele=a.apTeleD,a.apAimX=I(p.x+p.vx*(.7*o)+A(-30,30),20,2580),a.apAimY=I(p.y+p.vy*(.7*o)+A(-30,30),20,1780)):a.apCd=A(Math.max(.44,1.25-.26*n),Math.max(.8,1.95-.3*n)),m(145-8*n,.07,"sawtooth",.032)}}else if(a.apCd<=0){const t=s<180,e=s>360;let o=1===l?1:2===l?2:3;if(t&&l>=2&&o++,e&&1===l&&(o=2),a.apBurstLeft=o,a.apTeleD=Math.max(.24,.52-.08*n-(t?.08:0)),a.apTele=a.apTeleD,a.apAimX=h,a.apAimY=f,a.apBurstSpd=820+150*n+(e?90:0),Math.random()<.4+.2*n){const t=Math.random()<.5?-1:1;a.apAimX=I(a.apAimX+-r/s*t*(70+40*n),20,2580),a.apAimY=I(a.apAimY+i/s*t*(70+40*n),20,1780)}x.msg=3===l?"apex frenzy":"apex charging",x.msgT=.5,xt(a.x,a.y,"#b59bff",12+4*l,90+18*l),m(190-10*n,.05,"square",.02),l>=2&&a.apSummonCd<=0&&(kt(a,l,l),a.apSummonCd=A(Math.max(1.2,3-.6*n),Math.max(1.8,4.1-.7*n)))}if(a.apStormCd<=0&&!d&&(Tt(I(p.x+.32*p.vx+A(-36,36),24,2576),I(p.y+.32*p.vy+A(-36,36),24,1776),70+14*l,2.5+.65*l),l>=2&&Math.random()<.45&&Tt(I(a.x+A(-120,120),24,2576),I(a.y+A(-120,120),24,1776),64+10*l,2.2+.5*l),a.apStormCd=A(Math.max(.95,2.7-.5*n),Math.max(1.4,3.5-.55*n))),!d){const e=a.x-p.x,n=a.y-p.y,i=Math.hypot(e,n)||1,r=300+40*l;if(i<r){const a=(1-i/r)*(110+38*l);p.x=I(p.x+e/i*a*t,12,2588),p.y=I(p.y+n/i*a*t,12,1788),p.rx-=e/i*(1.5+.35*l),p.ry-=n/i*(1.3+.3*l)}}}const i=l-a.x,r=n-a.y,s=Math.hypot(i,r)||1;let o=1,h=0,f=0,c=0;for(let e=0;e<w.length;e++){const l=w[e],n=a.x-l.x,i=a.y-l.y,r=n*n+i*i;if(1===l.k){const e=1.9*l.r;if(r<e*e){const s=Math.sqrt(r)||1,h=1-s/e,f=120+h*h*390;a.vx+=-n/s*f*t,a.vy+=-i/s*f*t,o=Math.min(o,.8),r<l.r*l.r&&(o=Math.min(o,.48),c+=.95*p.chDo+7)}continue}if(!(r>=l.r*l.r))if(2===l.k)o=Math.min(o,.5);else if(3===l.k)o=Math.min(o,.72),c+=.75*p.chDo+4;else if(4===l.k){const e=Math.sqrt(r)||1,s=1-e/l.r,h=170+s*s*420;a.vx+=-n/e*h*t,a.vy+=-i/e*h*t,o=Math.min(o,.28),c+=2.1*p.chDo+22,(a.sc||0)<=0&&(a.sc=.24,xt(a.x,a.y,"#c8f3ff",4,34))}}a.sc>0&&(a.sc=Math.max(0,a.sc-t));for(let e=0;e<v.length;e++){const l=v[e],n=a.x-l.x,i=a.y-l.y,r=n*n+i*i,s=0|l.m;if(3===s){const e=2.35*l.r;if(r<e*e){const s=Math.sqrt(r)||1,c=1-s/e,b=90+c*c*350;a.vx+=-n/s*b*t,a.vy+=-i/s*b*t,o=Math.min(o,.88),r<l.r*l.r&&(f=3,o=Math.min(o,.42),h=1)}continue}if(r<l.r*l.r){f=s;const t=1===f?.3:2===f?.18:p.mkSl;o=Math.min(o,1-t),h=1,1===f&&p.cat&&a.ce<=0&&(a.ce=.55,a.hp-=p.chBurst,xt(a.x,a.y,"#ffd58f",5,44));break}}if(p.bot&&C.length)for(let t=0;t<C.length;t++){const e=C[t],l=a.x-e.x,n=a.y-e.y,i=l*l+n*n,r=J(0|e.t||1);i<400&&(o=Math.min(o,.65)),r.auraR>0&&i<r.auraR*r.auraR&&(o=Math.min(o,1-r.auraSl))}if(B&&C.length>=3){const l=C[0],n=C[1],i=C[2],r=a.r+20,s=r*r,h=R(a.x,a.y,l.x,l.y,n.x,n.y)<s||R(a.x,a.y,n.x,n.y,i.x,i.y)<s||R(a.x,a.y,i.x,i.y,l.x,l.y)<s,f=q(a.x,a.y,l.x,l.y,n.x,n.y,i.x,i.y);if((h||f)&&(o=Math.min(o,.52),(a.tc||0)<=0)){const t=p.zDmg*(a.k>=3?.58:.92);a.hp-=t,a.ht=.16;const l=a.x-p.x,n=a.y-p.y,i=Math.hypot(l,n)||1;if(a.vx+=l/i*360,a.vy+=n/i*360,a.tc=.09,F++,xt(a.x,a.y,"#8eefff",5,52),a.hp<=0){pt(e,"#8eefff",11,88,1),G++;continue}}a.tc>0&&(a.tc=Math.max(0,a.tc-t))}if(4===a.k){const t=a.apPhase||1;o=Math.max(o,t>=3?.72:2===t?.62:.54)}if(a.sl=h,h){const l=p.cat&&1===f?p.chDo:0;if(l>0&&(a.hp-=l*t),a.ht=Math.max(a.ht,.08),a.hp<=0){pt(e,"#f7d96b",8,60);continue}}if(c>0&&(a.hp-=c*t,a.ht=Math.max(a.ht,.11),a.hp<=0)){pt(e,"#c8f3ff",10,76,1);continue}a.ce>0&&(a.ce=Math.max(0,a.ce-t)),a.vx*=Math.max(0,1-8*t),a.vy*=Math.max(0,1-8*t),a.ht=Math.max(0,a.ht-t),a.x+=(i/s*a.s*o+a.vx)*t,a.y+=(r/s*a.s*o+a.vy)*t,X(a,6)&&(a.vx*=.4,a.vy*=.4);const b=p.x-a.x,y=p.y-a.y;if((Math.hypot(b,y)||1)<a.r+p.r-1){if(p.zt>0){if(a.hp-=p.zDmg,a.ht=.12,a.vx+=280*p.zx,a.vy+=280*p.zy,F++,a.hp<=0){pt(e,"#8fffe5",12,90,1),G++;continue}W+=.35*a.dmg;continue}4===a.k&&a.apImpactCd<=0&&!d&&(a.apImpactCd=.55,Tt(I(p.x+A(-16,16),24,2576),I(p.y+A(-16,16),24,1776),68+10*(a.apPhase||1),2.2+.35*(a.apPhase||1)),xt(p.x,p.y,"#e1c6ff",10,84),ot(.15)),W+=4===a.k?1.2*a.dmg:a.dmg}}var K;F>0&&(ht(Math.min(.04,.012*F)),ot(Math.min(.24,.04*F)),x.xpPulse=Math.min(.6,x.xpPulse+.06*F),m(260,.02,"square",.016),G>1&&m(310,.02,"square",.013)),W>0&&(K=W*t,p.zt>0&&(K*=p.zDr),p.hp-=K,ot(.03),p.hp<=0&&(p.hp=0,x.dead=1,x.start=1,x.kills>x.best&&(x.best=0|x.kills,localStorage.ss_best=x.best),x.msg="swarmed",x.msgT=999,ht(.09),ot(.42),m(120,.22,"sawtooth",.05),xt(p.x,p.y,"#ff6f89",26,130)));for(let e=z.length-1;e>=0;e--){const a=z[e],l=p.x-a.x,n=p.y-a.y,i=Math.hypot(l,n)||1;if(p.bot&&C.length)if(a.bc){const e=(0|a.bc)-1,l=e>=0&&e<C.length?C[e]:C[0],n=J(0|l.t||1),i=l.x-a.x,r=l.y-a.y,s=Math.hypot(i,r)||1,o=Math.min(1.3*n.pull,13*s);a.x+=i/s*o*t,a.y+=r/s*o*t}else{let e=0;for(let t=0;t<C.length;t++)e+=J(0|C[t].t||1).carry;if(p.bCarry<e&&i>1.45*p.magnet)for(let e=0;e<C.length;e++){const l=C[e];if(l.grabCd>0)continue;const n=J(0|l.t||1),i=l.x-a.x,r=l.y-a.y,s=Math.hypot(i,r)||1;if(s<n.fetch){a.x+=i/s*n.pull*t,a.y+=r/s*n.pull*t,s<10&&(a.bc=e+1,p.bCarry++,l.grabCd=n.grab,xt(a.x,a.y,"#9de6ff",3,24));break}}}i<p.magnet&&(a.x+=l/i*240*t,a.y+=n/i*240*t),i<p.r+8&&zt(e,a.bc?"bot":"player")}(g.gr||M)&&Math.random()<.04&&x.time>2&&dt({x:I(p.x+A(-20,20),12,2588),y:I(p.y+A(-20,20),12,1788),v:4,m:1,t:0})}(b),function(){const t=x.shake*x.shake,i=10*(2*Math.random()-1)*t,h=10*(2*Math.random()-1)*t;e.setTransform(n,0,0,n,i,h);const c=I(p.x-.5*a,0,2600-a),b=I(p.y-.5*l,0,1800-l),m=e.createLinearGradient(0,0,0,l);m.addColorStop(0,"#263f60"),m.addColorStop(.55,"#16273f"),m.addColorStop(1,"#0b111a"),e.fillStyle=m,e.fillRect(0,0,a,l),e.strokeStyle="rgba(63,96,132,.35)",e.lineWidth=1;const d=-c%56;for(let t=-b%56;t<l;t+=56)e.beginPath(),e.moveTo(0,0|t),e.lineTo(a,0|t),e.stroke();for(let t=d;t<a;t+=56)e.beginPath(),e.moveTo(0|t,0),e.lineTo(0|t,l),e.stroke();const y=1300-c,g=900-b;e.fillStyle="rgba(105,240,201,.07)",e.beginPath(),e.arc(y,g,210,0,2*Math.PI),e.fill();const u=O(p.x,p.y,-8);for(let t=0;t<r.length;t++){const n=r[t],i=n.x-c,h=n.y-b;if(i<-n.r-30||h<-n.r-30||i>a+n.r+30||h>l+n.r+30)continue;const f="home"===n.id?0:2===x.sch[n.id],m="home"===n.id?!p.mkOn:1===x.sch[n.id]||"nsh"===n.id&&(0===x.sch.nsh||2===x.sch.nsh&&x.labNsh>0)||"mel"===n.id&&(2===x.sch.nsh&&0===x.sch.mel||2===x.sch.mel&&x.labMel>0);e.globalAlpha=f?.18:m?.14:.08,e.fillStyle=n.c,e.beginPath(),e.arc(i,h,n.r,0,2*Math.PI),e.fill(),e.globalAlpha=.65,e.strokeStyle=f?"#9effc8":n.c,e.lineWidth=2,e.beginPath(),e.arc(i,h,n.r,0,2*Math.PI),e.stroke(),e.globalAlpha=1,e.fillStyle="#dce8ff",e.font="600 12px Trebuchet MS,sans-serif",e.fillText(n.n,i-n.r+10,h-n.r-8);const d="home"===n.id?48:44,y=30,g=i-.5*d,M=h-.5*y;if(e.fillStyle="rgba(18,25,37,.9)",e.fillRect(g,M,d,y),e.strokeStyle="rgba(165,190,220,.55)",e.lineWidth=1,e.strokeRect(g+.5|0,M+.5|0,d-1,y-1),e.fillStyle="rgba(248,234,164,.86)",e.fillRect(g+6|0,M+6|0,11,8),e.fillRect(g+d-17|0,M+6|0,11,8),e.fillStyle="rgba(44,56,72,.95)",e.beginPath(),e.arc(g+11+Math.sin(2*x.t+t),M+11,1.7,0,2*Math.PI),e.fill(),e.beginPath(),e.arc(g+d-11+Math.sin(2*x.t+t+1),M+11,1.7,0,2*Math.PI),e.fill(),x.start&&!x.dead){const a=u?o:s,l=a[(.45*x.t+2*t|0)%a.length],r=h-.44*n.r,f=4.6*l.length+12;e.fillStyle="rgba(8,12,20,.82)",B(i-.5*f,r-9,f,16,7),e.fill(),e.fillStyle="rgba(220,240,255,.9)",e.font="600 9px Trebuchet MS,sans-serif",e.fillText(l,i-.5*f+6,r+3)}}for(let t=0;t<z.length;t++){const n=z[t],i=n.x-c,r=n.y-b;i<-10||r<-10||i>a+10||r>l+10||(e.fillStyle="#69f0c9",e.beginPath(),e.arc(i,r,5,0,2*Math.PI),e.fill(),e.fillStyle="#ceffef",e.fillRect(i-1|0,r-1|0,2,2))}for(let t=0;t<v.length;t++){const n=v[t],i=n.x-c,r=n.y-b;if(i<-n.r-20||r<-n.r-20||i>a+n.r+20||r>l+n.r+20)continue;const s=n.t/n.d;e.globalAlpha=.12+.1*s;let o="#f4d96e",h="#fff0a9";p.cat&&(1===n.m?(o="#53d93d",h="#baff87"):2===n.m?(o="#42cdb9",h="#a8f6ea"):3===n.m&&(o="#597fd6",h="#bdd4ff")),e.fillStyle=o,e.beginPath(),e.arc(i,r,n.r,0,2*Math.PI),e.fill(),e.globalAlpha=.2+.2*Math.sin(5*(x.t+t))*s,e.strokeStyle=h,e.lineWidth=1.5,e.beginPath(),e.arc(i,r,.68*n.r+2*Math.sin(4*(x.t+t)),0,2*Math.PI),e.stroke(),p.cat&&(3===n.m&&(e.globalAlpha=.1+.08*s,e.strokeStyle="rgba(175,205,255,.72)",e.lineWidth=1.25,e.beginPath(),e.arc(i,r,2.35*n.r*(.97+.03*Math.sin(2*x.t+t)),0,2*Math.PI),e.stroke(),e.globalAlpha=.08+.07*s,e.strokeStyle="rgba(140,174,255,.58)",e.lineWidth=1,e.beginPath(),e.arc(i,r,1.6*n.r*(.96+.04*Math.sin(2.7*x.t+.8*t)),0,2*Math.PI),e.stroke()),e.globalAlpha=.18+.24*s,1===n.m?e.fillStyle="#dbff8f":2===n.m?e.fillStyle="#d8fff7":3===n.m?e.fillStyle="#e1ebff":e.fillStyle="#f1ffb3",e.beginPath(),e.arc(i+Math.sin(4*x.t+t)*n.r*.22,r-.16*n.r,2.4+.7*Math.sin(7*x.t+t),0,2*Math.PI),e.fill(),e.beginPath(),e.arc(i-.18*n.r,r+Math.sin(3*x.t+.7*t)*n.r*.14,1.9+.5*Math.sin(8*x.t+.4*t),0,2*Math.PI),e.fill(),e.beginPath(),e.arc(i+.12*n.r,r+.2*n.r,1.6+.4*Math.sin(6*x.t+.5*t),0,2*Math.PI),e.fill()),e.globalAlpha=1}for(let t=0;t<w.length;t++){const n=w[t],i=n.x-c,r=n.y-b;if(i<-n.r-40||r<-n.r-40||i>a+n.r+40||r>l+n.r+40)continue;const s=n.t/n.d,o=.86+.12*Math.sin(5*x.t+t),h=n.r*o;let f="#95f0b8",m="#d6ffea",d="#6ae9b4";if(2===n.k?(f="#7cf6e7",m="#d8fff7",d="#a0fff0"):3===n.k?(f="#c5f690",m="#efffd0",d="#d9ffab"):4===n.k&&(f="#bde9ff",m="#f0fbff",d="#d4f2ff"),e.globalAlpha=.14+.16*s,e.fillStyle=f,e.beginPath(),e.arc(i,r,h,0,2*Math.PI),e.fill(),e.globalAlpha=.28+.24*s,e.strokeStyle=m,e.lineWidth=2,e.beginPath(),e.arc(i,r,.78*h,0,2*Math.PI),e.stroke(),e.globalAlpha=.2+.2*s,e.strokeStyle=d,e.lineWidth=1.4,e.beginPath(),e.arc(i,r,h*(1.08+.05*Math.sin(7*x.t+t)),0,2*Math.PI),e.stroke(),4===n.k)for(let t=0;t<3;t++){const a=5.6*x.t+2.1*t,l=i+Math.cos(a)*h*.62,n=r+Math.sin(a)*h*.62;e.globalAlpha=.5+.3*s,e.fillStyle="#f2fcff",e.beginPath(),e.arc(l,n,2.3,0,2*Math.PI),e.fill()}e.globalAlpha=1}for(let t=0;t<k.length;t++){const n=k[t],i=n.x-c,r=n.y-b;if(i<-40||r<-40||i>a+40||r>l+40)continue;const s=4===n.k?"#713ce8":3===n.k?"#a789ff":2===n.k?"#665a78":1===n.k?"#5687a1":n.sl?"#70805a":"#4b667f";if(e.fillStyle=n.ht>0?"#9db4d1":s,e.beginPath(),e.arc(i,r,n.r,0,2*Math.PI),e.fill(),e.fillStyle="#f0627c",e.fillRect(i-4|0,r-2|0,3,3),e.fillRect(i+1|0,r-2|0,3,3),4===n.k){const a=I(n.hp/(n.apMax||n.hp||1),0,1),l=a>.66?"#bfa1ff":a>.33?"#d8b4ff":"#ffb6f2",s=Math.hypot(n.vx||0,n.vy||0);if(s>220){const a=(n.vx||0)/(s||1),l=(n.vy||0)/(s||1);e.globalAlpha=.14+.06*Math.sin(20*x.t+t),e.fillStyle="rgba(165,126,242,.7)",e.beginPath(),e.ellipse(i-a*(18+.02*s),r-l*(18+.02*s),.7*n.r,.44*n.r,Math.atan2(l,a),0,2*Math.PI),e.fill()}if(e.globalAlpha=.25+.12*Math.sin(8*x.t+t),e.strokeStyle=l,e.lineWidth=2,e.beginPath(),e.arc(i,r,n.r+10+2*Math.sin(6*x.t+t),0,2*Math.PI),e.stroke(),n.apTele>0&&void 0!==n.apAimX){const t=1-I(n.apTele/(n.apTeleD||.001),0,1),a=n.apAimX-c,l=n.apAimY-b;e.globalAlpha=.22+.5*t,e.strokeStyle="#f2d6ff",e.lineWidth=2.2+1.8*t,e.setLineDash([7,6]),e.lineDashOffset=90*-x.t,e.beginPath(),e.moveTo(i,r),e.lineTo(a,l),e.stroke(),e.setLineDash([]),e.beginPath(),e.arc(a,l,26+26*t,0,2*Math.PI),e.stroke(),e.globalAlpha=.12+.3*t,e.fillStyle="rgba(234,203,255,.85)",e.beginPath(),e.arc(a,l,18+22*t,0,2*Math.PI),e.fill(),e.fillStyle="rgba(248,232,255,.75)",e.beginPath(),e.arc(a,l,3.2,0,2*Math.PI),e.fill()}e.globalAlpha=1}}for(let t=0;t<T.length;t++){const a=T[t],l=a.x-c,n=a.y-b;if(a.pulse){const t=a.r||8;e.fillStyle="rgba(157,230,255,.2)",e.beginPath(),e.arc(l,n,1.4*t,0,2*Math.PI),e.fill(),e.strokeStyle=a.c||"#9de6ff",e.lineWidth=2,e.beginPath(),e.arc(l,n,t,0,2*Math.PI),e.stroke(),e.fillStyle="rgba(224,250,255,.88)",e.beginPath(),e.arc(l,n,.34*t,0,2*Math.PI),e.fill()}else e.fillStyle=a.c||"#ffd56d",e.fillRect(l-2|0,n-2|0,4,4)}const A=p.x-c+p.rx,R=p.y-b+p.ry,D=Math.abs(p.vx)>=Math.abs(p.vy)?p.face>0?f.e:f.w:p.vy<0?p.face>0?f.ne:f.nw:p.face>0?f.se:f.sw;if(e.fillStyle="rgba(0,0,0,.35)",e.beginPath(),e.ellipse(A,R+14,17,6,0,0,2*Math.PI),e.fill(),D&&D.complete?e.drawImage(D,A-22,R-18,44,30):(e.fillStyle="#0b0f14",e.beginPath(),e.arc(A,R,12,0,2*Math.PI),e.fill(),e.fillStyle="#ef4f6c",e.fillRect(A+3|0,R-6|0,7,3)),p.bHealFx>0){const t=Math.min(1,p.bHealFx/.7),a=24+2*Math.sin(18*x.t);e.globalAlpha=.18+.26*t,e.fillStyle="#79f2ad",e.beginPath(),e.arc(A,R,a+9*t,0,2*Math.PI),e.fill(),e.globalAlpha=.55+.35*t,e.strokeStyle="#bfffd6",e.lineWidth=2.2,e.beginPath(),e.arc(A,R,a,0,2*Math.PI),e.stroke(),e.globalAlpha=1}if(p.bot&&C.length){for(let t=0;t<C.length;t++){const a=J(0|C[t].t||1),l=a.body,n=a.ring,i=C[t],r=i.x-c,s=i.y-b;e.fillStyle="rgba(0,0,0,.25)",e.beginPath(),e.ellipse(r,s+8,11,4,0,0,2*Math.PI),e.fill(),e.fillStyle=l,e.beginPath(),e.arc(r,s,9,0,2*Math.PI),e.fill(),e.fillStyle="#16314a",e.fillRect(r-3|0,s-2|0,2,2),e.fillRect(r+1|0,s-2|0,2,2),e.strokeStyle=n,e.lineWidth=1.2,e.beginPath(),e.arc(r,s,12+1.5*Math.sin(9*x.t+t),0,2*Math.PI),e.stroke(),a.auraR>0&&(e.strokeStyle="rgba(255,231,176,.42)",e.lineWidth=1.5,e.beginPath(),e.arc(r,s,a.auraR*(.84+.08*Math.sin(4*x.t+.7*t)),0,2*Math.PI),e.stroke())}if(p.zt>0&&C.length>=3){const t=C[0],a=C[1],l=C[2],n=t.x-c,i=t.y-b,r=a.x-c,s=a.y-b,o=l.x-c,h=l.y-b,f=.35+.65*Math.max(p.triFx,p.zt/p.zDur);e.globalAlpha=.15+.14*f,e.fillStyle="rgba(126,236,255,.9)",e.beginPath(),e.moveTo(n,i),e.lineTo(r,s),e.lineTo(o,h),e.closePath(),e.fill(),e.globalAlpha=.62+.3*f,e.strokeStyle="#9de6ff",e.lineWidth=2.6,e.beginPath(),e.moveTo(n,i),e.lineTo(r,s),e.lineTo(o,h),e.closePath(),e.stroke();const m=3.6*x.t,d=[[n,i,r,s,0],[r,s,o,h,.33],[o,h,n,i,.66]];for(let t=0;t<3;t++){const a=d[t],l=(m+a[4])%1,n=a[0]+(a[2]-a[0])*l,i=a[1]+(a[3]-a[1])*l;e.fillStyle="rgba(213,250,255,.95)",e.beginPath(),e.arc(n,i,2.4,0,2*Math.PI),e.fill()}e.globalAlpha=1}if(p.bCarry>0){const t=C[0].x-c,a=C[0].y-b;e.fillStyle="rgba(6,10,16,.84)",e.beginPath(),e.arc(t+10,a-10,8,0,2*Math.PI),e.fill(),e.fillStyle="#dfffff",e.font="700 10px Trebuchet MS,sans-serif",e.fillText(""+p.bCarry,t+7,a-7)}}if(p.mkS>0&&p.zt<=0){const t=p.face>0?-1:1,a=I(p.mkS/.32,0,1),l=A+13*t,n=R+8,i=l+t*(11+2.2*Math.sin(36*x.t)),r=n+7+1.1*Math.sin(22*x.t);e.strokeStyle="rgba(248,220,112,"+(.38+.45*a)+")",e.lineWidth=2,e.beginPath(),e.moveTo(l,n),e.quadraticCurveTo(.5*(l+i),n+2,i,r),e.stroke(),e.fillStyle="rgba(250,214,103,.72)",e.beginPath(),e.arc(i+2*t,r+2,2.1,0,2*Math.PI),e.fill(),e.fillStyle="rgba(244,205,93,.38)",e.beginPath(),e.ellipse(i+5*t,r+7,5.2,2.7,0,0,2*Math.PI),e.fill()}if((p.zc>0||p.zcd>0)&&p.zt<=0){const t=p.zcd>0?0:Math.min(1,p.zc/p.zLoad),a=t<=0?Math.max(0,1-p.zcd/p.zCool):0,l=18+8*t+1.2*Math.sin(22*x.t);e.strokeStyle=p.zr?"#8fffe5":"#ffd56d",e.lineWidth=2+1.8*t,e.beginPath(),e.arc(A,R,l,.5*-Math.PI,.5*-Math.PI+2*Math.PI*t),e.stroke(),p.zcd>0&&(e.strokeStyle="rgba(158,200,255,.7)",e.lineWidth=2,e.beginPath(),e.arc(A,R,16,.5*-Math.PI,.5*-Math.PI+2*Math.PI*a),e.stroke())}if(p.zt>0){const t=p.zt/2;e.strokeStyle="rgba(143,255,229,.7)",e.lineWidth=2.5,e.beginPath(),e.arc(A,R,20+2*Math.sin(30*x.t)+4*t,0,2*Math.PI),e.stroke(),e.fillStyle="rgba(143,255,229,.16)",e.beginPath(),e.ellipse(A-10*p.zx,R-7*p.zy,20,10,Math.atan2(p.zy,p.zx),0,2*Math.PI),e.fill()}p.flash>0&&(e.globalAlpha=p.flash/.07,e.fillStyle="#ffe598",e.beginPath(),e.moveTo(A+16*p.gx,R+8*p.gy),e.lineTo(A+24*p.gx-5*p.gy,R+24*p.gy+4*p.gx),e.lineTo(A+24*p.gx+5*p.gy,R+24*p.gy-4*p.gx),e.closePath(),e.fill(),e.globalAlpha=1);for(let t=0;t<P.length;t++){const n=P[t],i=n.x-c,r=n.y-b;i<-8||r<-8||i>a+8||r>l+8||(e.globalAlpha=Math.max(0,Math.min(1,2.4*n.t)),e.fillStyle=n.c,e.fillRect(0|i,0|r,3,3))}e.globalAlpha=1;const q=44,E=a-18-q,X=a<420;let N=62,K=74;const Y=Math.max(96,a-190);if(e.fillStyle="rgba(7,10,16,.76)",e.fillRect(10,10,a-20,104),e.fillStyle="#eef4ff",e.font="700 17px Trebuchet MS,sans-serif",e.fillText("SCOTTY",20,32),X){const t=52,a=E-8;e.font="600 12px Trebuchet MS,sans-serif",e.fillStyle="#9ec8ff",e.fillText("Time "+x.time.toFixed(1)+"s",20,t),e.fillStyle="#ffd56d",e.fillText("Kills "+x.kills,118,t),e.textAlign="right",e.fillStyle="#dce8ff",e.fillText("Best "+x.best,a,t),e.textAlign="left",N=62,K=74}else e.font="600 14px Trebuchet MS,sans-serif",e.fillStyle="#9ec8ff",e.fillText("Time "+x.time.toFixed(1)+"s",20,54),e.fillStyle="#ffd56d",e.fillText("Kills "+x.kills,150,54),e.textAlign="right",e.fillStyle="#dce8ff",e.fillText("Best "+x.best,a-24,54),e.textAlign="left";e.fillStyle="#2a3346",e.fillRect(20,N,Y,10),e.fillStyle="#ef4f6c",e.fillRect(20,N,Y*(p.hp/p.maxHp),10),e.fillStyle="#24374d",e.fillRect(20,K,Y,8),e.fillStyle="#69f0c9",e.fillRect(20,K,Y*(x.xp/x.nextXp),8);let _=0;for(let t=0;t<k.length;t++)if(4===k[t].k){_=k[t];break}let U=118;if(_){const t=I(_.hp/(_.apMax||_.hp||1),0,1),l=_.apPhase||1,n=1===l?"ALPHA":2===l?"RAGE":"OMEGA",i=I(.58*a,220,620),r=12,s=.5*(a-i),o=U+2;e.fillStyle="rgba(10,14,22,.88)",B(s-10,o-18,i+20,38,11),e.fill();const h=e.createLinearGradient(0,o,0,o+r);h.addColorStop(0,"rgba(54,71,103,.95)"),h.addColorStop(1,"rgba(30,40,63,.95)"),e.fillStyle=h,e.fillRect(s,o,i,r);const f=e.createLinearGradient(s,0,s+i,0);1===l?(f.addColorStop(0,"#9a7dff"),f.addColorStop(1,"#c8b6ff")):2===l?(f.addColorStop(0,"#d28cff"),f.addColorStop(1,"#ffbfd8")):(f.addColorStop(0,"#ff8bd9"),f.addColorStop(1,"#ffc3f1")),e.fillStyle=f,e.fillRect(s,o,i*t,r),e.strokeStyle="rgba(220,234,255,.65)",e.lineWidth=1.2,e.strokeRect(s+.5,o+.5,i-1,r-1),e.fillStyle="#f4ecff",e.font="700 11px Trebuchet MS,sans-serif",e.textAlign="center",e.fillText("APEX DEAN // "+n,s+.5*i,o-7),e.textAlign="left",U+=34}const V=p.mkOn?x.bd2?"campus secured":x.bs2?"defeat apex boss":x.bd?"apex signal rising":x.bs?"defeat boss":x.pz&&"nsh"===x.pz.id?"solve nsh puzzle":x.pz&&"mel"===x.pz.id?"solve mellon puzzle":0===x.sch.nsh?"find nsh":1===x.sch.nsh?"solve nsh puzzle":0===x.sch.mel?"find mellon institute":1===x.sch.mel?"solve mellon puzzle":x.labNsh>0&&x.labMel>0?"visit nsh / mellon for prototype upgrades":x.labNsh>0?"visit nsh for buddy prototype":x.labMel>0?"visit mellon institute for catalyst prototype":2===x.sch.mel&&x.kills<20?"defeat 20 enemies to summon boss":"survive phase 2":"collect mints "+x.homeGot+"/"+x.homeNeed;if(e.fillStyle="rgba(8,12,19,.62)",e.fillRect(14,U,a-28,26),e.fillStyle="#d7ffe8",e.font="600 12px Trebuchet MS,sans-serif",e.fillText(V,22,U+17),x.start&&!x.dead){const t=(t,a,l,n,i,r)=>{e.fillStyle="rgba(8,12,19,.92)",e.fillRect(E,t,q,q),e.strokeStyle=n?a:"rgba(129,157,187,.7)",e.lineWidth=2,e.strokeRect(E+.5,t+.5,43,43),e.strokeStyle="rgba(72,88,109,.85)",e.lineWidth=3,e.beginPath(),e.arc(E+22,t+22,14.96,0,2*Math.PI),e.stroke(),e.strokeStyle=a,e.beginPath(),e.arc(E+22,t+22,14.96,.5*-Math.PI,.5*-Math.PI+2*Math.PI*I(l,0,1)),e.stroke(),e.fillStyle=a,r<1?(e.beginPath(),e.moveTo(E+21.56,t+8.36),e.lineTo(E+.35*q,t+23.32),e.lineTo(E+21.56,t+23.32),e.lineTo(E+17.16,t+36.08),e.lineTo(E+29.48,t+18.04),e.lineTo(E+22.44,t+18.04),e.closePath(),e.fill()):r<2?(e.beginPath(),e.arc(E+22,t+19.36,4.4,0,2*Math.PI),e.fill(),e.beginPath(),e.moveTo(E+22,t+8.8),e.bezierCurveTo(E+30.36,t+19.8,E+28.16,t+29.48,E+22,t+34.32),e.bezierCurveTo(E+15.84,t+29.48,E+13.64,t+19.8,E+22,t+8.8),e.fill()):(e.lineWidth=2,e.beginPath(),e.arc(E+22,t+22,.12*q,0,2*Math.PI),e.stroke(),e.beginPath(),e.arc(E+22,t+22,9.68,0,2*Math.PI),e.stroke()),i>0?(e.fillStyle="#dce8ff",e.font="700 10px Trebuchet MS,sans-serif",e.fillText(i.toFixed(1)+"s",E+8,t+q-6)):n&&(e.fillStyle="rgba(255,255,255,.8)",e.beginPath(),e.arc(E+q-8,t+8,3,0,2*Math.PI),e.fill())};t(14,"#8fffe5",p.zcd>0?1-p.zcd/p.zCool:p.zr?1:p.zc/p.zLoad,p.zt>0,p.zcd>0?p.zcd:0,0);const a=p.mkOn?p.mkT>0?1-p.mkT/p.mkI:1:0;t(66,p.cat?1===p.catType?"#8fdd73":2===p.catType?"#7ad8cd":3===p.catType?"#8fb6ff":"#f4d96e":"#f4d96e",a,p.mkS>0,p.mkOn&&p.mkT>0?p.mkT:0,1);const l=p.rf?p.rfT>0?1-p.rfT/p.rfI:1:0;p.rf&&t(118,"#a8b8ff",l,1,p.rfT>0?p.rfT:0,2),p.cat&&(e.fillStyle="rgba(7,10,16,.75)",e.fillRect(E-56,78,50,20),e.fillStyle="#dce8ff",e.font="600 10px Trebuchet MS,sans-serif",e.fillText(Z(),E-50,91))}if(x.msgT>0&&(e.fillStyle="rgba(8,12,19,.74)",e.fillRect(14,U+30,a-28,28),e.fillStyle="#d7ffe8",e.font="600 13px Trebuchet MS,sans-serif",e.fillText(x.msg,22,U+49)),x.bossDownT>0){const t=I(x.bossDownT/2.4,0,1),n=.96+.08*Math.sin(18*x.t)*t,i=.5*a,r=.52*l;e.fillStyle="rgba(7,10,16,"+(.2+.26*t)+")",e.fillRect(0,0,a,l),e.save(),e.translate(i,r),e.scale(n,n),e.translate(-i,-r),e.textAlign="center",e.fillStyle="rgba(255,227,143,"+(.44+.4*t)+")",e.font=(a<520?"700 30px":"700 40px")+" Trebuchet MS,sans-serif",e.fillText("BOSS DOWN",i,r-8),e.fillStyle="rgba(209,231,255,"+(.58+.32*t)+")",e.font=(a<520?"600 13px":"600 15px")+" Trebuchet MS,sans-serif",e.fillText("Apex signal detected",i,r+20),e.restore(),e.textAlign="left"}if(x.start&&!x.dead&&!x.lvup&&!x.pz&&S.show>.01){const t=S.x+S.tx,a=S.y+S.ty;e.fillStyle="rgba(7,11,17,"+.42*S.show+")",e.beginPath(),e.arc(S.x,S.y,S.r+8,0,2*Math.PI),e.fill(),e.strokeStyle="rgba(158,200,255,"+.45*S.show+")",e.lineWidth=2,e.beginPath(),e.arc(S.x,S.y,S.r,0,2*Math.PI),e.stroke(),e.fillStyle="rgba(105,240,201,"+(M?.65:.42)*S.show+")",e.beginPath(),e.arc(t,a,S.kr,0,2*Math.PI),e.fill(),e.strokeStyle="rgba(220,248,255,"+.65*S.show+")",e.lineWidth=1.5,e.beginPath(),e.arc(t,a,S.kr,0,2*Math.PI),e.stroke()}if(!x.start){const t=20,n=.16*l,i=a-40,r=.68*l,s=t+16;e.fillStyle="rgba(6,9,14,.86)",e.fillRect(t,n,i,r),e.fillStyle="#fff",e.font="700 30px Trebuchet MS,sans-serif",e.fillText("Project: Zoomies",s,n+42),e.fillStyle="#9ec8ff",e.font="600 15px Trebuchet MS,sans-serif",e.fillText("what the dog doing?",s,n+64),e.fillStyle="#d8e6ff",e.font="600 14px Trebuchet MS,sans-serif",W("Goop swallowed CMU paths. People are trapped inside buildings. Scotty is the only one fast enough to move across campus.",s,n+98,i-32,18,5),e.fillStyle="#9ec8ff",e.font="600 13px Trebuchet MS,sans-serif",W("Collaborate with each college, unlock abilities, and defeat the infestation. Overlap different puddles to make combo zones.",s,n+200,i-32,17,3),e.fillStyle="#dce8ff",e.font="600 12px Trebuchet MS,sans-serif",W("Controls: drag to move. Remove finger to charge Zoomies, then move to dash. Different puddles can mix into stronger effects.",s,n+250,i-32,16,4),e.fillStyle="#69f0c9",e.font="700 23px Trebuchet MS,sans-serif",e.fillText("tap start",s,n+r-22)}if(x.lvup&&!x.dead){e.fillStyle="rgba(6,10,15,.16)",e.fillRect(0,0,a,l);const t=L(),n=t.bx,i=t.by,r=t.bw,s=t.bh,o=t.rects,h=t.mobile;e.fillStyle="rgba(17,29,45,.95)",B(n,i,r,s,16),e.fill(),e.strokeStyle="rgba(90,125,163,.8)",e.lineWidth=1.2,B(n+.5,i+.5,r-1,s-1,16),e.stroke(),e.fillStyle="#ecf3ff",e.font=(h?"700 18px":"700 20px")+" Trebuchet MS,sans-serif",e.fillText("SKILL BOOK",n+14,i+24),e.fillStyle="#9ec8ff",e.font="600 12px Trebuchet MS,sans-serif",e.fillText("choose",n+14,i+39);for(let t=0;t<3;t++){const a=x.choices[t],l=o[t],n=.9+.1*H(I((x.cardT-.07*t)/.28,0,1)),i=l.x+.5*l.w,r=l.y+.5*l.h;e.save(),e.translate(i,r),e.scale(n,n),e.translate(-i,-r);const s=a&&a.bg?a.bg:"rgba(27,44,66,.96)",f=a&&a.st?a.st:"rgba(116,150,186,.85)",c=a&&a.tx?a.tx:"#eef5ff",b=a&&a.sub?a.sub:"#a9c3e2";if(e.fillStyle=s,B(l.x,l.y,l.w,l.h,10),e.fill(),e.strokeStyle=f,e.lineWidth=1.2,B(l.x+.5,l.y+.5,l.w-1,l.h-1,10),e.stroke(),a){const t=F(a.n)+" "+a.n;let n=h?16:17;for(;n>12&&(e.font="700 "+n+"px Trebuchet MS,sans-serif",!(e.measureText(t).width<=l.w-22));n--);e.fillStyle=c,e.fillText(t,l.x+12,l.y+30),e.fillStyle=b,e.font="600 12px Trebuchet MS,sans-serif",W(a.d,l.x+12,l.y+48,l.w-24,14,2)}e.restore()}e.fillStyle="#95bce8",e.font="600 12px Trebuchet MS,sans-serif",e.fillText("tap 1/2/3",n+14,i+s-12)}if(x.pz&&!x.dead&&!x.lvup&&x.start){const t=G(),n=x.pz;if(e.fillStyle="rgba(5,9,14,.5)",e.fillRect(0,0,a,l),e.fillStyle="rgba(16,24,37,.96)",B(t.bx,t.by,t.bw,t.bh,14),e.fill(),e.strokeStyle="rgba(106,145,185,.85)",e.lineWidth=1.2,B(t.bx+.5,t.by+.5,t.bw-1,t.bh-1,14),e.stroke(),e.fillStyle="#ecf3ff",e.font="700 19px Trebuchet MS,sans-serif",e.fillText("nsh"===n.id?"NSH lab":"Mellon lab",t.bx+14,t.by+27),"nsh"===n.id){e.fillStyle="#dce8ff",e.font="600 12px Trebuchet MS,sans-serif",e.fillText("order",t.bx+14,t.by+66);for(let a=0;a<n.seq.length;a++){const l=t.bx+24+34*a,i=t.by+86,r=a<n.step;e.fillStyle=r?"#8cffc2":"#79d7ff",e.beginPath(),e.arc(l,i,12,0,2*Math.PI),e.fill(),e.fillStyle="#12243a",e.font="700 11px Trebuchet MS,sans-serif",e.fillText(n.seq[a]+1+"",l-3,i+4)}}else{const a=["#8fd3ff","#ffd58f","#ff9fb7"];e.fillStyle="#dce8ff",e.font="600 12px Trebuchet MS,sans-serif",e.fillText("mix",t.bx+14,t.by+66);for(let l=0;l<n.seq.length;l++){const i=t.bx+24+30*l,r=t.by+86,s=l<n.step;e.fillStyle=a[n.seq[l]],e.beginPath(),e.arc(i,r,10,0,2*Math.PI),e.fill(),s&&(e.strokeStyle="#8cffc2",e.lineWidth=2,e.beginPath(),e.arc(i,r,12,0,2*Math.PI),e.stroke())}}for(let a=0;a<3;a++){const l=t.btn[a];e.fillStyle="nsh"===n.id?"rgba(37,87,129,.96)":["#3c6588","#9a6f3f","#8e4f64"][a],B(l.x,l.y,l.w,l.h,10),e.fill(),e.strokeStyle="rgba(196,223,255,.72)",e.lineWidth=1.1,B(l.x+.5,l.y+.5,l.w-1,l.h-1,10),e.stroke(),e.fillStyle="#eef5ff",e.font="700 13px Trebuchet MS,sans-serif",e.fillText("nsh"===n.id?"terminal "+(a+1):["blue","amber","rose"][a],l.x+9,l.y+28)}e.fillStyle="#9ec8ff",e.font="600 11px Trebuchet MS,sans-serif",e.fillText("tap 1/2/3",t.bx+14,t.by+t.bh-10)}x.dead&&(e.fillStyle="rgba(5,8,13,.86)",e.fillRect(24,.24*l,a-48,.5*l),e.fillStyle="#ff8298",e.font="700 33px Trebuchet MS,sans-serif",e.fillText("GAME OVER",.5*a-98,.38*l),e.fillStyle="#dce8ff",e.font="600 20px Trebuchet MS,sans-serif",e.fillText("Kills "+x.kills,.5*a-43,.47*l),e.fillText("Best "+x.best,.5*a-37,.53*l),e.fillStyle="#69f0c9",e.font="700 24px Trebuchet MS,sans-serif",e.fillText("tap retry",.5*a-56,.65*l))}(),requestAnimationFrame(t)})})();</script></body></html>