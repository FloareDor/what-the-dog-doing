<!doctype html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover"><title>Scotty Survival</title><style>:root{--bg:#0a0d12;--sky:#1a2940;--ink:#ecf3ff;--red:#ef4f6c;--mint:#69f0c9;--gold:#ffd56d;--line:#2f4868}*{box-sizing:border-box}html,body{margin:0;width:100%;height:100%;overflow:hidden;background:var(--bg);color:var(--ink);font-family:Trebuchet MS,Avenir Next,Segoe UI,sans-serif}body{touch-action:none}canvas{display:block;width:100%;height:100%}</style></head><body><canvas id="c"></canvas><script>(()=>{const t=document.getElementById("c"),e=t.getContext("2d");let l=360,a=740,n=1,i=0;const r=[{id:"home",n:"Cohon Centre",x:260,y:900,r:170,c:"#8ec0ff"},{id:"nsh",n:"NSH",x:980,y:460,r:170,c:"#79d7ff"},{id:"mel",n:"Mellon Inst",x:1880,y:1260,r:185,c:"#ffd58f"}],s=["i need to go out","these things are scary","may lord help us","can we ever go out?"],f=["a dog?","scotty??","what the dog doing?"],o={};function h(t){const e=new Image;return e.src="black_scottish_terrier_dog_with_red_scarf/rotations/"+t+".png",e}o.e=h("east"),o.w=h("west"),o.ne=h("north-east"),o.nw=h("north-west"),o.se=h("south-east"),o.sw=h("south-west");let c=0;function b(t,e,l,a){if(!c)return;const n=c.createOscillator(),i=c.createGain();n.type=l||"triangle",n.frequency.value=t,i.gain.value=a||.02,i.gain.exponentialRampToValueAtTime(1e-4,c.currentTime+e),n.connect(i).connect(c.destination),n.start(),n.stop(c.currentTime+e)}let d=0;function y(){if(!m.start)return;const t=performance.now();t-d<1200||(d=t,b(392,.07,"square",.02),b(523,.08,"triangle",.014))}const m={start:0,dead:0,lvup:0,t:0,time:0,kills:0,spawnT:0,nextSpawn:.8,msg:"",msgT:0,level:1,xp:0,nextXp:24,stop:0,shake:0,xpPulse:0,cardT:0,best:+localStorage.ss_best||0,choices:[],homeNeed:2,homeGot:0,sch:{nsh:0,mel:0},pz:0,uq:[],inB:"",bs:0,bd:0},x={x:260,y:900,vx:0,vy:0,r:15,hp:100,maxHp:100,speed:185,fireCd:0,fireRate:.46,dmg:12,range:400,shots:1,magnet:88,face:1,rx:0,ry:0,flash:0,gx:1,gy:0,zc:0,zr:0,zt:0,zx:1,zy:0,zcd:0,zDur:1,zSpd:2.1,zLoad:1.5,zCool:5.5,zDmg:24,zDr:.55,zb:0,zp:0,mkOn:0,mkT:0,mkI:8.8,mkS:0,mkD:14,mkR:54,mkSl:.5,chDo:20,chBurst:14,chHeal:8,chHealCd:0,chHealI:.85,cat:0,catM:0,catType:0,bot:0,bType:0,bAtk:1,bAuraR:0,bAuraSl:0,bHealCd:0,bHealI:10,bHealAmt:10,bx:0,by:0,ba:0,bcd:0,bRate:1.9,bDmg:1.15,bRange:480,bFetch:95,bPull:195,bCarry:0,bCarryMax:2,bGrabCd:0,bGrabI:.38,bPier:3,bSize:6},g={l:0,r:0,u:0,d:0,gr:0};let p=-1,u=0;const M={x:78,y:0,r:42,kr:16,tx:0,ty:0,ax:0,ay:0,ttx:0,tty:0,tax:0,tay:0,show:0,act:0},S=[],T=[],z=[],k=[],P=[];function v(t,e){return t+Math.random()*(e-t)}function w(t,e,l){return t<e?e:t>l?l:t}function I(t){const e=t-1;return 1+2.70158*e*e*e+1.70158*e*e}function C(t,l,a,n,i){const r=Math.max(0,Math.min(i,.5*Math.min(a,n)));e.beginPath(),e.moveTo(t+r,l),e.lineTo(t+a-r,l),e.quadraticCurveTo(t+a,l,t+a,l+r),e.lineTo(t+a,l+n-r),e.quadraticCurveTo(t+a,l+n,t+a-r,l+n),e.lineTo(t+r,l+n),e.quadraticCurveTo(t,l+n,t,l+n-r),e.lineTo(t,l+r),e.quadraticCurveTo(t,l,t+r,l),e.closePath()}function R(){const t=l<560,e=t?l-14:Math.min(l-20,620),n=t?w(.48*a,296,390):w(.4*a,268,340),i=.5*(l-e),r=a-n-12,s=[];if(t){const t=8,l=e-22,a=Math.max(74,Math.min(100,(n-84-2*t)/3)),f=r+50;for(let e=0;e<3;e++)s.push({x:i+14,y:f+e*(a+t),w:l,h:a})}else{const t=10,l=(e-32-2*t)/3,a=Math.max(102,Math.min(130,n-82)),f=r+52;for(let e=0;e<3;e++)s.push({x:i+16+e*(l+t),y:f,w:l,h:a})}return{mobile:t,bx:i,by:r,bw:e,bh:n,rects:s}}function A(t,l,a,n,i,r){const s=t.split(" ");let f="",o=0;for(let t=0;t<s.length;t++){const h=f?f+" "+s[t]:s[t];if(e.measureText(h).width<=n)f=h;else{if(e.fillText(f,l,a+o*i),o++,o>=r)return;f=s[t]}}o<r&&f&&e.fillText(f,l,a+o*i)}function q(t){return t.includes("Chemical")?"ðŸ§ª":t.includes("Bot")?"ðŸ¤–":t.includes("Shock")||t.includes("Zoomies")?"âš¡":t.includes("Territory")?"ðŸ’§":"â­"}function H(t){for(let e=0;e<r.length;e++)if(r[e].id===t)return r[e];return 0}function D(t,e,l){const a=l||0;for(let l=0;l<r.length;l++){const n=r[l],i=t-n.x,s=e-n.y;if(i*i+s*s<(n.r+a)*(n.r+a))return n}return 0}function G(t,e){const l=e||0;let a=0;for(let e=0;e<r.length;e++){const n=r[e];let i=t.x-n.x,s=t.y-n.y,f=Math.hypot(i,s)||1;const o=n.r+l;if(f<o){if(f<.001){const t=Math.random()*Math.PI*2;i=Math.cos(t),s=Math.sin(t),f=1}t.x=n.x+i/f*o,t.y=n.y+s/f*o,a=1}}return a}function L(){const t=Math.min(l-24,420),e=Math.min(a-130,260),n=.5*(l-t),i=.5*(a-e)+24,r=(t-36-20)/3,s=i+e-72;return{bx:n,by:i,bw:t,bh:e,btn:[{x:n+18,y:s,w:r,h:46},{x:n+18+r+10,y:s,w:r,h:46},{x:n+18+2*(r+10),y:s,w:r,h:46}]}}function W(t){if(!m.pz)if("nsh"===t){const t=3*Math.random()|0,e=(t+1+(2*Math.random()|0))%3;m.pz={id:"nsh",seq:[t,e],step:0},m.msg="research",m.msgT=1.2}else"mel"===t&&(m.pz={id:"mel",seq:[3*Math.random()|0,3*Math.random()|0,3*Math.random()|0],step:0},m.msg="research",m.msgT=1.2)}function B(t){if(!m.pz)return;const e=m.pz;if(t===e.seq[e.step]){if(e.step++,b(620+70*e.step,.04,"triangle",.018),e.step>=e.seq.length){const t=e.id;m.pz=0,function(t){"nsh"===t&&2!==m.sch.nsh?(m.sch.nsh=2,E("nsh"),m.msg="nsh",m.msgT=2.1,Z(.12),tt(x.x,x.y,"#79d7ff",16,95),b(760,.07,"square",.024)):"mel"===t&&2!==m.sch.mel&&(m.sch.mel=2,E("mel"),m.msg="mel",m.msgT=2.1,Z(.12),tt(x.x,x.y,"#ffd58f",16,95),b(720,.07,"square",.024))}(t)}}else e.step=0,Z(.03),b(180,.06,"square",.02),m.msg="retry",m.msgT=.55}function O(t){"nsh"===t&&0===m.sch.nsh?(m.sch.nsh=1,y(),W("nsh"),m.msg="help",m.msgT=1.4,b(640,.05,"triangle",.02)):"mel"===t&&0===m.sch.mel&&(m.sch.mel=1,y(),W("mel"),m.msg="help",m.msgT=1.4,b(680,.05,"triangle",.02))}function F(){return 1===x.catType?"acid":2===x.catType?"heal":3===x.catType?"grav":"chem"}function K(){x.cat&&(m.msg="chem: "+F(),m.msgT=.95,b(1===x.catType?540:2===x.catType?620:470,.04,"triangle",.02))}function E(t){m.uq.indexOf(t)<0&&m.uq.push(t)}function X(t){x.bot=1,x.bType=t,x.bx=x.x+20,x.by=x.y+4,x.ba=0,x.bcd=.45,x.bRate=1.9,x.bDmg=1.15,x.bRange=480,x.bFetch=95,x.bPull=195,x.bCarry=0,x.bCarryMax=2,x.bGrabCd=0,x.bGrabI=.38,x.bPier=3,x.bSize=6,x.bAtk=1,x.bAuraR=0,x.bAuraSl=0,x.bHealCd=0,x.bHealI=10,x.bHealAmt=10,1===t?(x.bRate=1.15,x.bDmg=1.6,x.bRange=620,x.bFetch=72,x.bPull=150,x.bCarryMax=1,x.bGrabI=.42,x.bPier=4,x.bSize=7.2):2===t?(x.bRate=1.72,x.bDmg=.95,x.bRange=520,x.bFetch=118,x.bPull=198,x.bCarryMax=2,x.bGrabI=.34,x.bPier=1,x.bSize=3.8,x.bHealI=10,x.bHealAmt=10):(x.bRate=2.45,x.bDmg=.95,x.bRange=390,x.bFetch=110,x.bPull=205,x.bCarryMax=2,x.bGrabI=.34,x.bPier=2,x.bSize=8.5,x.bAuraR=96,x.bAuraSl=.34)}function Y(t){x.cat=1,x.catType=t,x.catM=0,x.chDo=20,x.chBurst=14,x.chHeal=8,x.chHealCd=0,x.chHealI=.85,1===t?(x.chDo=24,x.chBurst=16):2===t?(x.chHeal=10,x.chHealI=.85):x.mkSl=Math.max(x.mkSl,.56)}function _(){if(m.lvup||m.dead||m.pz||!m.uq.length)return;const t=m.uq.shift();"nsh"!==t||x.bot?"mel"!==t||x.cat||(m.choices=[{n:"Acidic Puddle",d:"corrosive zone: burst + damage over time",f:()=>Y(1),bg:"rgba(33,75,34,.96)",st:"rgba(160,236,146,.88)",tx:"#edffe9",sub:"#bce2b3"},{n:"Heal Puddle",d:"restorative zone: heals Scotty while inside",f:()=>Y(2),bg:"rgba(22,79,72,.96)",st:"rgba(151,242,228,.9)",tx:"#e8fffb",sub:"#b6e7df"},{n:"Gravity Puddle",d:"field zone: pulls nearby enemies inward",f:()=>Y(3),bg:"rgba(30,45,86,.96)",st:"rgba(156,190,255,.9)",tx:"#edf3ff",sub:"#bfd1f0"}]):m.choices=[{n:"Volt Buddy",d:"striker bot: rapid shock pulses, low cargo",f:()=>X(1),bg:"rgba(29,53,79,.96)",st:"rgba(147,216,255,.88)",tx:"#f1f9ff",sub:"#b3d4ee"},{n:"Medic Buddy",d:"blue rounds + heals Scotty every 10s",f:()=>X(2),bg:"rgba(19,58,88,.96)",st:"rgba(126,199,255,.9)",tx:"#eaf5ff",sub:"#acc8e6"},{n:"Guard Buddy",d:"warden bot: slowing aura + sturdy pulse",f:()=>X(3),bg:"rgba(73,50,27,.96)",st:"rgba(255,205,138,.9)",tx:"#fff4df",sub:"#e6cda5"}],m.choices.length&&(m.lvup=1,m.cardT=0,m.msg="up",m.msgT=1.4,b(760,.07,"triangle",.028))}function Z(t){m.shake=w(m.shake+t,0,1.3)}function N(t){m.stop=Math.max(m.stop,t)}function U(){n=Math.max(1,Math.min(2,devicePixelRatio||1)),l=Math.max(320,0|innerWidth),a=Math.max(560,0|innerHeight),t.width=l*n|0,t.height=a*n|0,e.setTransform(n,0,0,n,0,0),e.imageSmoothingEnabled=!1;const i=M.r+16;M.act?(M.x=w(M.x,i,l-i),M.y=w(M.y,i,a-i)):(M.x=78,M.y=a-88)}function V(t,e){let l=t-M.x,a=e-M.y;const n=Math.hypot(l,a)||1,i=M.r;n<10?(l=0,a=0):n>i&&(l=l/n*i,a=a/n*i),M.ttx=l,M.tty=a,M.tax=l/i,M.tay=a/i}function j(t){M.act=0,M.ttx=0,M.tty=0,M.tax=0,M.tay=0,t&&(M.tx=0,M.ty=0,M.ax=0,M.ay=0,M.show=0)}function Q(t){P.length>=420||P.push(t)}function J(t){z.length>=260||z.push(t)}function $(t){T.length>=260||T.push(t)}function tt(t,e,l,a,n){const i=S.length>130?.5:S.length>90?.7:1,r=Math.max(1,a*i|0);for(let a=0;a<r;a++){const a=Math.random()*Math.PI*2,i=(n||70)*(.4+Math.random());Q({x:t,y:e,vx:Math.cos(a)*i,vy:Math.sin(a)*i,t:v(.2,.6),c:l})}}function et(t,e,l,a,n){const i=S[t],r=!!n;3===i.k&&(m.bd=1,m.bs=0,m.msg="boss down",m.msgT=1.5,Z(.24),b(240,.12,"triangle",.03)),m.kills++,r?tt(i.x,i.y,e||"#ff9675",Math.max(2,.35*(l||9)|0),Math.max(20,.6*(a||70))):(N(.03),Z(.08),tt(i.x,i.y,e||"#ff9675",l||9,a||70),b(280,.03,"square",.012));const s=260-z.length;if(s>0){const t=r?Math.random()<.25?1:0:1+(Math.random()<.4?1:0);for(let e=0;e<Math.min(t,s);e++)J({x:i.x+v(-7,7),y:i.y+v(-7,7),v:0|v(5,8),m:1,t:0})}S.splice(t,1)}function lt(t){if(m.dead=0,m.lvup=0,m.t=0,m.time=0,m.spawnT=0,m.nextSpawn=.8,m.kills=0,m.msg="",m.msgT=0,m.level=1,m.xp=0,m.nextXp=24,m.stop=0,m.shake=0,m.xpPulse=0,m.cardT=0,m.choices=[],m.homeGot=0,m.sch.nsh=0,m.sch.mel=0,m.pz=0,m.uq.length=0,m.inB="",m.bs=0,m.bd=0,x.x=260,x.y=900,x.vx=0,x.vy=0,x.hp=100,x.maxHp=100,x.speed=185,x.fireCd=0,x.fireRate=.46,x.dmg=12,x.range=400,x.shots=1,x.magnet=88,x.face=1,x.rx=0,x.ry=0,x.flash=0,x.gx=1,x.gy=0,x.zc=0,x.zr=0,x.zt=0,x.zx=1,x.zy=0,x.zcd=0,x.zDur=1,x.zSpd=2.1,x.zLoad=1.5,x.zCool=5.5,x.zDmg=24,x.zDr=.55,x.zb=0,x.zp=0,x.mkOn=0,x.mkT=0,x.mkI=8.8,x.mkS=0,x.mkD=14,x.mkR=54,x.mkSl=.5,x.chDo=20,x.chBurst=14,x.chHeal=8,x.chHealCd=0,x.chHealI=.85,x.cat=0,x.catM=0,x.catType=0,x.bot=0,x.bType=0,x.bAtk=1,x.bAuraR=0,x.bAuraSl=0,x.bHealCd=0,x.bHealI=10,x.bHealAmt=10,x.bx=x.x+20,x.by=x.y+4,x.ba=0,x.bcd=.45,x.bRate=1.9,x.bDmg=1.15,x.bRange=480,x.bFetch=95,x.bPull=195,x.bCarry=0,x.bCarryMax=2,x.bGrabCd=0,x.bGrabI=.38,x.bPier=3,x.bSize=6,S.length=0,T.length=0,z.length=0,k.length=0,P.length=0,g.l=g.r=g.u=g.d=g.gr=0,u=0,j(1),m.msg="home: unlock",m.msgT=1.6,t){for(let t=0;t<24;t++)J({x:1300+v(-120,120),y:900+v(-120,120),v:7,m:1,t:0});for(let t=0;t<10;t++)J({x:330+58*t,y:900+v(-60,60),v:5,m:1,t:0})}}function at(){if(S.length>=180)return;const t=Math.random()*Math.PI*2,e=v(360,560),l=1+.045*m.time;let a=22+8*l+v(-4,8),n=56+6*l+v(-6,10),i=v(12,18),r=8+.9*l,s=0;m.time>8&&Math.random()<.24&&(s=1,n*=1.65,a*=.66,i*=.82,r*=.82),m.time>18&&Math.random()<.18&&(s=2,n*=.74,a*=2.15,i*=1.35,r*=1.28);let f=w(x.x+Math.cos(t)*e,20,2580),o=w(x.y+Math.sin(t)*e,20,1780);const h=D(f,o,10);if(h){const t=f-h.x,e=o-h.y,l=Math.hypot(t,e)||1;f=h.x+t/l*(h.r+18),o=h.y+e/l*(h.r+18)}S.push({x:f,y:o,r:i,hp:a,s:n,dmg:r,vx:0,vy:0,ht:0,sl:0,ce:0,bm:0,bt:0,bi:"",k:s})}function nt(t,e){const l=z[t];l&&(l.bc&&x.bCarry>0&&x.bCarry--,function(t){for(m.xp+=t;m.xp>=m.nextXp;){m.xp-=m.nextXp,m.level++,m.nextXp=1.36*m.nextXp+9|0,rt(),m.lvup=1,m.cardT=0,m.xpPulse=.65,m.msg="upgrade",m.msgT=2.1,N(.06),Z(.2),b(860,.08,"triangle",.03);break}}(l.v),z.splice(t,1),m.xpPulse=Math.min(.5,m.xpPulse+.11),tt("bot"===e?x.bx:x.x,"bot"===e?x.by:x.y,"#69f0c9",4,40),x.mkOn||(m.homeGot++,m.homeGot>=m.homeNeed&&(x.mkOn=1,x.mkT=.25,m.msg="open",m.msgT=2.2,b(820,.07,"triangle",.028),tt(x.x,x.y,"#ffd56d",16,95))))}const it=[{n:"Rapid Fire",d:"shoot faster",f:()=>x.fireRate=Math.max(.15,.8*x.fireRate),req:()=>1},{n:"Big Bites",d:"more damage",f:()=>x.dmg+=8,req:()=>1},{n:"Speed Paws",d:"move faster",f:()=>x.speed+=30,req:()=>1},{n:"Extra Shot",d:"+1 projectile",f:()=>x.shots=Math.min(5,x.shots+1),req:()=>1},{n:"Long Reach",d:"longer range",f:()=>x.range+=150,req:()=>1},{n:"Snack Magnet",d:"pickup range up",f:()=>x.magnet+=40,req:()=>1},{n:"Tough Fur",d:"+max hp +heal",f:()=>{x.maxHp+=32,x.hp=Math.min(x.maxHp,x.hp+32)},req:()=>1},{n:"Quick Heal",d:"heal now",f:()=>x.hp=Math.min(x.maxHp,x.hp+45),req:()=>1},{n:"Zoomies Time",d:"zoomies lasts longer",f:()=>x.zDur=Math.min(2.6,x.zDur+.32),req:()=>1},{n:"Zoomies CD",d:"zoomies cooldown down",f:()=>x.zCool=Math.max(1.4,x.zCool-.85),req:()=>1},{n:"Zoomies Speed",d:"zoomies speed up",f:()=>x.zSpd=Math.min(4,x.zSpd+.45),req:()=>1},{n:"Zoomies Charge",d:"zoomies charge faster",f:()=>x.zLoad=Math.max(.55,x.zLoad-.24),req:()=>1},{n:"Territory CD",d:"territory cooldown down",f:()=>x.mkI=Math.max(3.2,x.mkI-.68),req:()=>x.mkOn},{n:"Territory Radius",d:"territory area bigger",f:()=>x.mkR=Math.min(110,x.mkR+16),req:()=>x.mkOn},{n:"Territory Duration",d:"territory lasts longer",f:()=>x.mkD=Math.min(40,x.mkD+5),req:()=>x.mkOn},{n:"Territory Slow",d:"territory slows more",f:()=>x.mkSl=Math.min(.88,x.mkSl+.12),req:()=>x.mkOn},{n:"Chemical Puddle",d:"chem damage up",f:()=>{x.chDo=Math.min(58,x.chDo+10),x.chBurst=Math.min(42,x.chBurst+8)},req:()=>x.cat},{n:"Chemical Radius",d:"chem area bigger",f:()=>x.mkR=Math.min(120,x.mkR+13),req:()=>x.cat},{n:"Chemical Tempo",d:"chem cooldown down",f:()=>x.mkI=Math.max(2.6,x.mkI-.58),req:()=>x.cat},{n:"Bot Fetch",d:"bot grabs mints farther away",f:()=>x.bFetch=Math.min(220,x.bFetch+34),req:()=>x.bot},{n:"Bot Cargo",d:"bot carries more mints",f:()=>x.bCarryMax=Math.min(5,x.bCarryMax+1),req:()=>x.bot},{n:"Shock Tempo",d:"shock pulse cooldown down",f:()=>x.bRate=Math.max(.62,.82*x.bRate),req:()=>x.bot&&x.bAtk},{n:"Shock Pierce",d:"pulse pierces more + wider",f:()=>{x.bPier=Math.min(8,x.bPier+1),x.bSize=Math.min(18,x.bSize+1.4)},req:()=>x.bot&&x.bAtk},{n:"Shock Power",d:"shock pulse damage up",f:()=>x.bDmg=Math.min(2.8,x.bDmg+.33),req:()=>x.bot&&x.bAtk},{n:"Shock Reach",d:"bot pulse range up",f:()=>x.bRange=Math.min(920,x.bRange+120),req:()=>x.bot&&x.bAtk}];function rt(){const t=it.filter(t=>!t.req||t.req());m.choices=[];for(let e=0;e<3&&t.length;e++){const e=Math.random()*t.length|0;m.choices.push(t[e]),t.splice(e,1)}}function st(t){m.lvup&&m.choices[t]&&(m.choices[t].f(),m.lvup=0,m.msg=m.choices[t].n+" applied",m.msgT=1.4,m.xpPulse=.25,Z(.08),tt(x.x,x.y,"#69f0c9",12,90),_())}function ft(){c||(c=new(window.AudioContext||window.webkitAudioContext)),m.start||(m.start=1,lt(1),b(430,.05,"triangle",.02))}function ot(e){p===e.pointerId&&(u=0,j(),t.hasPointerCapture(p)&&t.releasePointerCapture(p),p=-1)}addEventListener("resize",U),addEventListener("keydown",function(t){const e=t.code;if("Space"!==e&&"ArrowUp"!==e&&"ArrowDown"!==e&&"ArrowLeft"!==e&&"ArrowRight"!==e||t.preventDefault(),"Space"!==e&&"Enter"!==e||ft(),m.dead&&("Space"===e||"Enter"===e||"KeyR"===e))return lt(1),void b(360,.05,"triangle",.02);m.lvup?"Digit1"===e?st(0):"Digit2"===e?st(1):"Digit3"===e&&st(2):m.pz?"Digit1"===e?B(0):"Digit2"===e?B(1):"Digit3"===e&&B(2):m.start&&!m.dead&&("KeyQ"!==e?"KeyA"===e||"ArrowLeft"===e?g.l=1:"KeyD"===e||"ArrowRight"===e?g.r=1:"KeyW"===e||"ArrowUp"===e?g.u=1:"KeyS"===e||"ArrowDown"===e?g.d=1:"KeyE"!==e&&"ShiftLeft"!==e&&"ShiftRight"!==e||(g.gr=1):K())}),addEventListener("keyup",function(t){const e=t.code;"KeyA"===e||"ArrowLeft"===e?g.l=0:"KeyD"===e||"ArrowRight"===e?g.r=0:"KeyW"===e||"ArrowUp"===e?g.u=0:"KeyS"===e||"ArrowDown"===e?g.d=0:"KeyE"!==e&&"ShiftLeft"!==e&&"ShiftRight"!==e||(g.gr=0)}),t.addEventListener("pointerdown",function(e){if(!(p>=0&&p!==e.pointerId)){if(p=e.pointerId,t.setPointerCapture(p),ft(),m.dead)return lt(1),void b(360,.05,"triangle",.02);if(m.lvup)!function(t,e){if(!m.lvup)return;const l=R().rects;for(let a=0;a<l.length;a++){const n=l[a];if(t>=n.x&&t<=n.x+n.w&&e>=n.y&&e<=n.y+n.h){st(a);break}}}(e.clientX,e.clientY);else{if(m.pz){const t=L();for(let l=0;l<3;l++){const a=t.btn[l];if(e.clientX>=a.x&&e.clientX<=a.x+a.w&&e.clientY>=a.y&&e.clientY<=a.y+a.h)return void B(l)}return}m.start&&!m.dead&&x.cat&&function(t,e){const a=l-18-44;return t>=a&&t<=a+44&&e>=66&&e<=110}(e.clientX,e.clientY)?K():"mouse"!==e.pointerType&&(u=1,function(t,e){const n=M.r+16;M.x=w(t,n,l-n),M.y=w(e,n,a-n),M.tx=0,M.ty=0,M.ax=0,M.ay=0,M.ttx=0,M.tty=0,M.tax=0,M.tay=0,M.act=1}(e.clientX,e.clientY),V(e.clientX,e.clientY))}}},{passive:1}),t.addEventListener("pointermove",function(t){p!==t.pointerId||!m.start||m.dead||m.lvup||u&&V(t.clientX,t.clientY)},{passive:1}),t.addEventListener("pointerup",ot,{passive:1}),t.addEventListener("pointercancel",ot,{passive:1}),U(),lt(1),requestAnimationFrame(function t(h){i||(i=h);let c=.001*(h-i);i=h,c=Math.max(0,Math.min(.034,c)),function(t){const e=t;!function(t){const e=1-Math.exp(22*-t),l=1-Math.exp(16*-t);M.tx+=(M.ttx-M.tx)*e,M.ty+=(M.tty-M.ty)*e,M.ax+=(M.tax-M.ax)*e,M.ay+=(M.tay-M.ay)*e,M.show+=((M.act?1:0)-M.show)*l,!M.act&&M.show<.003&&(M.show=0)}(e),m.msgT>0&&(m.msgT-=e),m.stop>0&&(m.stop=Math.max(0,m.stop-e),t*=.06),m.shake>0&&(m.shake=Math.max(0,m.shake-2.2*e)),m.xpPulse>0&&(m.xpPulse=Math.max(0,m.xpPulse-1.7*e)),x.flash>0&&(x.flash=Math.max(0,x.flash-7*e)),x.zb>0&&(x.zb=Math.max(0,x.zb-e)),x.zp>0&&(x.zp=Math.max(0,x.zp-e)),x.rx*=Math.max(0,1-18*e),x.ry*=Math.max(0,1-18*e),x.zcd>0&&(x.zcd=Math.max(0,x.zcd-e)),x.mkS>0&&(x.mkS=Math.max(0,x.mkS-e)),x.mkT>0&&x.zt<=0&&(x.mkT=Math.max(0,x.mkT-e));for(let e=k.length-1;e>=0;e--){const l=k[e];l.t-=t,l.t<=0&&k.splice(e,1)}for(let e=P.length-1;e>=0;e--){const l=P[e];l.t-=t,l.x+=l.vx*t,l.y+=l.vy*t,l.vy+=480*t,l.t<=0&&P.splice(e,1)}if(!m.start||m.dead)return;if(m.lvup)return void(m.cardT=Math.min(.9,m.cardT+e));if(m.pz)return void(m.t+=t);m.t+=t;const l=H("nsh"),a=H("mel");x.mkOn&&0===m.sch.nsh&&Math.hypot(x.x-l.x,x.y-l.y)<l.r&&O("nsh"),2===m.sch.nsh&&0===m.sch.mel&&Math.hypot(x.x-a.x,x.y-a.y)<a.r&&O("mel"),_();const n=(g.r?1:0)-(g.l?1:0),i=(g.d?1:0)-(g.u?1:0),r=Math.hypot(M.ax,M.ay);let s=n,f=i;u&&r>.12&&(s+=M.ax,f+=M.ay);let o=Math.hypot(s,f);o>1&&(s/=o,f/=o);const h=(Math.hypot(n,i)>.05||u&&r>.12)&&x.mkS<=0,c=D(x.x,x.y,-6);if(x.mkOn&&x.mkT<=0&&x.mkS<=0&&x.zt<=0&&x.zr<=0&&x.zc<=0&&(k.length>=18&&k.shift(),k.push({x:x.x+4*x.gx,y:x.y+8,r:x.mkR,t:x.mkD,d:x.mkD,m:x.cat?x.catType||1:0}),x.mkS=.32,x.mkT=x.mkI,m.msg="territory",m.msgT=.7,N(.02),Z(.05),tt(x.x,x.y+8,"#ffd56d",10,46),b(560,.04,"triangle",.02)),x.zt<=0)if(!c&&!h&&x.zcd<=0&&x.mkS<=0){if(x.zc=Math.min(x.zLoad,x.zc+t),x.zc>.25){const e=x.zc/x.zLoad;x.rx+=.9*(2*Math.random()-1)*e*60*t,x.ry+=.9*(2*Math.random()-1)*e*60*t,Z(7e-4*e*60*t)}x.zc>=x.zLoad&&!x.zr&&(x.zr=1,m.msg="zoomies ready",m.msgT=1.1,Z(.08),b(760,.05,"triangle",.024))}else if(x.zr){x.zt=x.zDur,x.zr=0,x.zc=0;const t=o||1;x.zx=s/t,x.zy=f/t,N(.04),Z(.28),x.flash=.09,x.gx=x.zx,x.gy=x.zy,tt(x.x,x.y,"#9dffea",18,120),b(980,.06,"square",.028)}else x.zc=0;if(x.zt>0){if(x.zt=Math.max(0,x.zt-t),h){x.zx=.85*x.zx+.15*s,x.zy=.85*x.zy+.15*f;const t=Math.hypot(x.zx,x.zy)||1;x.zx/=t,x.zy/=t}const e=x.zb>0?1.35:1;x.vx=x.zx*x.speed*x.zSpd*e,x.vy=x.zy*x.speed*x.zSpd*e,x.face=x.vx>=0?1:-1,x.rx-=8*x.zx*t*60,x.ry-=6*x.zy*t*60,Math.random()<.65&&Q({x:x.x-v(-6,6),y:x.y-v(-6,6),vx:.12*-x.vx+v(-35,35),vy:.12*-x.vy+v(-35,35),t:v(.1,.25),c:"#8fffe5"}),x.zt<=0&&(x.zcd=x.zCool,m.msg="zoomies cd",m.msgT=.65,b(420,.04,"triangle",.016))}else x.vx=s*x.speed,x.vy=f*x.speed,Math.abs(x.vx)>.5&&(x.face=x.vx>0?1:-1),x.mkS>0&&(x.rx+=.5*Math.sin(45*m.t),Math.random()<.7&&Q({x:x.x+v(-5,5),y:x.y+10+v(-3,3),vx:v(-14,14),vy:v(6,30),t:v(.12,.26),c:"#ffd56d"}));if(x.x=w(x.x+x.vx*t,12,2588),x.y=w(x.y+x.vy*t,12,1788),x.zt>0&&x.zp<=0)for(let t=0;t<k.length;t++){const e=k[t],l=x.x-e.x,a=x.y-e.y;if(l*l+a*a<e.r*e.r){x.zp=.22,x.zb=.48,tt(x.x,x.y,"#8fffe5",8,95),b(740,.03,"triangle",.02);for(let t=S.length-1;t>=0;t--){const l=S[t],a=l.x-e.x,n=l.y-e.y;a*a+n*n<e.r*e.r&&(l.hp-=2.2*x.zDmg,l.ht=.13,l.vx+=260*x.zx,l.vy+=260*x.zy,l.hp<=0&&et(t,"#8fffe5",10,80,1))}break}}const d=D(x.x,x.y,-6);d||(m.time+=t);const y=d?d.id:"";if(m.inB=y,2===x.catType){x.chHealCd>0&&(x.chHealCd=Math.max(0,x.chHealCd-t));let e=0;for(let t=0;t<k.length;t++){const l=k[t],a=x.x-l.x,n=x.y-l.y;if(2===l.m&&a*a+n*n<l.r*l.r){e=1;break}}if(e&&x.chHealCd<=0&&x.hp<x.maxHp){const t=Math.min(x.chHeal,x.maxHp-x.hp);x.hp+=t,x.chHealCd=x.chHealI,tt(x.x,x.y,"#7fe8dd",8,52),m.msg="heal +"+(0|t),m.msgT=.65}}if(x.bot){x.ba+=2.3*t;const e=x.x+34*Math.cos(x.ba),l=x.y+20*Math.sin(1.17*x.ba);if(x.bx+=(e-x.bx)*Math.min(1,8*t),x.by+=(l-x.by)*Math.min(1,8*t),2===x.bType&&(x.bHealCd>0&&(x.bHealCd=Math.max(0,x.bHealCd-t)),x.bHealCd<=0&&x.hp<x.maxHp)){const t=Math.min(x.bHealAmt,x.maxHp-x.hp);x.hp+=t,x.bHealCd=x.bHealI,m.msg="medic +"+(0|t),m.msgT=.9,tt(x.x,x.y,"#7ec7ff",8,52),b(700,.05,"triangle",.016)}if(x.bGrabCd>0&&(x.bGrabCd=Math.max(0,x.bGrabCd-t)),!d&&x.bAtk&&(x.bcd-=t),!d&&x.bAtk&&x.bcd<=0){let t=0,e=x.bRange*x.bRange;for(let l=0;l<S.length;l++){const a=S[l],n=a.x-x.bx,i=a.y-x.by,r=n*n+i*i;r<e&&(e=r,t=a)}if(t){const e=Math.hypot(t.x-x.bx,t.y-x.by)||1,l=2!==x.bType,a=l?"#9de6ff":"#6fbaff";$({x:x.bx,y:x.by,vx:(t.x-x.bx)/e*420,vy:(t.y-x.by)/e*420,d:x.dmg*x.bDmg,life:1.35,pier:x.bPier,c:a,r:x.bSize,pulse:l}),x.bcd=x.bRate,tt(x.bx,x.by,a,4,36)}else x.bcd=.35}}x.fireCd-=t,!d&&x.fireCd<=0&&(x.fireCd=x.fireRate,function(){const t=function(){let t=0,e=1e9;for(let l=0;l<S.length;l++){const a=S[l],n=a.x-x.x,i=a.y-x.y,r=n*n+i*i;r<e&&(e=r,t=a)}return t}();if(!t)return;let e=t.x-x.x,l=t.y-x.y,a=Math.hypot(e,l)||1;if(a>x.range)return;e/=a,l/=a;const n=x.shots;for(let t=0;t<n;t++){const a=1===n?0:.18*(t-(n-1)/2),i=Math.cos(a),r=Math.sin(a),s=e*i-l*r,f=e*r+l*i;$({x:x.x,y:x.y,vx:520*s,vy:520*f,d:x.dmg,life:1.05,pier:1})}x.gx=e,x.gy=l,x.rx-=6*e,x.ry-=4*l,x.flash=.07,x.face=e>=0?1:-1,tt(x.x+16*e,x.y+10*l,"#ffd56d",3,35),Z(.025),b(640,.04,"square",.018)}()),m.spawnT-=t,2!==m.sch.mel||m.bs||m.bd||!(m.kills>26||m.time>52)||function(){if(m.bs||m.bd||S.length>=180)return;const t=Math.random()*Math.PI*2,e={x:w(x.x+520*Math.cos(t),40,2560),y:w(x.y+520*Math.sin(t),40,1760),r:34,hp:560+10*m.time,s:44,dmg:22,vx:0,vy:0,ht:0,sl:0,ce:0,bm:0,bt:0,bi:"",k:3};G(e,28),S.push(e),m.bs=1,m.msg="boss!",m.msgT=1.2,b(170,.15,"sawtooth",.03),Z(.2)}(),m.spawnT<=0&&(m.spawnT=m.nextSpawn,m.nextSpawn=Math.max(.18,.78-.018*m.time),at(),!m.bs&&m.time>26&&Math.random()<.28&&at());for(let e=T.length-1;e>=0;e--){const l=T[e];if(l.life-=t,l.x+=l.vx*t,l.y+=l.vy*t,l.life<=0||l.x<-20||l.y<-20||l.x>2620||l.y>1820)T.splice(e,1);else for(let t=S.length-1;t>=0;t--){const a=S[t],n=a.x-l.x,i=a.y-l.y,r=l.r||3;if(n*n+i*i<(a.r+r)*(a.r+r)&&(a.hp-=l.d,a.ht=l.pulse?.12:.09,a.vx+=l.vx*(l.pulse?.11:.07),a.vy+=l.vy*(l.pulse?.11:.07),l.pulse&&tt(a.x,a.y,"#9de6ff",3,28),l.pier--,a.hp<=0&&et(t,l.pulse?"#9de6ff":"#ff9675",l.pulse?7:9,l.pulse?58:70,l.pulse?1:0),l.pier<0)){T.splice(e,1);break}}}let p=0,I=0,C=0;const R=d;for(let e=S.length-1;e>=0;e--){const l=S[e];let a=x.x,n=x.y;if(R)if(l.bi!==R.id&&(l.bi=R.id,l.bm=0,l.bt=v(.9,1.7)),l.bt-=t,l.bt<=0&&(0===l.bm?(l.bm=1,l.bt=v(1.1,2.1)):(l.bm=0,l.bt=v(.9,1.7))),0===l.bm){const t=x.x-R.x,e=x.y-R.y,l=Math.hypot(t,e)||1;a=R.x+t/l*(R.r+8),n=R.y+e/l*(R.r+8)}else{const t=l.x-R.x,i=l.y-R.y,r=Math.hypot(t,i)||1;a=l.x+t/r*220+-i/r*Math.sin(2*m.t+e)*30,n=l.y+i/r*220+t/r*Math.sin(2*m.t+e)*30}else l.bi="",l.bt=0,l.bm=0;const i=a-l.x,r=n-l.y,s=Math.hypot(i,r)||1;let f=1,o=0,h=0;for(let e=0;e<k.length;e++){const a=k[e],n=l.x-a.x,i=l.y-a.y,r=n*n+i*i,s=0|a.m;if(3===s){const e=1.45*a.r;if(r<e*e){const s=Math.sqrt(r)||1,c=260*(1-s/e);l.vx+=-n/s*c*t,l.vy+=-i/s*c*t,r<a.r*a.r&&(h=3,f=Math.min(f,.42),o=1)}continue}if(r<a.r*a.r){h=s,f=Math.min(f,1-(1===h?.4:2===h?.26:.72)),o=1,1===h&&x.cat&&l.ce<=0&&(l.ce=.55,l.hp-=x.chBurst,tt(l.x,l.y,"#ffd58f",5,44));break}}if(x.bot){const t=l.x-x.bx,e=l.y-x.by;t*t+e*e<400&&(f=Math.min(f,.65)),x.bAuraR>0&&t*t+e*e<x.bAuraR*x.bAuraR&&(f=Math.min(f,1-x.bAuraSl))}if(l.sl=o,o){const a=x.cat&&1===h?x.chDo:0;if(a>0&&(l.hp-=a*t),l.ht=Math.max(l.ht,.08),l.hp<=0){et(e,"#f7d96b",8,60);continue}}l.ce>0&&(l.ce=Math.max(0,l.ce-t)),l.vx*=Math.max(0,1-8*t),l.vy*=Math.max(0,1-8*t),l.ht=Math.max(0,l.ht-t),l.x+=(i/s*l.s*f+l.vx)*t,l.y+=(r/s*l.s*f+l.vy)*t,G(l,6)&&(l.vx*=.4,l.vy*=.4);const c=x.x-l.x,b=x.y-l.y;if((Math.hypot(c,b)||1)<l.r+x.r-1){if(x.zt>0){if(l.hp-=x.zDmg,l.ht=.12,l.vx+=280*x.zx,l.vy+=280*x.zy,I++,l.hp<=0){et(e,"#8fffe5",12,90,1),C++;continue}p+=.35*l.dmg;continue}p+=l.dmg}}var A;I>0&&(N(Math.min(.04,.012*I)),Z(Math.min(.24,.04*I)),m.xpPulse=Math.min(.6,m.xpPulse+.06*I),b(260,.02,"square",.016),C>1&&b(310,.02,"square",.013)),p>0&&(A=p*t,x.zt>0&&(A*=x.zDr),x.hp-=A,Z(.03),x.hp<=0&&(x.hp=0,m.dead=1,m.start=1,m.kills>m.best&&(m.best=0|m.kills,localStorage.ss_best=m.best),m.msg="swarmed",m.msgT=999,N(.09),Z(.42),b(120,.22,"sawtooth",.05),tt(x.x,x.y,"#ff6f89",26,130)));for(let e=z.length-1;e>=0;e--){const l=z[e],a=x.x-l.x,n=x.y-l.y,i=Math.hypot(a,n)||1;if(x.bot){const e=x.bx-l.x,a=x.by-l.y,n=Math.hypot(e,a)||1;if(l.bc){const i=Math.min(1.3*x.bPull,13*n);l.x+=e/n*i*t,l.y+=a/n*i*t}else x.bCarry<x.bCarryMax&&x.bGrabCd<=0&&n<x.bFetch&&i>1.45*x.magnet&&(l.x+=e/n*x.bPull*t,l.y+=a/n*x.bPull*t,n<10&&(l.bc=1,x.bCarry++,x.bGrabCd=x.bGrabI,tt(l.x,l.y,"#9de6ff",3,24)))}i<x.magnet&&(l.x+=a/i*240*t,l.y+=n/i*240*t),i<x.r+8&&nt(e,l.bc?"bot":"player")}(g.gr||u)&&Math.random()<.04&&m.time>2&&J({x:w(x.x+v(-20,20),12,2588),y:w(x.y+v(-20,20),12,1788),v:4,m:1,t:0})}(c),function(){const t=m.shake*m.shake,i=10*(2*Math.random()-1)*t,h=10*(2*Math.random()-1)*t;e.setTransform(n,0,0,n,i,h);const c=w(x.x-.5*l,0,2600-l),b=w(x.y-.5*a,0,1800-a),d=e.createLinearGradient(0,0,0,a);d.addColorStop(0,"#263f60"),d.addColorStop(.55,"#16273f"),d.addColorStop(1,"#0b111a"),e.fillStyle=d,e.fillRect(0,0,l,a),e.strokeStyle="rgba(63,96,132,.35)",e.lineWidth=1;const y=-c%56;for(let t=-b%56;t<a;t+=56)e.beginPath(),e.moveTo(0,0|t),e.lineTo(l,0|t),e.stroke();for(let t=y;t<l;t+=56)e.beginPath(),e.moveTo(0|t,0),e.lineTo(0|t,a),e.stroke();const g=1300-c,p=900-b;e.fillStyle="rgba(105,240,201,.07)",e.beginPath(),e.arc(g,p,210,0,2*Math.PI),e.fill();const v=D(x.x,x.y,-8);for(let t=0;t<r.length;t++){const n=r[t],i=n.x-c,o=n.y-b;if(i<-n.r-30||o<-n.r-30||i>l+n.r+30||o>a+n.r+30)continue;const h="home"===n.id?0:2===m.sch[n.id],d="home"===n.id?!x.mkOn:1===m.sch[n.id]||"nsh"===n.id&&0===m.sch.nsh||"mel"===n.id&&2===m.sch.nsh&&0===m.sch.mel;e.globalAlpha=h?.18:d?.14:.08,e.fillStyle=n.c,e.beginPath(),e.arc(i,o,n.r,0,2*Math.PI),e.fill(),e.globalAlpha=.65,e.strokeStyle=h?"#9effc8":n.c,e.lineWidth=2,e.beginPath(),e.arc(i,o,n.r,0,2*Math.PI),e.stroke(),e.globalAlpha=1,e.fillStyle="#dce8ff",e.font="600 12px Trebuchet MS,sans-serif",e.fillText(n.n,i-n.r+10,o-n.r-8);const y="home"===n.id?48:44,g=30,p=i-.5*y,u=o-.5*g;if(e.fillStyle="rgba(18,25,37,.9)",e.fillRect(p,u,y,g),e.strokeStyle="rgba(165,190,220,.55)",e.lineWidth=1,e.strokeRect(p+.5|0,u+.5|0,y-1,g-1),e.fillStyle="rgba(248,234,164,.86)",e.fillRect(p+6|0,u+6|0,11,8),e.fillRect(p+y-17|0,u+6|0,11,8),e.fillStyle="rgba(44,56,72,.95)",e.beginPath(),e.arc(p+11+Math.sin(2*m.t+t),u+11,1.7,0,2*Math.PI),e.fill(),e.beginPath(),e.arc(p+y-11+Math.sin(2*m.t+t+1),u+11,1.7,0,2*Math.PI),e.fill(),m.start&&!m.dead){const l=v?f:s,a=l[(.45*m.t+2*t|0)%l.length],r=o-.44*n.r,h=4.6*a.length+12;e.fillStyle="rgba(8,12,20,.82)",C(i-.5*h,r-9,h,16,7),e.fill(),e.fillStyle="rgba(220,240,255,.9)",e.font="600 9px Trebuchet MS,sans-serif",e.fillText(a,i-.5*h+6,r+3)}}for(let t=0;t<z.length;t++){const n=z[t],i=n.x-c,r=n.y-b;i<-10||r<-10||i>l+10||r>a+10||(e.fillStyle="#69f0c9",e.beginPath(),e.arc(i,r,5,0,2*Math.PI),e.fill(),e.fillStyle="#ceffef",e.fillRect(i-1|0,r-1|0,2,2))}for(let t=0;t<k.length;t++){const n=k[t],i=n.x-c,r=n.y-b;if(i<-n.r-20||r<-n.r-20||i>l+n.r+20||r>a+n.r+20)continue;const s=n.t/n.d;e.globalAlpha=.12+.1*s;let f="#f4d96e",o="#fff0a9";x.cat&&(1===n.m?(f="#53d93d",o="#baff87"):2===n.m?(f="#42cdb9",o="#a8f6ea"):3===n.m&&(f="#597fd6",o="#bdd4ff")),e.fillStyle=f,e.beginPath(),e.arc(i,r,n.r,0,2*Math.PI),e.fill(),e.globalAlpha=.2+.2*Math.sin(5*(m.t+t))*s,e.strokeStyle=o,e.lineWidth=1.5,e.beginPath(),e.arc(i,r,.68*n.r+2*Math.sin(4*(m.t+t)),0,2*Math.PI),e.stroke(),x.cat&&(e.globalAlpha=.18+.24*s,1===n.m?e.fillStyle="#dbff8f":2===n.m?e.fillStyle="#d8fff7":3===n.m?e.fillStyle="#e1ebff":e.fillStyle="#f1ffb3",e.beginPath(),e.arc(i+Math.sin(4*m.t+t)*n.r*.22,r-.16*n.r,2.4+.7*Math.sin(7*m.t+t),0,2*Math.PI),e.fill(),e.beginPath(),e.arc(i-.18*n.r,r+Math.sin(3*m.t+.7*t)*n.r*.14,1.9+.5*Math.sin(8*m.t+.4*t),0,2*Math.PI),e.fill(),e.beginPath(),e.arc(i+.12*n.r,r+.2*n.r,1.6+.4*Math.sin(6*m.t+.5*t),0,2*Math.PI),e.fill()),e.globalAlpha=1}for(let t=0;t<S.length;t++){const n=S[t],i=n.x-c,r=n.y-b;if(i<-40||r<-40||i>l+40||r>a+40)continue;const s=3===n.k?"#a789ff":2===n.k?"#665a78":1===n.k?"#5687a1":n.sl?"#70805a":"#4b667f";e.fillStyle=n.ht>0?"#9db4d1":s,e.beginPath(),e.arc(i,r,n.r,0,2*Math.PI),e.fill(),e.fillStyle="#f0627c",e.fillRect(i-4|0,r-2|0,3,3),e.fillRect(i+1|0,r-2|0,3,3)}for(let t=0;t<T.length;t++){const l=T[t],a=l.x-c,n=l.y-b;if(l.pulse){const t=l.r||8;e.fillStyle="rgba(157,230,255,.2)",e.beginPath(),e.arc(a,n,1.4*t,0,2*Math.PI),e.fill(),e.strokeStyle=l.c||"#9de6ff",e.lineWidth=2,e.beginPath(),e.arc(a,n,t,0,2*Math.PI),e.stroke(),e.fillStyle="rgba(224,250,255,.88)",e.beginPath(),e.arc(a,n,.34*t,0,2*Math.PI),e.fill()}else e.fillStyle=l.c||"#ffd56d",e.fillRect(a-2|0,n-2|0,4,4)}const H=x.x-c+x.rx,G=x.y-b+x.ry,W=Math.abs(x.vx)>=Math.abs(x.vy)?x.face>0?o.e:o.w:x.vy<0?x.face>0?o.ne:o.nw:x.face>0?o.se:o.sw;if(e.fillStyle="rgba(0,0,0,.35)",e.beginPath(),e.ellipse(H,G+14,17,6,0,0,2*Math.PI),e.fill(),W&&W.complete?e.drawImage(W,H-22,G-18,44,30):(e.fillStyle="#0b0f14",e.beginPath(),e.arc(H,G,12,0,2*Math.PI),e.fill(),e.fillStyle="#ef4f6c",e.fillRect(H+3|0,G-6|0,7,3)),x.bot){const t=x.bx-c,l=x.by-b;let a="#88ddff",n="#dfffff";1===x.bType?(a="#93d8ff",n="#d0efff"):2===x.bType?(a="#6fbaff",n="#cfe7ff"):3===x.bType&&(a="#ffd48c",n="#fff0c7"),e.fillStyle="rgba(0,0,0,.25)",e.beginPath(),e.ellipse(t,l+8,11,4,0,0,2*Math.PI),e.fill(),e.fillStyle=a,e.beginPath(),e.arc(t,l,9,0,2*Math.PI),e.fill(),e.fillStyle="#16314a",e.fillRect(t-3|0,l-2|0,2,2),e.fillRect(t+1|0,l-2|0,2,2),e.strokeStyle=n,e.lineWidth=1.2,e.beginPath(),e.arc(t,l,12+1.5*Math.sin(9*m.t),0,2*Math.PI),e.stroke(),x.bAuraR>0&&(e.strokeStyle="rgba(255,231,176,.42)",e.lineWidth=1.5,e.beginPath(),e.arc(t,l,x.bAuraR*(.84+.08*Math.sin(4*m.t)),0,2*Math.PI),e.stroke()),x.bCarry>0&&(e.fillStyle="rgba(6,10,16,.84)",e.beginPath(),e.arc(t+10,l-10,8,0,2*Math.PI),e.fill(),e.fillStyle="#dfffff",e.font="700 10px Trebuchet MS,sans-serif",e.fillText(""+x.bCarry,t+7,l-7))}if(x.mkS>0&&x.zt<=0){const t=x.face>0?-1:1,l=w(x.mkS/.32,0,1),a=H+13*t,n=G+8,i=a+t*(11+2.2*Math.sin(36*m.t)),r=n+7+1.1*Math.sin(22*m.t);e.strokeStyle="rgba(248,220,112,"+(.38+.45*l)+")",e.lineWidth=2,e.beginPath(),e.moveTo(a,n),e.quadraticCurveTo(.5*(a+i),n+2,i,r),e.stroke(),e.fillStyle="rgba(250,214,103,.72)",e.beginPath(),e.arc(i+2*t,r+2,2.1,0,2*Math.PI),e.fill(),e.fillStyle="rgba(244,205,93,.38)",e.beginPath(),e.ellipse(i+5*t,r+7,5.2,2.7,0,0,2*Math.PI),e.fill()}if((x.zc>0||x.zcd>0)&&x.zt<=0){const t=x.zcd>0?0:Math.min(1,x.zc/x.zLoad),l=t<=0?Math.max(0,1-x.zcd/x.zCool):0,a=18+8*t+1.2*Math.sin(22*m.t);e.strokeStyle=x.zr?"#8fffe5":"#ffd56d",e.lineWidth=2+1.8*t,e.beginPath(),e.arc(H,G,a,.5*-Math.PI,.5*-Math.PI+2*Math.PI*t),e.stroke(),x.zcd>0&&(e.strokeStyle="rgba(158,200,255,.7)",e.lineWidth=2,e.beginPath(),e.arc(H,G,16,.5*-Math.PI,.5*-Math.PI+2*Math.PI*l),e.stroke())}if(x.zt>0){const t=x.zt/2;e.strokeStyle="rgba(143,255,229,.7)",e.lineWidth=2.5,e.beginPath(),e.arc(H,G,20+2*Math.sin(30*m.t)+4*t,0,2*Math.PI),e.stroke(),e.fillStyle="rgba(143,255,229,.16)",e.beginPath(),e.ellipse(H-10*x.zx,G-7*x.zy,20,10,Math.atan2(x.zy,x.zx),0,2*Math.PI),e.fill()}x.flash>0&&(e.globalAlpha=x.flash/.07,e.fillStyle="#ffe598",e.beginPath(),e.moveTo(H+16*x.gx,G+8*x.gy),e.lineTo(H+24*x.gx-5*x.gy,G+24*x.gy+4*x.gx),e.lineTo(H+24*x.gx+5*x.gy,G+24*x.gy-4*x.gx),e.closePath(),e.fill(),e.globalAlpha=1);for(let t=0;t<P.length;t++){const n=P[t],i=n.x-c,r=n.y-b;i<-8||r<-8||i>l+8||r>a+8||(e.globalAlpha=Math.max(0,Math.min(1,2.4*n.t)),e.fillStyle=n.c,e.fillRect(0|i,0|r,3,3))}e.globalAlpha=1;const B=44,O=l-18-B,K=l<420;let E=62,X=74;const Y=Math.max(96,l-190);if(e.fillStyle="rgba(7,10,16,.76)",e.fillRect(10,10,l-20,104),e.fillStyle="#eef4ff",e.font="700 17px Trebuchet MS,sans-serif",e.fillText("SCOTTY",20,32),K){const t=52,l=O-8;e.font="600 12px Trebuchet MS,sans-serif",e.fillStyle="#9ec8ff",e.fillText("Time "+m.time.toFixed(1)+"s",20,t),e.fillStyle="#ffd56d",e.fillText("Kills "+m.kills,118,t),e.textAlign="right",e.fillStyle="#dce8ff",e.fillText("Best "+m.best,l,t),e.textAlign="left",E=62,X=74}else e.font="600 14px Trebuchet MS,sans-serif",e.fillStyle="#9ec8ff",e.fillText("Time "+m.time.toFixed(1)+"s",20,54),e.fillStyle="#ffd56d",e.fillText("Kills "+m.kills,150,54),e.textAlign="right",e.fillStyle="#dce8ff",e.fillText("Best "+m.best,l-24,54),e.textAlign="left";e.fillStyle="#2a3346",e.fillRect(20,E,Y,10),e.fillStyle="#ef4f6c",e.fillRect(20,E,Y*(x.hp/x.maxHp),10),e.fillStyle="#24374d",e.fillRect(20,X,Y,8),e.fillStyle="#69f0c9",e.fillRect(20,X,Y*(m.xp/m.nextXp),8);const _=x.mkOn?m.bd?"boss defeated":m.bs?"defeat boss":m.pz&&"nsh"===m.pz.id?"solve nsh puzzle":m.pz&&"mel"===m.pz.id?"solve mellon puzzle":0===m.sch.nsh?"go to nsh":1===m.sch.nsh?"solve nsh puzzle":0===m.sch.mel?"go to mellon institute":1===m.sch.mel?"solve mellon puzzle":"survive phase 2":"collect mints "+m.homeGot+"/"+m.homeNeed;if(e.fillStyle="rgba(8,12,19,.62)",e.fillRect(14,118,l-28,26),e.fillStyle="#d7ffe8",e.font="600 12px Trebuchet MS,sans-serif",e.fillText(_,22,135),m.start&&!m.dead){const t=(t,l,a,n,i,r)=>{e.fillStyle="rgba(8,12,19,.92)",e.fillRect(O,t,B,B),e.strokeStyle=n?l:"rgba(129,157,187,.7)",e.lineWidth=2,e.strokeRect(O+.5,t+.5,43,43),e.strokeStyle="rgba(72,88,109,.85)",e.lineWidth=3,e.beginPath(),e.arc(O+22,t+22,14.96,0,2*Math.PI),e.stroke(),e.strokeStyle=l,e.beginPath(),e.arc(O+22,t+22,14.96,.5*-Math.PI,.5*-Math.PI+2*Math.PI*w(a,0,1)),e.stroke(),e.fillStyle=l,r<1?(e.beginPath(),e.moveTo(O+21.56,t+8.36),e.lineTo(O+.35*B,t+23.32),e.lineTo(O+21.56,t+23.32),e.lineTo(O+17.16,t+36.08),e.lineTo(O+29.48,t+18.04),e.lineTo(O+22.44,t+18.04),e.closePath(),e.fill()):r<2?(e.beginPath(),e.arc(O+22,t+19.36,4.4,0,2*Math.PI),e.fill(),e.beginPath(),e.moveTo(O+22,t+8.8),e.bezierCurveTo(O+30.36,t+19.8,O+28.16,t+29.48,O+22,t+34.32),e.bezierCurveTo(O+15.84,t+29.48,O+13.64,t+19.8,O+22,t+8.8),e.fill()):(e.lineWidth=2,e.beginPath(),e.arc(O+22,t+22,.12*B,0,2*Math.PI),e.stroke(),e.beginPath(),e.arc(O+22,t+22,9.68,0,2*Math.PI),e.stroke()),i>0?(e.fillStyle="#dce8ff",e.font="700 10px Trebuchet MS,sans-serif",e.fillText(i.toFixed(1)+"s",O+8,t+B-6)):n&&(e.fillStyle="rgba(255,255,255,.8)",e.beginPath(),e.arc(O+B-8,t+8,3,0,2*Math.PI),e.fill())};t(14,"#8fffe5",x.zcd>0?1-x.zcd/x.zCool:x.zr?1:x.zc/x.zLoad,x.zt>0,x.zcd>0?x.zcd:0,0);const l=x.mkOn?x.mkT>0?1-x.mkT/x.mkI:1:0;t(66,x.cat?1===x.catType?"#8fdd73":2===x.catType?"#7ad8cd":3===x.catType?"#8fb6ff":"#f4d96e":"#f4d96e",l,x.mkS>0,x.mkOn&&x.mkT>0?x.mkT:0,1);const a=x.rf?x.rfT>0?1-x.rfT/x.rfI:1:0;x.rf&&t(118,"#a8b8ff",a,1,x.rfT>0?x.rfT:0,2),x.cat&&(e.fillStyle="rgba(7,10,16,.75)",e.fillRect(O-56,78,50,20),e.fillStyle="#dce8ff",e.font="600 10px Trebuchet MS,sans-serif",e.fillText(F(),O-50,91))}if(m.msgT>0&&(e.fillStyle="rgba(8,12,19,.74)",e.fillRect(14,148,l-28,28),e.fillStyle="#d7ffe8",e.font="600 13px Trebuchet MS,sans-serif",e.fillText(m.msg,22,167)),m.start&&!m.dead&&!m.lvup&&!m.pz&&M.show>.01){const t=M.x+M.tx,l=M.y+M.ty;e.fillStyle="rgba(7,11,17,"+.42*M.show+")",e.beginPath(),e.arc(M.x,M.y,M.r+8,0,2*Math.PI),e.fill(),e.strokeStyle="rgba(158,200,255,"+.45*M.show+")",e.lineWidth=2,e.beginPath(),e.arc(M.x,M.y,M.r,0,2*Math.PI),e.stroke(),e.fillStyle="rgba(105,240,201,"+(u?.65:.42)*M.show+")",e.beginPath(),e.arc(t,l,M.kr,0,2*Math.PI),e.fill(),e.strokeStyle="rgba(220,248,255,"+.65*M.show+")",e.lineWidth=1.5,e.beginPath(),e.arc(t,l,M.kr,0,2*Math.PI),e.stroke()}if(!m.start){const t=20,n=.16*a,i=l-40,r=.68*a,s=t+16;e.fillStyle="rgba(6,9,14,.86)",e.fillRect(t,n,i,r),e.fillStyle="#fff",e.font="700 30px Trebuchet MS,sans-serif",e.fillText("Project: Zoomies",s,n+42),e.fillStyle="#9ec8ff",e.font="600 15px Trebuchet MS,sans-serif",e.fillText("what the dog doing?",s,n+64),e.fillStyle="#d8e6ff",e.font="600 14px Trebuchet MS,sans-serif",A("Goop swallowed CMU paths. People are trapped inside buildings. Scotty is the only one fast enough to move across campus.",s,n+98,i-32,18,5),e.fillStyle="#9ec8ff",e.font="600 13px Trebuchet MS,sans-serif",A("Collaborate with each college, unlock abilities, and defeat the infestation.",s,n+200,i-32,17,3),e.fillStyle="#dce8ff",e.font="600 12px Trebuchet MS,sans-serif",A("Controls: drag to move. Remove finger to charge Zoomies, then move to dash. Scotty pees to mark territory, and those puddles slow enemies.",s,n+250,i-32,16,4),e.fillStyle="#69f0c9",e.font="700 23px Trebuchet MS,sans-serif",e.fillText("tap start",s,n+r-22)}if(m.lvup&&!m.dead){e.fillStyle="rgba(6,10,15,.16)",e.fillRect(0,0,l,a);const t=R(),n=t.bx,i=t.by,r=t.bw,s=t.bh,f=t.rects,o=t.mobile;e.fillStyle="rgba(17,29,45,.95)",C(n,i,r,s,16),e.fill(),e.strokeStyle="rgba(90,125,163,.8)",e.lineWidth=1.2,C(n+.5,i+.5,r-1,s-1,16),e.stroke(),e.fillStyle="#ecf3ff",e.font=(o?"700 18px":"700 20px")+" Trebuchet MS,sans-serif",e.fillText("SKILL BOOK",n+14,i+24),e.fillStyle="#9ec8ff",e.font="600 12px Trebuchet MS,sans-serif",e.fillText("choose",n+14,i+39);for(let t=0;t<3;t++){const l=m.choices[t],a=f[t],n=.9+.1*I(w((m.cardT-.07*t)/.28,0,1)),i=a.x+.5*a.w,r=a.y+.5*a.h;e.save(),e.translate(i,r),e.scale(n,n),e.translate(-i,-r);const s=l&&l.bg?l.bg:"rgba(27,44,66,.96)",h=l&&l.st?l.st:"rgba(116,150,186,.85)",c=l&&l.tx?l.tx:"#eef5ff",b=l&&l.sub?l.sub:"#a9c3e2";if(e.fillStyle=s,C(a.x,a.y,a.w,a.h,10),e.fill(),e.strokeStyle=h,e.lineWidth=1.2,C(a.x+.5,a.y+.5,a.w-1,a.h-1,10),e.stroke(),l){const t=q(l.n)+" "+l.n;let n=o?16:17;for(;n>12&&(e.font="700 "+n+"px Trebuchet MS,sans-serif",!(e.measureText(t).width<=a.w-22));n--);e.fillStyle=c,e.fillText(t,a.x+12,a.y+30),e.fillStyle=b,e.font="600 12px Trebuchet MS,sans-serif",A(l.d,a.x+12,a.y+48,a.w-24,14,2)}e.restore()}e.fillStyle="#95bce8",e.font="600 12px Trebuchet MS,sans-serif",e.fillText("tap 1/2/3",n+14,i+s-12)}if(m.pz&&!m.dead&&!m.lvup&&m.start){const t=L(),n=m.pz;if(e.fillStyle="rgba(5,9,14,.5)",e.fillRect(0,0,l,a),e.fillStyle="rgba(16,24,37,.96)",C(t.bx,t.by,t.bw,t.bh,14),e.fill(),e.strokeStyle="rgba(106,145,185,.85)",e.lineWidth=1.2,C(t.bx+.5,t.by+.5,t.bw-1,t.bh-1,14),e.stroke(),e.fillStyle="#ecf3ff",e.font="700 19px Trebuchet MS,sans-serif",e.fillText("nsh"===n.id?"NSH lab":"Mellon lab",t.bx+14,t.by+27),"nsh"===n.id){e.fillStyle="#dce8ff",e.font="600 12px Trebuchet MS,sans-serif",e.fillText("order",t.bx+14,t.by+66);for(let l=0;l<n.seq.length;l++){const a=t.bx+24+34*l,i=t.by+86,r=l<n.step;e.fillStyle=r?"#8cffc2":"#79d7ff",e.beginPath(),e.arc(a,i,12,0,2*Math.PI),e.fill(),e.fillStyle="#12243a",e.font="700 11px Trebuchet MS,sans-serif",e.fillText(n.seq[l]+1+"",a-3,i+4)}}else{const l=["#8fd3ff","#ffd58f","#ff9fb7"];e.fillStyle="#dce8ff",e.font="600 12px Trebuchet MS,sans-serif",e.fillText("mix",t.bx+14,t.by+66);for(let a=0;a<n.seq.length;a++){const i=t.bx+24+30*a,r=t.by+86,s=a<n.step;e.fillStyle=l[n.seq[a]],e.beginPath(),e.arc(i,r,10,0,2*Math.PI),e.fill(),s&&(e.strokeStyle="#8cffc2",e.lineWidth=2,e.beginPath(),e.arc(i,r,12,0,2*Math.PI),e.stroke())}}for(let l=0;l<3;l++){const a=t.btn[l];e.fillStyle="nsh"===n.id?"rgba(37,87,129,.96)":["#3c6588","#9a6f3f","#8e4f64"][l],C(a.x,a.y,a.w,a.h,10),e.fill(),e.strokeStyle="rgba(196,223,255,.72)",e.lineWidth=1.1,C(a.x+.5,a.y+.5,a.w-1,a.h-1,10),e.stroke(),e.fillStyle="#eef5ff",e.font="700 13px Trebuchet MS,sans-serif",e.fillText("nsh"===n.id?"terminal "+(l+1):["blue","amber","rose"][l],a.x+9,a.y+28)}e.fillStyle="#9ec8ff",e.font="600 11px Trebuchet MS,sans-serif",e.fillText("tap 1/2/3",t.bx+14,t.by+t.bh-10)}m.dead&&(e.fillStyle="rgba(5,8,13,.86)",e.fillRect(24,.24*a,l-48,.5*a),e.fillStyle="#ff8298",e.font="700 33px Trebuchet MS,sans-serif",e.fillText("GAME OVER",.5*l-98,.38*a),e.fillStyle="#dce8ff",e.font="600 20px Trebuchet MS,sans-serif",e.fillText("Kills "+m.kills,.5*l-43,.47*a),e.fillText("Best "+m.best,.5*l-37,.53*a),e.fillStyle="#69f0c9",e.font="700 24px Trebuchet MS,sans-serif",e.fillText("tap retry",.5*l-56,.65*a))}(),requestAnimationFrame(t)})})();</script></body></html>