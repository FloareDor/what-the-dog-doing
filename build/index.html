<!doctype html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover"><title>Scotty Survival</title><style>:root{--bg:#0a0d12;--sky:#1a2940;--ink:#ecf3ff;--red:#ef4f6c;--mint:#69f0c9;--gold:#ffd56d;--line:#2f4868}*{box-sizing:border-box}html,body{margin:0;width:100%;height:100%;overflow:hidden;background:var(--bg);color:var(--ink);font-family:Trebuchet MS,Avenir Next,Segoe UI,sans-serif}body{touch-action:none}canvas{display:block;width:100%;height:100%}</style></head><body><canvas id="c"></canvas><script src="leaderboard-config.js"></script><script>(()=>{const t=document.getElementById("c"),e=t.getContext("2d");let l=360,a=740,s=1,n=0;const r=[{id:"home",n:"Cohon Centre",x:260,y:900,r:170,c:"#8ec0ff"},{id:"nsh",n:"NSH",x:980,y:460,r:170,c:"#79d7ff"},{id:"mel",n:"Mellon Inst",x:1880,y:1260,r:185,c:"#ffd58f"}],i=["i need to go out","these things are scary","may lord help us","can we ever go out?"],o=["a dog?","scotty??","what the dog doing?"],h=180,f=.42,c=1.08,m={};function b(t){const e=new Image;return e.src="black_scottish_terrier_dog_with_red_scarf/rotations/"+t+".png",e}m.e=b("east"),m.w=b("west"),m.ne=b("north-east"),m.nw=b("north-west"),m.se=b("south-east"),m.sw=b("south-west");let x=0;function d(t,e,l,a){if(!x)return;const s=x.createOscillator(),n=x.createGain();s.type=l||"triangle",s.frequency.value=t,n.gain.value=a||.02,n.gain.exponentialRampToValueAtTime(1e-4,x.currentTime+e),s.connect(n).connect(x.destination),s.start(),s.stop(x.currentTime+e)}let y=0;function p(){if(!g.start)return;const t=performance.now();t-y<1200||(y=t,d(392,.07,"square",.02),d(523,.08,"triangle",.014))}const g={start:0,dead:0,lvup:0,t:0,time:0,kills:0,spawnT:0,nextSpawn:.8,msg:"",msgT:0,level:1,xp:0,nextXp:24,stop:0,shake:0,xpPulse:0,cardT:0,best:+localStorage.ss_best||0,choices:[],homeNeed:3,homeGot:0,sch:{nsh:0,mel:0},pz:0,uq:[],inB:"",bs:0,bd:0,bs2:0,bd2:0,b2At:0,bossDownT:0,apWarn1:0,apWarn2:0,apStormHitCd:0,botMask:0,chemMask:0,labStep:0,labBank:0,labFlip:0,labNsh:0,labMel:0,labNshRuns:0,labMelRuns:0,stormCd:0,labCd:0,lvPend:0,lvGrace:0,lbSent:0,lbTop:[],lbTopErr:"",lbFetchT:0,lbRankText:"",lbRankErr:"",lbRankFetchT:0,lbBtnX:0,lbBtnY:0,lbBtnW:0,lbBtnH:0},u=window.LEADERBOARD_CONFIG||{},M=((u.supabaseUrl||"")+"").replace(/\/+$/,""),T=(u.supabaseAnonKey||"")+"",k=(u.table||"leaderboard_entries")+"",S="zoomies_last_entry",v="zoomies_lb_name",P="zoomies_lb_optin";function z(t){try{return localStorage.getItem(t)||""}catch{return""}}function C(t,e){try{localStorage.setItem(t,e)}catch{}}function R(t){return"string"==typeof t&&t.length>0&&t.length<=24&&/^[A-Za-z0-9 _.-]+$/.test(t)}function w(){location.href="leaderboard.html"}async function A(t){if(!M||!T||!k)return;const e=Date.now();if(t||!(e-g.lbFetchT<8e3)){g.lbFetchT=e,g.lbTopErr="";try{const t="?select=name,kills,time_seconds&order=kills.desc,time_seconds.asc,id.asc&limit=3",e=await fetch(M+"/rest/v1/"+encodeURIComponent(k)+t,{headers:{apikey:T,Authorization:"Bearer "+T}});if(!e.ok)return void(g.lbTopErr="leaderboard unavailable");const l=await e.json();g.lbTop=Array.isArray(l)?l:[]}catch{g.lbTopErr="leaderboard unavailable"}}}async function I(t){if(!M||!T||!k)return;const e=Date.now();if(!t&&e-g.lbRankFetchT<8e3)return;g.lbRankFetchT=e,g.lbRankErr="";const l=function(t){try{const e=localStorage.getItem(t);return e?JSON.parse(e):0}catch{return 0}}(S);if(l&&l.id)try{const s=await fetch(M+"/rest/v1/"+encodeURIComponent(k)+"?select=id,name,kills,time_seconds&id=eq."+l.id+"&limit=1",{headers:{apikey:T,Authorization:"Bearer "+T}});if(!s.ok)return void(g.lbRankErr="rank unavailable");const n=await s.json();if(!Array.isArray(n)||!n.length)return void(g.lbRankText="score syncing...");const r=n[0];async function a(t){const e=await fetch(M+"/rest/v1/"+encodeURIComponent(k)+"?select=id&"+t,{method:"HEAD",headers:{apikey:T,Authorization:"Bearer "+T,Prefer:"count=exact"}});if(!e.ok)throw Error("count failed");return function(t){const e=((t||"")+"").match(/\/(\d+)$/);return e?+e[1]:0}(e.headers.get("content-range"))}const i=await a("kills=gt."+r.kills)+await a("kills=eq."+r.kills+"&time_seconds=lt."+r.time_seconds)+await a("kills=eq."+r.kills+"&time_seconds=eq."+r.time_seconds+"&id=lt."+r.id)+1;g.lbRankText="your rank #"+i+" ("+r.kills+" / "+Number(r.time_seconds).toFixed(1)+"s)"}catch{g.lbRankErr="rank unavailable"}else g.lbRankText="submit once to track your rank"}const D={x:260,y:900,vx:0,vy:0,r:15,hp:100,maxHp:100,speed:185,fireCd:0,fireRate:.46,dmg:12,range:400,shots:1,magnet:88,face:1,rx:0,ry:0,flash:0,gx:1,gy:0,zc:0,zr:0,zt:0,zx:1,zy:0,zcd:0,zDur:1,zSpd:2.1,zLoad:1.5,zCool:5.5,zDmg:24,zDr:.55,zb:0,zp:0,mkOn:0,mkT:0,mkI:8.8,mkS:0,mkD:14,mkR:54,mkSl:.54,chDo:14,chBurst:10,chHeal:8,chHealCd:0,chHealI:.85,cat:0,catM:0,catType:0,bot:0,botCount:0,botSlots:0,bType:0,bAtk:1,bAuraR:0,bAuraSl:0,bHealCd:0,bHealI:10,bHealAmt:10,bHealFx:0,triA:0,triFx:0,slCharge:0,slFocus:0,slT:0,slRecallT:0,slLinkT:0,slRecallPulse:0,slCarryVx:0,slCarryVy:0,slPow:0,slWave:0,slComboFx:0,slHitMask:0,slPerfect:0,slDx:1,slDy:0,bx:0,by:0,ba:0,bcd:0,bRate:1.9,bDmg:1.15,bRange:480,bFetch:95,bPull:195,bCarry:0,bCarryMax:2,bGrabCd:0,bGrabI:.38,bPier:4,bSize:6},B={l:0,r:0,u:0,d:0,gr:0};let F=-1,H=0;const q={x:78,y:0,r:42,kr:16,tx:0,ty:0,ax:0,ay:0,ttx:0,tty:0,tax:0,tay:0,show:0,act:0},L=[],W=[],E=[],G=[],O=[],X=[],N=[];function _(t,e){return t+Math.random()*(e-t)}function V(t,e,l){return t<e?e:t>l?l:t}function Y(t,e,l,a,s,n){const r=s-l,i=n-a;let o=((t-l)*r+(e-a)*i)/(r*r+i*i||1);o=V(o,0,1);const h=t-(l+r*o),f=e-(a+i*o);return h*h+f*f}function K(t){const e=t-1;return 1+2.70158*e*e*e+1.70158*e*e}function U(t,l,a,s,n){const r=Math.max(0,Math.min(n,.5*Math.min(a,s)));e.beginPath(),e.moveTo(t+r,l),e.lineTo(t+a-r,l),e.quadraticCurveTo(t+a,l,t+a,l+r),e.lineTo(t+a,l+s-r),e.quadraticCurveTo(t+a,l+s,t+a-r,l+s),e.lineTo(t+r,l+s),e.quadraticCurveTo(t,l+s,t,l+s-r),e.lineTo(t,l+r),e.quadraticCurveTo(t,l,t+r,l),e.closePath()}function Z(){const t=l<560,e=t?l-14:Math.min(l-20,620),s=t?V(.48*a,296,390):V(.4*a,268,340),n=.5*(l-e),r=a-s-12,i=[];if(t){const t=8,l=e-22,a=Math.max(74,Math.min(100,(s-84-2*t)/3)),o=r+50;for(let e=0;e<3;e++)i.push({x:n+14,y:o+e*(a+t),w:l,h:a})}else{const t=10,l=(e-32-2*t)/3,a=Math.max(102,Math.min(130,s-82)),o=r+52;for(let e=0;e<3;e++)i.push({x:n+16+e*(l+t),y:o,w:l,h:a})}return{mobile:t,bx:n,by:r,bw:e,bh:s,rects:i}}function Q(t,l,a,s,n,r){const i=t.split(" ");let o="",h=0;for(let t=0;t<i.length;t++){const f=o?o+" "+i[t]:i[t];if(e.measureText(f).width<=s)o=f;else{if(e.fillText(o,l,a+h*n),h++,h>=r)return;o=i[t]}}h<r&&o&&e.fillText(o,l,a+h*n)}function j(t){return t.includes("Buddy")||t.includes("Bot")?"ðŸ¤–":t.includes("Catalyst")||t.includes("Chemical")||t.includes("Acidic")?"ðŸ§ª":t.includes("Heal")||t.includes("Tough")?"â¤ï¸":t.includes("Shock")||t.includes("Zoomies")||t.includes("Rapid")||t.includes("Speed")?"âš¡":t.includes("Magnet")?"ðŸ§²":t.includes("Shot")?"ðŸŽ¯":t.includes("Territory")||t.includes("Puddle")||t.includes("Gravity")?"ðŸ’§":t.includes("Bite")?"ðŸ¦´":"ðŸ› ï¸"}function J(t){for(let e=0;e<r.length;e++)if(r[e].id===t)return r[e];return 0}function $(t,e,l){const a=l||0;for(let l=0;l<r.length;l++){const s=r[l],n=t-s.x,i=e-s.y;if(n*n+i*i<(s.r+a)*(s.r+a))return s}return 0}function tt(t,e){const l=e||0;let a=0;for(let e=0;e<r.length;e++){const s=r[e];let n=t.x-s.x,i=t.y-s.y,o=Math.hypot(n,i)||1;const h=s.r+l;if(o<h){if(o<.001){const t=Math.random()*Math.PI*2;n=Math.cos(t),i=Math.sin(t),o=1}t.x=s.x+n/o*h,t.y=s.y+i/o*h,a=1}}return a}function et(){const t=Math.min(l-24,420),e=Math.min(a-130,260),s=.5*(l-t),n=.5*(a-e)+24,r=(t-36-20)/3,i=n+e-72;return{bx:s,by:n,bw:t,bh:e,btn:[{x:s+18,y:i,w:r,h:46},{x:s+18+r+10,y:i,w:r,h:46},{x:s+18+2*(r+10),y:i,w:r,h:46}]}}function lt(t){const e=[];let l=-1;for(let a=0;a<t;a++){let t=3*Math.random()|0;t===l&&(t=(t+1+(2*Math.random()|0))%3),e.push(t),l=t}return e}function at(t,e){if(!g.pz)if("lab"===e&&"nsh"===t){const t=1+(g.labNshRuns/2|0),e=4+Math.min(2,t-1);g.pz={id:"nsh",seq:lt(e),step:0,lab:1,trial:g.labNshRuns+1,tier:t},g.msg="research",g.msgT=1.2}else if("lab"===e&&"mel"===t){const t=1+(g.labMelRuns/2|0),e=5+Math.min(2,t-1);g.pz={id:"mel",seq:lt(e),step:0,lab:1,trial:g.labMelRuns+1,tier:t},g.msg="research",g.msgT=1.2}else"nsh"===t?(g.pz={id:"nsh",seq:lt(3),step:0},g.msg="research",g.msgT=1.2):"mel"===t&&(g.pz={id:"mel",seq:lt(4),step:0},g.msg="research",g.msgT=1.2)}function st(t){if(!g.pz)return;const e=g.pz;if(t===e.seq[e.step]){if(e.step++,d(620+70*e.step,.04,"triangle",.018),e.step>=e.seq.length){const t=e.id;g.pz=0,function(t){"nsh"===t&&2!==g.sch.nsh?(g.sch.nsh=2,ot("nsh"),g.msg="nsh",g.msgT=2.1,St(.12),It(D.x,D.y,"#79d7ff",16,95),d(760,.07,"square",.024)):"nsh"===t&&g.labNsh>0?(g.labNsh--,ot("nsh"),g.msg="nsh prototype ready",g.msgT=1.8,St(.12),It(D.x,D.y,"#9de6ff",12,72),d(740,.06,"triangle",.022)):"mel"===t&&2!==g.sch.mel?(g.sch.mel=2,ot("mel"),g.msg="mel",g.msgT=2.1,St(.12),It(D.x,D.y,"#ffd58f",16,95),d(720,.07,"square",.024)):"mel"===t&&g.labMel>0&&(g.labMel--,ot("mel"),g.msg="mellon prototype ready",g.msgT=1.8,St(.12),It(D.x,D.y,"#b6ef9d",12,72),d(720,.06,"triangle",.022)),pt(),g.labCd=3}(t),e.lab&&("nsh"===t?g.labNshRuns++:"mel"===t&&g.labMelRuns++)}}else e.step=0,St(.03),d(180,.06,"square",.02),g.msg="retry",g.msgT=.55}function nt(t){"nsh"===t&&0===g.sch.nsh?(g.sch.nsh=1,p(),at("nsh"),g.msg="help",g.msgT=1.4,d(640,.05,"triangle",.02)):"mel"===t&&0===g.sch.mel&&(g.sch.mel=1,p(),at("mel"),g.msg="help",g.msgT=1.4,d(680,.05,"triangle",.02))}function rt(){const t=ht(g.chemMask);return t>=3?"triple burst":2===t?"dual burst":1&g.chemMask?"acid":2&g.chemMask?"heal":4&g.chemMask?"grav":"chem"}function it(){D.cat&&(g.msg="brew: "+rt(),g.msgT=1.1,d(520,.04,"triangle",.016))}function ot(t){g.uq.indexOf(t)<0&&g.uq.push(t)}function ht(t){return(1&t?1:0)+(2&t?1:0)+(4&t?1:0)}function ft(){return D.zt>0||D.slT>0||D.slRecallT>0||D.slLinkT>0}function ct(){return ft()||g.lvGrace>0}const mt={1:{rate:1.15,dmg:1.6,range:620,fetch:72,pull:150,carry:1,grab:.42,pier:5,size:7.2,auraR:0,auraSl:0,healI:0,healAmt:0,pulse:1,col:"#9de6ff",body:"#93d8ff",ring:"#d0efff"},2:{rate:1.72,dmg:.95,range:520,fetch:118,pull:198,carry:2,grab:.34,pier:0,size:3.8,auraR:0,auraSl:0,healI:18,healAmt:10,pulse:0,col:"#7ae8a3",body:"#74de95",ring:"#d9ffe5"},3:{rate:2.45,dmg:.95,range:390,fetch:110,pull:205,carry:2,grab:.34,pier:2,size:8.5,auraR:124,auraSl:.46,healI:0,healAmt:0,pulse:1,col:"#ffd48c",body:"#ffd48c",ring:"#fff0c7"}};function bt(t){const e=mt[t]||mt[1],l=Math.max(0,D.bCarryMax-2);return{rate:Math.max(.5,e.rate*(D.bRate/1.9)),dmg:e.dmg*(D.bDmg/1.15),range:e.range*(D.bRange/480),fetch:e.fetch*(D.bFetch/95),pull:e.pull*(D.bPull/195),carry:Math.max(1,e.carry+l),grab:Math.max(.14,e.grab*(D.bGrabI/.38)),pier:Math.max(0,Math.round(e.pier+(D.bPier-4))),size:Math.max(2.8,e.size*(D.bSize/6)),auraR:e.auraR,auraSl:e.auraSl,healI:e.healI,healAmt:e.healAmt,pulse:e.pulse,col:e.col,body:e.body,ring:e.ring}}function xt(t){const e=[];for(let l=1;l<=3;l++)t&1<<l-1||e.push(l);return e}function dt(t){return 1===t?{n:"Volt Buddy",d:"striker bot: rapid shock pulses, low cargo",f:()=>Mt(1),bg:"rgba(29,53,79,.96)",st:"rgba(147,216,255,.88)",tx:"#f1f9ff",sub:"#b3d4ee"}:2===t?{n:"Medic Buddy",d:"green rounds + heals Scotty every 18s",f:()=>Mt(2),bg:"rgba(24,72,44,.96)",st:"rgba(148,232,171,.9)",tx:"#e9ffef",sub:"#b9e5c6"}:{n:"Guard Buddy",d:"warden bot: slowing aura + sturdy pulse",f:()=>Mt(3),bg:"rgba(73,50,27,.96)",st:"rgba(255,205,138,.9)",tx:"#fff4df",sub:"#e6cda5"}}function yt(t){return 1===t?{n:"Acidic Puddle",d:"corrosive zone: burst + damage over time",f:()=>Tt(1),bg:"rgba(33,75,34,.96)",st:"rgba(160,236,146,.88)",tx:"#edffe9",sub:"#bce2b3"}:2===t?{n:"Heal Puddle",d:"restorative zone: heals Scotty while inside",f:()=>Tt(2),bg:"rgba(22,79,72,.96)",st:"rgba(151,242,228,.9)",tx:"#e8fffb",sub:"#b6e7df"}:{n:"Gravity Puddle",d:"black hole zone: drags enemies from far outside",f:()=>Tt(3),bg:"rgba(30,45,86,.96)",st:"rgba(156,190,255,.9)",tx:"#edf3ff",sub:"#bfd1f0"}}function pt(){for(;g.kills>=50*(g.labStep+1);)g.labStep++,g.labBank++,g.msg="new prototype intel",g.msgT=1.25,d(620,.04,"triangle",.018);for(;g.labBank>0;){const t=g.uq.indexOf("nsh")>=0?1:0,e=g.uq.indexOf("mel")>=0?1:0,l=ht(g.botMask),a=ht(g.chemMask),s=l+g.labNsh+t,n=2===s?4:1,r=2===g.sch.nsh&&l>=1&&s<3&&g.labBank>=n,i=2===g.sch.mel&&a>=1&&a+g.labMel+e<3;if(!r&&!i)break;let o="";r&&i?(g.labFlip^=1,o=g.labFlip?"nsh":"mel"):o=r?"nsh":"mel","nsh"===o?(g.labNsh++,g.msg="nsh: prototype bench ready",g.msgT=1.6,d(700,.05,"triangle",.02),g.labBank-=n):(g.labMel++,g.msg="mellon: catalyst bench ready",g.msgT=1.6,d(680,.05,"triangle",.02),g.labBank--)}}function gt(t){g.lvup||g.pz||g.uq.length||g.labCd>0||("nsh"===t&&g.labNsh>0?(at("nsh","lab"),g.msg="nsh: run prototype trial",g.msgT=1.35,d(700,.05,"triangle",.02)):"mel"===t&&g.labMel>0&&(at("mel","lab"),g.msg="mellon: run prototype trial",g.msgT=1.35,d(680,.05,"triangle",.02)))}function ut(){const t=function(){const t=[];for(let e=1;e<=3;e++)g.botMask&1<<e-1&&t.push(e);return t}(),e=D.bot?Math.max(1,Math.min(0|D.botCount,t.length||1)):0;for(;X.length<e;){const e=t[Math.min(t.length-1,X.length)]||1;X.push({x:D.x,y:D.y,t:e,cd:_(.05,.3),grabCd:_(.03,.22),slx:0,sly:0,vx:0,vy:0})}for(;X.length>e;)X.pop();for(let e=0;e<X.length;e++)X[e].t=t[Math.min(t.length-1,e)]||X[e].t||1;if(D.botSlots!==e){const t=40;for(let e=0;e<X.length;e++){const l=D.ba+e*(2*Math.PI/Math.max(1,X.length));X[e].x=D.x+Math.cos(l)*t,X[e].y=D.y+Math.sin(l)*t,X[e].cd=_(.05,.3),X[e].grabCd=_(.03,.22),X[e].slx=0,X[e].sly=0,X[e].vx=0,X[e].vy=0}D.botSlots=e}X.length||(D.bx=D.x+20,D.by=D.y+4,D.botSlots=0)}function Mt(t){const e=!D.bot;D.bot=1,D.bType=t,D.bx=D.x+20,D.by=D.y+4,D.ba=0,e&&(D.bcd=.45,D.bRate=1.9,D.bDmg=1.15,D.bRange=480,D.bFetch=95,D.bPull=195,D.bCarry=0,D.bCarryMax=2,D.bGrabCd=0,D.bGrabI=.38,D.bPier=4,D.bSize=6,D.bAtk=1,D.bAuraR=0,D.bAuraSl=0,D.bHealCd=0,D.bHealI=10,D.bHealAmt=10,D.bHealFx=0),g.botMask|=1<<t-1,D.botCount=Math.max(1,ht(g.botMask)),ut(),pt()}function Tt(t){D.cat=1,D.catType=t,D.catM=0,D.chDo=14,D.chBurst=10,D.chHeal=8,D.chHealCd=0,D.chHealI=.85,1===t?(D.chDo=20,D.chBurst=13):2===t?(D.chHeal=10,D.chHealI=.85):D.mkSl=Math.max(D.mkSl,.6),g.chemMask|=1<<t-1,pt()}function kt(){if(g.lvup||g.dead||g.pz||!g.uq.length||ct())return;const t=g.uq.shift();if(g.choices=[],"nsh"===t){const t=xt(g.botMask);if(1===t.length){const e=t[0];return Mt(e),g.msg="nsh: "+function(t){return 1===t?"Volt Buddy":2===t?"Medic Buddy":"Guard Buddy"}(e)+" calibrated",g.msgT=1.6,It(D.x,D.y,"#9de6ff",14,84),void d(760,.06,"triangle",.025)}2===t.length?g.choices=[dt(t[0]),dt(t[1]),{n:"Wildcard Buddy",d:"installs one of the remaining buddy prototypes",f:()=>Mt(t[Math.random()*t.length|0]),bg:"rgba(42,63,95,.96)",st:"rgba(167,207,255,.86)",tx:"#eef7ff",sub:"#c3d8ef"}]:3===t.length&&(g.choices=[dt(1),dt(2),dt(3)])}else if("mel"===t){const t=xt(g.chemMask);if(1===t.length){const e=t[0];return Tt(e),g.msg="mellon: "+function(t){return 1===t?"Acidic Puddle":2===t?"Heal Puddle":"Gravity Puddle"}(e)+" calibrated",g.msgT=1.6,It(D.x,D.y,"#b6ef9d",14,84),void d(740,.06,"triangle",.025)}2===t.length?g.choices=[yt(t[0]),yt(t[1]),{n:"Wildcard Catalyst",d:"mixes one of the remaining catalyst variants",f:()=>Tt(t[Math.random()*t.length|0]),bg:"rgba(38,76,56,.96)",st:"rgba(159,236,184,.88)",tx:"#eaffef",sub:"#c2ebd0"}]:3===t.length&&(g.choices=[yt(1),yt(2),yt(3)])}g.choices.length&&(g.lvup=1,g.cardT=0,g.msg="up",g.msgT=1.4,d(760,.07,"triangle",.028))}function St(t){g.shake=V(g.shake+t,0,1.3)}function vt(t){g.stop=Math.max(g.stop,t)}function Pt(){s=Math.max(1,Math.min(2,devicePixelRatio||1)),l=Math.max(320,0|innerWidth),a=Math.max(560,0|innerHeight),t.width=l*s|0,t.height=a*s|0,e.setTransform(s,0,0,s,0,0),e.imageSmoothingEnabled=!1;const n=q.r+16;q.act?(q.x=V(q.x,n,l-n),q.y=V(q.y,n,a-n)):(q.x=78,q.y=a-88)}function zt(t,e){let l=t-q.x,a=e-q.y;const s=Math.hypot(l,a)||1,n=q.r;s<10?(l=0,a=0):s>n&&(l=l/s*n,a=a/s*n),q.ttx=l,q.tty=a,q.tax=l/n,q.tay=a/n}function Ct(t){q.act=0,q.ttx=0,q.tty=0,q.tax=0,q.tay=0,t&&(q.tx=0,q.ty=0,q.ax=0,q.ay=0,q.show=0)}function Rt(t){O.length>=420||O.push(t)}function wt(t){E.length>=260||E.push(t)}function At(t){W.length>=260||W.push(t)}function It(t,e,l,a,s){const n=L.length>130?.5:L.length>90?.7:1,r=Math.max(1,a*n|0);for(let a=0;a<r;a++){const a=Math.random()*Math.PI*2,n=(s||70)*(.4+Math.random());Rt({x:t,y:e,vx:Math.cos(a)*n,vy:Math.sin(a)*n,t:_(.2,.6),c:l})}}function Dt(t,e,l,a,s){const n=L[t],r=!!s;3===n.k?(g.bd=1,g.bs=0,g.b2At=g.t+12,g.apWarn1=0,g.apWarn2=0,g.apStormHitCd=0,g.msg="something big is approaching...",g.msgT=2.4,g.bossDownT=2.4,vt(.09),St(.55),It(n.x,n.y,"#ffe38f",44,210),It(n.x,n.y,"#9de6ff",26,150),d(200,.12,"sawtooth",.038),d(320,.12,"triangle",.024),d(500,.14,"square",.02)):4===n.k&&(g.bd2=1,g.bs2=0,g.msg="apex down",g.msgT=1.8,St(.32),d(210,.16,"sawtooth",.04)),g.kills++,pt(),r?It(n.x,n.y,e||"#ff9675",Math.max(2,.35*(l||9)|0),Math.max(20,.6*(a||70))):(vt(.03),St(.08),It(n.x,n.y,e||"#ff9675",l||9,a||70),d(280,.03,"square",.012));const i=260-E.length;if(i>0){const t=r?Math.random()<.25?1:0:1+(Math.random()<.4?1:0);for(let e=0;e<Math.min(t,i);e++)wt({x:n.x+_(-7,7),y:n.y+_(-7,7),v:0|_(5,8),m:1,t:0})}L.splice(t,1)}function Bt(t){G.length>=18&&G.shift(),G.push({x:D.x+4*D.gx,y:D.y+8,r:D.mkR,t:D.mkD,d:D.mkD,m:t});const e=1===t?"acid":2===t?"heal":3===t?"grav":"territory",l=1===t?"#8fdd73":2===t?"#7ad8cd":3===t?"#8fb6ff":"#ffd56d";g.msg=e,g.msgT=.5,It(D.x,D.y+8,l,8,38),d(1===t?540:2===t?600:3===t?480:560,.03,"triangle",.018),vt(.015),St(.035)}function Ft(t,e,l,a,s){(function(t,e,l,a){for(let s=0;s<N.length;s++){const n=N[s],r=e-n.x,i=l-n.y;if(n.k===t&&r*r+i*i<(a+n.r)*(a+n.r)*.22)return 1}return 0})(t,e,l,a)||(N.length>=14&&N.shift(),N.push({k:t,x:e,y:l,r:a,t:s,d:s,pcd:0}),g.msg=function(t){return 1===t?"vortex: pull + melt":2===t?"sanctuary: heal + slow":3===t?"toxic bloom: chip + regen":"campus storm!"}(t),g.msgT=4===t?1.55:1.2,It(e,l,function(t){return 1===t?"#95f0b8":2===t?"#89ffe8":3===t?"#ccff9b":"#c8f3ff"}(t),4===t?24:14,4===t?126:84),d(4===t?820:1===t?700:2===t?640:680,.06,"triangle",.022))}function Ht(t,e,l){G[t]&&(G[t].t=Math.min(G[t].t,.05)),G[e]&&(G[e].t=Math.min(G[e].t,.05)),void 0!==l&&G[l]&&(G[l].t=Math.min(G[l].t,.05))}function qt(t){if(g.dead=0,g.lvup=0,g.t=0,g.time=0,g.spawnT=0,g.nextSpawn=.8,g.kills=0,g.msg="",g.msgT=0,g.level=1,g.xp=0,g.nextXp=24,g.stop=0,g.shake=0,g.xpPulse=0,g.cardT=0,g.choices=[],g.homeGot=0,g.sch.nsh=0,g.sch.mel=0,g.pz=0,g.uq.length=0,g.inB="",g.bs=0,g.bd=0,g.bs2=0,g.bd2=0,g.b2At=0,g.bossDownT=0,g.apWarn1=0,g.apWarn2=0,g.apStormHitCd=0,g.botMask=0,g.chemMask=0,g.labStep=0,g.labBank=0,g.labFlip=0,g.labNsh=0,g.labMel=0,g.labNshRuns=0,g.labMelRuns=0,g.stormCd=0,g.labCd=0,g.lvPend=0,g.lvGrace=0,g.lbSent=0,g.lbTopErr="",g.lbRankErr="",g.lbRankText="",g.lbFetchT=0,g.lbRankFetchT=0,g.lbBtnX=0,g.lbBtnY=0,g.lbBtnW=0,g.lbBtnH=0,D.x=260,D.y=900,D.vx=0,D.vy=0,D.hp=100,D.maxHp=100,D.speed=185,D.fireCd=0,D.fireRate=.46,D.dmg=12,D.range=400,D.shots=1,D.magnet=88,D.face=1,D.rx=0,D.ry=0,D.flash=0,D.gx=1,D.gy=0,D.zc=0,D.zr=0,D.zt=0,D.zx=1,D.zy=0,D.zcd=0,D.zDur=1,D.zSpd=2.1,D.zLoad=1.5,D.zCool=5.5,D.zDmg=24,D.zDr=.55,D.zb=0,D.zp=0,D.mkOn=0,D.mkT=0,D.mkI=8.8,D.mkS=0,D.mkD=14,D.mkR=54,D.mkSl=.54,D.mkBurst=0,D.mkBurstT=0,D.mkBurstQ=[],D.chDo=14,D.chBurst=10,D.chHeal=8,D.chHealCd=0,D.chHealI=.85,D.cat=0,D.catM=0,D.catType=0,D.bot=0,D.botCount=0,D.botSlots=0,D.bType=0,D.bAtk=1,D.bAuraR=0,D.bAuraSl=0,D.bHealCd=0,D.bHealI=10,D.bHealAmt=10,D.bHealFx=0,D.triA=0,D.triFx=0,D.slCharge=0,D.slFocus=0,D.slT=0,D.slRecallT=0,D.slLinkT=0,D.slRecallPulse=0,D.slCarryVx=0,D.slCarryVy=0,D.slPow=0,D.slWave=0,D.slComboFx=0,D.slHitMask=0,D.slPerfect=0,D.slDx=1,D.slDy=0,D.bx=D.x+20,D.by=D.y+4,D.ba=0,D.bcd=.45,D.bRate=1.9,D.bDmg=1.15,D.bRange=480,D.bFetch=95,D.bPull=195,D.bCarry=0,D.bCarryMax=2,D.bGrabCd=0,D.bGrabI=.38,D.bPier=4,D.bSize=6,D.slRopeRest=0,L.length=0,W.length=0,E.length=0,G.length=0,O.length=0,X.length=0,N.length=0,B.l=B.r=B.u=B.d=B.gr=0,H=0,Ct(1),g.msg="home: unlock",g.msgT=1.6,t){for(let t=0;t<24;t++)wt({x:1300+_(-120,120),y:900+_(-120,120),v:7,m:1,t:0});for(let t=0;t<10;t++)wt({x:330+58*t,y:900+_(-60,60),v:5,m:1,t:0})}}function Lt(){if(L.length>=h)return;const t=Math.random()*Math.PI*2,e=_(360,560),l=1+.045*g.time;let a=22+8*l+_(-4,8),s=56+6*l+_(-6,10),n=_(12,18),r=8+.9*l,i=0;g.time>8&&Math.random()<.24&&(i=1,s*=1.65,a*=.66,n*=.82,r*=.82),g.time>18&&Math.random()<.18&&(i=2,s*=.74,a*=2.15,n*=1.35,r*=1.28);let o=V(D.x+Math.cos(t)*e,20,2580),f=V(D.y+Math.sin(t)*e,20,1780);const c=$(o,f,10);if(c){const t=o-c.x,e=f-c.y,l=Math.hypot(t,e)||1;o=c.x+t/l*(c.r+18),f=c.y+e/l*(c.r+18)}L.push({x:o,y:f,r:n,hp:a,s,dmg:r,vx:0,vy:0,ht:0,sl:0,ce:0,bm:0,bt:0,bi:"",k:i})}function Wt(t,e,l){if(L.length>=179)return;const a=Math.max(1,0|l);for(let l=0;l<e&&L.length<h;l++){const e=Math.random()*Math.PI*2,l=_(30,82),s=V(t.x+Math.cos(e)*l,20,2580),n=V(t.y+Math.sin(e)*l,20,1780),r=a>=3&&Math.random()<.34?2:1,i=2===r?86+4.8*g.time+_(-8,10):54+3.4*g.time+_(-6,8),o=2===r?70+_(-8,10):96+_(-10,18),h=2===r?18+.28*g.time:13+.24*g.time,f={x:s,y:n,r:2===r?_(14,19):_(11,16),hp:i,s:o,dmg:h,vx:0,vy:0,ht:0,sl:0,ce:0,bm:0,bt:0,bi:"",k:r};tt(f,10),L.push(f)}}function Et(t,e,l,a){const s=V(.78*l,44,86),n=Math.max(1.15,.72*a);for(let l=0;l<N.length;l++){const a=N[l];if(5!==a.k)continue;const r=a.x-t,i=a.y-e,o=.4*(a.r+s);if(r*r+i*i<o*o)return a.x=.5*(a.x+t),a.y=.5*(a.y+e),a.r=Math.max(a.r,s),a.t=Math.max(a.t,n),a.d=Math.max(a.d,n),void(a.pcd=0)}N.length>=14&&N.shift(),N.push({k:5,x:t,y:e,r:s,t:n,d:n,pcd:0,ap:1}),It(t,e,"#d4b8ff",8,52),d(250,.035,"sawtooth",.011)}function Gt(){return function(){const t=Xt.filter(t=>!t.req||t.req());g.choices=[];for(let e=0;e<3&&t.length;e++){const e=Math.random()*t.length|0;g.choices.push(t[e]),t.splice(e,1)}}(),g.choices.length?(g.lvup=1,g.cardT=0,g.xpPulse=.65,g.msg="upgrade",g.msgT=2.1,vt(.06),St(.2),d(860,.08,"triangle",.03),1):0}function Ot(t,e){const l=E[t];if(!l)return;l.bc&&D.bCarry>0&&D.bCarry--,function(t){for(g.xp+=t;g.xp>=g.nextXp;){g.xp-=g.nextXp,g.level++,g.nextXp=1.36*g.nextXp+9|0,ct()?(g.lvPend++,g.xpPulse=.65,g.msg="upgrade queued",g.msgT=1,d(760,.05,"triangle",.018)):Gt();break}}(l.v),E.splice(t,1),g.xpPulse=Math.min(.5,g.xpPulse+.11);let a=D.x,s=D.y;if("bot"===e){const t=(0|l.bc)-1,e=t>=0&&t<X.length?X[t]:0;a=e?e.x:D.bx,s=e?e.y:D.by}It(a,s,"#69f0c9",4,40),D.mkOn||(g.homeGot++,g.homeGot>=g.homeNeed&&(D.mkOn=1,D.mkT=.25,g.msg="open",g.msgT=2.2,d(820,.07,"triangle",.028),It(D.x,D.y,"#ffd56d",16,95)))}const Xt=[{n:"Rapid Fire",d:"shoot faster",f:()=>D.fireRate=Math.max(.15,.8*D.fireRate),req:()=>1},{n:"Big Bites",d:"more damage",f:()=>D.dmg+=8,req:()=>1},{n:"Speed Paws",d:"move faster",f:()=>D.speed+=30,req:()=>1},{n:"Extra Shot",d:"+1 projectile",f:()=>D.shots=Math.min(5,D.shots+1),req:()=>1},{n:"Snack Magnet",d:"pickup range up",f:()=>D.magnet+=40,req:()=>1},{n:"Tough Fur",d:"+max hp +heal",f:()=>{D.maxHp+=32,D.hp=Math.min(D.maxHp,D.hp+32)},req:()=>1},{n:"Quick Heal",d:"heal now",f:()=>D.hp=Math.min(D.maxHp,D.hp+45),req:()=>1},{n:"Zoomies Time",d:"zoomies lasts longer",f:()=>D.zDur=Math.min(2.6,D.zDur+.32),req:()=>1},{n:"Zoomies CD",d:"zoomies cooldown down",f:()=>D.zCool=Math.max(1.4,D.zCool-.85),req:()=>1},{n:"Zoomies Speed",d:"zoomies speed up",f:()=>D.zSpd=Math.min(4,D.zSpd+.45),req:()=>1},{n:"Zoomies Charge",d:"zoomies charge faster",f:()=>D.zLoad=Math.max(.55,D.zLoad-.24),req:()=>1},{n:"Territory CD",d:"territory cooldown down",f:()=>D.mkI=Math.max(3.2,D.mkI-.68),req:()=>D.mkOn},{n:"Territory Radius",d:"territory area bigger",f:()=>D.mkR=Math.min(110,D.mkR+16),req:()=>D.mkOn},{n:"Territory Duration",d:"territory lasts longer",f:()=>D.mkD=Math.min(40,D.mkD+5),req:()=>D.mkOn},{n:"Territory Slow",d:"territory slows more",f:()=>D.mkSl=Math.min(.88,D.mkSl+.12),req:()=>D.mkOn},{n:"Chemical Puddle",d:"chem damage up",f:()=>{D.chDo=Math.min(58,D.chDo+10),D.chBurst=Math.min(42,D.chBurst+8)},req:()=>D.cat},{n:"Chemical Radius",d:"chem area bigger",f:()=>D.mkR=Math.min(120,D.mkR+13),req:()=>D.cat},{n:"Chemical Tempo",d:"chem cooldown down",f:()=>D.mkI=Math.max(2.6,D.mkI-.58),req:()=>D.cat},{n:"Bot Fetch",d:"bot grabs mints farther away",f:()=>D.bFetch=Math.min(220,D.bFetch+34),req:()=>D.bot},{n:"Bot Cargo",d:"bot carries more mints",f:()=>D.bCarryMax=Math.min(5,D.bCarryMax+1),req:()=>D.bot},{n:"Shock Tempo",d:"shock pulse cooldown down",f:()=>D.bRate=Math.max(.62,.82*D.bRate),req:()=>D.bot&&D.bAtk},{n:"Shock Pierce",d:"pulse pierces more + wider",f:()=>{D.bPier=Math.min(8,D.bPier+1),D.bSize=Math.min(18,D.bSize+1.4)},req:()=>D.bot&&D.bAtk},{n:"Shock Power",d:"shock pulse damage up",f:()=>D.bDmg=Math.min(2.8,D.bDmg+.33),req:()=>D.bot&&D.bAtk}];function Nt(t){g.lvup&&g.choices[t]&&(g.choices[t].f(),g.lvup=0,g.msg=g.choices[t].n+" applied",g.msgT=1.4,g.xpPulse=.25,g.labCd=Math.max(g.labCd,3),St(.08),It(D.x,D.y,"#69f0c9",12,90),kt())}function _t(t){D.zt>0?D.flash=Math.max(D.flash,.03):(D.hp-=t,St(.03),D.hp<=0&&(D.hp=0,g.dead=1,g.start=1,g.kills>g.best&&(g.best=0|g.kills,localStorage.ss_best=g.best),g.msg="swarmed",g.msgT=999,vt(.09),St(.42),d(120,.22,"sawtooth",.05),It(D.x,D.y,"#ff6f89",26,130),A(1),I(1),async function(){if(g.lbSent)return;if(g.lbSent=1,!function(){if(!M||!T||!k)return 0;const t=z(P);if("yes"===t)return 1;if("no"===t)return 0;const e=confirm("Join the global leaderboard? Your name, kills, and time will be submitted when a run ends.");return C(P,e?"yes":"no"),e?1:0}())return;const t=function(){let t=z(v).trim();if(R(t))return t;const e=prompt("Enter a name for global leaderboard (1-24 chars).");return null==e?"":(t=e.trim(),R(t)?(C(v,t),t):(alert("Name must be 1-24 chars and only letters, numbers, spaces, _, ., or -."),""))}();if(!t)return;const e=0|g.kills,l=+g.time.toFixed(1);if(!(e<0||!Number.isFinite(l)||l<0))try{const a=await fetch(M+"/rest/v1/"+encodeURIComponent(k),{method:"POST",headers:{"Content-Type":"application/json",apikey:T,Authorization:"Bearer "+T,Prefer:"return=representation"},body:JSON.stringify([{name:t,kills:e,time_seconds:l}])});if(!a.ok)return;const s=await a.json(),n=Array.isArray(s)?s[0]:0;n&&n.id&&C(S,JSON.stringify({id:n.id,name:n.name,kills:n.kills,time_seconds:n.time_seconds})),A(1),I(1)}catch{}}()))}function Vt(){x||(x=new(window.AudioContext||window.webkitAudioContext)),g.start||(g.start=1,qt(1),d(430,.05,"triangle",.02))}function Yt(e){F===e.pointerId&&(H=0,Ct(),t.hasPointerCapture(F)&&t.releasePointerCapture(F),F=-1)}addEventListener("resize",Pt),addEventListener("keydown",function(t){const e=t.code;if("Space"!==e&&"ArrowUp"!==e&&"ArrowDown"!==e&&"ArrowLeft"!==e&&"ArrowRight"!==e||t.preventDefault(),"Space"!==e&&"Enter"!==e||Vt(),!g.dead||"KeyL"!==e)return!g.dead||"Space"!==e&&"Enter"!==e&&"KeyR"!==e?void(g.lvup?"Digit1"===e?Nt(0):"Digit2"===e?Nt(1):"Digit3"===e&&Nt(2):g.pz?"Digit1"===e?st(0):"Digit2"===e?st(1):"Digit3"===e&&st(2):g.start&&!g.dead&&("KeyQ"!==e?"KeyA"===e||"ArrowLeft"===e?B.l=1:"KeyD"===e||"ArrowRight"===e?B.r=1:"KeyW"===e||"ArrowUp"===e?B.u=1:"KeyS"===e||"ArrowDown"===e?B.d=1:"KeyE"!==e&&"ShiftLeft"!==e&&"ShiftRight"!==e||(B.gr=1):it())):(qt(1),void d(360,.05,"triangle",.02));w()}),addEventListener("keyup",function(t){const e=t.code;"KeyA"===e||"ArrowLeft"===e?B.l=0:"KeyD"===e||"ArrowRight"===e?B.r=0:"KeyW"===e||"ArrowUp"===e?B.u=0:"KeyS"===e||"ArrowDown"===e?B.d=0:"KeyE"!==e&&"ShiftLeft"!==e&&"ShiftRight"!==e||(B.gr=0)}),t.addEventListener("pointerdown",function(e){if(!(F>=0&&F!==e.pointerId)){if(F=e.pointerId,t.setPointerCapture(F),Vt(),g.dead)return e.clientX>=g.lbBtnX&&e.clientX<=g.lbBtnX+g.lbBtnW&&e.clientY>=g.lbBtnY&&e.clientY<=g.lbBtnY+g.lbBtnH?void w():(qt(1),void d(360,.05,"triangle",.02));if(g.lvup)!function(t,e){if(!g.lvup)return;const l=Z().rects;for(let a=0;a<l.length;a++){const s=l[a];if(t>=s.x&&t<=s.x+s.w&&e>=s.y&&e<=s.y+s.h){Nt(a);break}}}(e.clientX,e.clientY);else{if(g.pz){const t=et();for(let l=0;l<3;l++){const a=t.btn[l];if(e.clientX>=a.x&&e.clientX<=a.x+a.w&&e.clientY>=a.y&&e.clientY<=a.y+a.h)return void st(l)}return}g.start&&!g.dead&&D.cat&&function(t,e){const a=l-18-44;return t>=a&&t<=a+44&&e>=66&&e<=110}(e.clientX,e.clientY)?it():"mouse"!==e.pointerType&&(H=1,function(t,e){const s=q.r+16;q.x=V(t,s,l-s),q.y=V(e,s,a-s),q.tx=0,q.ty=0,q.ax=0,q.ay=0,q.ttx=0,q.tty=0,q.tax=0,q.tay=0,q.act=1}(e.clientX,e.clientY),zt(e.clientX,e.clientY))}}},{passive:1}),t.addEventListener("pointermove",function(t){F!==t.pointerId||!g.start||g.dead||g.lvup||H&&zt(t.clientX,t.clientY)},{passive:1}),t.addEventListener("pointerup",Yt,{passive:1}),t.addEventListener("pointercancel",Yt,{passive:1}),Pt(),qt(1),requestAnimationFrame(function t(b){n||(n=b);let x=.001*(b-n);n=b,x=Math.max(0,Math.min(.034,x)),function(t){const e=t;!function(t){const e=1-Math.exp(22*-t),l=1-Math.exp(16*-t);q.tx+=(q.ttx-q.tx)*e,q.ty+=(q.tty-q.ty)*e,q.ax+=(q.tax-q.ax)*e,q.ay+=(q.tay-q.ay)*e,q.show+=((q.act?1:0)-q.show)*l,!q.act&&q.show<.003&&(q.show=0)}(e),g.msgT>0&&(g.msgT-=e),g.bossDownT>0&&(g.bossDownT=Math.max(0,g.bossDownT-e)),g.apStormHitCd>0&&(g.apStormHitCd=Math.max(0,g.apStormHitCd-e)),g.stormCd>0&&(g.stormCd=Math.max(0,g.stormCd-e)),g.labCd>0&&(g.labCd=Math.max(0,g.labCd-e)),g.stop>0&&(g.stop=Math.max(0,g.stop-e),t*=.06),g.shake>0&&(g.shake=Math.max(0,g.shake-2.2*e)),g.xpPulse>0&&(g.xpPulse=Math.max(0,g.xpPulse-1.7*e)),D.flash>0&&(D.flash=Math.max(0,D.flash-7*e)),D.zb>0&&(D.zb=Math.max(0,D.zb-e)),D.zp>0&&(D.zp=Math.max(0,D.zp-e)),D.rx*=Math.max(0,1-18*e),D.ry*=Math.max(0,1-18*e),D.zcd>0&&(D.zcd=Math.max(0,D.zcd-e)),D.mkS>0&&(D.mkS=Math.max(0,D.mkS-e)),D.mkT>0&&D.zt<=0&&(D.mkT=Math.max(0,D.mkT-e)),D.bHealFx>0&&(D.bHealFx=Math.max(0,D.bHealFx-e)),D.triFx>0&&(D.triFx=Math.max(0,D.triFx-e*(D.slT>0||D.slRecallT>0||D.slLinkT>0?1:1.7))),D.slWave>0&&(D.slWave=Math.max(0,D.slWave-2.6*e)),D.slComboFx>0&&(D.slComboFx=Math.max(0,D.slComboFx-2.1*e)),D.slLinkT>0&&(D.slLinkT=Math.max(0,D.slLinkT-e));for(let e=G.length-1;e>=0;e--){const l=G[e];l.t-=t,l.t<=0&&G.splice(e,1)}for(let e=N.length-1;e>=0;e--){const l=N[e];l.t-=t,l.pcd>0&&(l.pcd=Math.max(0,l.pcd-t)),l.t<=0&&N.splice(e,1)}for(let e=O.length-1;e>=0;e--){const l=O[e];l.t-=t,l.x+=l.vx*t,l.y+=l.vy*t,l.vy+=480*t,l.t<=0&&O.splice(e,1)}if(!g.start)return;if(g.dead)return A(0),void I(0);if(ft()?g.lvGrace=1:g.lvGrace>0&&(g.lvGrace=Math.max(0,g.lvGrace-e)),!g.lvup&&!g.pz&&g.lvPend>0&&!ct()&&(g.lvPend--,Gt()),g.lvup)return void(g.cardT=Math.min(.9,g.cardT+e));if(g.pz)return void(g.t+=t);if(g.t+=t,g.bd&&!g.bs2&&!g.bd2){const t=g.b2At-g.t;t<=8.5&&!g.apWarn1&&(g.apWarn1=1,g.msg="something big is approaching...",g.msgT=1.5,d(190,.055,"triangle",.016)),t<=3.6&&!g.apWarn2&&(g.apWarn2=1,g.msg="someone...",g.msgT=1.2,d(170,.06,"sawtooth",.02))}const l=J("nsh"),a=J("mel");D.mkOn&&0===g.sch.nsh&&Math.hypot(D.x-l.x,D.y-l.y)<l.r&&nt("nsh"),2===g.sch.nsh&&0===g.sch.mel&&Math.hypot(D.x-a.x,D.y-a.y)<a.r&&nt("mel"),2===g.sch.nsh&&g.labNsh>0&&Math.hypot(D.x-l.x,D.y-l.y)<l.r&&gt("nsh"),2===g.sch.mel&&g.labMel>0&&Math.hypot(D.x-a.x,D.y-a.y)<a.r&&gt("mel"),kt();const s=(B.r?1:0)-(B.l?1:0),n=(B.d?1:0)-(B.u?1:0),r=Math.hypot(q.ax,q.ay);let i=s,o=n;H&&r>.12&&(i+=q.ax,o+=q.ay);let m=Math.hypot(i,o);m>1&&(i/=m,o/=m);const b=(Math.hypot(s,n)>.05||H&&r>.12)&&D.mkS<=0,x=$(D.x,D.y,-6);if(D.mkOn&&D.mkT<=0&&D.mkS<=0&&D.zt<=0&&D.zr<=0&&D.zc<=0&&D.mkBurst<=0&&function(){const t=[];if(D.cat)for(let e=1;e<=3;e++)g.chemMask&1<<e-1&&t.push(e);t.length||t.push(0),Bt(t[0]),D.mkS=.32,D.mkBurstQ=t.slice(1),D.mkBurst=D.mkBurstQ.length,D.mkBurstT=D.mkBurst>0?.5:0,D.mkBurst<=0&&(D.mkT=D.mkI)}(),D.mkBurst>0&&(D.mkBurstT=Math.max(0,D.mkBurstT-t),D.mkBurstT<=0&&D.mkBurstQ.length>0&&(Bt(D.mkBurstQ.shift()),D.mkBurst--,D.mkBurst>0?D.mkBurstT=.5:D.mkT=D.mkI)),function(){const t=[];for(let e=0;e<G.length;e++){const l=G[e];l.t>.08&&l.m>=1&&l.m<=3&&t.push(e)}if(t.length<2)return;if(g.stormCd<=0&&t.length>=3)for(let e=0;e<t.length-2;e++){const l=G[t[e]];for(let a=e+1;a<t.length-1;a++){const s=G[t[a]];for(let n=a+1;n<t.length;n++){const r=G[t[n]];if(14!=(1<<l.m|1<<s.m|1<<r.m))continue;const i=Math.hypot(l.x-s.x,l.y-s.y),o=Math.hypot(s.x-r.x,s.y-r.y),h=Math.hypot(r.x-l.x,r.y-l.y);if(i>.8*(l.r+s.r)||o>.8*(s.r+r.r)||h>.8*(r.r+l.r))continue;const f=(l.x+s.x+r.x)/3,c=(l.y+s.y+r.y)/3,m=Math.min(152,(l.r+s.r+r.r)/3+36);Ft(4,f,c,m,6),g.stormCd=8,Ht(t[e],t[a],t[n]);for(let t=N.length-1;t>=0;t--){const e=N[t];5===e.k&&Math.hypot(e.x-f,e.y-c)<m+e.r+80&&(It(e.x,e.y,"#8effdc",12,72),N.splice(t,1))}for(let t=L.length-1;t>=0;t--){const e=L[t],l=e.x-f,a=e.y-c,s=l*l+a*a;if(4===e.k&&s<1.8*m*(1.8*m)){e.hp-=4.5*D.chBurst+3.5*D.chDo,e.ht=.3,e.s*=.45,e.apStormCd=Math.max(e.apStormCd||0,4);const s=Math.hypot(l,a)||1;if(e.vx+=l/s*520,e.vy+=a/s*520,It(e.x,e.y,"#8effdc",26,160),g.msg="campus storm: apex vulnerable!",g.msgT=1.8,d(860,.08,"triangle",.03),e.hp<=0){Dt(t,"#8effdc",18,130,1);continue}}if(s<m*m*1.2){const s=Math.hypot(l,a)||1;e.hp-=2.8*D.chBurst+1.5*D.chDo,e.ht=.2,e.vx+=l/s*360,e.vy+=a/s*360,e.hp<=0&&Dt(t,"#c8f3ff",12,96,1)}}return}}}const e={};for(let l=0;l<t.length-1;l++){const a=t[l];if(e[a])continue;const s=G[a];for(let n=l+1;n<t.length;n++){const l=t[n];if(e[l])continue;const r=G[l];if(s.m===r.m)continue;if(Math.hypot(s.x-r.x,s.y-r.y)>.7*(s.r+r.r))continue;const i=Math.min(s.m,r.m),o=Math.max(s.m,r.m),h=1===i&&3===o?1:2===i&&3===o?2:3;Ft(h,.5*(s.x+r.x),.5*(s.y+r.y),Math.min(122,.44*(s.r+r.r)+18),1===h?5.4:2===h?6.1:5.8),Ht(a,l),e[a]=1,e[l]=1;break}}}(),D.zt<=0)if(!x&&!b&&D.zcd<=0&&D.mkS<=0){if(D.zc=Math.min(D.zLoad,D.zc+t),D.zc>.25){const e=D.zc/D.zLoad;D.rx+=.9*(2*Math.random()-1)*e*60*t,D.ry+=.9*(2*Math.random()-1)*e*60*t,St(7e-4*e*60*t)}D.zc>=D.zLoad&&!D.zr&&(D.zr=1,g.msg="zoomies ready",g.msgT=1.1,St(.08),d(760,.05,"triangle",.024))}else if(D.zr){D.zt=D.zDur,D.zr=0,D.zc=0;const t=m||1;D.zx=i/t,D.zy=o/t,D.slCharge=0,D.slFocus=0,D.slPow=0,D.slLinkT=0,D.slHitMask=0,D.slPerfect=0,D.slRopeRest=0,vt(.04),St(.28),D.flash=.09,D.gx=D.zx,D.gy=D.zy,It(D.x,D.y,"#9dffea",18,120),d(980,.06,"square",.028)}else D.zc=0;if(D.zt>0){if(D.zt=Math.max(0,D.zt-t),b){D.zx=.85*D.zx+.15*i,D.zy=.85*D.zy+.15*o;const t=Math.hypot(D.zx,D.zy)||1;D.zx/=t,D.zy/=t}const e=D.zb>0?1.35:1;if(D.vx=D.zx*D.speed*D.zSpd*e+D.slCarryVx,D.vy=D.zy*D.speed*D.zSpd*e+D.slCarryVy,D.face=D.vx>=0?1:-1,D.rx-=8*D.zx*t*60,D.ry-=6*D.zy*t*60,Math.random()<.65&&Rt({x:D.x-_(-6,6),y:D.y-_(-6,6),vx:.12*-D.vx+_(-35,35),vy:.12*-D.vy+_(-35,35),t:_(.1,.25),c:"#8fffe5"}),D.zt<=0){if(D.bot&&X.length>=3&&D.slCharge>=.25){const t=D.slPerfect&&D.slFocus>=.98?1:0,e=Math.min(1,D.slCharge*(t?1.15:1));D.slT=.34+(.72-.34)*e,D.slRecallT=0,D.slRecallPulse=0,D.slCarryVx=0,D.slCarryVy=0,D.slPow=.68+.48*e+.34*t,D.slLinkT=c*(.82+.34*e+.2*t),D.slDx=D.zx,D.slDy=D.zy,D.slWave=1,D.triFx=1,D.slHitMask=0,D.slRopeRest=176+72*e+36*t,D.slComboFx=Math.max(D.slComboFx,t?.95:0);const l=620*(1.02+.82*e+.46*t)+.6*Math.max(0,D.vx*D.zx+D.vy*D.zy);for(let t=0;t<3&&t<X.length;t++){const a=X[t],s=.26*(t-1),n=Math.cos(s),r=Math.sin(s),i=D.zx*n-D.zy*r,o=D.zx*r+D.zy*n,h=l*(1-.06*Math.abs(t-1));a.slx=i*h+.28*D.vx,a.sly=o*h+.28*D.vy,a.vx=a.slx,a.vy=a.sly,It(a.x,a.y,"#b6f6ff",6,50+44*e)}vt(.05+.025*e),St(.2+.14*e),It(D.x,D.y,"#8eefff",14,92+58*e),g.msg=t?"perfect slingshot":"slingshot pack",g.msgT=.82,d(t?1020:940,.05,"square",.026),d(t?1350:1220,.04,"triangle",.018),D.slPerfect=0,D.slFocus=0}else D.slCharge=0,D.slFocus=0,D.slPerfect=0,D.slRecallT=0,D.slLinkT=0,D.slRecallPulse=0,D.slCarryVx=0,D.slCarryVy=0,D.slHitMask=0,D.slRopeRest=0,g.msg="zoomies cd",g.msgT=.65,d(420,.04,"triangle",.016);D.zcd=D.zCool}}else D.vx=i*D.speed+D.slCarryVx,D.vy=o*D.speed+D.slCarryVy,Math.abs(D.vx)>.5&&(D.face=D.vx>0?1:-1),D.mkS>0&&(D.rx+=.5*Math.sin(45*g.t),Math.random()<.7&&Rt({x:D.x+_(-5,5),y:D.y+10+_(-3,3),vx:_(-14,14),vy:_(6,30),t:_(.12,.26),c:"#ffd56d"}));if(D.x=V(D.x+D.vx*t,12,2588),D.y=V(D.y+D.vy*t,12,1788),D.zt>0&&D.zp<=0)for(let t=0;t<G.length;t++){const e=G[t],l=D.x-e.x,a=D.y-e.y;if(l*l+a*a<e.r*e.r){D.zp=.22,D.zb=.48,It(D.x,D.y,"#8fffe5",8,95),d(740,.03,"triangle",.02);for(let t=L.length-1;t>=0;t--){const l=L[t],a=l.x-e.x,s=l.y-e.y;a*a+s*s<e.r*e.r&&(l.hp-=2.2*D.zDmg,l.ht=.13,l.vx+=260*D.zx,l.vy+=260*D.zy,l.hp<=0&&Dt(t,"#8fffe5",10,80,1))}break}}const y=$(D.x,D.y,-6);y||(g.time+=t);const p=y?y.id:"";if(g.inB=p,D.cat){D.chHealCd>0&&(D.chHealCd=Math.max(0,D.chHealCd-t));let e=0;for(let t=0;t<G.length;t++){const l=G[t],a=D.x-l.x,s=D.y-l.y;if(2===l.m&&a*a+s*s<l.r*l.r){e=1;break}}if(e&&D.chHealCd<=0&&D.hp<D.maxHp){const t=Math.min(D.chHeal,D.maxHp-D.hp);D.hp+=t,D.chHealCd=D.chHealI,It(D.x,D.y,"#7fe8dd",8,52),g.msg="heal +"+(0|t),g.msgT=.65}}let u=0,M=0,T=0,k=0;for(let t=0;t<N.length;t++){const e=N[t],l=D.x-e.x,a=D.y-e.y;l*l+a*a<e.r*e.r&&(2===e.k?(!T||e.t>T.t)&&(T=e):3===e.k?u=1:4===e.k?M=1:5===e.k&&(k=e))}if(T&&T.pcd<=0&&D.hp<D.maxHp){const t=Math.min(10,D.maxHp-D.hp);D.hp+=t,T.pcd=1.6,It(D.x,D.y,"#95ffe8",10,70),g.msg="well +"+(0|t),g.msgT=.6}if(u&&D.hp<D.maxHp){const e=Math.min(D.maxHp-D.hp,1.6*t);e>0&&(D.hp+=e)}if(M&&D.hp<D.maxHp){const e=Math.min(D.maxHp-D.hp,8*t);e>0&&(D.hp+=e)}if(k&&!y){const e=k.x-D.x,l=k.y-D.y,a=Math.hypot(e,l)||1;let s=(24+(k.d-k.t)/Math.max(.001,k.d)*14)*(.35+.65*V(a/Math.max(1,k.r),0,1));D.zt>0&&(s*=.32),D.x=V(D.x+e/a*s*t,12,2588),D.y=V(D.y+l/a*s*t,12,1788),g.apStormHitCd<=0&&a<.82*k.r&&(_t(D.zt>0?1.08:2.4),g.apStormHitCd=.42),Math.random()<.28&&Rt({x:D.x+_(-8,8),y:D.y+_(-8,8),vx:_(-18,18),vy:_(-30,10),t:_(.08,.18),c:"#d4b8ff"})}let S=0;if(D.bot&&D.botCount>0){if(ut(),S=D.zt>0&&X.length>=3,S){const e=b?Math.max(0,i*D.zx+o*D.zy):0,l=.6+.95*e;D.slCharge=Math.min(1,D.slCharge+t*l),D.zt<=.24?b&&e>.82?(D.slFocus=Math.min(1,D.slFocus+4.5*t),D.slFocus>=1&&!D.slPerfect&&(D.slPerfect=1,D.slComboFx=Math.max(D.slComboFx,.55),g.msg="perfect line",g.msgT=.45,d(1180,.03,"triangle",.014))):D.slPerfect||(D.slFocus=Math.max(0,D.slFocus-3.8*t)):D.slPerfect||(D.slFocus=Math.max(0,D.slFocus-1.6*t)),D.triFx=Math.min(1,D.triFx+t*(D.slPerfect?4.1:3.2))}else D.slT<=0&&D.slRecallT<=0&&D.slLinkT<=0&&(D.slCharge>0||D.slFocus>0||D.slPerfect)&&(D.slCharge=Math.max(0,D.slCharge-2.6*t),D.slFocus=Math.max(0,D.slFocus-2.8*t),D.slFocus<=.02&&(D.slPerfect=0));D.slT>0?(D.slT=Math.max(0,D.slT-t),D.slT<=0&&(X.length>=3&&D.slPow>.08?(D.slRecallT=f*(.86+.28*Math.min(1,D.slPow)),D.slRecallPulse=0,g.msg="recall strike",g.msgT=.52,d(860,.03,"triangle",.014)):D.slHitMask=0)):D.slRecallT>0&&(D.slRecallT=Math.max(0,D.slRecallT-t),D.slRecallT<=0&&(D.slRecallPulse=1,D.slLinkT=Math.max(D.slLinkT,.652),D.slHitMask=0)),D.ba+=t*(S||D.slT>0||D.slRecallT>0||D.slLinkT>0?4.9:2.3),D.triA+=t*(S||D.slLinkT>0?9.2:4.2);const e=X.length>=3&&D.slLinkT>0;if((D.slT>0||D.slRecallT>0||e)&&b){const e=Math.hypot(i,o)||1,l=i/e,a=o/e,s=D.slT>0?9.2:D.slRecallT>0?7.4:6.1,n=Math.min(1,t*s);D.slDx+=(l-D.slDx)*n,D.slDy+=(a-D.slDy)*n;const r=Math.hypot(D.slDx,D.slDy)||1;D.slDx/=r,D.slDy/=r}if(X.length>=3&&(D.slT>0||D.slRecallT>0||e)){(D.slRopeRest||0)<=0&&(D.slRopeRest=176);const e=142*(.7+.45*Math.min(1,D.slPow)+(D.slT>0?.24:0));D.slRopeRest=Math.max(44,D.slRopeRest-t*e)}else(D.slRopeRest||0)>0&&(D.slRopeRest=Math.max(0,D.slRopeRest-220*t));let l=0,a=0,s=0,n=0,r=.18,h=0,m=0,x=0;X.length>=3&&(D.slT>0?(l=2,r=.46):D.slRecallT>0?(l=3,r=.33):e?(l=4,r=.29):S&&(l=1,r=.18));for(let r=0;r<X.length;r++){const i=X[r],o=i.x,b=i.y,d=Math.max(.001,t);if(D.slT>0&&r<3){const e=860*(.62+.48*Math.min(1,D.slPow));i.slx+=D.slDx*e*t,i.sly+=D.slDy*e*t,i.x=V(i.x+i.slx*t,16,2584),i.y=V(i.y+i.sly*t,16,1784);const l=Math.max(0,1-t*(2.35+1.2*Math.max(0,.9-D.slPow)));i.slx*=l,i.sly*=l}else{let e=0,l=0;if(D.slRecallT>0&&r<3){const a=V(D.slRecallT/f,0,1),s=24+22*a,n=(r-1)*(24+12*a);e=D.x+D.slDx*s-D.slDy*n,l=D.y+D.slDy*s+D.slDx*n;const o=22+20*(1-a);i.vx+=(e-i.x)*o*t,i.vy+=(l-i.y)*o*t;const h=Math.max(0,1-t*(7.2+1.8*(1-a)));i.vx*=h,i.vy*=h,i.x=V(i.x+i.vx*t,16,2584),i.y=V(i.y+i.vy*t,16,1784)}else if(S&&r<3){const a=94+34*D.slCharge,s=(r-1)*(34+12*D.slCharge),n=Math.sin(18*g.t+1.6*r)*(4+8*D.slCharge);e=D.x-D.zx*a-D.zy*s,l=D.y-D.zy*a+D.zx*s+n;const o=18+20*D.slCharge;i.vx+=(e-i.x)*o*t,i.vy+=(l-i.y)*o*t;const h=Math.max(0,1-t*(7.4+1.8*D.slCharge));i.vx*=h,i.vy*=h,i.x=V(i.x+i.vx*t,16,2584),i.y=V(i.y+i.vy*t,16,1784)}else{const a=D.ba+r*(2*Math.PI/X.length),s=38+2*Math.sin(2*g.t+.7*r);e=D.x+Math.cos(a)*s,l=D.y+Math.sin(a)*s,i.x+=(e-i.x)*Math.min(1,8*t),i.y+=(l-i.y)*Math.min(1,8*t)}i.slx*=Math.max(0,1-7.8*t),i.sly*=Math.max(0,1-7.8*t)}if(i.vx=(i.x-o)/d,i.vy=(i.y-b)/d,D.slT>0&&r<3||(i.slx=.74*i.slx+.26*i.vx,i.sly=.74*i.sly+.26*i.vy),e&&r<3){const e=i.x-D.x,l=i.y-D.y,a=Math.hypot(e,l)||1,s=e/a,n=l/a,r=V(D.slLinkT/c,0,1);let o=Math.max(44,D.slRopeRest||92)+11.56*r+20*Math.min(1,D.slPow);D.slT>0?o+=28:D.slRecallT>0&&(o=Math.max(44,.74*o));const f=i.vx-D.vx,b=i.vy-D.vy,d=V((13.2*(a-o)+13.2*.58*(f*s+b*n))*t,-125,125),y=-n,p=s,g=V(.32*-(f*y+b*p)*(.65+.55*Math.min(1,D.slPow))*t,-84,84),u=-s*d+y*g,M=-n*d+p*g;i.slx+=u,i.sly+=M,i.vx+=u,i.vy+=M,i.x=V(i.x+u*t,16,2584),i.y=V(i.y+M*t,16,1784);const T=.62*(.76+.34*Math.min(1,D.slPow));h-=u*T,m-=M*T,x++,Math.random()<.18&&Math.abs(a-o)>10&&Rt({x:.5*(D.x+i.x)+_(-4,4),y:.5*(D.y+i.y)+_(-4,4),vx:_(-16,16),vy:_(-16,16),t:_(.06,.14),c:"#d6f7ff"})}if(l&&r<3){let t=0,e=0;if(2===l)t=.6*i.vx+.4*i.slx,e=.6*i.vy+.4*i.sly;else if(3===l){const l=D.x-i.x,a=D.y-i.y,s=Math.hypot(l,a)||1,n=190+110*D.slPow;t=l/s*n+.45*i.vx+.2*i.slx,e=a/s*n+.45*i.vy+.2*i.sly}else 4===l?(t=.78*i.vx+.38*i.slx,e=.78*i.vy+.38*i.sly):(t=.72*i.vx+.25*i.slx,e=.72*i.vy+.25*i.sly);a+=t,s+=e,n++}i.grabCd>0&&(i.grabCd=Math.max(0,i.grabCd-t))}if(x>0&&(a+=h,s+=m,n+=x),n>0){const e=a/n*r,i=s/n*r,o=Math.min(1,t*(2===l?9.2:3===l?8.4:4===l?7.8:6.8));D.slCarryVx+=(e-D.slCarryVx)*o,D.slCarryVy+=(i-D.slCarryVy)*o}else{const e=Math.max(0,1-8.5*t);D.slCarryVx*=e,D.slCarryVy*=e,Math.abs(D.slCarryVx)+Math.abs(D.slCarryVy)<.5&&(D.slCarryVx=0,D.slCarryVy=0)}D.slT>0||D.slRecallT>0||D.slLinkT>0?D.triFx=Math.min(1,D.triFx+4.1*t):!S&&D.slLinkT<=0&&D.slPow>0&&(D.slPow=Math.max(0,D.slPow-2.2*t)),D.slT<=0&&D.slRecallT<=0&&D.slLinkT<=0&&D.slWave<=0&&D.slPow<.01&&(D.slPow=0,D.slRopeRest=0,D.triFx=Math.max(0,D.triFx-2.2*t)),D.bx=X[0].x,D.by=X[0].y;let p=0,u=18,M=10;for(let t=0;t<X.length;t++)if(2==(0|X[t].t)){const t=bt(2);p=1,u=Math.min(u,t.healI||18),M=Math.max(M,t.healAmt||10)}if(p&&(D.bHealCd>0&&(D.bHealCd=Math.max(0,D.bHealCd-t)),D.bHealCd<=0&&D.hp<D.maxHp)){const t=Math.min(M,D.maxHp-D.hp);D.hp+=t,D.bHealCd=u,D.bHealFx=.7,g.msg="medic +"+(0|t),g.msgT=.9,It(D.x,D.y,"#84f0a6",10,62),d(760,.05,"triangle",.018)}if(!y&&D.bAtk)for(let e=0;e<X.length;e++){const l=X[e],a=bt(0|l.t||1);if(l.cd-=t,l.cd>0)continue;let s=0,n=a.range*a.range;for(let t=0;t<L.length;t++){const e=L[t],a=e.x-l.x,r=e.y-l.y,i=a*a+r*r;i<n&&(n=i,s=e)}if(s){const t=Math.hypot(s.x-l.x,s.y-l.y)||1,e=!!a.pulse,n=a.col,r=a.pier;At({x:l.x,y:l.y,vx:(s.x-l.x)/t*420,vy:(s.y-l.y)/t*420,d:D.dmg*a.dmg,life:1.35,pier:r,c:n,r:a.size,pulse:e}),l.cd=a.rate,It(l.x,l.y,n,4,36)}else l.cd=.35}}else X.length=0,D.bCarry=0,D.botSlots=0,S=0,D.slCharge=0,D.slFocus=0,D.slT=0,D.slRecallT=0,D.slLinkT=0,D.slRecallPulse=0,D.slCarryVx=0,D.slCarryVy=0,D.slPow=0,D.slHitMask=0,D.slPerfect=0,D.slComboFx=0,D.slRopeRest=0;D.fireCd-=t,!y&&D.fireCd<=0&&(D.fireCd=D.fireRate,function(){const t=function(){let t=0,e=1e9;for(let l=0;l<L.length;l++){const a=L[l],s=a.x-D.x,n=a.y-D.y,r=s*s+n*n;r<e&&(e=r,t=a)}return t}();if(!t)return;let e=t.x-D.x,l=t.y-D.y,a=Math.hypot(e,l)||1;if(a>D.range)return;e/=a,l/=a;const s=D.shots;for(let t=0;t<s;t++){const a=1===s?0:.18*(t-(s-1)/2),n=Math.cos(a),r=Math.sin(a),i=e*n-l*r,o=e*r+l*n;At({x:D.x,y:D.y,vx:520*i,vy:520*o,d:D.dmg,life:1.05,pier:1})}D.gx=e,D.gy=l,D.rx-=6*e,D.ry-=4*l,D.flash=.07,D.face=e>=0?1:-1,It(D.x+16*e,D.y+10*l,"#ffd56d",3,35),St(.025),d(640,.04,"square",.018)}()),g.spawnT-=t;const v=g.kills>45||g.time>72;2===g.sch.mel&&!g.bs&&!g.bd&&!g.bs2&&!g.bd2&&g.kills>=35&&v&&function(){if(g.bs||g.bd||g.bs2||g.bd2||L.length>=h)return;const t=Math.random()*Math.PI*2,e={x:V(D.x+520*Math.cos(t),40,2560),y:V(D.y+520*Math.sin(t),40,1760),r:35,hp:640+11*g.time,s:46,dmg:24,vx:0,vy:0,ht:0,sl:0,ce:0,bm:0,bt:0,bi:"",k:3};tt(e,28),L.push(e),g.bs=1,g.msg="boss!",g.msgT=1.2,d(170,.15,"sawtooth",.03),St(.2)}(),g.bd&&!g.bs2&&!g.bd2&&g.t>=g.b2At&&function(){if(g.bs2||g.bd2||L.length>=h)return;const t=Math.random()*Math.PI*2,e=2280+30*g.time,l={x:V(D.x+560*Math.cos(t),44,2556),y:V(D.y+560*Math.sin(t),44,1756),r:42,hp:e,s:62,dmg:42,vx:0,vy:0,ht:0,sl:0,ce:0,bm:0,bt:0,bi:"",k:4,apMax:e,apBaseS:62,apCd:_(1.4,2.2),apTele:0,apTeleD:0,apAimX:0,apAimY:0,apBurstLeft:0,apBurstSpd:860,apPhase:1,apStormCd:_(3.4,5.2),apSummonCd:_(3.4,4.8),apEvadeCd:0,apImpactCd:0};tt(l,36),L.push(l),g.bs2=1,g.bd=0,g.msg="apex boss! phase omega",g.msgT=1.7,d(120,.2,"sawtooth",.04),St(.34)}(),g.spawnT<=0&&(g.spawnT=g.nextSpawn,g.nextSpawn=Math.max(.18,.78-.018*g.time),Lt(),!g.bs&&!g.bs2&&g.time>26&&Math.random()<.28&&Lt());for(let e=W.length-1;e>=0;e--){const l=W[e];if(l.life-=t,l.x+=l.vx*t,l.y+=l.vy*t,l.life<=0||l.x<-20||l.y<-20||l.x>2620||l.y>1820)W.splice(e,1);else for(let t=L.length-1;t>=0;t--){const a=L[t],s=a.x-l.x,n=a.y-l.y,r=l.r||3;if(s*s+n*n<(a.r+r)*(a.r+r)&&(a.hp-=l.d,a.ht=l.pulse?.12:.09,a.vx+=l.vx*(l.pulse?.11:.07),a.vy+=l.vy*(l.pulse?.11:.07),l.pulse&&It(a.x,a.y,"#9de6ff",3,28),l.pier--,a.hp<=0&&Dt(t,l.pulse?"#9de6ff":"#ff9675",l.pulse?7:9,l.pulse?58:70,l.pulse?1:0),l.pier<0)){W.splice(e,1);break}}}let P=0,z=0,C=0,R=0,w=0;const F=y;for(let e=L.length-1;e>=0;e--){const l=L[e];let a=D.x,s=D.y;if(F)if(l.bi!==F.id&&(l.bi=F.id,l.bm=0,l.bt=_(.9,1.7)),l.bt-=t,l.bt<=0&&(0===l.bm?(l.bm=1,l.bt=_(1.1,2.1)):(l.bm=0,l.bt=_(.9,1.7))),0===l.bm){const t=D.x-F.x,e=D.y-F.y,l=Math.hypot(t,e)||1;a=F.x+t/l*(F.r+8),s=F.y+e/l*(F.r+8)}else{const t=l.x-F.x,n=l.y-F.y,r=Math.hypot(t,n)||1;a=l.x+t/r*220+-n/r*Math.sin(2*g.t+e)*30,s=l.y+n/r*220+t/r*Math.sin(2*g.t+e)*30}else l.bi="",l.bt=0,l.bm=0;if(4===l.k){l.apMax||(l.apMax=l.hp),l.apBaseS||(l.apBaseS=l.s),l.apCd||(l.apCd=_(1.4,2.2)),l.apStormCd||(l.apStormCd=_(3.4,5.2)),l.apSummonCd||(l.apSummonCd=_(3.4,4.8)),l.apBurstSpd||(l.apBurstSpd=860),l.apTele||(l.apTele=0),l.apBurstLeft||(l.apBurstLeft=0),l.apEvadeCd||(l.apEvadeCd=0),l.apImpactCd||(l.apImpactCd=0);const e=V(l.hp/(l.apMax||1),0,1),a=e>.66?1:e>.33?2:3,s=a-1;l.apPhase=a,l.s=(l.apBaseS||62)*(1+.14*s+(D.zt>0?.18:0)),l.apCd-=t,l.apStormCd-=t,l.apSummonCd-=t,l.apEvadeCd>0&&(l.apEvadeCd=Math.max(0,l.apEvadeCd-t)),l.apImpactCd>0&&(l.apImpactCd=Math.max(0,l.apImpactCd-t));const n=D.x-l.x,r=D.y-l.y,i=Math.hypot(n,r)||1,o=1===a?.34:2===a?.52:.72,h=V(D.x+D.vx*o+28*(D.zx||0),20,2580),f=V(D.y+D.vy*o+28*(D.zy||0),20,1780);if(!y&&D.zt>0&&l.apEvadeCd<=0){const t=Math.random()<.5?-1:1,e=260+70*s;l.vx+=-D.zy*t*e,l.vy+=D.zx*t*e,l.apEvadeCd=.65-.08*s,a>=3&&Math.random()<.45&&Et(V(l.x+-D.zy*t*54,24,2576),V(l.y+D.zx*t*54,24,1776),58+10*s,1.8+.35*s),It(l.x,l.y,"#d7c1ff",10,70),d(176,.05,"sawtooth",.02)}if(l.apTele>0){if(l.apTele=Math.max(0,l.apTele-t),l.vx*=Math.max(0,1-13*t),l.vy*=Math.max(0,1-13*t),Math.random()<.6&&Rt({x:l.x+_(-8,8),y:l.y+_(-8,8),vx:_(-26,26),vy:_(-26,26),t:_(.1,.2),c:"#dab9ff"}),Math.random()<.55&&Rt({x:l.apAimX+_(-10,10),y:l.apAimY+_(-10,10),vx:_(-20,20),vy:_(-20,20),t:_(.08,.18),c:"#f4dcff"}),l.apTele<=0){const t=l.apAimX-l.x,e=l.apAimY-l.y,n=Math.hypot(t,e)||1,r=(l.apBurstSpd||860)+140*s+_(-45,60);l.vx+=t/n*r,l.vy+=e/n*r,l.ht=Math.max(l.ht,.18),St(.2+.05*s),vt(.03),It(l.x,l.y,"#c7a9ff",20,140),Et(V(l.apAimX+_(-22,22),24,2576),V(l.apAimY+_(-22,22),24,1776),68+12*s,2.2+.5*s),a>=2&&Math.random()<.7&&Wt(l,3===a?3:2,a),l.apBurstLeft=(0|l.apBurstLeft)-1,l.apBurstLeft>0?(l.apTeleD=Math.max(.18,.34-.04*s),l.apTele=l.apTeleD,l.apAimX=V(D.x+D.vx*(.7*o)+_(-30,30),20,2580),l.apAimY=V(D.y+D.vy*(.7*o)+_(-30,30),20,1780)):l.apCd=_(Math.max(.44,1.25-.26*s),Math.max(.8,1.95-.3*s)),d(145-8*s,.07,"sawtooth",.032)}}else if(l.apCd<=0){const t=i<180,e=i>360;let o=1===a?1:2===a?2:3;if(t&&a>=2&&o++,e&&1===a&&(o=2),l.apBurstLeft=o,l.apTeleD=Math.max(.24,.52-.08*s-(t?.08:0)),l.apTele=l.apTeleD,l.apAimX=h,l.apAimY=f,l.apBurstSpd=820+150*s+(e?90:0),Math.random()<.4+.2*s){const t=Math.random()<.5?-1:1;l.apAimX=V(l.apAimX+-r/i*t*(70+40*s),20,2580),l.apAimY=V(l.apAimY+n/i*t*(70+40*s),20,1780)}g.msg=3===a?"apex frenzy":"apex charging",g.msgT=.5,It(l.x,l.y,"#b59bff",12+4*a,90+18*a),d(190-10*s,.05,"square",.02),a>=2&&l.apSummonCd<=0&&(Wt(l,a,a),l.apSummonCd=_(Math.max(1.2,3-.6*s),Math.max(1.8,4.1-.7*s)))}if(l.apStormCd<=0&&!y&&(Et(V(D.x+.32*D.vx+_(-36,36),24,2576),V(D.y+.32*D.vy+_(-36,36),24,1776),62+10*a,2+.45*a),a>=3&&Math.random()<.16&&Et(V(l.x+_(-120,120),24,2576),V(l.y+_(-120,120),24,1776),56+8*a,1.8+.35*a),l.apStormCd=_(Math.max(2.8,4.9-.4*s),Math.max(3.6,6.1-.45*s))),!y){const e=l.x-D.x,s=l.y-D.y,n=Math.hypot(e,s)||1,r=300+40*a;if(n<r){const l=(1-n/r)*(110+38*a);D.x=V(D.x+e/n*l*t,12,2588),D.y=V(D.y+s/n*l*t,12,1788),D.rx-=e/n*(1.5+.35*a),D.ry-=s/n*(1.3+.3*a)}}}const n=a-l.x,r=s-l.y,i=Math.hypot(n,r)||1;let o=1,h=0,f=0,c=0,m=0;for(let e=0;e<N.length;e++){const a=N[e],s=l.x-a.x,n=l.y-a.y,r=s*s+n*n;if(5!==a.k){if(1===a.k){const e=1.9*a.r;if(r<e*e){const i=Math.sqrt(r)||1,h=1-i/e,f=120+h*h*390;l.vx+=-s/i*f*t,l.vy+=-n/i*f*t,o=Math.min(o,.8),r<a.r*a.r&&(o=Math.min(o,.48),c+=.95*D.chDo+7)}continue}if(!(r>=a.r*a.r))if(2===a.k)o=Math.min(o,.5);else if(3===a.k)o=Math.min(o,.72),c+=.75*D.chDo+4;else if(4===a.k){const e=Math.sqrt(r)||1,i=1-e/a.r,h=170+i*i*420;l.vx+=-s/e*h*t,l.vy+=-n/e*h*t,o=Math.min(o,.28),c+=2.1*D.chDo+22,m=1,(l.sc||0)<=0&&(l.sc=.24,It(l.x,l.y,"#c8f3ff",4,34))}}else r<a.r*a.r&&4!==l.k&&(o=Math.min(o,1.15))}l.sc>0&&(l.sc=Math.max(0,l.sc-t));for(let e=0;e<G.length;e++){const a=G[e],s=l.x-a.x,n=l.y-a.y,r=s*s+n*n,i=0|a.m;if(3===i){const e=2.35*a.r;if(r<e*e){const i=Math.sqrt(r)||1,c=1-i/e,m=90+c*c*350;l.vx+=-s/i*m*t,l.vy+=-n/i*m*t,o=Math.min(o,.88),r<a.r*a.r&&(f=3,o=Math.min(o,.42),h=1)}continue}if(r<a.r*a.r){f=i;const t=1===i?.3:2===i?.18:D.mkSl;o=Math.min(o,1-t),h=1,1===i&&D.cat&&l.ce<=0&&(l.ce=.55,l.hp-=D.chBurst,It(l.x,l.y,"#ffd58f",5,44));break}}if(D.bot&&X.length)for(let t=0;t<X.length;t++){const e=X[t],a=l.x-e.x,s=l.y-e.y,n=a*a+s*s,r=bt(0|e.t||1);n<400&&(o=Math.min(o,.65)),r.auraR>0&&n<r.auraR*r.auraR&&(o=Math.min(o,1-r.auraSl))}if((S||D.slRecallT>0||D.slLinkT>0)&&X.length>=3){o=Math.min(o,S?.58:.66);let t=0;for(let e=0;e<3;e++){const a=X[e],s=l.r+14;if(Y(l.x,l.y,D.x,D.y,a.x,a.y)<s*s){t=1;break}}if(t&&(l.tc||0)<=0){const t=S?Math.max(.1,D.slCharge):Math.max(.32,D.slPow),a=S?.24+.38*t:.34+.92*t,s=D.zDmg*a*(l.k>=3?.82:1);l.hp-=s,l.ht=Math.max(l.ht,S?.12:.16);const n=(S?170:230)+(S?120:250)*t,r=S?D.zx:D.slDx,i=S?D.zy:D.slDy;if(l.vx+=r*n,l.vy+=i*n,l.tc=S?.08:.06,z++,It(l.x,l.y,S?"#95edff":"#bff8ff",S?3:5,S?34:48),l.hp<=0){Dt(e,S?"#95edff":"#bff8ff",S?9:11,S?70:84,1),C++;continue}}}if((D.slT>0||D.slRecallT>0)&&X.length>=3){const t=D.slT<=0&&D.slRecallT>0;let a=0;for(let s=0;s<3;s++){const n=X[s],r=l.x-n.x,i=l.y-n.y,o=l.r+(t?20:22);if(r*r+i*i<o*o&&(l.tc||0)<=0){const o=(t?1.05:1.45)+(t?1.05:1.75)*D.slPow,h=D.zDmg*o*(l.k>=3?.82:t?1:1.05);l.hp-=h,l.ht=.18;const f=Math.hypot(r,i)||1,c=Math.hypot(D.x-n.x,D.y-n.y)||1,m=t?(D.x-n.x)/c:D.slDx,b=t?(D.y-n.y)/c:D.slDy,x=(t?240:340)+(t?190:320)*D.slPow;if(l.vx+=m*x+r/f*(130+100*D.slPow),l.vy+=b*x+i/f*(130+100*D.slPow),l.tc=t?.08:.095,z++,It(l.x,l.y,t?"#bdf7ff":"#8eefff",t?5:7,t?52:64),a=1,!t){const t=1<<s;D.slHitMask&t||(D.slHitMask|=t),R||7!==D.slHitMask||(R=1,w=Math.max(w,D.slPow),D.slLinkT=Math.max(D.slLinkT,.8140000000000001),D.slWave=Math.max(D.slWave,.95),D.slComboFx=Math.max(D.slComboFx,1.2),g.msg="triple crack",g.msgT=.7,d(1240,.04,"square",.024),d(820,.05,"triangle",.017))}if(l.hp<=0){Dt(e,t?"#bdf7ff":"#8eefff",t?9:12,t?76:92,1),C++;break}}}if(a&&l.hp<=0)continue}if(l.tc>0&&(l.tc=Math.max(0,l.tc-t)),4===l.k){const t=l.apPhase||1;m?(o=Math.min(o,.22),c+=3.5*D.chDo+38,(l.sc||0)<=0&&(l.sc=.18,It(l.x,l.y,"#8effdc",8,58))):o=Math.max(o,t>=3?.72:2===t?.62:.54)}if(l.sl=h,h){const a=D.cat&&1===f?D.chDo:0;if(a>0&&(l.hp-=a*t),l.ht=Math.max(l.ht,.08),l.hp<=0){Dt(e,"#f7d96b",8,60);continue}}if(c>0&&(l.hp-=c*t,l.ht=Math.max(l.ht,.11),l.hp<=0)){Dt(e,"#c8f3ff",10,76,1);continue}l.ce>0&&(l.ce=Math.max(0,l.ce-t)),l.vx*=Math.max(0,1-8*t),l.vy*=Math.max(0,1-8*t),l.ht=Math.max(0,l.ht-t),l.x+=(n/i*l.s*o+l.vx)*t,l.y+=(r/i*l.s*o+l.vy)*t,tt(l,6)&&(l.vx*=.4,l.vy*=.4);const b=D.x-l.x,x=D.y-l.y;if((Math.hypot(b,x)||1)<l.r+D.r-1){if(D.zt>0){if(l.hp-=D.zDmg,l.ht=.12,l.vx+=280*D.zx,l.vy+=280*D.zy,z++,l.hp<=0){Dt(e,"#8fffe5",12,90,1),C++;continue}P+=.35*l.dmg;continue}4===l.k&&l.apImpactCd<=0&&!y&&(l.apImpactCd=.9,Et(V(D.x+_(-16,16),24,2576),V(D.y+_(-16,16),24,1776),68+10*(l.apPhase||1),2.2+.35*(l.apPhase||1)),It(D.x,D.y,"#e1c6ff",10,84),St(.15)),P+=4===l.k?1.2*l.dmg:l.dmg}}if(D.slRecallPulse){D.slRecallPulse=0;const t=132*(.88+.24*Math.min(1,D.slPow)),e=t*t,l=D.zDmg*(.48+.62*Math.min(1,D.slPow));let a=0;for(let s=L.length-1;s>=0;s--){const n=L[s],r=n.x-D.x,i=n.y-D.y,o=r*r+i*i;if(o>e)continue;const h=Math.sqrt(o)||1,f=1-h/t;n.hp-=l*(.58+.42*f),n.ht=Math.max(n.ht,.13);const c=170+220*f*(.7+.3*Math.min(1,D.slPow));n.vx+=r/h*c,n.vy+=i/h*c,a++,z++,Math.random()<.26&&It(n.x,n.y,"#cdf9ff",3,34),n.hp<=0&&(Dt(s,"#cdf9ff",10,78,1),C++)}D.slWave=Math.max(D.slWave,.78),D.slComboFx=Math.max(D.slComboFx,.48),It(D.x,D.y,"#cdf9ff",16,104+66*Math.min(1,D.slPow)),a>0&&(g.msg="recall burst",g.msgT=.55,vt(.035+.015*Math.min(1,D.slPow)),St(.08+.07*Math.min(1,D.slPow)),d(900,.03,"square",.018))}if(R){const t=165*(.9+.35*w),e=t*t,l=D.zDmg*(.7+1.1*w);for(let a=L.length-1;a>=0;a--){const s=L[a],n=s.x-D.x,r=s.y-D.y,i=n*n+r*r;if(i>e)continue;const o=Math.sqrt(i)||1,h=1-o/t;s.hp-=l*(.55+.45*h),s.ht=Math.max(s.ht,.14);const f=220+280*w*h;s.vx+=n/o*f,s.vy+=r/o*f,z++,Math.random()<.32&&It(s.x,s.y,"#b8f6ff",3,40),s.hp<=0&&(Dt(a,"#b8f6ff",11,86,1),C++)}vt(.06+.03*Math.min(1,w)),St(.2+.14*Math.min(1,w)),It(D.x,D.y,"#b8f6ff",20,130+90*w)}z>0&&(vt(Math.min(.04,.012*z)),St(Math.min(.24,.04*z)),g.xpPulse=Math.min(.6,g.xpPulse+.06*z),d(260,.02,"square",.016),C>1&&d(310,.02,"square",.013)),P>0&&_t(P*t);for(let e=E.length-1;e>=0;e--){const l=E[e],a=D.x-l.x,s=D.y-l.y,n=Math.hypot(a,s)||1;if(D.bot&&X.length)if(l.bc){const e=(0|l.bc)-1,a=e>=0&&e<X.length?X[e]:X[0],s=bt(0|a.t||1),n=a.x-l.x,r=a.y-l.y,i=Math.hypot(n,r)||1,o=Math.min(1.3*s.pull,13*i);l.x+=n/i*o*t,l.y+=r/i*o*t}else{let e=0;for(let t=0;t<X.length;t++)e+=bt(0|X[t].t||1).carry;if(D.bCarry<e&&n>1.45*D.magnet)for(let e=0;e<X.length;e++){const a=X[e];if(a.grabCd>0)continue;const s=bt(0|a.t||1),n=a.x-l.x,r=a.y-l.y,i=Math.hypot(n,r)||1;if(i<s.fetch){l.x+=n/i*s.pull*t,l.y+=r/i*s.pull*t,i<10&&(l.bc=e+1,D.bCarry++,a.grabCd=s.grab,It(l.x,l.y,"#9de6ff",3,24));break}}}n<D.magnet&&(l.x+=a/n*240*t,l.y+=s/n*240*t),n<D.r+8&&Ot(e,l.bc?"bot":"player")}(B.gr||H)&&Math.random()<.04&&g.time>2&&wt({x:V(D.x+_(-20,20),12,2588),y:V(D.y+_(-20,20),12,1788),v:4,m:1,t:0})}(x),function(){const t=g.shake*g.shake,n=10*(2*Math.random()-1)*t,h=10*(2*Math.random()-1)*t;e.setTransform(s,0,0,s,n,h);const b=V(D.x-.5*l,0,2600-l),x=V(D.y-.5*a,0,1800-a),d=e.createLinearGradient(0,0,0,a);d.addColorStop(0,"#263f60"),d.addColorStop(.55,"#16273f"),d.addColorStop(1,"#0b111a"),e.fillStyle=d,e.fillRect(0,0,l,a),e.strokeStyle="rgba(63,96,132,.35)",e.lineWidth=1;const y=-b%56;for(let t=-x%56;t<a;t+=56)e.beginPath(),e.moveTo(0,0|t),e.lineTo(l,0|t),e.stroke();for(let t=y;t<l;t+=56)e.beginPath(),e.moveTo(0|t,0),e.lineTo(0|t,a),e.stroke();const p=1300-b,u=900-x;e.fillStyle="rgba(105,240,201,.07)",e.beginPath(),e.arc(p,u,210,0,2*Math.PI),e.fill();const M=$(D.x,D.y,-8);for(let t=0;t<r.length;t++){const s=r[t],n=s.x-b,h=s.y-x;if(n<-s.r-30||h<-s.r-30||n>l+s.r+30||h>a+s.r+30)continue;const f="home"===s.id?0:2===g.sch[s.id],c="home"===s.id?!D.mkOn:1===g.sch[s.id]||"nsh"===s.id&&(0===g.sch.nsh||2===g.sch.nsh&&g.labNsh>0)||"mel"===s.id&&(2===g.sch.nsh&&0===g.sch.mel||2===g.sch.mel&&g.labMel>0);e.globalAlpha=f?.18:c?.14:.08,e.fillStyle=s.c,e.beginPath(),e.arc(n,h,s.r,0,2*Math.PI),e.fill(),e.globalAlpha=.65,e.strokeStyle=f?"#9effc8":s.c,e.lineWidth=2,e.beginPath(),e.arc(n,h,s.r,0,2*Math.PI),e.stroke(),e.globalAlpha=1,e.fillStyle="#dce8ff",e.font="600 12px Trebuchet MS,sans-serif",e.fillText(s.n,n-s.r+10,h-s.r-8);const m="home"===s.id?48:44,d=30,y=n-.5*m,p=h-.5*d;if(e.fillStyle="rgba(18,25,37,.9)",e.fillRect(y,p,m,d),e.strokeStyle="rgba(165,190,220,.55)",e.lineWidth=1,e.strokeRect(y+.5|0,p+.5|0,m-1,d-1),e.fillStyle="rgba(248,234,164,.86)",e.fillRect(y+6|0,p+6|0,11,8),e.fillRect(y+m-17|0,p+6|0,11,8),e.fillStyle="rgba(44,56,72,.95)",e.beginPath(),e.arc(y+11+Math.sin(2*g.t+t),p+11,1.7,0,2*Math.PI),e.fill(),e.beginPath(),e.arc(y+m-11+Math.sin(2*g.t+t+1),p+11,1.7,0,2*Math.PI),e.fill(),g.start&&!g.dead){const l=M?o:i,a=l[(.45*g.t+2*t|0)%l.length],r=h-.44*s.r,f=4.6*a.length+12;e.fillStyle="rgba(8,12,20,.82)",U(n-.5*f,r-9,f,16,7),e.fill(),e.fillStyle="rgba(220,240,255,.9)",e.font="600 9px Trebuchet MS,sans-serif",e.fillText(a,n-.5*f+6,r+3)}}for(let t=0;t<E.length;t++){const s=E[t],n=s.x-b,r=s.y-x;n<-10||r<-10||n>l+10||r>a+10||(e.fillStyle="#69f0c9",e.beginPath(),e.arc(n,r,5,0,2*Math.PI),e.fill(),e.fillStyle="#ceffef",e.fillRect(n-1|0,r-1|0,2,2))}for(let t=0;t<G.length;t++){const s=G[t],n=s.x-b,r=s.y-x;if(n<-s.r-20||r<-s.r-20||n>l+s.r+20||r>a+s.r+20)continue;const i=s.t/s.d;e.globalAlpha=.12+.1*i;let o="#f4d96e",h="#fff0a9";D.cat&&(1===s.m?(o="#53d93d",h="#baff87"):2===s.m?(o="#42cdb9",h="#a8f6ea"):3===s.m&&(o="#597fd6",h="#bdd4ff")),e.fillStyle=o,e.beginPath(),e.arc(n,r,s.r,0,2*Math.PI),e.fill(),e.globalAlpha=.2+.2*Math.sin(5*(g.t+t))*i,e.strokeStyle=h,e.lineWidth=1.5,e.beginPath(),e.arc(n,r,.68*s.r+2*Math.sin(4*(g.t+t)),0,2*Math.PI),e.stroke(),D.cat&&(3===s.m&&(e.globalAlpha=.1+.08*i,e.strokeStyle="rgba(175,205,255,.72)",e.lineWidth=1.25,e.beginPath(),e.arc(n,r,2.35*s.r*(.97+.03*Math.sin(2*g.t+t)),0,2*Math.PI),e.stroke(),e.globalAlpha=.08+.07*i,e.strokeStyle="rgba(140,174,255,.58)",e.lineWidth=1,e.beginPath(),e.arc(n,r,1.6*s.r*(.96+.04*Math.sin(2.7*g.t+.8*t)),0,2*Math.PI),e.stroke()),e.globalAlpha=.18+.24*i,1===s.m?e.fillStyle="#dbff8f":2===s.m?e.fillStyle="#d8fff7":3===s.m?e.fillStyle="#e1ebff":e.fillStyle="#f1ffb3",e.beginPath(),e.arc(n+Math.sin(4*g.t+t)*s.r*.22,r-.16*s.r,2.4+.7*Math.sin(7*g.t+t),0,2*Math.PI),e.fill(),e.beginPath(),e.arc(n-.18*s.r,r+Math.sin(3*g.t+.7*t)*s.r*.14,1.9+.5*Math.sin(8*g.t+.4*t),0,2*Math.PI),e.fill(),e.beginPath(),e.arc(n+.12*s.r,r+.2*s.r,1.6+.4*Math.sin(6*g.t+.5*t),0,2*Math.PI),e.fill()),e.globalAlpha=1}for(let t=0;t<N.length;t++){const s=N[t],n=s.x-b,r=s.y-x;if(n<-s.r-40||r<-s.r-40||n>l+s.r+40||r>a+s.r+40)continue;const i=s.t/s.d,o=.86+.12*Math.sin(5*g.t+t),h=s.r*o;let f="#95f0b8",c="#d6ffea",m="#6ae9b4";if(2===s.k?(f="#7cf6e7",c="#d8fff7",m="#a0fff0"):3===s.k?(f="#c5f690",c="#efffd0",m="#d9ffab"):4===s.k?(f="#bde9ff",c="#f0fbff",m="#d4f2ff"):5===s.k&&(f="#b89edf",c="#d8c4f0",m="#c4a8e8"),e.globalAlpha=.14+.16*i,e.fillStyle=f,e.beginPath(),e.arc(n,r,h,0,2*Math.PI),e.fill(),e.globalAlpha=.28+.24*i,e.strokeStyle=c,e.lineWidth=2,e.beginPath(),e.arc(n,r,.78*h,0,2*Math.PI),e.stroke(),e.globalAlpha=.2+.2*i,e.strokeStyle=m,e.lineWidth=1.4,e.beginPath(),e.arc(n,r,h*(1.08+.05*Math.sin(7*g.t+t)),0,2*Math.PI),e.stroke(),4===s.k)for(let t=0;t<3;t++){const l=5.6*g.t+2.1*t,a=n+Math.cos(l)*h*.62,s=r+Math.sin(l)*h*.62;e.globalAlpha=.5+.3*i,e.fillStyle="#f2fcff",e.beginPath(),e.arc(a,s,2.3,0,2*Math.PI),e.fill()}if(5===s.k){for(let t=0;t<4;t++){const l=-4.2*g.t+1.57*t,a=n+Math.cos(l)*h*.55,s=r+Math.sin(l)*h*.55;e.globalAlpha=.35+.25*i,e.fillStyle="#e0c8ff",e.beginPath(),e.arc(a,s,2,0,2*Math.PI),e.fill()}e.globalAlpha=.08+.1*i,e.strokeStyle="#9b7ccc",e.lineWidth=1.8,e.beginPath(),e.arc(n,r,h*(.5+.08*Math.sin(9*g.t+t)),0,2*Math.PI),e.stroke()}e.globalAlpha=1}for(let t=0;t<L.length;t++){const s=L[t],n=s.x-b,r=s.y-x;if(n<-40||r<-40||n>l+40||r>a+40)continue;const i=4===s.k?"#713ce8":3===s.k?"#a789ff":2===s.k?"#665a78":1===s.k?"#5687a1":s.sl?"#70805a":"#4b667f";if(e.fillStyle=s.ht>0?"#9db4d1":i,e.beginPath(),e.arc(n,r,s.r,0,2*Math.PI),e.fill(),e.fillStyle="#f0627c",e.fillRect(n-4|0,r-2|0,3,3),e.fillRect(n+1|0,r-2|0,3,3),4===s.k){const l=V(s.hp/(s.apMax||s.hp||1),0,1),a=l>.66?"#bfa1ff":l>.33?"#d8b4ff":"#ffb6f2",i=Math.hypot(s.vx||0,s.vy||0);if(i>220){const l=(s.vx||0)/(i||1),a=(s.vy||0)/(i||1);e.globalAlpha=.14+.06*Math.sin(20*g.t+t),e.fillStyle="rgba(165,126,242,.7)",e.beginPath(),e.ellipse(n-l*(18+.02*i),r-a*(18+.02*i),.7*s.r,.44*s.r,Math.atan2(a,l),0,2*Math.PI),e.fill()}if(e.globalAlpha=.25+.12*Math.sin(8*g.t+t),e.strokeStyle=a,e.lineWidth=2,e.beginPath(),e.arc(n,r,s.r+10+2*Math.sin(6*g.t+t),0,2*Math.PI),e.stroke(),s.apTele>0&&void 0!==s.apAimX){const t=1-V(s.apTele/(s.apTeleD||.001),0,1),l=s.apAimX-b,a=s.apAimY-x;e.globalAlpha=.22+.5*t,e.strokeStyle="#f2d6ff",e.lineWidth=2.2+1.8*t,e.setLineDash([7,6]),e.lineDashOffset=90*-g.t,e.beginPath(),e.moveTo(n,r),e.lineTo(l,a),e.stroke(),e.setLineDash([]),e.beginPath(),e.arc(l,a,26+26*t,0,2*Math.PI),e.stroke(),e.globalAlpha=.12+.3*t,e.fillStyle="rgba(234,203,255,.85)",e.beginPath(),e.arc(l,a,18+22*t,0,2*Math.PI),e.fill(),e.fillStyle="rgba(248,232,255,.75)",e.beginPath(),e.arc(l,a,3.2,0,2*Math.PI),e.fill()}e.globalAlpha=1}}for(let t=0;t<W.length;t++){const l=W[t],a=l.x-b,s=l.y-x;if(l.pulse){const t=l.r||8;e.fillStyle="rgba(157,230,255,.2)",e.beginPath(),e.arc(a,s,1.4*t,0,2*Math.PI),e.fill(),e.strokeStyle=l.c||"#9de6ff",e.lineWidth=2,e.beginPath(),e.arc(a,s,t,0,2*Math.PI),e.stroke(),e.fillStyle="rgba(224,250,255,.88)",e.beginPath(),e.arc(a,s,.34*t,0,2*Math.PI),e.fill()}else e.fillStyle=l.c||"#ffd56d",e.fillRect(a-2|0,s-2|0,4,4)}const T=D.x-b+D.rx,k=D.y-x+D.ry,S=Math.abs(D.vx)>=Math.abs(D.vy)?D.face>0?m.e:m.w:D.vy<0?D.face>0?m.ne:m.nw:D.face>0?m.se:m.sw;if(e.fillStyle="rgba(0,0,0,.35)",e.beginPath(),e.ellipse(T,k+14,17,6,0,0,2*Math.PI),e.fill(),S&&S.complete?e.drawImage(S,T-22,k-18,44,30):(e.fillStyle="#0b0f14",e.beginPath(),e.arc(T,k,12,0,2*Math.PI),e.fill(),e.fillStyle="#ef4f6c",e.fillRect(T+3|0,k-6|0,7,3)),D.bHealFx>0){const t=Math.min(1,D.bHealFx/.7),l=24+2*Math.sin(18*g.t);e.globalAlpha=.18+.26*t,e.fillStyle="#79f2ad",e.beginPath(),e.arc(T,k,l+9*t,0,2*Math.PI),e.fill(),e.globalAlpha=.55+.35*t,e.strokeStyle="#bfffd6",e.lineWidth=2.2,e.beginPath(),e.arc(T,k,l,0,2*Math.PI),e.stroke(),e.globalAlpha=1}if(D.bot&&X.length){for(let t=0;t<X.length;t++){const l=bt(0|X[t].t||1),a=l.body,s=l.ring,n=X[t],r=n.x-b,i=n.y-x;e.fillStyle="rgba(0,0,0,.25)",e.beginPath(),e.ellipse(r,i+8,11,4,0,0,2*Math.PI),e.fill(),e.fillStyle=a,e.beginPath(),e.arc(r,i,9,0,2*Math.PI),e.fill(),e.fillStyle="#16314a",e.fillRect(r-3|0,i-2|0,2,2),e.fillRect(r+1|0,i-2|0,2,2),e.strokeStyle=s,e.lineWidth=1.2,e.beginPath(),e.arc(r,i,12+1.5*Math.sin(9*g.t+t),0,2*Math.PI),e.stroke(),l.auraR>0&&(e.strokeStyle="rgba(255,231,176,.42)",e.lineWidth=1.5,e.beginPath(),e.arc(r,i,l.auraR*(.84+.08*Math.sin(4*g.t+.7*t)),0,2*Math.PI),e.stroke())}if((D.zt>0||D.slT>0||D.slRecallT>0||D.slLinkT>0)&&X.length>=3){const t=V(D.slLinkT/c,0,1),l=Math.max(D.triFx,D.slCharge,D.slFocus,D.slPow*(D.slT>0||D.slRecallT>0||D.slLinkT>0?1:.35),.85*t,.55*D.slComboFx),a=1-V((Math.max(44,D.slRopeRest||92)-44)/132,0,1),s=D.zt>0?D.zx:D.slT>0||D.slRecallT>0?D.slDx:D.gx,n=D.zt>0?D.zy:D.slT>0||D.slRecallT>0?D.slDy:D.gy,r=4.6*g.t;for(let t=0;t<3;t++){const i=X[t],o=i.x-b,h=i.y-x,f=(t-1)*(12+(9+6*(1-a))*l),c=.5*(T+o)+-n*f,m=.5*(k+h)+s*f;e.strokeStyle="rgba(150,238,255,"+(.28+.42*l+.08*a)+")",e.lineWidth=1.8+1.6*l,e.beginPath(),e.moveTo(T,k),e.quadraticCurveTo(c,m,o,h),e.stroke(),e.strokeStyle="rgba(223,252,255,"+(.2+.48*l+.06*a)+")",e.lineWidth=.9+.9*l,e.beginPath(),e.moveTo(T,k),e.quadraticCurveTo(c,m,o,h),e.stroke();const d=(r+.27*t)%1,y=1-d,p=y*y*T+2*y*d*c+d*d*o,g=y*y*k+2*y*d*m+d*d*h;if(e.fillStyle="rgba(219,250,255,"+(.5+.45*l+.04*a)+")",e.beginPath(),e.arc(p,g,1.9+1.1*l,0,2*Math.PI),e.fill(),D.slT>0||D.slRecallT>0||D.slLinkT>0){const t=(i.slx||0)+D.slDx*(28+44*a),s=(i.sly||0)+D.slDy*(28+44*a),n=Math.hypot(t,s)||1,r=o-t/n*(18+10*l),f=h-s/n*(18+10*l);e.strokeStyle="rgba(167,244,255,"+(.22+.44*l+.14*a)+")",e.lineWidth=2.2+.9*l,e.beginPath(),e.moveTo(r,f),e.lineTo(o,h),e.stroke()}}if(D.zt>0&&D.slFocus>0){const t=Math.min(1,D.slFocus),l=30+9*t+1.1*Math.sin(20*g.t);e.strokeStyle=D.slPerfect?"rgba(255,233,160,.95)":"rgba(196,239,255,"+(.35+.45*t)+")",e.lineWidth=1.4+1.6*t,e.beginPath(),e.arc(T,k,l,.5*-Math.PI,.5*-Math.PI+2*Math.PI*t),e.stroke(),D.slPerfect&&(e.fillStyle="rgba(255,240,190,.96)",e.font="700 10px Trebuchet MS,sans-serif",e.fillText("PERFECT",T-22,k-28))}}if(D.bCarry>0){const t=X[0].x-b,l=X[0].y-x;e.fillStyle="rgba(6,10,16,.84)",e.beginPath(),e.arc(t+10,l-10,8,0,2*Math.PI),e.fill(),e.fillStyle="#dfffff",e.font="700 10px Trebuchet MS,sans-serif",e.fillText(""+D.bCarry,t+7,l-7)}}if(D.mkS>0&&D.zt<=0){const t=D.face>0?-1:1,l=V(D.mkS/.32,0,1),a=T+13*t,s=k+8,n=a+t*(11+2.2*Math.sin(36*g.t)),r=s+7+1.1*Math.sin(22*g.t);e.strokeStyle="rgba(248,220,112,"+(.38+.45*l)+")",e.lineWidth=2,e.beginPath(),e.moveTo(a,s),e.quadraticCurveTo(.5*(a+n),s+2,n,r),e.stroke(),e.fillStyle="rgba(250,214,103,.72)",e.beginPath(),e.arc(n+2*t,r+2,2.1,0,2*Math.PI),e.fill(),e.fillStyle="rgba(244,205,93,.38)",e.beginPath(),e.ellipse(n+5*t,r+7,5.2,2.7,0,0,2*Math.PI),e.fill()}if((D.zc>0||D.zcd>0)&&D.zt<=0){const t=D.zcd>0?0:Math.min(1,D.zc/D.zLoad),l=t<=0?Math.max(0,1-D.zcd/D.zCool):0,a=18+8*t+1.2*Math.sin(22*g.t);e.strokeStyle=D.zr?"#8fffe5":"#ffd56d",e.lineWidth=2+1.8*t,e.beginPath(),e.arc(T,k,a,.5*-Math.PI,.5*-Math.PI+2*Math.PI*t),e.stroke(),D.zcd>0&&(e.strokeStyle="rgba(158,200,255,.7)",e.lineWidth=2,e.beginPath(),e.arc(T,k,16,.5*-Math.PI,.5*-Math.PI+2*Math.PI*l),e.stroke())}if(D.zt>0||D.slT>0||D.slRecallT>0||D.slLinkT>0){const t=D.zt>0?D.zt/2:Math.max(.55*D.slPow,.46*V(D.slLinkT/c,0,1)),l=D.zt>0?D.zx:D.slT>0||D.slRecallT>0?D.slDx:D.gx,a=D.zt>0?D.zy:D.slT>0||D.slRecallT>0?D.slDy:D.gy;e.strokeStyle="rgba(143,255,229,.7)",e.lineWidth=2.5,e.beginPath(),e.arc(T,k,20+2*Math.sin(30*g.t)+4*t,0,2*Math.PI),e.stroke(),e.fillStyle="rgba(143,255,229,.16)",e.beginPath(),e.ellipse(T-10*l,k-7*a,20,10,Math.atan2(a,l),0,2*Math.PI),e.fill()}if(D.slWave>0){const t=D.slWave,l=30+88*(1-t);e.globalAlpha=.06+.16*t,e.fillStyle="rgba(142,238,255,.95)",e.beginPath(),e.arc(T,k,1.08*l,0,2*Math.PI),e.fill(),e.globalAlpha=.74*t,e.strokeStyle="rgba(214,250,255,.96)",e.lineWidth=2+2.4*t,e.beginPath(),e.arc(T,k,l,0,2*Math.PI),e.stroke(),e.globalAlpha=1}if(D.slComboFx>0){const t=Math.min(1,D.slComboFx),l=42+58*(1-t);e.globalAlpha=.07+.2*t,e.fillStyle="rgba(185,244,255,.95)",e.beginPath(),e.arc(T,k,1.1*l,0,2*Math.PI),e.fill(),e.globalAlpha=.2+.45*t,e.strokeStyle="rgba(229,251,255,.96)",e.lineWidth=1.8+1.5*t,e.beginPath(),e.arc(T,k,l,0,2*Math.PI),e.stroke(),e.globalAlpha=1}D.flash>0&&(e.globalAlpha=D.flash/.07,e.fillStyle="#ffe598",e.beginPath(),e.moveTo(T+16*D.gx,k+8*D.gy),e.lineTo(T+24*D.gx-5*D.gy,k+24*D.gy+4*D.gx),e.lineTo(T+24*D.gx+5*D.gy,k+24*D.gy-4*D.gx),e.closePath(),e.fill(),e.globalAlpha=1);for(let t=0;t<O.length;t++){const s=O[t],n=s.x-b,r=s.y-x;n<-8||r<-8||n>l+8||r>a+8||(e.globalAlpha=Math.max(0,Math.min(1,2.4*s.t)),e.fillStyle=s.c,e.fillRect(0|n,0|r,3,3))}e.globalAlpha=1;const v=44,P=l-18-v,z=l<420;let C=62,R=74;const w=Math.max(96,l-190);if(e.fillStyle="rgba(7,10,16,.76)",e.fillRect(10,10,l-20,104),e.fillStyle="#eef4ff",e.font="700 17px Trebuchet MS,sans-serif",e.fillText("SCOTTY",20,32),z){const t=52,l=P-8;e.font="600 12px Trebuchet MS,sans-serif",e.fillStyle="#9ec8ff",e.fillText("Time "+g.time.toFixed(1)+"s",20,t),e.fillStyle="#ffd56d",e.fillText("Kills "+g.kills,118,t),e.textAlign="right",e.fillStyle="#dce8ff",e.fillText("Best "+g.best,l,t),e.textAlign="left",C=62,R=74}else e.font="600 14px Trebuchet MS,sans-serif",e.fillStyle="#9ec8ff",e.fillText("Time "+g.time.toFixed(1)+"s",20,54),e.fillStyle="#ffd56d",e.fillText("Kills "+g.kills,150,54),e.textAlign="right",e.fillStyle="#dce8ff",e.fillText("Best "+g.best,l-24,54),e.textAlign="left";e.fillStyle="#2a3346",e.fillRect(20,C,w,10),e.fillStyle="#ef4f6c",e.fillRect(20,C,w*(D.hp/D.maxHp),10),e.fillStyle="#24374d",e.fillRect(20,R,w,8),e.fillStyle="#69f0c9",e.fillRect(20,R,w*(g.xp/g.nextXp),8);let A=0;for(let t=0;t<L.length;t++)if(4===L[t].k){A=L[t];break}let I=118;if(A){const t=V(A.hp/(A.apMax||A.hp||1),0,1),a=A.apPhase||1,s=1===a?"ALPHA":2===a?"RAGE":"OMEGA",n=V(.58*l,220,620),r=12,i=.5*(l-n),o=I+2;e.fillStyle="rgba(10,14,22,.88)",U(i-10,o-18,n+20,38,11),e.fill();const h=e.createLinearGradient(0,o,0,o+r);h.addColorStop(0,"rgba(54,71,103,.95)"),h.addColorStop(1,"rgba(30,40,63,.95)"),e.fillStyle=h,e.fillRect(i,o,n,r);const f=e.createLinearGradient(i,0,i+n,0);1===a?(f.addColorStop(0,"#9a7dff"),f.addColorStop(1,"#c8b6ff")):2===a?(f.addColorStop(0,"#d28cff"),f.addColorStop(1,"#ffbfd8")):(f.addColorStop(0,"#ff8bd9"),f.addColorStop(1,"#ffc3f1")),e.fillStyle=f,e.fillRect(i,o,n*t,r),e.strokeStyle="rgba(220,234,255,.65)",e.lineWidth=1.2,e.strokeRect(i+.5,o+.5,n-1,r-1),e.fillStyle="#f4ecff",e.font="700 11px Trebuchet MS,sans-serif",e.textAlign="center",e.fillText("APEX DEAN // "+s,i+.5*n,o-7),e.textAlign="left",I+=34}const B=function(){if(!D.mkOn)return"collect mints "+g.homeGot+"/"+g.homeNeed;if(g.bd2)return"campus secured";if(g.bs2&&ht(g.chemMask)>=3)return"triple burst! overlap all 3 puddles to storm apex!";if(g.bs2)return"defeat apex boss";if(g.bd){const t=Math.max(0,g.b2At-g.t);return(t<=3.6?"someone...":"something big is approaching...")+" "+t.toFixed(1)+"s"}return g.bs?"defeat boss":g.pz&&"nsh"===g.pz.id?"solve nsh puzzle":g.pz&&"mel"===g.pz.id?"solve mellon puzzle":0===g.sch.nsh?"find nsh":1===g.sch.nsh?"solve nsh puzzle":0===g.sch.mel?"find mellon institute":1===g.sch.mel?"solve mellon puzzle":g.labNsh>0&&g.labMel>0?"visit nsh / mellon for prototype upgrades":g.labNsh>0?"visit nsh for buddy prototype":g.labMel>0?"visit mellon institute for catalyst prototype":2===g.sch.mel&&g.kills<35?"defeat 35 enemies to summon boss":"survive phase 2"}();if(e.fillStyle="rgba(8,12,19,.62)",e.fillRect(14,I,l-28,26),e.fillStyle="#d7ffe8",e.font="600 12px Trebuchet MS,sans-serif",e.fillText(B,22,I+17),D.bot&&X.length>=3){const t=I+30,a=l-44,s=D.zt>0&&D.slT<=0&&D.slRecallT<=0,n=s?V(D.slCharge,0,1):D.slT>0?V(D.slT/.72,0,1):D.slRecallT>0?V(D.slRecallT/f,0,1):D.slLinkT>0?V(D.slLinkT/c,0,1):0,r=s?"triple buddy: rope windup":D.slT>0?"triple buddy: blade throw":D.slRecallT>0?"triple buddy: blade recall":D.slLinkT>0?"triple buddy: ropes tightening":"triple buddy: zoomies to arm";e.fillStyle="rgba(8,12,19,.64)",e.fillRect(14,t,l-28,22),e.fillStyle="rgba(48,72,98,.9)",e.fillRect(22,t+8,a,8),e.fillStyle=D.slRecallT>0?"#c9f7ff":D.slT>0?"#8eefff":D.slLinkT>0?"#a8f4ff":"#9fdfff",e.fillRect(22,t+8,a*n,8),e.fillStyle="#d5f2ff",e.font="600 11px Trebuchet MS,sans-serif",e.fillText(r,22,t+16),I+=26}if(g.start&&!g.dead){const t=(t,l,a,s,n,r)=>{e.fillStyle="rgba(8,12,19,.92)",e.fillRect(P,t,v,v),e.strokeStyle=s?l:"rgba(129,157,187,.7)",e.lineWidth=2,e.strokeRect(P+.5,t+.5,43,43),e.strokeStyle="rgba(72,88,109,.85)",e.lineWidth=3,e.beginPath(),e.arc(P+22,t+22,14.96,0,2*Math.PI),e.stroke(),e.strokeStyle=l,e.beginPath(),e.arc(P+22,t+22,14.96,.5*-Math.PI,.5*-Math.PI+2*Math.PI*V(a,0,1)),e.stroke(),e.fillStyle=l,r<1?(e.beginPath(),e.moveTo(P+21.56,t+8.36),e.lineTo(P+.35*v,t+23.32),e.lineTo(P+21.56,t+23.32),e.lineTo(P+17.16,t+36.08),e.lineTo(P+29.48,t+18.04),e.lineTo(P+22.44,t+18.04),e.closePath(),e.fill()):r<2?(e.beginPath(),e.arc(P+22,t+19.36,4.4,0,2*Math.PI),e.fill(),e.beginPath(),e.moveTo(P+22,t+8.8),e.bezierCurveTo(P+30.36,t+19.8,P+28.16,t+29.48,P+22,t+34.32),e.bezierCurveTo(P+15.84,t+29.48,P+13.64,t+19.8,P+22,t+8.8),e.fill()):(e.lineWidth=2,e.beginPath(),e.arc(P+22,t+22,.12*v,0,2*Math.PI),e.stroke(),e.beginPath(),e.arc(P+22,t+22,9.68,0,2*Math.PI),e.stroke()),n>0?(e.fillStyle="#dce8ff",e.font="700 10px Trebuchet MS,sans-serif",e.fillText(n.toFixed(1)+"s",P+8,t+v-6)):s&&(e.fillStyle="rgba(255,255,255,.8)",e.beginPath(),e.arc(P+v-8,t+8,3,0,2*Math.PI),e.fill())};t(14,"#8fffe5",D.zcd>0?1-D.zcd/D.zCool:D.zr?1:D.zc/D.zLoad,D.zt>0,D.zcd>0?D.zcd:0,0);const l=D.mkOn?D.mkT>0?1-D.mkT/D.mkI:1:0;t(66,D.cat?function(){const t=ht(g.chemMask);return t>=3?"#5ccba0":2===t?"#7ae88a":1&g.chemMask?"#8fdd73":2&g.chemMask?"#7ad8cd":4&g.chemMask?"#8fb6ff":"#f4d96e"}():"#f4d96e",l,D.mkS>0,D.mkOn&&D.mkT>0?D.mkT:0,1);const a=D.rf?D.rfT>0?1-D.rfT/D.rfI:1:0;D.rf&&t(118,"#a8b8ff",a,1,D.rfT>0?D.rfT:0,2),D.cat&&(e.fillStyle="rgba(7,10,16,.75)",e.fillRect(P-56,78,50,20),e.fillStyle="#dce8ff",e.font="600 10px Trebuchet MS,sans-serif",e.fillText(rt(),P-50,91))}if(g.msgT>0&&(e.fillStyle="rgba(8,12,19,.74)",e.fillRect(14,I+30,l-28,28),e.fillStyle="#d7ffe8",e.font="600 13px Trebuchet MS,sans-serif",e.fillText(g.msg,22,I+49)),g.bossDownT>0){const t=V(g.bossDownT/2.4,0,1),s=.96+.08*Math.sin(18*g.t)*t,n=.5*l,r=.52*a;e.fillStyle="rgba(7,10,16,"+(.2+.26*t)+")",e.fillRect(0,0,l,a),e.save(),e.translate(n,r),e.scale(s,s),e.translate(-n,-r),e.textAlign="center",e.fillStyle="rgba(255,227,143,"+(.44+.4*t)+")",e.font=(l<520?"700 30px":"700 40px")+" Trebuchet MS,sans-serif",e.fillText("BOSS DOWN",n,r-8),e.fillStyle="rgba(209,231,255,"+(.58+.32*t)+")",e.font=(l<520?"600 13px":"600 15px")+" Trebuchet MS,sans-serif",e.fillText("something big is approaching...",n,r+20),e.restore(),e.textAlign="left"}if(g.start&&!g.dead&&!g.lvup&&!g.pz&&q.show>.01){const t=q.x+q.tx,l=q.y+q.ty;e.fillStyle="rgba(7,11,17,"+.42*q.show+")",e.beginPath(),e.arc(q.x,q.y,q.r+8,0,2*Math.PI),e.fill(),e.strokeStyle="rgba(158,200,255,"+.45*q.show+")",e.lineWidth=2,e.beginPath(),e.arc(q.x,q.y,q.r,0,2*Math.PI),e.stroke(),e.fillStyle="rgba(105,240,201,"+(H?.65:.42)*q.show+")",e.beginPath(),e.arc(t,l,q.kr,0,2*Math.PI),e.fill(),e.strokeStyle="rgba(220,248,255,"+.65*q.show+")",e.lineWidth=1.5,e.beginPath(),e.arc(t,l,q.kr,0,2*Math.PI),e.stroke()}if(!g.start){const t=20,s=.16*a,n=l-40,r=.68*a,i=t+16;e.fillStyle="rgba(6,9,14,.86)",e.fillRect(t,s,n,r),e.fillStyle="#fff",e.font="700 30px Trebuchet MS,sans-serif",e.fillText("Project: Zoomies",i,s+42),e.fillStyle="#9ec8ff",e.font="600 15px Trebuchet MS,sans-serif",e.fillText("what the dog doing?",i,s+64),e.fillStyle="#d8e6ff",e.font="600 14px Trebuchet MS,sans-serif",Q("Goop swallowed CMU paths. People are trapped inside buildings. Scotty is the only one fast enough to move across campus.",i,s+98,n-32,18,5),e.fillStyle="#9ec8ff",e.font="600 13px Trebuchet MS,sans-serif",Q("Collaborate with each school lab to keep evacuation routes open and push back the goop across campus.",i,s+200,n-32,17,3),e.fillStyle="#dce8ff",e.font="600 12px Trebuchet MS,sans-serif",Q("Controls: drag to move. Remove finger to charge Zoomies, then move to dash. Scotty also marks his territory with pee puddles that slow enemies and protect escape lanes.",i,s+250,n-32,16,4),e.fillStyle="#69f0c9",e.font="700 23px Trebuchet MS,sans-serif",e.fillText("tap start",i,s+r-22)}if(g.lvup&&!g.dead){e.fillStyle="rgba(6,10,15,.16)",e.fillRect(0,0,l,a);const t=Z(),s=t.bx,n=t.by,r=t.bw,i=t.bh,o=t.rects,h=t.mobile;e.fillStyle="rgba(17,29,45,.95)",U(s,n,r,i,16),e.fill(),e.strokeStyle="rgba(90,125,163,.8)",e.lineWidth=1.2,U(s+.5,n+.5,r-1,i-1,16),e.stroke(),e.fillStyle="#ecf3ff",e.font=(h?"700 18px":"700 20px")+" Trebuchet MS,sans-serif",e.fillText("SKILL BOOK",s+14,n+24),e.fillStyle="#9ec8ff",e.font="600 12px Trebuchet MS,sans-serif",e.fillText("choose",s+14,n+39);for(let t=0;t<3;t++){const l=g.choices[t],a=o[t],s=.9+.1*K(V((g.cardT-.07*t)/.28,0,1)),n=a.x+.5*a.w,r=a.y+.5*a.h;e.save(),e.translate(n,r),e.scale(s,s),e.translate(-n,-r);const i=l&&l.bg?l.bg:"rgba(27,44,66,.96)",f=l&&l.st?l.st:"rgba(116,150,186,.85)",c=l&&l.tx?l.tx:"#eef5ff",m=l&&l.sub?l.sub:"#a9c3e2";if(e.fillStyle=i,U(a.x,a.y,a.w,a.h,10),e.fill(),e.strokeStyle=f,e.lineWidth=1.2,U(a.x+.5,a.y+.5,a.w-1,a.h-1,10),e.stroke(),l){const t=j(l.n)+" "+l.n;let s=h?16:17;for(;s>12&&(e.font="700 "+s+"px Trebuchet MS,sans-serif",!(e.measureText(t).width<=a.w-22));s--);e.fillStyle=c,e.fillText(t,a.x+12,a.y+30),e.fillStyle=m,e.font="600 12px Trebuchet MS,sans-serif",Q(l.d,a.x+12,a.y+48,a.w-24,14,2)}e.restore()}e.fillStyle="#95bce8",e.font="600 12px Trebuchet MS,sans-serif",e.fillText("tap 1/2/3",s+14,n+i-12)}if(g.pz&&!g.dead&&!g.lvup&&g.start){const t=et(),s=g.pz;if(e.fillStyle="rgba(5,9,14,.5)",e.fillRect(0,0,l,a),e.fillStyle="rgba(16,24,37,.96)",U(t.bx,t.by,t.bw,t.bh,14),e.fill(),e.strokeStyle="rgba(106,145,185,.85)",e.lineWidth=1.2,U(t.bx+.5,t.by+.5,t.bw-1,t.bh-1,14),e.stroke(),e.fillStyle="#ecf3ff",e.font="700 19px Trebuchet MS,sans-serif",e.fillText("nsh"===s.id?"NSH lab":"Mellon lab",t.bx+14,t.by+27),"nsh"===s.id){e.fillStyle="#dce8ff",e.font="600 12px Trebuchet MS,sans-serif",e.fillText("order",t.bx+14,t.by+66);for(let l=0;l<s.seq.length;l++){const a=t.bx+24+34*l,n=t.by+86,r=l<s.step;e.fillStyle=r?"#8cffc2":"#79d7ff",e.beginPath(),e.arc(a,n,12,0,2*Math.PI),e.fill(),e.fillStyle="#12243a",e.font="700 11px Trebuchet MS,sans-serif",e.fillText(s.seq[l]+1+"",a-3,n+4)}}else{const l=["#8fd3ff","#ffd58f","#ff9fb7"];e.fillStyle="#dce8ff",e.font="600 12px Trebuchet MS,sans-serif",e.fillText("mix",t.bx+14,t.by+66);for(let a=0;a<s.seq.length;a++){const n=t.bx+24+30*a,r=t.by+86,i=a<s.step;e.fillStyle=l[s.seq[a]],e.beginPath(),e.arc(n,r,10,0,2*Math.PI),e.fill(),i&&(e.strokeStyle="#8cffc2",e.lineWidth=2,e.beginPath(),e.arc(n,r,12,0,2*Math.PI),e.stroke())}}for(let l=0;l<3;l++){const a=t.btn[l];e.fillStyle="nsh"===s.id?"rgba(37,87,129,.96)":["#3c6588","#9a6f3f","#8e4f64"][l],U(a.x,a.y,a.w,a.h,10),e.fill(),e.strokeStyle="rgba(196,223,255,.72)",e.lineWidth=1.1,U(a.x+.5,a.y+.5,a.w-1,a.h-1,10),e.stroke(),e.fillStyle="#eef5ff",e.font="700 13px Trebuchet MS,sans-serif",e.fillText("nsh"===s.id?"terminal "+(l+1):["blue","amber","rose"][l],a.x+9,a.y+28)}e.fillStyle="#9ec8ff",e.font="600 11px Trebuchet MS,sans-serif",e.fillText("tap 1/2/3",t.bx+14,t.by+t.bh-10)}if(g.dead){if(e.fillStyle="rgba(5,8,13,.86)",e.fillRect(24,.24*a,l-48,.5*a),e.fillStyle="#ff8298",e.font="700 33px Trebuchet MS,sans-serif",e.fillText("GAME OVER",.5*l-98,.38*a),e.fillStyle="#dce8ff",e.font="600 20px Trebuchet MS,sans-serif",e.fillText("Kills "+g.kills,.5*l-43,.47*a),e.fillText("Best "+g.best,.5*l-37,.53*a),e.fillStyle="#9ec8ff",e.font="600 13px Trebuchet MS,sans-serif",e.fillText("Top 3 global",.5*l-40,.58*a),e.fillStyle="#dce8ff",e.font="600 12px Trebuchet MS,sans-serif",g.lbTop.length)for(let t=0;t<g.lbTop.length&&t<3;t++){const s=g.lbTop[t],n=.605*a+16*t;e.fillText(t+1+". "+s.name+"  "+s.kills+" / "+Number(s.time_seconds).toFixed(1)+"s",.5*l-88,n)}else e.fillText(g.lbTopErr||"loading leaderboard...",.5*l-70,.605*a);e.fillStyle="#9de6ff",e.font="600 12px Trebuchet MS,sans-serif",e.fillText(g.lbRankText||g.lbRankErr||"checking your rank...",.5*l-88,.655*a),e.fillStyle="#69f0c9",e.font="700 20px Trebuchet MS,sans-serif",e.fillText("tap retry (anywhere)",.5*l-98,.695*a);const t=Math.min(210,l-90),s=34,n=.5*(l-t),r=.72*a;g.lbBtnX=n,g.lbBtnY=r,g.lbBtnW=t,g.lbBtnH=s,e.fillStyle="rgba(19,38,58,.95)",U(n,r,t,s,10),e.fill(),e.strokeStyle="rgba(130,190,255,.9)",e.lineWidth=1.4,U(n+.5,r+.5,t-1,s-1,10),e.stroke(),e.fillStyle="#9de6ff",e.font="700 15px Trebuchet MS,sans-serif",e.fillText("open leaderboard",n+40,r+22)}}(),requestAnimationFrame(t)})})();</script></body></html>