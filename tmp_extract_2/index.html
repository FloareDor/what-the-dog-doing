<!doctype html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover"><title>Scotty Survival</title><style>:root{--bg:#0a0d12;--sky:#1a2940;--ink:#ecf3ff;--red:#ef4f6c;--mint:#69f0c9;--gold:#ffd56d;--line:#2f4868}*{box-sizing:border-box}html,body{margin:0;width:100%;height:100%;overflow:hidden;background:var(--bg);color:var(--ink);font-family:Trebuchet MS,Avenir Next,Segoe UI,sans-serif}body{touch-action:none}canvas{display:block;width:100%;height:100%}</style></head><body><canvas id="c"></canvas><script>(()=>{const t=document.getElementById("c"),e=t.getContext("2d");let l=360,n=740,i=1,a=0;const s=1300,r=[{id:"nsh",n:"newell-simon hall",x:980,y:280,r:170,c:"#79d7ff"},{id:"mel",n:"mellon institute",x:2100,y:1260,r:185,c:"#ffd58f"}],o=[{id:"home",n:"home base",x:260,y:900,r:170,c:"#8ec0ff"},{id:"nsh",n:"newell-simon hall",x:980,y:280,r:170,c:"#79d7ff"},{id:"mel",n:"mellon institute",x:2100,y:1260,r:185,c:"#ffd58f"}],f={};function h(t){const e=new Image;return e.src="black_scottish_terrier_dog_with_red_scarf/rotations/"+t+".png",e}f.e=h("east"),f.w=h("west"),f.ne=h("north-east"),f.nw=h("north-west"),f.se=h("south-east"),f.sw=h("south-west");let c=0;function d(t,e,l,n){if(!c)return;const i=c.createOscillator(),a=c.createGain();i.type=l||"triangle",i.frequency.value=t,a.gain.value=n||.02,a.gain.exponentialRampToValueAtTime(1e-4,c.currentTime+e),i.connect(a).connect(c.destination),i.start(),i.stop(c.currentTime+e)}let m=0,x="sound/whatthedogdoin.mp3",y=0;function p(){if(!g.start)return;const t=performance.now();if(!(t-y<1200)){y=t;try{m||(m=new Audio(x),m.volume=.56,m.preload="auto",m.onerror=()=>{x.indexOf("../src/")<0&&(x="../src/sound/whatthedogdoin.mp3",m=0)}),m.currentTime=0,m.play().catch(()=>{})}catch{}}}const g={start:0,dead:0,lvup:0,t:0,time:0,kills:0,spawnT:0,nextSpawn:.8,msg:"",msgT:0,midSeen:0,level:1,xp:0,nextXp:24,stop:0,shake:0,xpPulse:0,cardT:0,best:+localStorage.ss_best||0,choices:[],homeNeed:6,homeGot:0,sch:{nsh:0,mel:0},pz:0,nshSeen:0,melSeen:0},u={x:260,y:900,vx:0,vy:0,r:15,hp:100,maxHp:100,speed:185,fireCd:0,fireRate:.46,dmg:12,range:560,shots:1,magnet:88,face:1,rx:0,ry:0,flash:0,gx:1,gy:0,zc:0,zr:0,zt:0,zx:1,zy:0,zcd:0,zDur:1,zSpd:2.1,zLoad:1.5,zCool:5.5,zDmg:24,zDr:.55,mkOn:0,mkT:0,mkI:8.8,mkS:0,mkD:14,mkR:54,mkSl:.5,chDo:14,chBurst:10,cat:0,catM:0,bot:0,bx:0,by:0,ba:0,bcd:0},b={l:0,r:0,u:0,d:0,gr:0};let M=-1,S=0;const T={x:78,y:0,r:42,kr:16,tx:0,ty:0,ax:0,ay:0},k=[],z=[],v=[],P=[],w=[];function I(t,e){return t+Math.random()*(e-t)}function R(t,e,l){return t<e?e:t>l?l:t}function q(t){const e=t-1;return 1+2.70158*e*e*e+1.70158*e*e}function C(t,l,n,i,a){const s=Math.max(0,Math.min(a,.5*Math.min(n,i)));e.beginPath(),e.moveTo(t+s,l),e.lineTo(t+n-s,l),e.quadraticCurveTo(t+n,l,t+n,l+s),e.lineTo(t+n,l+i-s),e.quadraticCurveTo(t+n,l+i,t+n-s,l+i),e.lineTo(t+s,l+i),e.quadraticCurveTo(t,l+i,t,l+i-s),e.lineTo(t,l+s),e.quadraticCurveTo(t,l,t+s,l),e.closePath()}function D(){const t=l<560,e=t?l-14:Math.min(l-20,620),i=t?R(.48*n,296,390):R(.4*n,268,340),a=.5*(l-e),s=n-i-12,r=[];if(t){const t=8,l=e-22,n=Math.max(74,Math.min(100,(i-84-2*t)/3)),o=s+50;for(let e=0;e<3;e++)r.push({x:a+14,y:o+e*(n+t),w:l,h:n})}else{const t=10,l=(e-32-2*t)/3,n=Math.max(102,Math.min(130,i-82)),o=s+52;for(let e=0;e<3;e++)r.push({x:a+16+e*(l+t),y:o,w:l,h:n})}return{mobile:t,bx:a,by:s,bw:e,bh:i,rects:r}}function A(t,l,n,i,a,s){const r=t.split(" ");let o="",f=0;for(let t=0;t<r.length;t++){const h=o?o+" "+r[t]:r[t];if(e.measureText(h).width<=i)o=h;else{if(e.fillText(o,l,n+f*a),f++,f>=s)return;o=r[t]}}f<s&&o&&e.fillText(o,l,n+f*a)}function L(t){return t.includes("Chemical")?"ðŸ§ª":t.includes("Zoomies")?"âš¡":t.includes("Territory")?"ðŸ’§":t.includes("Rapid Fire")?"ðŸ”¥":t.includes("Big Bites")?"ðŸ¦·":t.includes("Speed Paws")?"ðŸ’¨":t.includes("Extra Shot")?"ðŸŽ¯":t.includes("Long Reach")?"ðŸ“¡":t.includes("Snack Magnet")?"ðŸ§²":t.includes("Tough Fur")?"ðŸ›¡ï¸":t.includes("Quick Heal")?"ðŸ’š":"â­"}function O(t){for(let e=0;e<r.length;e++)if(r[e].id===t)return r[e];return 0}function W(t,e,l){const n=l||0;for(let l=0;l<o.length;l++){const i=o[l],a=t-i.x,s=e-i.y;if(a*a+s*s<(i.r+n)*(i.r+n))return i}return 0}function E(t,e){const l=e||0;let n=0;for(let e=0;e<o.length;e++){const i=o[e];let a=t.x-i.x,s=t.y-i.y,r=Math.hypot(a,s)||1;const f=i.r+l;if(r<f){if(r<.001){const t=Math.random()*Math.PI*2;a=Math.cos(t),s=Math.sin(t),r=1}t.x=i.x+a/r*f,t.y=i.y+s/r*f,n=1}}return n}function K(){const t=Math.min(l-24,420),e=Math.min(n-130,260),i=.5*(l-t),a=.5*(n-e)+24,s=(t-36-20)/3,r=a+e-72;return{bx:i,by:a,bw:t,bh:e,btn:[{x:i+18,y:r,w:s,h:46},{x:i+18+s+10,y:r,w:s,h:46},{x:i+18+2*(s+10),y:r,w:s,h:46}]}}function X(t){if(!g.pz)if("nsh"===t){const t=3*Math.random()|0,e=(t+1+(2*Math.random()|0))%3,l=(t+2)%3;g.pz={id:"nsh",seq:[t,e,l],step:0},g.msg="nsh puzzle: reconnect terminals",g.msgT=1.2}else"mel"===t&&(g.pz={id:"mel",seq:[3*Math.random()|0,3*Math.random()|0,3*Math.random()|0,3*Math.random()|0],step:0},g.msg="mellon puzzle: mix safe reagent order",g.msgT=1.2)}function B(t){if(!g.pz)return;const e=g.pz;if(t===e.seq[e.step]){if(e.step++,d(620+70*e.step,.04,"triangle",.018),e.step>=e.seq.length){const t=e.id;g.pz=0,function(t){"nsh"===t&&2!==g.sch.nsh?(g.sch.nsh=2,u.bot=1,u.bx=u.x+20,u.by=u.y+4,u.bcd=.25,g.msg="robotics online: bot buddy unlocked",g.msgT=2.1,F(.12),J(u.x,u.y,"#79d7ff",16,95),d(760,.07,"square",.024)):"mel"===t&&2!==g.sch.mel&&(g.sch.mel=2,u.cat=1,u.catM=0,g.msg="chemistry online: chemical puddles unlocked",g.msgT=2.1,F(.12),J(u.x,u.y,"#ffd58f",16,95),d(720,.07,"square",.024))}(t)}}else e.step=0,F(.03),d(180,.06,"square",.02),g.msg="wrong input, retry",g.msgT=.55}function Y(t){"nsh"===t&&0===g.sch.nsh?(g.sch.nsh=1,p(),X("nsh"),g.msg="nsh mission started",g.msgT=1.4,d(640,.05,"triangle",.02)):"mel"===t&&0===g.sch.mel&&(g.sch.mel=1,p(),X("mel"),g.msg="mellon mission started",g.msgT=1.4,d(680,.05,"triangle",.02))}function H(){u.cat&&(u.catM=1-u.catM,g.msg="chemical mode: "+(u.catM?"corrosive":"sticky"),g.msgT=.95,d(u.catM?520:460,.04,"triangle",.02))}function F(t){g.shake=R(g.shake+t,0,1.3)}function G(t){g.stop=Math.max(g.stop,t)}function _(){i=Math.max(1,Math.min(2,devicePixelRatio||1)),l=Math.max(320,0|innerWidth),n=Math.max(560,0|innerHeight),t.width=l*i|0,t.height=n*i|0,e.setTransform(i,0,0,i,0,0),e.imageSmoothingEnabled=!1,T.y=n-88}function Z(t,e){const l=t-T.x,n=e-T.y;return l*l+n*n<1.8*T.r*(1.8*T.r)}function U(t,e){let l=t-T.x,n=e-T.y;const i=Math.hypot(l,n)||1,a=T.r;i<10?(l=0,n=0):i>a&&(l=l/i*a,n=n/i*a),T.tx=l,T.ty=n,T.ax=l/a,T.ay=n/a}function V(){T.tx=0,T.ty=0,T.ax=0,T.ay=0}function N(t){w.length>=420||w.push(t)}function Q(t){v.length>=260||v.push(t)}function j(t){z.length>=260||z.push(t)}function J(t,e,l,n,i){const a=k.length>130?.5:k.length>90?.7:1,s=Math.max(1,n*a|0);for(let n=0;n<s;n++){const n=Math.random()*Math.PI*2,a=(i||70)*(.4+Math.random());N({x:t,y:e,vx:Math.cos(n)*a,vy:Math.sin(n)*a,t:I(.2,.6),c:l})}}function $(t,e,l,n,i){const a=k[t],s=!!i;g.kills++,s?J(a.x,a.y,e||"#ff9675",Math.max(2,.35*(l||9)|0),Math.max(20,.6*(n||70))):(G(.03),F(.08),J(a.x,a.y,e||"#ff9675",l||9,n||70),d(280,.03,"square",.012));const r=260-v.length;if(r>0){const t=s?Math.random()<.25?1:0:1+(Math.random()<.4?1:0);for(let e=0;e<Math.min(t,r);e++)Q({x:a.x+I(-7,7),y:a.y+I(-7,7),v:0|I(5,8),m:1,t:0})}k.splice(t,1)}function tt(t){if(g.dead=0,g.lvup=0,g.t=0,g.time=0,g.spawnT=0,g.nextSpawn=.8,g.kills=0,g.msg="",g.msgT=0,g.midSeen=0,g.level=1,g.xp=0,g.nextXp=24,g.stop=0,g.shake=0,g.xpPulse=0,g.cardT=0,g.choices=[],g.homeGot=0,g.sch.nsh=0,g.sch.mel=0,g.pz=0,g.nshSeen=0,g.melSeen=0,u.x=260,u.y=900,u.vx=0,u.vy=0,u.hp=100,u.maxHp=100,u.speed=185,u.fireCd=0,u.fireRate=.46,u.dmg=12,u.range=560,u.shots=1,u.magnet=88,u.face=1,u.rx=0,u.ry=0,u.flash=0,u.gx=1,u.gy=0,u.zc=0,u.zr=0,u.zt=0,u.zx=1,u.zy=0,u.zcd=0,u.zDur=1,u.zSpd=2.1,u.zLoad=1.5,u.zCool=5.5,u.zDmg=24,u.zDr=.55,u.mkOn=0,u.mkT=0,u.mkI=8.8,u.mkS=0,u.mkD=14,u.mkR=54,u.mkSl=.5,u.chDo=14,u.chBurst=10,u.cat=0,u.catM=0,u.bot=0,u.bx=u.x+20,u.by=u.y+4,u.ba=0,u.bcd=.2,k.length=0,z.length=0,v.length=0,P.length=0,w.length=0,b.l=b.r=b.u=b.d=b.gr=0,S=0,V(),g.msg="home base: unlock territory first",g.msgT=1.6,t){for(let t=0;t<24;t++)Q({x:s+I(-120,120),y:900+I(-120,120),v:7,m:1,t:0});for(let t=0;t<10;t++)Q({x:330+58*t,y:900+I(-60,60),v:5,m:1,t:0})}}function et(t){for(g.xp+=t;g.xp>=g.nextXp;){g.xp-=g.nextXp,g.level++,g.nextXp=1.36*g.nextXp+9|0,nt(),g.lvup=1,g.cardT=0,g.xpPulse=.65,g.msg="Level up! Open the skill book",g.msgT=2.1,G(.06),F(.2),d(860,.08,"triangle",.03);break}}const lt=[{n:"Rapid Fire",d:"Shoot faster",f:()=>u.fireRate=Math.max(.15,.84*u.fireRate),req:()=>1},{n:"Big Bites",d:"+6 damage",f:()=>u.dmg+=6,req:()=>1},{n:"Speed Paws",d:"+24 move speed",f:()=>u.speed+=24,req:()=>1},{n:"Extra Shot",d:"+1 bullet",f:()=>u.shots=Math.min(5,u.shots+1),req:()=>1},{n:"Long Reach",d:"+120 range",f:()=>u.range+=120,req:()=>1},{n:"Snack Magnet",d:"+30 pickup radius",f:()=>u.magnet+=30,req:()=>1},{n:"Tough Fur",d:"+25 max hp",f:()=>{u.maxHp+=25,u.hp=Math.min(u.maxHp,u.hp+25)},req:()=>1},{n:"Quick Heal",d:"Heal 35 hp",f:()=>u.hp=Math.min(u.maxHp,u.hp+35),req:()=>1},{n:"Zoomies Time",d:"+0.25s zoomies",f:()=>u.zDur=Math.min(2.6,u.zDur+.25),req:()=>1},{n:"Zoomies CD",d:"-0.7s cooldown",f:()=>u.zCool=Math.max(1.4,u.zCool-.7),req:()=>1},{n:"Zoomies Speed",d:"+0.35x dash speed",f:()=>u.zSpd=Math.min(4,u.zSpd+.35),req:()=>1},{n:"Zoomies Charge",d:"-0.2s load time",f:()=>u.zLoad=Math.max(.55,u.zLoad-.2),req:()=>1},{n:"Territory CD",d:"-0.55s marking cooldown",f:()=>u.mkI=Math.max(3.2,u.mkI-.55),req:()=>u.mkOn},{n:"Territory Radius",d:"+12 puddle radius",f:()=>u.mkR=Math.min(110,u.mkR+12),req:()=>u.mkOn},{n:"Territory Duration",d:"+4s puddle life",f:()=>u.mkD=Math.min(40,u.mkD+4),req:()=>u.mkOn},{n:"Territory Slow",d:"+10% puddle slow",f:()=>u.mkSl=Math.min(.88,u.mkSl+.1),req:()=>u.mkOn},{n:"Chemical Puddle",d:"+6 chem dps and +4 burst",f:()=>{u.chDo=Math.min(58,u.chDo+6),u.chBurst=Math.min(42,u.chBurst+4)},req:()=>u.cat},{n:"Chemical Radius",d:"+10 puddle radius",f:()=>u.mkR=Math.min(120,u.mkR+10),req:()=>u.cat},{n:"Chemical Tempo",d:"-0.45s territory cooldown",f:()=>u.mkI=Math.max(2.6,u.mkI-.45),req:()=>u.cat}];function nt(){const t=lt.filter(t=>!t.req||t.req());g.choices=[];for(let e=0;e<3&&t.length;e++){const e=Math.random()*t.length|0;g.choices.push(t[e]),t.splice(e,1)}}function it(t){g.lvup&&g.choices[t]&&(g.choices[t].f(),g.lvup=0,g.msg=g.choices[t].n+" applied",g.msgT=1.4,g.xpPulse=.25,F(.08),J(u.x,u.y,"#69f0c9",12,90))}function at(){c||(c=new(window.AudioContext||window.webkitAudioContext)),g.start||(g.start=1,tt(1),d(430,.05,"triangle",.02))}function st(e){M===e.pointerId&&(S=0,V(),t.hasPointerCapture(M)&&t.releasePointerCapture(M),M=-1)}addEventListener("resize",_),addEventListener("keydown",function(t){const e=t.code;if("Space"!==e&&"ArrowUp"!==e&&"ArrowDown"!==e&&"ArrowLeft"!==e&&"ArrowRight"!==e||t.preventDefault(),"Space"!==e&&"Enter"!==e||at(),g.dead&&("Space"===e||"Enter"===e||"KeyR"===e))return tt(1),void d(360,.05,"triangle",.02);g.lvup?"Digit1"===e?it(0):"Digit2"===e?it(1):"Digit3"===e&&it(2):g.pz?"Digit1"===e?B(0):"Digit2"===e?B(1):"Digit3"===e&&B(2):g.start&&!g.dead&&("KeyQ"!==e?"KeyA"===e||"ArrowLeft"===e?b.l=1:"KeyD"===e||"ArrowRight"===e?b.r=1:"KeyW"===e||"ArrowUp"===e?b.u=1:"KeyS"===e||"ArrowDown"===e?b.d=1:"KeyE"!==e&&"ShiftLeft"!==e&&"ShiftRight"!==e||(b.gr=1):H())}),addEventListener("keyup",function(t){const e=t.code;"KeyA"===e||"ArrowLeft"===e?b.l=0:"KeyD"===e||"ArrowRight"===e?b.r=0:"KeyW"===e||"ArrowUp"===e?b.u=0:"KeyS"===e||"ArrowDown"===e?b.d=0:"KeyE"!==e&&"ShiftLeft"!==e&&"ShiftRight"!==e||(b.gr=0)}),t.addEventListener("pointerdown",function(e){if(!(M>=0&&M!==e.pointerId)){if(M=e.pointerId,t.setPointerCapture(M),at(),g.dead)return tt(1),void d(360,.05,"triangle",.02);if(g.lvup)!function(t,e){if(!g.lvup)return;const l=D().rects;for(let n=0;n<l.length;n++){const i=l[n];if(t>=i.x&&t<=i.x+i.w&&e>=i.y&&e<=i.y+i.h){it(n);break}}}(e.clientX,e.clientY);else{if(g.pz){const t=K();for(let l=0;l<3;l++){const n=t.btn[l];if(e.clientX>=n.x&&e.clientX<=n.x+n.w&&e.clientY>=n.y&&e.clientY<=n.y+n.h)return void B(l)}return}g.start&&!g.dead&&u.cat&&function(t,e){const n=l-18-44;return t>=n&&t<=n+44&&e>=66&&e<=110}(e.clientX,e.clientY)?H():Z(e.clientX,e.clientY)&&(S=1,U(e.clientX,e.clientY))}}},{passive:1}),t.addEventListener("pointermove",function(t){M!==t.pointerId||!g.start||g.dead||g.lvup||(S||Z(t.clientX,t.clientY))&&(S=1,U(t.clientX,t.clientY))},{passive:1}),t.addEventListener("pointerup",st,{passive:1}),t.addEventListener("pointercancel",st,{passive:1}),_(),tt(1),requestAnimationFrame(function t(r){a||(a=r);let h=.001*(r-a);a=r,h=Math.max(0,Math.min(.034,h)),function(t){const e=t;g.msgT>0&&(g.msgT-=e),g.stop>0&&(g.stop=Math.max(0,g.stop-e),t*=.06),g.shake>0&&(g.shake=Math.max(0,g.shake-2.2*e)),g.xpPulse>0&&(g.xpPulse=Math.max(0,g.xpPulse-1.7*e)),u.flash>0&&(u.flash=Math.max(0,u.flash-7*e)),u.rx*=Math.max(0,1-18*e),u.ry*=Math.max(0,1-18*e),u.zcd>0&&(u.zcd=Math.max(0,u.zcd-e)),u.mkS>0&&(u.mkS=Math.max(0,u.mkS-e)),u.mkT>0&&u.zt<=0&&(u.mkT=Math.max(0,u.mkT-e));for(let e=P.length-1;e>=0;e--){const l=P[e];l.t-=t,l.t<=0&&P.splice(e,1)}for(let e=w.length-1;e>=0;e--){const l=w[e];l.t-=t,l.x+=l.vx*t,l.y+=l.vy*t,l.vy+=480*t,l.t<=0&&w.splice(e,1)}if(!g.start||g.dead)return;if(g.lvup)return void(g.cardT=Math.min(.9,g.cardT+e));if(g.pz)return void(g.t+=t);g.t+=t,g.time+=t,!g.midSeen&&Math.hypot(u.x-s,u.y-900)<200&&(g.midSeen=1,g.msg='"what the dog doing?" by some human.',g.msgT=3.2,d(520,.05,"triangle",.02));const l=O("nsh"),n=O("mel");u.mkOn&&0===g.sch.nsh&&Math.hypot(u.x-l.x,u.y-l.y)<l.r&&Y("nsh"),2===g.sch.nsh&&0===g.sch.mel&&Math.hypot(u.x-n.x,u.y-n.y)<n.r&&Y("mel");const i=(b.r?1:0)-(b.l?1:0),a=(b.d?1:0)-(b.u?1:0),r=Math.hypot(T.ax,T.ay);let o=i,f=a;S&&r>.12&&(o+=T.ax,f+=T.ay);let h=Math.hypot(o,f);h>1&&(o/=h,f/=h);const c=(Math.hypot(i,a)>.05||S&&r>.12)&&u.mkS<=0;if(u.mkOn&&u.mkT<=0&&u.mkS<=0&&u.zt<=0&&u.zr<=0&&u.zc<=0&&(P.length>=18&&P.shift(),P.push({x:u.x+4*u.gx,y:u.y+8,r:u.mkR,t:u.mkD,d:u.mkD,m:u.cat?u.catM:0}),u.mkS=.32,u.mkT=u.mkI,g.msg="Territory marked",g.msgT=.7,G(.02),F(.05),J(u.x,u.y+8,"#ffd56d",10,46),d(560,.04,"triangle",.02)),u.zt<=0)if(!c&&u.zcd<=0&&u.mkS<=0){if(u.zc=Math.min(u.zLoad,u.zc+t),u.zc>.25){const e=u.zc/u.zLoad;u.rx+=.9*(2*Math.random()-1)*e*60*t,u.ry+=.9*(2*Math.random()-1)*e*60*t,F(7e-4*e*60*t)}u.zc>=u.zLoad&&!u.zr&&(u.zr=1,g.msg="Zoomies ready: push to dash",g.msgT=1.1,F(.08),d(760,.05,"triangle",.024))}else if(u.zr){u.zt=u.zDur,u.zr=0,u.zc=0;const t=h||1;u.zx=o/t,u.zy=f/t,G(.04),F(.28),u.flash=.09,u.gx=u.zx,u.gy=u.zy,J(u.x,u.y,"#9dffea",18,120),d(980,.06,"square",.028)}else u.zc=0;if(u.zt>0){if(u.zt=Math.max(0,u.zt-t),c){u.zx=.85*u.zx+.15*o,u.zy=.85*u.zy+.15*f;const t=Math.hypot(u.zx,u.zy)||1;u.zx/=t,u.zy/=t}u.vx=u.zx*u.speed*u.zSpd,u.vy=u.zy*u.speed*u.zSpd,u.face=u.vx>=0?1:-1,u.rx-=8*u.zx*t*60,u.ry-=6*u.zy*t*60,Math.random()<.65&&N({x:u.x-I(-6,6),y:u.y-I(-6,6),vx:.12*-u.vx+I(-35,35),vy:.12*-u.vy+I(-35,35),t:I(.1,.25),c:"#8fffe5"}),u.zt<=0&&(u.zcd=u.zCool,g.msg="Zoomies cooling...",g.msgT=.65,d(420,.04,"triangle",.016))}else u.vx=o*u.speed,u.vy=f*u.speed,Math.abs(u.vx)>.5&&(u.face=u.vx>0?1:-1),u.mkS>0&&(u.vx=0,u.vy=0,u.rx+=.5*Math.sin(45*g.t),Math.random()<.7&&N({x:u.x+I(-5,5),y:u.y+10+I(-3,3),vx:I(-14,14),vy:I(6,30),t:I(.12,.26),c:"#ffd56d"}));u.x=R(u.x+u.vx*t,12,2588),u.y=R(u.y+u.vy*t,12,1788);const m=W(u.x,u.y,-6);if(u.bot){u.ba+=2.3*t;const e=u.x+34*Math.cos(u.ba),l=u.y+20*Math.sin(1.17*u.ba);if(u.bx+=(e-u.bx)*Math.min(1,8*t),u.by+=(l-u.by)*Math.min(1,8*t),m||(u.bcd-=t),!m&&u.bcd<=0){let t=0,e=184900;for(let l=0;l<k.length;l++){const n=k[l],i=n.x-u.bx,a=n.y-u.by,s=i*i+a*a;s<e&&(e=s,t=n)}if(t){const e=Math.hypot(t.x-u.bx,t.y-u.by)||1;j({x:u.bx,y:u.by,vx:(t.x-u.bx)/e*540,vy:(t.y-u.by)/e*540,d:.55*u.dmg,life:.9,pier:0,c:"#9de6ff"}),u.bcd=.5}else u.bcd=.2}}u.fireCd-=t,!m&&u.fireCd<=0&&(u.fireCd=u.fireRate,function(){const t=function(){let t=0,e=1e9;for(let l=0;l<k.length;l++){const n=k[l],i=n.x-u.x,a=n.y-u.y,s=i*i+a*a;s<e&&(e=s,t=n)}return t}();if(!t)return;let e=t.x-u.x,l=t.y-u.y,n=Math.hypot(e,l)||1;if(n>u.range)return;e/=n,l/=n;const i=u.shots;for(let t=0;t<i;t++){const n=1===i?0:.18*(t-(i-1)/2),a=Math.cos(n),s=Math.sin(n),r=e*a-l*s,o=e*s+l*a;j({x:u.x,y:u.y,vx:520*r,vy:520*o,d:u.dmg,life:1.05,pier:1})}u.gx=e,u.gy=l,u.rx-=6*e,u.ry-=4*l,u.flash=.07,u.face=e>=0?1:-1,J(u.x+16*e,u.y+10*l,"#ffd56d",3,35),F(.025),d(640,.04,"square",.018)}()),g.spawnT-=t,g.spawnT<=0&&(g.spawnT=g.nextSpawn,g.nextSpawn=Math.max(.22,.9-.012*g.time),function(){if(k.length>=180)return;const t=Math.random()*Math.PI*2,e=I(360,560),l=1+.045*g.time,n=22+8*l+I(-4,8),i=56+6*l+I(-6,10);let a=R(u.x+Math.cos(t)*e,20,2580),s=R(u.y+Math.sin(t)*e,20,1780);const r=W(a,s,10);if(r){const t=a-r.x,e=s-r.y,l=Math.hypot(t,e)||1;a=r.x+t/l*(r.r+18),s=r.y+e/l*(r.r+18)}k.push({x:a,y:s,r:I(12,18),hp:n,s:i,dmg:8+.9*l,vx:0,vy:0,ht:0,sl:0,ce:0,bm:0,bt:0,bi:""})}());for(let e=z.length-1;e>=0;e--){const l=z[e];if(l.life-=t,l.x+=l.vx*t,l.y+=l.vy*t,l.life<=0||l.x<-20||l.y<-20||l.x>2620||l.y>1820)z.splice(e,1);else for(let t=k.length-1;t>=0;t--){const n=k[t],i=n.x-l.x,a=n.y-l.y;if(i*i+a*a<(n.r+3)*(n.r+3)&&(n.hp-=l.d,n.ht=.09,n.vx+=.07*l.vx,n.vy+=.07*l.vy,l.pier--,n.hp<=0&&$(t,"#ff9675",9,70),l.pier<0)){z.splice(e,1);break}}}let x=0,y=0,p=0;const M=m;for(let e=k.length-1;e>=0;e--){const l=k[e];let n=u.x,i=u.y;if(M)if(l.bi!==M.id&&(l.bi=M.id,l.bm=0,l.bt=I(.9,1.7)),l.bt-=t,l.bt<=0&&(0===l.bm?(l.bm=1,l.bt=I(1.1,2.1)):(l.bm=0,l.bt=I(.9,1.7))),0===l.bm){const t=u.x-M.x,e=u.y-M.y,l=Math.hypot(t,e)||1;n=M.x+t/l*(M.r+8),i=M.y+e/l*(M.r+8)}else{const t=l.x-M.x,a=l.y-M.y,s=Math.hypot(t,a)||1;n=l.x+t/s*220+-a/s*Math.sin(2*g.t+e)*30,i=l.y+a/s*220+t/s*Math.sin(2*g.t+e)*30}else l.bi="",l.bt=0,l.bm=0;const a=n-l.x,s=i-l.y,r=Math.hypot(a,s)||1;let o=1,f=0,h=0;for(let t=0;t<P.length;t++){const e=P[t],n=l.x-e.x,i=l.y-e.y;if(n*n+i*i<e.r*e.r){h=e.m?1:0;const t=e.m?.36:.72;o=Math.min(o,1-t),f=1,e.m&&u.cat&&l.ce<=0&&(l.ce=.55,l.hp-=u.chBurst,J(l.x,l.y,"#ffd58f",5,44));break}}if(u.bot){const t=l.x-u.bx,e=l.y-u.by;t*t+e*e<400&&(o=Math.min(o,.65))}if(l.sl=f,f){const n=u.cat&&h?u.chDo:0;if(n>0&&(l.hp-=n*t),l.ht=Math.max(l.ht,.08),l.hp<=0){$(e,"#f7d96b",8,60);continue}}l.ce>0&&(l.ce=Math.max(0,l.ce-t)),l.vx*=Math.max(0,1-8*t),l.vy*=Math.max(0,1-8*t),l.ht=Math.max(0,l.ht-t),l.x+=(a/r*l.s*o+l.vx)*t,l.y+=(s/r*l.s*o+l.vy)*t,E(l,6)&&(l.vx*=.4,l.vy*=.4);const c=u.x-l.x,d=u.y-l.y;if((Math.hypot(c,d)||1)<l.r+u.r-1){if(u.zt>0){if(l.hp-=u.zDmg,l.ht=.12,l.vx+=280*u.zx,l.vy+=280*u.zy,y++,l.hp<=0){$(e,"#8fffe5",12,90,1),p++;continue}x+=.35*l.dmg;continue}x+=l.dmg}}var q;y>0&&(G(Math.min(.04,.012*y)),F(Math.min(.24,.04*y)),g.xpPulse=Math.min(.6,g.xpPulse+.06*y),d(260,.02,"square",.016),p>1&&d(310,.02,"square",.013)),x>0&&(q=x*t,u.zt>0&&(q*=u.zDr),u.hp-=q,F(.03),u.hp<=0&&(u.hp=0,g.dead=1,g.start=1,g.kills>g.best&&(g.best=0|g.kills,localStorage.ss_best=g.best),g.msg="You got swarmed",g.msgT=999,G(.09),F(.42),d(120,.22,"sawtooth",.05),J(u.x,u.y,"#ff6f89",26,130)));for(let e=v.length-1;e>=0;e--){const l=v[e],n=u.x-l.x,i=u.y-l.y,a=Math.hypot(n,i)||1;a<u.magnet&&(l.x+=n/a*240*t,l.y+=i/a*240*t),a<u.r+8&&(et(l.v),v.splice(e,1),g.xpPulse=Math.min(.5,g.xpPulse+.11),J(u.x,u.y,"#69f0c9",4,40),u.mkOn||(g.homeGot++,g.homeGot>=g.homeNeed&&(u.mkOn=1,u.mkT=.25,g.msg="territory unlocked: now visit newell-simon hall",g.msgT=2.2,d(820,.07,"triangle",.028),J(u.x,u.y,"#ffd56d",16,95))))}(b.gr||S)&&Math.random()<.04&&g.time>2&&Q({x:R(u.x+I(-20,20),12,2588),y:R(u.y+I(-20,20),12,1788),v:4,m:1,t:0})}(h),function(){const t=g.shake*g.shake,a=10*(2*Math.random()-1)*t,r=10*(2*Math.random()-1)*t;e.setTransform(i,0,0,i,a,r);const h=R(u.x-.5*l,0,2600-l),c=R(u.y-.5*n,0,1800-n),d=e.createLinearGradient(0,0,0,n);d.addColorStop(0,"#263f60"),d.addColorStop(.55,"#16273f"),d.addColorStop(1,"#0b111a"),e.fillStyle=d,e.fillRect(0,0,l,n),e.strokeStyle="rgba(63,96,132,.35)",e.lineWidth=1;const m=-h%56;for(let t=-c%56;t<n;t+=56)e.beginPath(),e.moveTo(0,0|t),e.lineTo(l,0|t),e.stroke();for(let t=m;t<l;t+=56)e.beginPath(),e.moveTo(0|t,0),e.lineTo(0|t,n),e.stroke();const x=s-h,y=900-c;e.fillStyle="rgba(105,240,201,.07)",e.beginPath(),e.arc(x,y,210,0,2*Math.PI),e.fill();for(let t=0;t<o.length;t++){const i=o[t],a=i.x-h,s=i.y-c;if(a<-i.r-30||s<-i.r-30||a>l+i.r+30||s>n+i.r+30)continue;const r="home"===i.id?0:2===g.sch[i.id],f="home"===i.id?!u.mkOn:1===g.sch[i.id];e.globalAlpha=r?.18:f?.14:.08,e.fillStyle=i.c,e.beginPath(),e.arc(a,s,i.r,0,2*Math.PI),e.fill(),e.globalAlpha=.65,e.strokeStyle=r?"#9effc8":i.c,e.lineWidth=2,e.beginPath(),e.arc(a,s,i.r,0,2*Math.PI),e.stroke(),e.globalAlpha=1,e.fillStyle="#dce8ff",e.font="600 12px Trebuchet MS,sans-serif",e.fillText(i.n,a-i.r+10,s-i.r-8);const d="home"===i.id?48:44,m=30,x=a-.5*d,y=s-.5*m;e.fillStyle="rgba(18,25,37,.9)",e.fillRect(x,y,d,m),e.strokeStyle="rgba(165,190,220,.55)",e.lineWidth=1,e.strokeRect(x+.5|0,y+.5|0,d-1,m-1),e.fillStyle="rgba(248,234,164,.86)",e.fillRect(x+6|0,y+6|0,11,8),e.fillRect(x+d-17|0,y+6|0,11,8),e.fillStyle="rgba(44,56,72,.95)",e.beginPath(),e.arc(x+11+Math.sin(2*g.t+t),y+11,1.7,0,2*Math.PI),e.fill(),e.beginPath(),e.arc(x+d-11+Math.sin(2*g.t+t+1),y+11,1.7,0,2*Math.PI),e.fill()}for(let t=0;t<v.length;t++){const i=v[t],a=i.x-h,s=i.y-c;a<-10||s<-10||a>l+10||s>n+10||(e.fillStyle="#69f0c9",e.beginPath(),e.arc(a,s,5,0,2*Math.PI),e.fill(),e.fillStyle="#ceffef",e.fillRect(a-1|0,s-1|0,2,2))}for(let t=0;t<P.length;t++){const i=P[t],a=i.x-h,s=i.y-c;if(a<-i.r-20||s<-i.r-20||a>l+i.r+20||s>n+i.r+20)continue;const r=i.t/i.d;e.globalAlpha=.12+.1*r;let o="#f4d96e",f="#fff0a9";u.cat&&(o=i.m?"#8fdd73":"#d9e87a",f=i.m?"#d8ffc8":"#f2f6bd"),e.fillStyle=o,e.beginPath(),e.arc(a,s,i.r,0,2*Math.PI),e.fill(),e.globalAlpha=.2+.2*Math.sin(5*(g.t+t))*r,e.strokeStyle=f,e.lineWidth=1.5,e.beginPath(),e.arc(a,s,.68*i.r+2*Math.sin(4*(g.t+t)),0,2*Math.PI),e.stroke(),e.globalAlpha=1}for(let t=0;t<k.length;t++){const i=k[t],a=i.x-h,s=i.y-c;a<-40||s<-40||a>l+40||s>n+40||(e.fillStyle=i.ht>0?"#9db4d1":i.sl?"#70805a":"#4b667f",e.beginPath(),e.arc(a,s,i.r,0,2*Math.PI),e.fill(),e.fillStyle="#f0627c",e.fillRect(a-4|0,s-2|0,3,3),e.fillRect(a+1|0,s-2|0,3,3))}for(let t=0;t<z.length;t++){const l=z[t],n=l.x-h,i=l.y-c;e.fillStyle=l.c||"#ffd56d",e.fillRect(n-2|0,i-2|0,4,4)}const p=u.x-h+u.rx,b=u.y-c+u.ry,M=Math.abs(u.vx)>=Math.abs(u.vy)?u.face>0?f.e:f.w:u.vy<0?u.face>0?f.ne:f.nw:u.face>0?f.se:f.sw;if(e.fillStyle="rgba(0,0,0,.35)",e.beginPath(),e.ellipse(p,b+14,17,6,0,0,2*Math.PI),e.fill(),M&&M.complete?e.drawImage(M,p-22,b-18,44,30):(e.fillStyle="#0b0f14",e.beginPath(),e.arc(p,b,12,0,2*Math.PI),e.fill(),e.fillStyle="#ef4f6c",e.fillRect(p+3|0,b-6|0,7,3)),u.bot){const t=u.bx-h,l=u.by-c;e.fillStyle="rgba(0,0,0,.25)",e.beginPath(),e.ellipse(t,l+8,11,4,0,0,2*Math.PI),e.fill(),e.fillStyle="#88ddff",e.beginPath(),e.arc(t,l,9,0,2*Math.PI),e.fill(),e.fillStyle="#16314a",e.fillRect(t-3|0,l-2|0,2,2),e.fillRect(t+1|0,l-2|0,2,2),e.strokeStyle="#dfffff",e.lineWidth=1.2,e.beginPath(),e.arc(t,l,12+1.5*Math.sin(9*g.t),0,2*Math.PI),e.stroke()}if(u.mkS>0&&u.zt<=0){const t=u.face>0?-1:1,l=R(u.mkS/.32,0,1),n=p+13*t,i=b+8,a=n+t*(11+2.2*Math.sin(36*g.t)),s=i+7+1.1*Math.sin(22*g.t);e.strokeStyle="rgba(248,220,112,"+(.38+.45*l)+")",e.lineWidth=2,e.beginPath(),e.moveTo(n,i),e.quadraticCurveTo(.5*(n+a),i+2,a,s),e.stroke(),e.fillStyle="rgba(250,214,103,.72)",e.beginPath(),e.arc(a+2*t,s+2,2.1,0,2*Math.PI),e.fill(),e.fillStyle="rgba(244,205,93,.38)",e.beginPath(),e.ellipse(a+5*t,s+7,5.2,2.7,0,0,2*Math.PI),e.fill()}if((u.zc>0||u.zcd>0)&&u.zt<=0){const t=u.zcd>0?0:Math.min(1,u.zc/u.zLoad),l=t<=0?Math.max(0,1-u.zcd/u.zCool):0,n=18+8*t+1.2*Math.sin(22*g.t);e.strokeStyle=u.zr?"#8fffe5":"#ffd56d",e.lineWidth=2+1.8*t,e.beginPath(),e.arc(p,b,n,.5*-Math.PI,.5*-Math.PI+2*Math.PI*t),e.stroke(),u.zcd>0&&(e.strokeStyle="rgba(158,200,255,.7)",e.lineWidth=2,e.beginPath(),e.arc(p,b,16,.5*-Math.PI,.5*-Math.PI+2*Math.PI*l),e.stroke())}if(u.zt>0){const t=u.zt/2;e.strokeStyle="rgba(143,255,229,.7)",e.lineWidth=2.5,e.beginPath(),e.arc(p,b,20+2*Math.sin(30*g.t)+4*t,0,2*Math.PI),e.stroke(),e.fillStyle="rgba(143,255,229,.16)",e.beginPath(),e.ellipse(p-10*u.zx,b-7*u.zy,20,10,Math.atan2(u.zy,u.zx),0,2*Math.PI),e.fill()}u.flash>0&&(e.globalAlpha=u.flash/.07,e.fillStyle="#ffe598",e.beginPath(),e.moveTo(p+16*u.gx,b+8*u.gy),e.lineTo(p+24*u.gx-5*u.gy,b+24*u.gy+4*u.gx),e.lineTo(p+24*u.gx+5*u.gy,b+24*u.gy-4*u.gx),e.closePath(),e.fill(),e.globalAlpha=1);for(let t=0;t<w.length;t++){const i=w[t],a=i.x-h,s=i.y-c;a<-8||s<-8||a>l+8||s>n+8||(e.globalAlpha=Math.max(0,Math.min(1,2.4*i.t)),e.fillStyle=i.c,e.fillRect(0|a,0|s,3,3))}e.globalAlpha=1;const I=44,O=l-18-I,W=l<420,E=W?118:104;let X=62,B=74;const Y=Math.max(96,l-190),H=10+E;if(e.fillStyle="rgba(7,10,16,.76)",e.fillRect(10,10,l-20,E),e.fillStyle="#eef4ff",e.font="700 17px Trebuchet MS,sans-serif",e.fillText("SCOTTY SURVIVAL",20,32),W){const t=52,n=(l-44)/3;e.font="600 13px Trebuchet MS,sans-serif",e.fillStyle="#9ec8ff",e.fillText("Time "+g.time.toFixed(1)+"s",20,t),e.fillStyle="#ffd56d",e.fillText("Kills "+g.kills,20+n,t),e.fillStyle="#69f0c9",e.fillText("Level "+g.level,20+2*n,t),e.textAlign="right",e.fillStyle="#dce8ff",e.fillText("Best "+g.best,l-24,68),e.textAlign="left",X=76,B=88}else e.font="600 14px Trebuchet MS,sans-serif",e.fillStyle="#9ec8ff",e.fillText("Time "+g.time.toFixed(1)+"s",20,54),e.fillStyle="#ffd56d",e.fillText("Kills "+g.kills,120,54),e.fillStyle="#69f0c9",e.fillText("Level "+g.level,200,54),e.textAlign="right",e.fillStyle="#dce8ff",e.fillText("Best "+g.best,l-24,54),e.textAlign="left";e.fillStyle="#2a3346",e.fillRect(20,X,Y,10),e.fillStyle="#ef4f6c",e.fillRect(20,X,Y*(u.hp/u.maxHp),10),e.fillStyle="#24374d",e.fillRect(20,B,Y,8),e.fillStyle="#69f0c9",e.fillRect(20,B,Y*(g.xp/g.nextXp),8);const F=u.mkOn?g.pz&&"nsh"===g.pz.id?"nsh puzzle: reconnect 3 terminals":g.pz&&"mel"===g.pz.id?"mellon puzzle: match reagent sequence":0===g.sch.nsh?"go to newell-simon hall":1===g.sch.nsh?"nsh: finish terminal task":0===g.sch.mel?"go to mellon institute":1===g.sch.mel?"mellon: finish reagent task":"phase 1 ready: bot buddy + chemical puddles active":"home base: collect mints "+g.homeGot+"/"+g.homeNeed;if(e.fillStyle="rgba(8,12,19,.62)",e.fillRect(14,H+4,l-28,26),e.fillStyle="#d7ffe8",e.font="600 12px Trebuchet MS,sans-serif",e.fillText(F,22,H+21),g.start&&!g.dead){const t=(t,l,n,i,a,s)=>{e.fillStyle="rgba(8,12,19,.92)",e.fillRect(O,t,I,I),e.strokeStyle=i?l:"rgba(129,157,187,.7)",e.lineWidth=2,e.strokeRect(O+.5,t+.5,43,43),e.strokeStyle="rgba(72,88,109,.85)",e.lineWidth=3,e.beginPath(),e.arc(O+22,t+22,14.96,0,2*Math.PI),e.stroke(),e.strokeStyle=l,e.beginPath(),e.arc(O+22,t+22,14.96,.5*-Math.PI,.5*-Math.PI+2*Math.PI*R(n,0,1)),e.stroke(),e.fillStyle=l,s<1?(e.beginPath(),e.moveTo(O+21.56,t+8.36),e.lineTo(O+.35*I,t+23.32),e.lineTo(O+21.56,t+23.32),e.lineTo(O+17.16,t+36.08),e.lineTo(O+29.48,t+18.04),e.lineTo(O+22.44,t+18.04),e.closePath(),e.fill()):(e.beginPath(),e.arc(O+22,t+19.36,4.4,0,2*Math.PI),e.fill(),e.beginPath(),e.moveTo(O+22,t+8.8),e.bezierCurveTo(O+30.36,t+19.8,O+28.16,t+29.48,O+22,t+34.32),e.bezierCurveTo(O+15.84,t+29.48,O+13.64,t+19.8,O+22,t+8.8),e.fill()),a>0?(e.fillStyle="#dce8ff",e.font="700 10px Trebuchet MS,sans-serif",e.fillText(a.toFixed(1)+"s",O+8,t+I-6)):i&&(e.fillStyle="rgba(255,255,255,.8)",e.beginPath(),e.arc(O+I-8,t+8,3,0,2*Math.PI),e.fill())};t(14,"#8fffe5",u.zcd>0?1-u.zcd/u.zCool:u.zr?1:u.zc/u.zLoad,u.zt>0,u.zcd>0?u.zcd:0,0);const l=u.mkOn?u.mkT>0?1-u.mkT/u.mkI:1:0;t(66,u.cat?u.catM?"#8fdd73":"#d9e87a":"#f4d96e",l,u.mkS>0,u.mkOn&&u.mkT>0?u.mkT:0,1),u.cat&&(e.fillStyle="rgba(7,10,16,.75)",e.fillRect(O-56,78,50,20),e.fillStyle="#dce8ff",e.font="600 10px Trebuchet MS,sans-serif",e.fillText(u.catM?"corr":"stick",O-50,91))}if(g.msgT>0&&(e.fillStyle="rgba(8,12,19,.74)",e.fillRect(14,H+34,l-28,28),e.fillStyle="#d7ffe8",e.font="600 13px Trebuchet MS,sans-serif",e.fillText(g.msg,22,H+53)),g.start&&!g.dead&&!g.lvup&&!g.pz){const t=T.x+T.tx,l=T.y+T.ty;e.fillStyle="rgba(7,11,17,.42)",e.beginPath(),e.arc(T.x,T.y,T.r+8,0,2*Math.PI),e.fill(),e.strokeStyle="rgba(158,200,255,.45)",e.lineWidth=2,e.beginPath(),e.arc(T.x,T.y,T.r,0,2*Math.PI),e.stroke(),e.fillStyle="rgba(105,240,201,"+(S?.65:.42)+")",e.beginPath(),e.arc(t,l,T.kr,0,2*Math.PI),e.fill(),e.strokeStyle="rgba(220,248,255,.65)",e.lineWidth=1.5,e.beginPath(),e.arc(t,l,T.kr,0,2*Math.PI),e.stroke()}if(!g.start){const t=20,i=.16*n,a=l-40,s=.68*n,r=t+16;e.fillStyle="rgba(6,9,14,.86)",e.fillRect(t,i,a,s),e.fillStyle="#fff",e.font="700 30px Trebuchet MS,sans-serif",e.fillText("what the dog doing",r,i+44),e.fillStyle="#9ec8ff",e.font="700 15px Trebuchet MS,sans-serif",e.fillText("lore",r,i+72),e.fillStyle="#d8e6ff",e.font="600 16px Trebuchet MS,sans-serif",A("night at cmu, deadly goop spread across campus paths.",r,i+94,a-32,20,2),A("students and professors are hiding inside the schools, and scotty is the only one fast enough to move between them.",r,i+134,a-32,20,3),e.fillStyle="#9ec8ff",e.font="700 15px Trebuchet MS,sans-serif",e.fillText("tutorial",r,i+182),e.fillStyle="#d8e6ff",e.font="600 16px Trebuchet MS,sans-serif",e.fillText("eat mints to get xp and level up",r,i+206),e.fillText("unlock territory at home base first",r,i+230),e.fillText("phase 1 schools: easy puzzle tasks at nsh + mellon",r,i+254),e.fillText("touch: left thumb joystick | keyboard: wasd, e, q, 1/2/3",r,i+278),e.fillStyle="#69f0c9",e.font="700 23px Trebuchet MS,sans-serif",e.fillText("tap or press space to start",r,i+338)}if(g.lvup&&!g.dead){e.fillStyle="rgba(6,10,15,.16)",e.fillRect(0,0,l,n);const t=D(),i=t.bx,a=t.by,s=t.bw,r=t.bh,o=t.rects,f=t.mobile;e.fillStyle="rgba(17,29,45,.95)",C(i,a,s,r,16),e.fill(),e.strokeStyle="rgba(90,125,163,.8)",e.lineWidth=1.2,C(i+.5,a+.5,s-1,r-1,16),e.stroke(),e.fillStyle="#ecf3ff",e.font=(f?"700 18px":"700 20px")+" Trebuchet MS,sans-serif",e.fillText("SCOTTY'S SKILL BOOK",i+14,a+24),e.fillStyle="#9ec8ff",e.font="600 12px Trebuchet MS,sans-serif",e.fillText("Choose one upgrade",i+14,a+39);for(let t=0;t<3;t++){const l=g.choices[t],n=o[t],i=.9+.1*q(R((g.cardT-.07*t)/.28,0,1)),a=n.x+.5*n.w,s=n.y+.5*n.h;if(e.save(),e.translate(a,s),e.scale(i,i),e.translate(-a,-s),e.fillStyle="rgba(27,44,66,.96)",C(n.x,n.y,n.w,n.h,10),e.fill(),e.strokeStyle="rgba(116,150,186,.85)",e.lineWidth=1.2,C(n.x+.5,n.y+.5,n.w-1,n.h-1,10),e.stroke(),l){const t=L(l.n)+" "+l.n;let i=f?16:17;for(;i>12&&(e.font="700 "+i+"px Trebuchet MS,sans-serif",!(e.measureText(t).width<=n.w-22));i--);e.fillStyle="#eef5ff",e.fillText(t,n.x+12,n.y+30),e.fillStyle="#a9c3e2",e.font="600 12px Trebuchet MS,sans-serif",A(l.d,n.x+12,n.y+48,n.w-24,14,2)}e.restore()}e.fillStyle="#95bce8",e.font="600 12px Trebuchet MS,sans-serif",e.fillText("Tap a choice or press 1/2/3",i+14,a+r-12)}if(g.pz&&!g.dead&&!g.lvup&&g.start){const t=K(),i=g.pz;if(e.fillStyle="rgba(5,9,14,.5)",e.fillRect(0,0,l,n),e.fillStyle="rgba(16,24,37,.96)",C(t.bx,t.by,t.bw,t.bh,14),e.fill(),e.strokeStyle="rgba(106,145,185,.85)",e.lineWidth=1.2,C(t.bx+.5,t.by+.5,t.bw-1,t.bh-1,14),e.stroke(),e.fillStyle="#ecf3ff",e.font="700 19px Trebuchet MS,sans-serif",e.fillText("nsh"===i.id?"nsh task: reconnect terminals":"mellon task: reagent order",t.bx+14,t.by+27),e.fillStyle="#9ec8ff",e.font="600 12px Trebuchet MS,sans-serif",e.fillText("simple puzzle: tap in order (easy)",t.bx+14,t.by+44),"nsh"===i.id){e.fillStyle="#dce8ff",e.font="600 12px Trebuchet MS,sans-serif",e.fillText("required order",t.bx+14,t.by+66);for(let l=0;l<i.seq.length;l++){const n=t.bx+24+34*l,a=t.by+86,s=l<i.step;e.fillStyle=s?"#8cffc2":"#79d7ff",e.beginPath(),e.arc(n,a,12,0,2*Math.PI),e.fill(),e.fillStyle="#12243a",e.font="700 11px Trebuchet MS,sans-serif",e.fillText(i.seq[l]+1+"",n-3,a+4)}}else{const l=["#8fd3ff","#ffd58f","#ff9fb7"];e.fillStyle="#dce8ff",e.font="600 12px Trebuchet MS,sans-serif",e.fillText("target mix",t.bx+14,t.by+66);for(let n=0;n<i.seq.length;n++){const a=t.bx+24+30*n,s=t.by+86,r=n<i.step;e.fillStyle=l[i.seq[n]],e.beginPath(),e.arc(a,s,10,0,2*Math.PI),e.fill(),r&&(e.strokeStyle="#8cffc2",e.lineWidth=2,e.beginPath(),e.arc(a,s,12,0,2*Math.PI),e.stroke())}}for(let l=0;l<3;l++){const n=t.btn[l];e.fillStyle="nsh"===i.id?"rgba(37,87,129,.96)":["#3c6588","#9a6f3f","#8e4f64"][l],C(n.x,n.y,n.w,n.h,10),e.fill(),e.strokeStyle="rgba(196,223,255,.72)",e.lineWidth=1.1,C(n.x+.5,n.y+.5,n.w-1,n.h-1,10),e.stroke(),e.fillStyle="#eef5ff",e.font="700 13px Trebuchet MS,sans-serif",e.fillText("nsh"===i.id?"terminal "+(l+1):["blue","amber","rose"][l],n.x+9,n.y+28)}e.fillStyle="#9ec8ff",e.font="600 11px Trebuchet MS,sans-serif",e.fillText("tap buttons or press 1/2/3",t.bx+14,t.by+t.bh-10)}g.dead&&(e.fillStyle="rgba(5,8,13,.86)",e.fillRect(24,.24*n,l-48,.5*n),e.fillStyle="#ff8298",e.font="700 33px Trebuchet MS,sans-serif",e.fillText("GAME OVER",.5*l-98,.38*n),e.fillStyle="#dce8ff",e.font="600 20px Trebuchet MS,sans-serif",e.fillText("Kills "+g.kills,.5*l-43,.47*n),e.fillText("Best "+g.best,.5*l-37,.53*n),e.fillStyle="#69f0c9",e.font="700 24px Trebuchet MS,sans-serif",e.fillText("Tap or press Space to retry",.5*l-139,.65*n))}(),requestAnimationFrame(t)})})();</script></body></html>